{"title":"druid配置详解","uid":"647a0ca593f8753976e4c6270337edb2","slug":"druid配置详解","date":"2022-06-22T12:57:50.000Z","updated":"2022-06-22T13:02:42.991Z","comments":true,"path":"api/articles/druid配置详解.json","keywords":null,"cover":"https://ts1.cn.mm.bing.net/th/id/R-C.291263adbc35be0c86be8bd5445c89bd?rik=sZo1SBCL7vul2w&riu=http%3a%2f%2fimg.mm4000.com%2ffile%2fa%2f6e%2fd8f786fcda.jpg%3fdown&ehk=gHj4HbgPFNBvkZNJCzeKDkRlbx27w7kK4rNHGQOi3KU%3d&risl=&pid=ImgRaw&r=0","content":"<h3 id=\"druid配置详解\"><a class=\"markdownIt-Anchor\" href=\"#druid配置详解\">#</a> druid 配置详解</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">属性</th>\n<th style=\"text-align:center\">说明</th>\n<th style=\"text-align:center\">建议值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">url</td>\n<td style=\"text-align:center\">数据库的 jdbc 连接地址。一般为连接 oracle/mysql。示例如下：</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">mysql : jdbc:mysql://ip:port/dbname?option1&amp;option2&amp;…</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">oracle : jdbc:oracle:thin:@ip:port:oracle_sid</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">username</td>\n<td style=\"text-align:center\">登录数据库的用户名</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">password</td>\n<td style=\"text-align:center\">登录数据库的用户密码</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">initialSize</td>\n<td style=\"text-align:center\">启动程序时，在连接池中初始化多少个连接</td>\n<td style=\"text-align:center\">10-50 已足够</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">maxActive</td>\n<td style=\"text-align:center\">连接池中最多支持多少个活动会话</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">maxWait</td>\n<td style=\"text-align:center\">程序向连接池中请求连接时，超过 maxWait 的值后，认为本次请求失败，即连接池</td>\n<td style=\"text-align:center\">100</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">没有可用连接，单位毫秒，设置 - 1 时表示无限等待</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">minEvictableIdleTimeMillis</td>\n<td style=\"text-align:center\">池中某个连接的空闲时长达到 N 毫秒后，连接池在下次检查空闲连接时，将</td>\n<td style=\"text-align:center\">见说明部分</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">回收该连接，要小于防火墙超时设置</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">net.netfilter.nf_conntrack_tcp_timeout_established 的设置</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">timeBetweenEvictionRunsMillis</td>\n<td style=\"text-align:center\">检查空闲连接的频率，单位毫秒，非正整数时表示不进行检查</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">keepAlive</td>\n<td style=\"text-align:center\">程序没有 close 连接且空闲时长超过 minEvictableIdleTimeMillis, 则会执</td>\n<td style=\"text-align:center\">true</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">行 validationQuery 指定的 SQL, 以保证该程序连接不会池 kill 掉，其范围不超</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">过 minIdle 指定的连接个数。</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">minIdle</td>\n<td style=\"text-align:center\">回收空闲连接时，将保证至少有 minIdle 个连接.</td>\n<td style=\"text-align:center\">与 initialSize 相同</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">removeAbandoned</td>\n<td style=\"text-align:center\">要求程序从池中 get 到连接后，N 秒后必须 close, 否则 druid 会强制回收该</td>\n<td style=\"text-align:center\">false, 当发现程序有未</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">连接，不管该连接中是活动还是空闲，以防止进程不会进行 close 而霸占连接。</td>\n<td style=\"text-align:center\">正常 close 连接时设置为 true</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">removeAbandonedTimeout</td>\n<td style=\"text-align:center\">设置 druid 强制回收连接的时限，当程序从池中 get 到连接开始算起，超过此</td>\n<td style=\"text-align:center\">应大于业务运行最长时间</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">值后，druid 将强制回收该连接，单位秒。</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">logAbandoned</td>\n<td style=\"text-align:center\">当 druid 强制回收连接后，是否将 stack trace 记录到日志中</td>\n<td style=\"text-align:center\">true</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">testWhileIdle</td>\n<td style=\"text-align:center\">当程序请求连接，池在分配连接时，是否先检查该连接是否有效。(高效)</td>\n<td style=\"text-align:center\">true</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">validationQuery</td>\n<td style=\"text-align:center\">检查池中的连接是否仍可用的 SQL 语句，drui 会连接到数据库执行该 SQL, 如果</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">正常返回，则表示连接可用，否则表示连接不可用</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">testOnBorrow</td>\n<td style=\"text-align:center\">程序 <strong>申请</strong> 连接时，进行连接有效性检查（低效，影响性能）</td>\n<td style=\"text-align:center\">false</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">testOnReturn</td>\n<td style=\"text-align:center\">程序 <strong>返还</strong> 连接时，进行连接有效性检查（低效，影响性能）</td>\n<td style=\"text-align:center\">false</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">poolPreparedStatements</td>\n<td style=\"text-align:center\">缓存通过以下两个方法发起的 SQL:</td>\n<td style=\"text-align:center\">true</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">public PreparedStatement prepareStatement(String sql)</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">public PreparedStatement prepareStatement(String sql,</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">int resultSetType, int resultSetConcurrency)</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">maxPoolPrepareStatementPerConnectionSize</td>\n<td style=\"text-align:center\">每个连接最多缓存多少个 SQL</td>\n<td style=\"text-align:center\">20</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">filters</td>\n<td style=\"text-align:center\">这里配置的是插件，常用的插件有:</td>\n<td style=\"text-align:center\">stat,wall,slf4j</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">监控统计: filter:stat</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">日志监控: filter:log4j 或者 slf4j</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">防御 SQL 注入: filter:wall</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">connectProperties</td>\n<td style=\"text-align:center\">连接属性。比如设置一些连接池统计方面的配置。</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">比如设置一些数据库连接属性:</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"配置示例\"><a class=\"markdownIt-Anchor\" href=\"#配置示例\">#</a> 配置示例</h3>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">driverClassName&#x3D;com.mysql.jdbc.Driver\nurl&#x3D;jdbc:mysql:&#x2F;&#x2F;&#x2F;db3?useSSL&#x3D;false&amp;useServerPrepStmts&#x3D;true\nusername&#x3D;root\npassword&#x3D;root\n#初始化连接数量\ninitialSize&#x3D;5\n#最大连接数\nmaxActive&#x3D;10\n#最大等待时间\nmaxWait&#x3D;3000<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","text":"# druid 配置详解 属性 说明 建议值 url 数据库的 jdbc 连接地址。一般为连接 oracle/mysql。示例如下： mysql : jdbc:mysql://ip:port/dbname?option1&amp;option2&amp;… oracle : jd...","link":"","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"JavaWeb","slug":"JavaWeb","count":10,"path":"api/categories/JavaWeb.json"}],"tags":[{"name":"JavaWeb","slug":"JavaWeb","count":10,"path":"api/tags/JavaWeb.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#druid%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3\"><span class=\"toc-text\"> druid 配置详解</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B\"><span class=\"toc-text\"> 配置示例</span></a></li></ol>","author":{"name":"cCor4ng3","slug":"blog-author","avatar":"http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/53BC80F5D1388E1A7955F40466B7F050.jpg","link":"/","description":"Fight 为 · Live","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"JavaWeb-Maven","uid":"de916a02e234c53ab1fc7473c41a0ed5","slug":"JavaWeb-Maven","date":"2022-06-23T13:37:21.000Z","updated":"2022-06-23T13:42:28.255Z","comments":true,"path":"api/articles/JavaWeb-Maven.json","keywords":null,"cover":"https://p.qpic.cn/dnfbbspic/0/dnfbbs_dnfbbs_dnf_gamebbs_qq_com_forum_201908_08_083118piqghztqtt5t15ap.jpg/0","text":"# 1、Maven 概述 Maven 是专门用于管理和构建 Java 项目的工具，它的主要功能有： 提供了一套标准化的项目结构 提供了一套标准化的构建流程（编译、测试、打包、发布） 提供了一套依赖管理机制 标准化项目结构： 标准化构建流程： 提供了一套依赖管理机制 Maven 简...","link":"","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"JavaWeb","slug":"JavaWeb","count":10,"path":"api/categories/JavaWeb.json"}],"tags":[{"name":"JavaWeb","slug":"JavaWeb","count":10,"path":"api/tags/JavaWeb.json"}],"author":{"name":"cCor4ng3","slug":"blog-author","avatar":"http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/53BC80F5D1388E1A7955F40466B7F050.jpg","link":"/","description":"Fight 为 · Live","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"JavaWeb-JDBC","uid":"4892e4a27a2575ab7f5b307cf40eb42d","slug":"JavaWeb-JDBC","date":"2022-06-22T12:55:59.000Z","updated":"2022-06-22T12:56:50.878Z","comments":true,"path":"api/articles/JavaWeb-JDBC.json","keywords":null,"cover":"https://macjpeg.macsc.com/macdown/pic/201909/24142951_c67bd569aa.jpeg","text":"# 1、JDBC 简介 JDBC 概念 JDBC 就是使用 Java 语言操作关系型数据库的一套 API 全称：（Java DataBase Connectivity）Java 数据库连接 JDBC 本质： 官方（Sun 公司）定义的一套操作所有关系型数据库的规则，即接口 各个数...","link":"","photos":[],"count_time":{"symbolsCount":"15k","symbolsTime":"14 mins."},"categories":[{"name":"JavaWeb","slug":"JavaWeb","count":10,"path":"api/categories/JavaWeb.json"}],"tags":[{"name":"JavaWeb","slug":"JavaWeb","count":10,"path":"api/tags/JavaWeb.json"}],"author":{"name":"cCor4ng3","slug":"blog-author","avatar":"http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/53BC80F5D1388E1A7955F40466B7F050.jpg","link":"/","description":"Fight 为 · Live","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}